!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("three"),require("axios")):"function"==typeof define&&define.amd?define([,"axios"],t):"object"==typeof exports?exports.engine=t(require("three"),require("axios")):e.engine=t(e.THREE,e.axios)}(window,function(e,t){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=51)}([function(t,r){t.exports=e},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0);var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"degreeToRadian",value:function(e){return e*(Math.PI/180)}},{key:"radianToDegree",value:function(e){return e*(180/Math.PI)}},{key:"webMercatorXToRadianLog",value:function(t){return t/e.EARTH_RADIUS}},{key:"webMercatorXToDegreeLog",value:function(t){var r=e.webMercatorXToRadianLog(t);return e.radianToDegree(r)}},{key:"webMercatorYToRadianLat",value:function(t){if(isNaN(t))throw{error:"webMercatorYToRadianLat",detail:t};var r=t/e.EARTH_RADIUS,n=Math.pow(Math.E,r);return 2*Math.atan(n)-Math.PI/2}},{key:"webMercatorYToDegreeLat",value:function(e){var t=this.webMercatorYToRadianLat(e);return this.radianToDegree(t)}},{key:"getTileWebMercatorEnvelopeByGrid",value:function(t,r,n){var o=e.EQUATOR/2,i=2*o/Math.pow(2,t),a=r*i-o,s=o-n*i;return{minX:a,minY:s-i,maxX:a+i,maxY:s}}},{key:"getWebMercatorGrid",value:function(e){}},{key:"webMercatorToDegreeGeographic",value:function(t,r){return[e.webMercatorXToDegreeLog(t),e.webMercatorYToDegreeLat(r)]}},{key:"getTileGeographicEnvelopByGrid",value:function(t,r,n){var o=e.getTileWebMercatorEnvelopeByGrid(t,r,n),i=e.webMercatorToDegreeGeographic(o.minX,o.minY),a=e.webMercatorToDegreeGeographic(o.maxX,o.maxY);return{minLon:i[0],minLat:i[1],maxLon:a[0],maxLat:a[1]}}},{key:"geographicToCartesianCoord",value:function(t,r,n){if(!(t>=-180.001&&t<=180.001)){console.warn(t);throw{error:"invalid lon",detail:"geographicToCartesianCoord"}}if(!(r>=-90.001&&r<=90.001)){console.warn(r);throw{error:"invalid lat",detail:"geographicToCartesianCoord"}}var o=e.degreeToRadian(t),i=e.degreeToRadian(r),a=Math.sin(o),s=Math.cos(o),u=Math.sin(i),l=Math.cos(i);return{x:n*a*l,y:n*u,z:n*s*l}}},{key:"geographicToEarthSurface",value:function(t,r,n,i){new o.Vector3;var a=e.getTileGridByGeographic(t,r,n),s=a.column,u=a.row;var l=e.getTileCartesianEnvelopByGrid(t,s,u,i),c=e.getTileGeographicEnvelopByGrid(t,s,u),f=l,h=c.maxLon-c.minLon,d=c.maxLat-c.minLat,p=r-c.minLon,v=c.maxLon-r,y=c.maxLat-n,m=n-c.minLat,g=f[2].clone().multiplyScalar(v/h).add(f[1].clone().multiplyScalar(p/h)),_=f[3].clone().multiplyScalar(v/h).add(f[0].clone().multiplyScalar(p/h));return g.multiplyScalar(m/d).add(_.multiplyScalar(y/d))}},{key:"geographicToEarthSurfaceByIntersection",value:function(t,r,n,i){var a=e.getTileGridByGeographic(t,r,n),s=a.column,u=a.row,l=e.getTileCartesianEnvelopByGrid(t,s,u,i);var c=l[0].clone(),f=l[1].clone(),h=l[2].clone(),d=c.clone().sub(f),p=h.clone().sub(f);var v=p.clone().cross(d).normalize();var y=-c.clone().sub(new o.Vector3(0,0,0)).dot(v);var m=new o.Plane(v,y),g=e.geographicToCartesianCoord(r,n,1.1*i),_=new o.Line3(new o.Vector3(0,0,0),g),b=new o.Vector3;return m.intersectLine(_,b),b}},{key:"getGeoNormalOnEarthSurface",value:function(t,r,n){var i=e.getTileGridByGeographic(t,r,n),a=i.column,s=i.row,u=e.getTileGeographicEnvelopByGrid(t,a,s);var l={lat:(u.minLat+u.maxLat)/2,lon:(u.minLon+u.maxLon)/2};var c=e.geographicToCartesianCoord(l.lon,l.lat,1);return(c=new o.Vector3(c.x,c.y,c.z)).normalize(),c}},{key:"getLocalSystemOnEarthSurface",value:function(t,r,n,i){var a=e.getTileGridByGeographic(t,r,n),s=a.column,u=a.row,l=e.getTileGeographicEnvelopByGrid(t,s,u);l.minLon,l.minLat,l.maxLon,l.maxLat;var c=e.getTileCartesianEnvelopByGrid(t,s,u,i);var f=c[0].clone(),h=c[1].clone(),d=c[2].clone(),p=f.clone().sub(h),v=d.clone().sub(h);var y=v.clone().cross(p).normalize();var m=-f.clone().sub(new o.Vector3(0,0,0)).dot(y);var g=new o.Plane(y,m),_=e.geographicToCartesianCoord(r,n,1.1*i),b=new o.Line3(new o.Vector3(0,0,0),_),w=new o.Vector3;g.intersectLine(b,w);var A=h.clone().sub(d).normalize(),x=y.clone().cross(A).normalize();y.clone().cross(A).normalize();return{origin:e.geographicToEarthSurface(t,r,n,i),lng:A,lat:x,alt:y}}},{key:"getTileCartesianEnvelopByGrid",value:function(t,r,n,i){var a=e.getTileGeographicEnvelopByGrid(t,r,n),s=[];s[3]=e.geographicToCartesianCoord(a.minLon,a.minLat,i),s[2]=e.geographicToCartesianCoord(a.minLon,a.maxLat,i),s[1]=e.geographicToCartesianCoord(a.maxLon,a.maxLat,i),s[0]=e.geographicToCartesianCoord(a.maxLon,a.minLat,i);for(var u=0;u<4;u++)s[u]=new o.Vector3(s[u].x,s[u].y,s[u].z);return s}},{key:"getTileCartesianEnvelopOnEarthSurface",value:function(t,r,n,i,a){var s=e.getTileGeographicEnvelopByGrid(t,r,n),u=[];u[3]=e.geographicToEarthSurface(a,s.minLon,s.minLat,i),u[2]=e.geographicToEarthSurface(a,s.minLon,s.maxLat,i),u[1]=e.geographicToEarthSurface(a,s.maxLon,s.maxLat,i),u[0]=e.geographicToEarthSurface(a,s.maxLon,s.minLat,i);for(var l=0;l<4;l++)u[l]=new o.Vector3(u[l].x,u[l].y,u[l].z),u[l].length()>1.5&&console.warn(arguments,s,u[l]);return u}},{key:"getTileCartesianGeometryOnEarthSurface",value:function(t,r,n,i,a,s){for(var u=e.getTileWebMercatorEnvelopeByGrid(t,r,n),l=[],c=[],f=[],h=[],d=(u.maxX-u.minX)/a,p=(u.maxY-u.minY)/a,v=1/a,y=[],m=[],g=[],_=[],b=0;b<=a;b++){y.push(u.minX+b*d),m.push(u.minY+b*p);var w=b*v;g.push(w),_.push(w)}for(var A=0;A<=a;A++)for(var x=0;x<=a;x++){var k=y[x],T=m[A],O=e.webMercatorToDegreeGeographic(k,T),E=e.geographicToEarthSurface(s,O[0],O[1],i);l.push(new o.Vector3(E.x,E.y,E.z)),f.push(new o.Vector2(g[x],_[A]))}for(var P=0;P<a;P++)for(var S=0;S<a;S++){var M=(a+1)*P+S,C=(a+1)*(P+1)+S,j=C+1,L=M+1,B=new o.Face3(j,C,M),R=new o.Face3(M,L,j);c.push(B,R),h.push([f[j],f[C],f[M]],[f[M],f[L],f[j]])}h.length!==c.length&&console.warn("unequal uvs and vertices");var I=new o.Geometry;return I.vertices=l,I.faces=c,I.faceVertexUvs[0]=h,(new o.BufferGeometry).fromGeometry(I)}},{key:"getTileCartesianGeometryByGrid",value:function(t,r,n,i,a){if(!function(){isNaN(a)&&(console.warn("segment not a number",a),a=1);(a=Math.floor(a))<=0||a>999?(console.warn("segment out of range",a,"level",t),a=1):a<1&&(a=1);return!0}())return console.error("getTileCartesianGeometryByGrid has error that cannot proceed"),null;for(var s=e.getTileWebMercatorEnvelopeByGrid(t,r,n),u=[],l=[],c=[],f=[],h=(s.maxX-s.minX)/a,d=(s.maxY-s.minY)/a,p=1/a,v=[],y=[],m=[],g=[],_=0;_<=a;_++){v.push(s.minX+_*h),y.push(s.minY+_*d);var b=_*p;m.push(b),g.push(b)}for(var w=0;w<=a;w++)for(var A=0;A<=a;A++){var x=v[A],k=y[w],T=e.webMercatorToDegreeGeographic(x,k),O=e.geographicToCartesianCoord(T[0],T[1],i);u.push(new o.Vector3(O.x,O.y,O.z)),c.push(new o.Vector2(m[A],g[w]))}for(var E=0;E<a;E++)for(var P=0;P<a;P++){var S=(a+1)*E+P,M=(a+1)*(E+1)+P,C=M+1,j=S+1,L=new o.Face3(C,M,S),B=new o.Face3(S,j,C);l.push(L,B),f.push([c[C],c[M],c[S]],[c[S],c[j],c[C]])}f.length!==l.length&&console.warn("unequal uvs and vertices");var R=new o.Geometry;return R.vertices=u,R.faces=l,R.faceVertexUvs[0]=f,(new o.BufferGeometry).fromGeometry(R)}},{key:"radianLogToWebMercatorX",value:function(t){if(!(!isNaN(t)&&t<=Math.PI+.001&&t>=-(Math.PI+.001))){throw{detail:"invalid radianLog"}}return e.EARTH_RADIUS*t}},{key:"degreeLogToWebMercatorX",value:function(t){if(!(!isNaN(t)&&t<=180.001&&t>=-180.001)){throw{detail:"invalid degreeLog"}}var r=e.degreeToRadian(t);return e.radianLogToWebMercatorX(r)}},{key:"radianLatToWebMercatorY",value:function(t){if(!(t<=Math.PI/2+.001&&t>=-(Math.PI/2+.001))){throw{detail:"invalid radianLat"}}var r=Math.PI/4+t/2,n=Math.tan(r),o=Math.log(n);return e.EARTH_RADIUS*o}},{key:"degreeLatToWebMercatorY",value:function(t){if(!(t<=90.001&&t>=-90.001)){throw{detail:"invalid degreeLat"}}var r=e.degreeToRadian(t);return e.radianLatToWebMercatorY(r)}},{key:"radianGeographicToWebMercator",value:function(t,r){return[e.radianLogToWebMercatorX(t),e.radianLatToWebMercatorY(r)]}},{key:"degreeGeographicToWebMercator",value:function(t,r){return[e.degreeLogToWebMercatorX(t),e.degreeLatToWebMercatorY(r)]}},{key:"numerationSystemTo10",value:function(e,t){return parseInt(t,e)}},{key:"numerationSystemFrom10",value:function(e,t){return t.toString(e)}},{key:"numerationSystemChange",value:function(t,r,n){var o=e.numerationSystemTo10(t,n);return e.numerationSystemFrom10(r,o)}},{key:"utmToWgs84",value:function(e,t,r){var n=r.split("_");if(2!==n.length)return{};var o=Number(n[0]),i=/[n-z]/i.test(n[1]);!1===i&&(t=1e7-t);var a=6378137,s=.081819191,u=.006739497,l=t/.9996/(a*(1-Math.pow(s,2)/4-3*Math.pow(s,4)/64-5*Math.pow(s,6)/256)),c=(1-Math.sqrt(1-s*s))/(1+Math.sqrt(1-s*s)),f=3*c/2-27*Math.pow(c,3)/32,h=21*Math.pow(c,2)/16-55*Math.pow(c,4)/32,d=151*Math.pow(c,3)/96,p=1097*Math.pow(c,4)/512,v=l+f*Math.sin(2*l)+h*Math.sin(4*l)+d*Math.sin(6*l)+p*Math.sin(8*l),y=a/Math.pow(1-Math.pow(s*Math.sin(v),2),.5),m=a*(1-s*s)/Math.pow(1-Math.pow(s*Math.sin(v),2),1.5),g=y*Math.tan(v)/m,_=5e5-e,b=_/(.9996*y),w=b*b/2,A=Math.pow(Math.tan(v),2),x=u*Math.pow(Math.cos(v),2),k=(5+3*A+10*x-4*x*x-9*u)*Math.pow(b,4)/24,T=(61+90*A+298*x+45*A*A-252*u-3*x*x)*Math.pow(b,6)/720,O=180*((_/(.9996*y)-(1+2*A+x)*Math.pow(b,3)/6+(5-2*x+28*A-3*Math.pow(x,2)+8*u+24*Math.pow(A,2))*Math.pow(b,5)/120)/Math.cos(v))/Math.PI,E=180*(v-g*(w+k+T))/Math.PI;return!1===i&&(E=-E),{latitude:E,longitude:o>0?6*o-183-O:3-O}}},{key:"sphericalToGeographic",value:function(t,r){var n=r,o=Math.PI/2-t;return[e.radianToDegree(n),e.radianToDegree(o)]}},{key:"earthSurfaceToGeographic",value:function(t,r,n){var i=!1;i&&console.log("target",r);var a=new o.Spherical;a.setFromVector3(r);var s=e.sphericalToGeographic(a.phi,a.theta),u=e.getTileGridByGeographic(t,s[0],s[1]),l=e.getTileCartesianEnvelopByGrid(t,u.column,u.row,n);i&&console.log("cart",l);var c=l[1].clone().sub(l[2]),f=l[0].clone().sub(l[3]),h=_(r,l[2],c),d=_(r,l[3],f);i&&console.log("dist",h,d);var p=h+d;h/=p,d/=p,i&&console.log("b1",h,"b2",d,"bsum",p);var v=new o.Vector3;v.lerpVectors(l[2],l[3],h);var y=new o.Vector3;y.lerpVectors(l[1],l[0],h);var m=r.distanceTo(v)/y.distanceTo(v);i&&console.log("a1",m);var g=e.getTileGeographicEnvelopByGrid(t,u.column,u.row,n);return{lng:g.minLon+(g.maxLon-g.minLon)*m,lat:g.minLat+(g.maxLat-g.minLat)*(1-h)};function _(e,t,r){t=t.clone(),r=r.clone().normalize(),e=e.clone(),i&&console.log("distanceTo",t,r,e);var n=t.clone().add(r.multiplyScalar(e.clone().sub(t).dot(r)));return i&&console.log("proj",n),n.distanceTo(e)}}},{key:"getNoneGroundCartesianFromLngLatAlt",value:function(t,r,n,i,a){new o.Vector3;var s=e.getTileGridByGeographic(t,r,n),u=s.column,l=s.row,c=e.getTileCartesianEnvelopByGrid(t,u,l,a),f=c[0].clone(),h=c[1].clone(),d=c[2].clone(),p=f.clone().sub(h),v=d.clone().sub(h).clone().cross(p).normalize();var y=e.getTileGeographicEnvelopByGrid(t,u,l),m=c,g=y.maxLon-y.minLon,_=y.maxLat-y.minLat,b=r-y.minLon,w=y.maxLon-r,A=y.maxLat-n,x=n-y.minLat,k=m[2].clone().multiplyScalar(w/g).add(m[1].clone().multiplyScalar(b/g)),T=m[3].clone().multiplyScalar(w/g).add(m[0].clone().multiplyScalar(b/g)),O=k.multiplyScalar(x/_).add(T.multiplyScalar(A/_)).clone().add(v.multiplyScalar(i*a/e.EARTH_RADIUS));return O}},{key:"getLngLatAltFromNoneGroundCartesian",value:function(t,r,n){var o=e.projectCartesianOntoEarthSurface(t,r.clone(),n),i=e.earthSurfaceToGeographic(t,o.clone(),n),a=r.clone().sub(o).length()*(r.length()>o.length()?1:-1)/n*e.EARTH_RADIUS;return{lng:i.lng,lat:i.lat,alt:a}}},{key:"projectCartesianOntoEarthSurface",value:function(t,r,n){var i=new o.Spherical;i.setFromVector3(r);var a=e.sphericalToGeographic(i.phi,i.theta),s=e.getTileGridByGeographic(t,a[0],a[1]),u=e.getTileCartesianEnvelopByGrid(t,s.column,s.row,n),l=u[0].clone(),c=u[1].clone(),f=u[2].clone(),h=l.clone().sub(c),d=f.clone().sub(c).clone().cross(h).normalize();return l.clone().sub(r).projectOnVector(d).add(r)}},{key:"getTileGridByGeographic",value:function(t,r,n){var o=e.degreeGeographicToWebMercator(r,n),i=e.EQUATOR/Math.pow(2,t),a=e.EQUATOR/2;return{column:Math.floor((o[0]+a)/i),row:Math.floor((a-o[1])/i)}}},{key:"EQUATOR",get:function(){return 40075016.686}},{key:"EARTH_RADIUS",get:function(){return 6378137}}]),e}();t.default=i},function(e,t,r){e.exports=function(){var e=e||function(e,t){var r=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),n={},o=n.lib={},i=o.Base={extend:function(e){var t=r(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},a=o.WordArray=i.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=void 0!=t?t:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,o=e.sigBytes;if(this.clamp(),n%4)for(var i=0;i<o;i++){var a=r[i>>>2]>>>24-i%4*8&255;t[n+i>>>2]|=a<<24-(n+i)%4*8}else for(var i=0;i<o;i+=4)t[n+i>>>2]=r[i>>>2];return this.sigBytes+=o,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=i.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var r,n=[],o=function(t){var t=t,r=987654321,n=4294967295;return function(){var o=((r=36969*(65535&r)+(r>>16)&n)<<16)+(t=18e3*(65535&t)+(t>>16)&n)&n;return o/=4294967296,(o+=.5)*(e.random()>.5?1:-1)}},i=0;i<t;i+=4){var s=o(4294967296*(r||e.random()));r=987654071*s(),n.push(4294967296*s()|0)}return new a.init(n,t)}}),s=n.enc={},u=s.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o++){var i=t[o>>>2]>>>24-o%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new a.init(r,t/2)}},l=s.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],o=0;o<r;o++){var i=t[o>>>2]>>>24-o%4*8&255;n.push(String.fromCharCode(i))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new a.init(r,t)}},c=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(l.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return l.parse(unescape(encodeURIComponent(e)))}},f=o.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=c.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r=this._data,n=r.words,o=r.sigBytes,i=this.blockSize,s=4*i,u=o/s,l=(u=t?e.ceil(u):e.max((0|u)-this._minBufferSize,0))*i,c=e.min(4*l,o);if(l){for(var f=0;f<l;f+=i)this._doProcessBlock(n,f);var h=n.splice(0,l);r.sigBytes-=c}return new a.init(h,c)},clone:function(){var e=i.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),h=(o.Hasher=f.extend({cfg:i.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new h.HMAC.init(e,r).finalize(t)}}}),n.algo={});return n}(Math);return e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(r(13)),a=r(6);var s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.tree,n=t.Type,o=void 0===n?i.default:n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._tree=r,this._Type=o}return o(e,[{key:"destruct",value:function(){return this._tree=void 0,this._Type=void 0,!0}},{key:"updateMaterial",value:function(){return this.tree.traverse(this.tree.root,function(e){return e.updateMaterial(),!0})}},{key:"generateTileMaterial",value:function(e){var t=n({},(0,a.filterDefined)(e.style),(0,a.filterDefined)(this.tree.style));return new this.Type(t)}},{key:"releaseMemoryOf",value:function(e){return!0}},{key:"tree",get:function(){return this._tree},set:function(e){this._tree=e}},{key:"Type",set:function(e){return this._Type=e,this.updateMaterial()},get:function(){return this._Type}}]),e}();t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.delayPromise=function(e){return function(t){return new Promise(function(r){return setTimeout(function(){return r(t)},e)})}},t.timedPromise=function(e,t){var r=new Promise(function(e,r){var n=setTimeout(function(){clearTimeout(n),r(new Error("Timed out in "+t+"ms."))},t)});return Promise.race([e,r])},t.throttle=function(e,t){var r=void 0,n=void 0,o=void 0;return function(){var i=this,a=arguments;r?(clearTimeout(n),n=setTimeout(function(){Date.now()-o>=t&&(e.apply(i,a),o=Date.now())},t-(Date.now()-o))):(e.apply(i,a),o=Date.now(),r=!0)}},t.debounce=function(e,t){var r=void 0;return function(){var n=this,o=arguments;clearTimeout(r),r=setTimeout(function(){return e.apply(n,o)},t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0);var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._parent=t,this._node=new o.Object3D,this._children=[],null!==t&&t.addChild(this),this.visible=!0,this._property={type:"HyperNode"}}return n(e,[{key:"destruct",value:function(){this._property.type="destructed";var e=!0;if(this.children&&this.children.length>0)for(var t=this.children.length-1;t>=0;t--)e=e&&this.children[t].destruct();return this._children=[],this.parent&&(e=e&&this.parent.removeChild(this)),this._parent=null,this._node=void 0,e||console.warn("HyperNode destruct failure."),e}},{key:"addChild",value:function(e){return-1!==this._children.indexOf(e)?(console.warn("Trying to add an exisitng child."),!1):(this._children.push(e),this._node.add(e.sceneNode),!0)}},{key:"removeChild",value:function(e){var t=this._children.indexOf(e);return-1===t?(console.warn("Trying to remove an un-exisitng child."),!1):(this._children.splice(t,1),this._node.remove(e.sceneNode),!0)}},{key:"applyToChildren",value:function(e,t,r,n){for(var o=!0,i=0;i<this._children.length;i++)o=e(this._children[i],t,r,n)&&o;return o}},{key:"traverse",value:function(e){var t=!0;t=e(this)&&t;for(var r=0;r<this._children.length;r++)t=this._children[r].traverse(e)&&t;return t}},{key:"traverseVisible",value:function(e){if(!1===this.visible)return!0;var t=!0;t=e(this)&&t;for(var r=0;r<this._children.length;r++)t=this._children[r].traverse(e)&&t;return t}},{key:"traverseAncestors",value:function(e){var t=this.parent,r=!0;return null!==t&&(r=e(t)&&r,r=t.traverseAncestors(e)&&r),r}},{key:"setMatrix",value:function(e,t){this.sceneNode.matrix.copy(e),this.sceneNode.matrixWorldNeedsUpdate=!0}},{key:"sceneUpdated",value:function(e){this.applyToChildren(function(e,t){e.sceneUpdated(t)},e)}},{key:"updateVisibility",value:function(e){this.applyToChildren(function(e,t){e.updateVisibility(t)},e)}},{key:"animate",value:function(e){this.applyToChildren(function(e,t){e.animate(t)},e)}},{key:"initInfo",value:function(){console.warn("HyperNode.initInfo is not implemented")}},{key:"sceneNode",get:function(){return this._node}},{key:"children",get:function(){return this._children}},{key:"parent",get:function(){return this._parent}},{key:"matrix",get:function(){return this.sceneNode.matrix}},{key:"matrixWorld",get:function(){return this.sceneNode.matrixWorld}},{key:"visible",get:function(){return this._visible},set:function(e){this._visible=e}},{key:"type",get:function(){return this._property.type}},{key:"property",get:function(){return JSON.parse(JSON.stringify(this._property))},set:function(e){this._property=JSON.parse(JSON.stringify(e))}},{key:"JSON",get:function(){for(var e=[],t=0;t<this.children.length;t++)e.push(this.children[t].JSON);return{property:this.property,children:e}}}]),e}();t.default=i},function(e,t,r){"use strict";function n(e){var t={};return Object.keys(e).filter(function(t){return void 0!==e[t]&&null!==e[t]}).forEach(function(r){t[r]=e[r]}),t}Object.defineProperty(t,"__esModule",{value:!0}),t.filterDefined=n,t.optionPadding=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e instanceof Object?Object.assign({},n(e),n(t)):e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={scale:1,resolution:6}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);var o=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{uniforms:n.ShaderLib.phong.uniforms,vertexShader:n.ShaderLib.phong.vertexShader,fragmentShader:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n        // #include <lights_fragment_begin>\n        GeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n        vec3 irradiance;\n        #if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n          PointLight pointLight;\n          float dotNL;\n          #pragma unroll_loop\n          for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n            pointLight = pointLights[ i ];\n            getPointDirectLightIrradiance( pointLight, geometry, directLight );\n            #ifdef USE_SHADOWMAP\n              directLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n            #endif\n            #ifdef TOON\n              irradiance = getGradientIrradiance( normal, normalize( pointLight.position + vViewPosition ) ) * directLight.color;\n            #else\n              dotNL = saturate( dot( normal, normalize( pointLight.position + vViewPosition ) ) );\n              irradiance = dotNL * directLight.color;\n            #endif\n            #ifndef PHYSICALLY_CORRECT_LIGHTS\n              irradiance *= PI;\n            #endif\n            reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n            reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n          }\n        #endif\n        #if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n        #if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n        #if defined( RE_IndirectDiffuse )\n\tirradiance = getAmbientLightIrradiance( ambientLightColor );\n        #if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearCoatRadiance = vec3( 0.0 );\n#endif\n\n        // ends here\n        #include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n"}));return r.fog=!0,r.lights=!0,r.isMeshPhongMaterial=!0,r.color=new n.Color(16777215),r.specular=new n.Color(1118481),r.shininess=30,r.map=null,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=null,r.aoMapIntensity=1,r.emissive=new n.Color(0),r.emissiveIntensity=1,r.emissiveMap=null,r.bumpMap=null,r.bumpScale=1,r.normalMap=null,r.normalMapType=n.TangentSpaceNormalMap,r.normalScale=new n.Vector2(1,1),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.specularMap=null,r.alphaMap=null,r.envMap=null,r.combine=n.MultiplyOperation,r.reflectivity=1,r.refractionRatio=.98,r.wireframe=!1,r.wireframeLinewidth=1,r.wireframeLinecap="round",r.wireframeLinejoin="round",r.skinning=!1,r.morphTargets=!1,r.morphNormals=!1,r.setValues(e),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.ShaderMaterial),t}();t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._version="0.0.1"}return n(e,null,[{key:"detectIE",value:function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);if(e.indexOf("Trident/")>0){var r=e.indexOf("rv:");return parseInt(e.substring(r+3,e.indexOf(".",r)),10)}var n=e.indexOf("Edge/");return n>0&&parseInt(e.substring(n+5,e.indexOf(".",n)),10)}},{key:"isMobile",get:function(){return!(!navigator||!navigator.userAgent)&&/iPhone|iPod|iPad|Android|BlackBerry/.test(navigator.userAgent)}},{key:"canvas",get:function(){return!!window.CanvasRenderingContext2D}},{key:"webgl",get:function(){return function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(e){return!1}}()}},{key:"workers",get:function(){return!!window.Worker}},{key:"browser",get:function(){return{isWeChat:navigator.userAgent.indexOf("MicroMessenger")>=0,isOpera:!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,isFirefox:"undefined"!=typeof InstallTrigger,isSafari:Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,isChrome:!!window.chrome,isIE:!!document.documentMode}}}]),e}();t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(r(5));var i=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r._property.type="HyperLayer",r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),n(t,[{key:"clear",value:function(){console.warn("clear is not implemented")}}]),t}();t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=s(r(72)),i=s(r(74)),a=r(4);function s(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(t){var r=t.FOREST_CAPACITY,n=t.CACHE_CAPACITY,o=t.MAX_DOWNLOAD_CONCURRENCY,a=t.MIN_AREA,s=t.MAX_LEVEL,u=t.allowWorker,l=t.trees,c=void 0===l?[]:l,f=t.name,h=void 0===f?"LodForest":f,d=t.debug,p=void 0!==d&&d;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=h,this.FOREST_CAPACITY=r,this.MAX_DOWNLOAD_CONCURRENCY=o,this.MIN_AREA=a,this.MAX_LEVEL=s,this.allowWorker=u,this.trees=c,this._numOfNodes=0,this.CACHE_CAPACITY=n,this.CACHE_CAPACITY<this.FOREST_CAPACITY+10&&(this.CACHE_CAPACITY=this.FOREST_CAPACITY+Math.min(100,Math.max(.4*this.FOREST_CAPACITY,10)),console.warn("Cache is too small. Resized to",this.CACHE_CAPACITY)),this.retriever=new i.default({cacheCapacity:this.CACHE_CAPACITY,dockCapacity:o,debug:p})}return n(e,[{key:"destruct",value:function(){var e=!0;return this.trees=[],e=e&&this.retriever.destruct(),this.retriever=null,e}},{key:"clear",value:function(){this.trees=[],this.retriever.clear()}},{key:"add",value:function(e){var t=this._indexOf(e);return-1===t?(this.trees.push(e),!0):(console.warn("tree already exists",e,t),!1)}},{key:"remove",value:function(e){var t=this._indexOf(e);return-1!==t&&(this.trees.splice(t,1),!0)}},{key:"applyToVisibleTrees",value:function(e,t){for(var r=!0,n=0;n<this.trees.length;n++)this.trees[n].visible&&(r=e(this.trees[n],t)&&r);return r}},{key:"sceneUpdated",value:function(e){var t=e.camera;if(0===this.trees.length)return!0;var r=this;return this._preUpdateTree({camera:t}).then((0,a.delayPromise)(10)).then(function(){return r._updateTree({camera:t})}).then((0,a.delayPromise)(10)).then(function(){return r._retrieveTiles()}).catch(function(e){return console.error(e),Promise.resolve()})}},{key:"_preUpdateTree",value:function(e){var t=this,r=e.camera;return new Promise(function(e,n){var o=t.applyToVisibleTrees(function(e){return!e.preSceneUpdate||e.preSceneUpdate({camera:r})});o?e(o):n(o)})}},{key:"_updateTree",value:function(e){var t=e.camera,r=this;return new Promise(function(e,n){r.__updateTree({camera:t})?e():n(new Error("LodForest::_updateTree"))})}},{key:"__updateTree",value:function(e){e.camera;var t=!0,r=new o.default(function(e,t){return t.key-e.key});this.applyToVisibleTrees(function(e){t=e.traverse(e.root,function(e){return e.needsPrune=!0,!0})&&t;var n=e.root,o=h(n),i={node:n,tree:e};r.enqueue(o,i)});var n=0;do{if(n>=this.FOREST_CAPACITY){0;break}var i=r.dequeue();if(void 0===i){0;break}var a=i.key,s=i.value.node,u=i.value.tree;if(a<this.MIN_AREA){0;break}if(s.needsPrune=!1,s.level<this.MAX_LEVEL&&s.level<u.maxLevel&&s.expandable){0===s.nodes.length&&(t=u.expand(s)&&t);for(var l=0;l<s.nodes.length;l++){var c=s.nodes[l];c.needsPrune=!0;var f=h(c);f>=this.MIN_AREA&&r.enqueue(f,{tree:u,node:c})}n+=s.nodes.length,this._numOfNodes=n}}while(!r.isEmpty());return r.clear(),r=void 0,this.applyToVisibleTrees(function(e){t=e.traverse(e.root,function(t){return!t.needsPrune||e.prune(t)})&&t}),t;function h(e){var t=e.screenArea;return e.ssArea=t,t}}},{key:"_retrieveTiles",value:function(){var e=this.retriever.abortPending(),t=this,r=new o.default(function(e,t){return t.key-e.key}),n=new o.default(function(e,t){return t.key-e.key});this.applyToVisibleTrees(function(e){var t=e.root.ssArea,o={tree:e,node:e.root};r.enqueue(t,o),n.enqueue(t,o)});for(var i=[];!r.isEmpty();){var a=r.dequeue(),s=p(a.value.tree,a.value.node);i.push(s)}for(;!n.isEmpty();)for(var u=n.dequeue(),l=u.value.tree,c=u.value.node.nodes,f=0;f<c.length;f++){var h=c[f],d=p(l,h);i.push(d),n.enqueue(h.ssArea,{tree:l,node:h})}return e.then(function(){return Promise.all(i)});function p(e,r){return t.retriever.request(r).then(function(t){if(!r.expired){if(!r.loaded){var n=r.digest(t);r.onContentLoaded(n),r.displayByload(),e.flags.modelInitialized||e._onContentInitialized()}return Promise.resolve()}return Promise.resolve()}).catch(function(e){return"[Dock] abortPending"===e.message||"timeout"===e.message||"expired"===e.message||console.warn("[Network unstable] LodForest._retrieveTiles",e),Promise.resolve()})}}},{key:"_indexOf",value:function(e){return(Array.prototype.indexOf?function(e,t){return e.indexOf(t)}:function(e,t){for(var r=0;r<e.length;r++)if(e[r]===t)return r;return-1})(this.trees,e)}},{key:"size",get:function(){return this._numOfNodes}}]),e}();t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(r(5));var i=function(e){function t(e,r){var n=r.name,o=void 0===n?"HyperEntity":n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.name=o,i._property.type="HyperEntity",i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),n(t,[{key:"initInfo",value:function(){return Promise.reject(new Error("initInfo not impelemented."))}},{key:"box",get:function(){return console.warn("HyperEntity.box is not impelemented"),null}},{key:"visible",set:function(e){!function e(t,r,n,o){var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);null!==a&&e(a,r,n,o)}else if("value"in i&&i.writable)i.value=n;else{var s=i.set;void 0!==s&&s.call(o,n)}return n}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visible",e,this),this._tree&&(this._tree.visible=e)},get:function(){return function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visible",this)}}]),t}();t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=r(6);var i=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.level,n=e.x,i=e.y,a=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(e,["level","x","y"]);!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=a.color,u=a.map,l=a.transparent,c=void 0!==l&&l,f=a.opacity,h=void 0===f?1:f,d=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,(0,o.filterDefined)({color:s,map:u,transparent:c,opacity:h})));return d.level=r,d.x=n,d.y=i,d}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.MeshBasicMaterial),t}();t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.polygonIntersectArea=function(e,t){var r=!1,n=0,o=0,i=0,a=5e4,s=a/2;return function(e,t){r&&console.log("a",e,"b",t);for(var s=e.length,l=t.length,c=[],f=s+1;f--;)c[f]=null;var v=[];for(f=l+1;f--;)v[f]=null;var _=new function(e,t){this.min=e,this.max=t}(new u(1/0,1/0),new u(-1/0,-1/0));if(s<3||l<3)return 0;h(e,_),h(t,_),r&&console.log("bbox",_);var b=_.max.x-_.min.x;o=a/b;var w=_.max.y-_.min.y,A=o*(i=a/w);r&&console.log("rngx",b,"rngy",w,"ascale",A),y(e,c,0,_),y(t,v,2,_),r&&console.log("ipa",c,"ipb",v);for(var x=0;x<s;++x)for(var k=0;k<l;++k)if(p(c[x].rx,v[k].rx)&&p(c[x].ry,v[k].ry)){var T=-d(c[x].ip,v[k].ip,v[k+1].ip),O=d(c[x+1].ip,v[k].ip,v[k+1].ip),E=T<0;if(E===O<0){var P=d(v[k].ip,c[x].ip,c[x+1].ip),S=-d(v[k+1].ip,c[x].ip,c[x+1].ip);P<0==S<0&&(E?m(c[x],c[x+1],v[k],v[k+1],T,O,P,S):m(v[k],v[k+1],c[x],c[x+1],P,S,T,O))}}return g(c,s,v,l),g(v,l,c,s),n/A}(e,t);function u(e,t){this.x=e,this.y=t}function l(e,t){this.mn=e,this.mx=t}function c(){this.x=0,this.y=0}function f(){this.ip=null,this.rx=null,this.ry=null,this.in=0}function h(e,t){for(var r=e.length;r--;)t.min.x=Math.min(t.min.x,e[r].x),t.min.y=Math.min(t.min.y,e[r].y),t.max.x=Math.max(t.max.x,e[r].x),t.max.y=Math.max(t.max.y,e[r].y)}function d(e,t,r){return t.x*r.y-t.y*r.x+e.x*(t.y-r.y)+e.y*(r.x-t.x)}function p(e,t){return e.mn<t.mx&&t.mn<e.mx}function v(e,t,r,o,i){n+=i*(r-e)*(o+t)/2}function y(e,t,r,n){for(var a=e.length,u=a;u--;)t[u]=new f,t[u].ip=new c,t[u].ip.x=-8&Math.floor((e[u].x-n.min.x)*o-s)|r|1&u,t[u].ip.y=-8&Math.floor((e[u].y-n.min.y)*i-s)|r;for(t[0].ip.y+=1&a,t[a]=t[0],u=a;u--;)t[u].rx=t[u].ip.x<t[u+1].ip.x?new l(t[u].ip.x,t[u+1].ip.x):new l(t[u+1].ip.x,t[u].ip.x),t[u].ry=t[u].ip.y<t[u+1].ip.y?new l(t[u].ip.y,t[u+1].ip.y):new l(t[u+1].ip.y,t[u].ip.y),t[u].in=0}function m(e,t,r,n,o,i,a,s){var u=o/(o+i),l=a/(a+s);v(Math.floor(e.ip.x+u*(t.ip.x-e.ip.x)),Math.floor(e.ip.y+u*(t.ip.y-e.ip.y)),t.ip.x,t.ip.y,1),v(n.ip.x,n.ip.y,Math.floor(r.ip.x+l*(n.ip.x-r.ip.x)),Math.floor(r.ip.y+l*(n.ip.y-r.ip.y)),1),++e.in,--r.in}function g(e,t,r,n){for(var o=0,i=n,a=e[0].ip;i--;)if(r[i].rx.mn<a.x&&a.x<r[i].rx.mx){var s=d(a,r[i].ip,r[i+1].ip)>0;o+=s!==r[i].ip.x<r[i+1].ip.x?0:s?-1:1}for(var u=0;u<t;++u)0!==o&&v(e[u].ip.x,e[u].ip.y,e[u+1].ip.x,e[u+1].ip.y,o),o+=e[u].in}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AtmosphereSelfShaderMaterial=t.GroundSelfShaderMaterial=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0);function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u={Kr:.0025,Km:.001,ESun:20,g:-.95,innerRadius:.999,outerRadius:1.00505,wavelength:[.65,.57,.475],scaleDepth:.25},l={uniforms:{v3LightPosition:{type:"v3",value:new o.Vector3(1,1,1).normalize()},focus:{type:"v3",value:new o.Vector3(0,0,0)},v3InvWavelength:{type:"v3",value:new o.Vector3(1/Math.pow(u.wavelength[0],4),1/Math.pow(u.wavelength[1],4),1/Math.pow(u.wavelength[2],4))},fInnerRadius:{type:"f",value:u.innerRadius},fInnerRadius2:{type:"f",value:u.innerRadius*u.innerRadius},fOuterRadius:{type:"f",value:u.outerRadius},fOuterRadius2:{type:"f",value:u.outerRadius*u.outerRadius},fKrESun:{type:"f",value:u.Kr*u.ESun},fKmESun:{type:"f",value:u.Km*u.ESun},fKr4PI:{type:"f",value:4*u.Kr*Math.PI},fKm4PI:{type:"f",value:4*u.Km*Math.PI},fScale:{type:"f",value:1/(u.outerRadius-u.innerRadius)},fScaleDepth:{type:"f",value:u.scaleDepth},fScaleOverScaleDepth:{type:"f",value:1/(u.outerRadius-u.innerRadius)/u.scaleDepth},g:{type:"f",value:u.g},g2:{type:"f",value:u.g*u.g},fNightScale:{type:"f",value:1},fExposure:{type:"f",value:2}},vertexShader_atmosphere:["// Atmospheric scattering vertex shader  // Author: Sean O'Neil  // Copyright (c) 2004 Sean O'Neil","uniform vec3 v3InvWavelength;","uniform float fOuterRadius;","uniform float fOuterRadius2;","uniform float fInnerRadius;","uniform float fInnerRadius2;","uniform float fKrESun;","uniform float fKmESun;","uniform float fKr4PI;","uniform float fKm4PI;","uniform float fScale;","uniform float fScaleDepth;","uniform float fScaleOverScaleDepth;","const int nSamples = 3;","const float fSamples = 3.0;","varying vec3 v3Direction;","varying vec3 c0;","varying vec3 c1;","varying float startDepth;","uniform vec3 v3LightPosition;","varying vec3 ncenter;","float scale(float fCos)","{","float x = 1.0 - fCos;","return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));","}","#include <logdepthbuf_pars_vertex>","void main(void)","{","vec3 modelPos = (modelMatrix * vec4(position, 1.0)).xyz;","ncenter = (modelMatrix * vec4(0, 0, 0, 1.0)).xyz;","vec3 translatedPosition = modelPos - ncenter;","vec3 translatedCameraPosition = cameraPosition - ncenter;","float fCameraHeight = max(0.0, length(cameraPosition - ncenter));","float fCameraHeight2 = pow(fCameraHeight, 2.0);","vec3 v3Ray = translatedPosition - translatedCameraPosition;","float fFar = length(v3Ray);","v3Ray /= fFar;","bool inSpace = fCameraHeight>fOuterRadius;","float B = 2.0 * dot(translatedCameraPosition, v3Ray);","float C = fCameraHeight2 - fOuterRadius2;","float fDet = max(0.0, B*B - 4.0 * C);","float fNear = 0.5 * (-B - sqrt(fDet));","fFar = inSpace ? fFar - fNear : fFar;","vec3 v3Start = inSpace ? translatedCameraPosition + v3Ray * fNear : translatedCameraPosition;","float fHeight = inSpace ? fOuterRadius : length(v3Start);","float fStartAngle = dot(v3Ray, v3Start) / fHeight;","float closeSurfaceDiff = min(0.0, (fInnerRadius - fHeight));","float fStartDepth = inSpace ? exp(-1.0 / fScaleDepth) : exp(fScaleOverScaleDepth * closeSurfaceDiff);","float fStartOffset = fStartDepth*scale(fStartAngle);","startDepth = clamp(fStartOffset,0.0,1.0);","float fSampleLength = fFar / fSamples;","float fScaledLength = fSampleLength * fScale;","vec3 v3SampleRay = v3Ray * fSampleLength;","vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;","vec3 v3FrontColor = vec3(0.0, 0.0, 0.0);","float fScatter;","float fDepth;","float fLightAngle;","float fCameraAngle;","vec3 v3Attenuate;","#pragma unroll_loop","for ( int i = 0; i < 3; i ++ ) {","fHeight = length(v3SamplePoint);","fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));","fLightAngle = dot(v3LightPosition, v3SamplePoint) / fHeight;","fCameraAngle = dot(v3Ray, v3SamplePoint) / fHeight;","fScatter = (fStartOffset + fDepth * (scale(fLightAngle) - scale(fCameraAngle)));","v3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));","v3FrontColor += v3Attenuate * (fDepth * fScaledLength);","v3SamplePoint += v3SampleRay;","}","vec3 transformed = vec3( position );","vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );","gl_Position = projectionMatrix * mvPosition;","c0 = v3FrontColor * (v3InvWavelength * fKrESun);","c1 = v3FrontColor * fKmESun;","v3Direction = translatedCameraPosition - translatedPosition;","#include <logdepthbuf_vertex>","}"].join("\n"),fragmentShader_atmosphere:["// Atmospheric scattering vertex shader  // Author: Sean O'Neil  // Copyright (c) 2004 Sean O'Neil","uniform float fExposure;","uniform vec3 v3LightPosition;","uniform float g;","uniform float g2;","uniform float fOuterRadius;","varying vec3 v3Direction;","varying vec3 c0;","varying vec3 c1;","varying float startDepth;","varying vec3 ncenter;","float getMiePhase(float fCos, float fCos2, float g, float g2)","{","return 1.5 * ((1.0 - g2) / (2.0 + g2)) * (1.0 + fCos2) / pow(max(0.0, 1.0 + g2 - 2.0 * g * fCos), 1.5);","}","float getRayleighPhase(float fCos2)","{","return 0.75 + 0.75 * fCos2;","}","#include <logdepthbuf_pars_fragment>","void main (void)","{","#include <logdepthbuf_fragment>","float fCameraHeight = length(cameraPosition - ncenter);","float fCos = dot(v3LightPosition, v3Direction) / length(v3Direction);","float fCos2 = fCos * fCos;","float rayleighPhase = getRayleighPhase(fCos2);","float miePhase = getMiePhase(fCos, fCos2, g, g2);","float sun = 2.0*((1.0 - 0.2) / (2.0 + 0.2)) * (1.0 + fCos*fCos) / pow(max(0.0, 1.0 + 0.2 - 2.0*(-0.2)*fCos), 1.0);","vec3 color = rayleighPhase * c0 +            miePhase * c1 +            startDepth * sun * vec3(0.05,0.05,0.1);","color = vec3(1.0) - exp(-fExposure*color);","float nightmult = clamp(max(color.x, max(color.y, color.z))*1.5,0.0,1.0);","gl_FragColor = vec4(color, nightmult);","gl_FragColor.a = fCameraHeight<=fOuterRadius ? nightmult + fOuterRadius - fCameraHeight : gl_FragColor.a;","}"].join("\n"),vertexShader_ground:["// Atmospheric scattering vertex shader  // Author: Sean O'Neil  // Copyright (c) 2004 Sean O'Neil  // Ported for use with three.js/WebGL by James Baicoianu","uniform vec3 v3LightPosition;","uniform vec3 v3InvWavelength;","uniform float fOuterRadius;","uniform float fOuterRadius2;","uniform float fInnerRadius;","uniform float fInnerRadius2;","uniform float fKrESun;","uniform float fKmESun;","uniform float fKr4PI;","uniform float fKm4PI;","uniform float fScale;","uniform float fScaleDepth;","uniform float fScaleOverScaleDepth;","uniform sampler2D tDiffuse;","varying vec3 c0;","varying vec3 c1;","varying vec2 vUv;","const int nSamples = 3;","const float fSamples = 3.0;","float scale(float fCos)","{","float x = 1.0 - fCos;","return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));","}","#include <logdepthbuf_pars_vertex>","void main(void)","{","vec3 ncenter = (modelMatrix * vec4(0, 0, 0, 1.0)).xyz;","vec3 modelPos = (modelMatrix * vec4(position, 1.0)).xyz;","vec3 translatedPosition = modelPos - ncenter;","vec3 translatedCameraPosition = cameraPosition - ncenter;","float fCameraHeight = max(0.0, length(cameraPosition - ncenter));","float fCameraHeight2 = pow(fCameraHeight, 2.0);","vec3 v3Ray = translatedPosition - translatedCameraPosition;","float fFar = length(v3Ray);","v3Ray /= fFar;","bool inSpace = fCameraHeight>fOuterRadius;","float B = 2.0 * dot(translatedCameraPosition, v3Ray);","float C = fCameraHeight2 - fOuterRadius2;","float fDet = max(0.0, B*B - 4.0 * C);","float fNear = 0.5 * (-B - sqrt(fDet));","fFar = inSpace ? fFar - fNear : fFar;","vec3 v3Start = inSpace ? translatedCameraPosition + v3Ray * fNear : translatedCameraPosition;","float fDepth = exp((fInnerRadius - fOuterRadius) / fScaleDepth);","float fCameraAngle = dot(-v3Ray, translatedPosition) / length(translatedPosition);","float fLightAngle = dot(v3LightPosition, translatedPosition) / length(translatedPosition);","float fCameraScale = scale(fCameraAngle);","float fLightScale = scale(fLightAngle);","float fCameraOffset = fDepth*fCameraScale;","float fTemp = (fLightScale + fCameraScale);","float fSampleLength = fFar / fSamples;","float fScaledLength = fSampleLength * fScale;","vec3 v3SampleRay = v3Ray * fSampleLength;","vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;","vec3 v3FrontColor = vec3(0.0, 0.0, 0.0);","vec3 v3Attenuate;","float fHeight;","float fScatter;","float closeSurfaceDiff;","#pragma unroll_loop","for ( int i = 0; i < 3; i ++ ) {","fHeight = length(v3SamplePoint);","closeSurfaceDiff = min(0.6 * (fInnerRadius - fOuterRadius), (fInnerRadius - fHeight));","fDepth = exp(fScaleOverScaleDepth * closeSurfaceDiff);","fCameraOffset = clamp(fCameraOffset, -0.1, 0.1);","fScatter = fDepth*fTemp - fCameraOffset;","v3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));","v3FrontColor += v3Attenuate * (fDepth * fScaledLength);","v3SamplePoint += v3SampleRay;","}","c0 = v3Attenuate;","c1 = v3FrontColor * (v3InvWavelength * fKrESun + fKmESun);","vec3 transformed = vec3( position );","vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vUv = uv;","#include <logdepthbuf_vertex>","}"].join("\n"),fragmentShader_ground:["// Atmospheric scattering fragment shader  // Author: Sean O'Neil  // Copyright (c) 2004 Sean O'Neil  // Ported for use with three.js/WebGL by James Baicoianu","uniform float fNightScale;","uniform sampler2D tDiffuse;","varying vec3 c0;","varying vec3 c1;","varying vec2 vUv;","uniform float fExposure;","#include <logdepthbuf_pars_fragment>","void main (void)","{","#include <logdepthbuf_fragment>","vec3 diffuseTex = texture2D( tDiffuse, vUv ).xyz;","vec3 diffuseNightTex = diffuseTex * 0.1;","vec3 day = diffuseTex * c0;","vec3 night = fNightScale * diffuseNightTex * diffuseNightTex * diffuseNightTex * (1.0 - c0);","vec3 color = c1 + day + night;","color = 1.0 - exp(-fExposure * color);","gl_FragColor = vec4(color, 1.0);","}"].join("\n")},c=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.level,n=e.x,s=e.y,u=e.flatShading;i(this,t);var c=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return c.uniforms=l.uniforms,c.vertexShader=l.vertexShader_atmosphere,c.fragmentShader=l.fragmentShader_atmosphere,c.transparent=!0,c.extensions.derivatives=!0,c.side=o.BackSide,c.level=r,c.x=n,c.y=s,c.flatShading=u,c}return s(t,o.ShaderMaterial),t}(),f=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.map,n=e.level,o=e.x,s=e.y,u=e.flatShading,c=e.transparent,f=void 0!==c&&c;i(this,t);var h=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return h.uniforms=Object.assign({},l.uniforms,{tDiffuse:{type:"t",value:r}}),h.vertexShader=l.vertexShader_ground,h.fragmentShader=l.fragmentShader_ground,h.transparent=f,h.extensions.derivatives=!0,h.level=n,h.x=o,h.y=s,h.flatShading=u,h}return s(t,o.ShaderMaterial),n(t,[{key:"map",set:function(e){this.uniforms.tDiffuse.value=e},get:function(){return this.uniforms.tDiffuse.value}},{key:"sun",set:function(e){this.uniforms.v3LightPosition.value.copy(e)},get:function(){return this.uniforms.v3LightPosition.value}}]),t}();t.GroundSelfShaderMaterial=f,t.AtmosphereSelfShaderMaterial=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.solidColorTexture=t.loadUVMap=void 0;var n=r(0),o=null;t.loadUVMap=function(){return o||(o=function(){var e=new n.TextureLoader;return new Promise(function(t,r){e.load("../public/img/UV_Grid_Sm.jpg",function(e){e.wrapS=e.wrapT=n.RepeatWrapping,t(e)},void 0,function(e){r(e)})})}()),o},t.solidColorTexture=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:40,o=new Uint8Array(3);o[0]=e,o[1]=t,o[2]=r;var i=new n.DataTexture(o,1,1,n.RGBFormat);return i.needsUpdate=!0,i}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=function(){function e(t){var r=t.key,n=t.value,o=t.weight,i=void 0===o?100:o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._key=r,this._value=n,this._weight=i}return n(e,[{key:"destruct",value:function(){return this._key=void 0,this._value=void 0,this._weight=0,!0}},{key:"weight",get:function(){return this._weight}},{key:"value",get:function(){return this._value}},{key:"valid",get:function(){return console.warn("CacheEntry::valid not implemented."),!0}}]),e}();t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={disposeMesh:function(e){e&&(e.geometry&&e.geometry.dispose&&e.geometry.dispose(),e.material&&(e.material.map&&e.material.map.dispose&&(e.material.map.dispose(),e.material.map=void 0),e.material.alphaMap&&e.material.alphaMap.dispose&&(e.material.alphaMap.dispose(),e.material.alphaMap=void 0),e.material.dispose&&e.material.dispose()))}};t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=s(r(87)),i=r(0),a=s(r(1));function s(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e,r){var n=r.name,o=void 0===n?"ProjectEntity":n,s=r.forest,u=r.earthScale,l=r.earthResolution,c=r.position;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var f=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,{name:o}));return void 0===c.alt&&(c.alt=0),f.name="ProjectEntity",f._tree=null,f._forest=s,f._treeNode=new i.Object3D,f._treeNode.add(new i.AxesHelper(1e3)),f.displayHolder=new i.Object3D,f.displayHolder.add(f._treeNode),f.sceneNode.add(f.displayHolder),f.sceneNode.applyMatrix(function(){var e=a.default.getLocalSystemOnEarthSurface(l,c.lng,c.lat,u),t=a.default.getNoneGroundCartesianFromLngLatAlt(l,c.lng,c.lat,c.alt,u),r=new i.Matrix4;r.makeBasis(e.lng,e.lat,e.alt),r.setPosition(t);var n=u/a.default.EARTH_RADIUS;return r.scale(new i.Vector3(n,n,n)),r}()),f}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),n(t,[{key:"destruct",value:function(){return this.sceneNode.remove(this.displayHolder),this.displayHolder.remove(this._treeNode),this._forest=void 0,function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"import",value:function(){return Promise.reject(new Error("Not implemented"))}},{key:"treeNode",get:function(){return this._treeNode}},{key:"material",get:function(){if(this._tree)return this._tree.material;console.warn("Tree is not created, material not ready.")},set:function(e){this._tree?this._tree.material=e:console.warn("Tree is not ready.")}}]),t}();t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(r(8)),o=r(6);var i=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.level,n=e.x,i=e.y,a=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(e,["level","x","y"]);!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=a.transparent,u=void 0!==s&&s,l=a.opacity,c=a.color,f=a.map,h=a.emissive,d=a.emissiveMap,p=a.specular,v=a.specularMap,y=a.shininess,m=a.flatShading,g=void 0!==m&&m,_=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,(0,o.filterDefined)({transparent:u,opacity:l,color:c,map:f,emissive:h,emissiveMap:d,specular:p,specularMap:v,shininess:y,flatShading:g})));return _.level=r,_.x=n,_.y=i,_}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.default),t}();t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.disposeMap=t.disposeMaterial=t.extractMaterialParams=void 0;var n=r(6),o=r(0),i=function(e,t){var r=void 0;switch(t){case"standard":r=a(e);break;case"phong":r=s(e);break;default:console.warn("Unknown type",t),r=s(e)}return r},a=function(e){var t=Object.assign({},{opacity:1,map:null},{opacity:e.opacity,color:e.color,map:e.map,emissive:e.emissive,metalness:e.metalness,roughness:e.roughness,emissiveIntensity:e.shininess});return t.opacity<1?t.transparent=!0:t.transparent=!1,(0,n.filterDefined)(t)},s=function(e){var t={opacity:1,emissive:new o.Color(1,1,1),color:new o.Color(1,1,1),map:null},r=Object.assign({},t,{opacity:e.opacity||e.d,emissive:e.emissive||i(e.Ka),emissiveMap:e.emissiveMap||i(e.map_Ka),color:e.color||i(e.Kd),map:e.map||e.map_Kd,specular:e.specular||i(e.Ks),specularMap:e.specularMap||e.map_Ks,shininess:e.shininess||e.Ns});function i(e){if(e&&e instanceof Array&&3===e.length)return new o.Color(e[0]/255,e[1]/255,e[2]/255)}return r.opacity<1?r.transparent=!0:r.transparent=!1,(0,n.filterDefined)(r)};t.extractMaterialParams=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"standard";return e instanceof Array?e.map(function(e){return i(e,t)}):i(e,t)},t.disposeMaterial=function(e){return e instanceof Array?e.forEach(function(e){e.dispose()}):e.dispose(),!0},t.disposeMap=function(e){return e instanceof Array?e.forEach(function(e){t(e)}):t(e),!0;function t(e){["map","emissiveMap","specularMap"].forEach(function(t){e[t]&&(e[t].dispose(),e[t]=null)})}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stringToTexture=t.stringsToTextures=t.loadTexture=void 0;var n=function(){var e=s(regeneratorRuntime.mark(function e(t){var r,n,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(a in r={},n=[],i=function(e){var i=o(t[e]).then(function(t){return r[e]=t,Promise.resolve()}).catch(function(t){return console.warn(t),r[e]=null,Promise.resolve()});n.push(i)},t)i(a);return e.abrupt("return",Promise.all(n).then(function(){return Promise.resolve(r)}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),o=function(){var e=s(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return window&&(r=window.URL||window.webkitURL),n=new a.TextureLoader,e.abrupt("return",new Promise(function(e,o){n.load(t,function(n){r&&r.revokeObjectURL(t),n.wrapS=n.wrapT=a.RepeatWrapping,e(n)},void 0,function(e){o(e)})}));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),i=r(4),a=r(0);function s(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,i){try{var a=t[o](i),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}t.loadTexture=function(e){var t=e.textureUrl,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12e4,n=new Promise(function(e,r){var n=new a.TextureLoader;n.setCrossOrigin("anonymous"),n.withCredentials=!0,n.load(t,function(t){e(t)},function(e){console.log(e.loaded/e.total*100+"% loaded")},function(e){r(e)})});return(0,i.timedPromise)(n,r)},t.stringsToTextures=n,t.stringToTexture=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0},i=f(r(35)),a=f(r(95)),s=r(0),u=r(96),l=r(22),c=f(r(97));function f(e){return e&&e.__esModule?e:{default:e}}function h(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function d(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,i){try{var a=t[o](i),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}var p=function(e){function t(e){var r=e.parent,n=e.name,o=e.fileDirectory,i=void 0===o?null:o,a=e.fileName,s=e.showBBox,u=void 0!==s&&s,l=e.depth,c=e.estimatedBBox,f=void 0===c?null:c,h=e.sharedOptions;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var d=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:r,name:n,sharedOptions:h}));return d._fileDirectory=i,d.fileName=a,d._showBBox=u,d._bbox=null,d._estimatedBBox=f,d._nextLevelParams=null,d._depth=l,d.contentLoaded.then(function(){d._showBBox&&d._displayBBox()}),d}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),n(t,[{key:"destruct",value:function(){return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"downloading",value:function(){var e=d(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.debug&&console.log("download"),t=this.resourceKey,r=this.TILE_DOWNLOAD_TIMEOUT,e.abrupt("return",this.loadWorker.load({resourceKey:t,timeout:r}));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"cook",value:function(){var e=d(regeneratorRuntime.mark(function e(t){var r,n,o,i,u,f,d,p,m,g,_,b=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.osgGeometry,n=t.groups,o=t.materials,i=t.nextLevelParams.map(function(e){var t=(0,c.default)(e.fileName),r=t.match(/(.*)[/\\]/);return{fileDirectory:r?b.resourceDirectory+r[0]:b.resourceDirectory,fileName:t.replace(/^.*[\\/]/,""),estimatedBBox:new s.Box3(new(Function.prototype.bind.apply(s.Vector3,[null].concat(h(e.estimatedBBox.min)))),new(Function.prototype.bind.apply(s.Vector3,[null].concat(h(e.estimatedBBox.max)))))}}),u=t.images,f=t.bbox,d=v({osgGeometry:r,groups:n}),e.next=9,(0,l.stringsToTextures)(u);case 9:return p=e.sent,(m=y(o,p)).needsUpdate=!0,g=new s.Box3(new(Function.prototype.bind.apply(s.Vector3,[null].concat(h(f.min)))),new(Function.prototype.bind.apply(s.Vector3,[null].concat(h(f.max))))),_={key:this.resourceKey,value:{geometry:d,material:m,nextLevelParams:i,bbox:g},weight:1},e.abrupt("return",Promise.resolve(new a.default(_)));case 15:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"defaultCooked",value:function(){var e=d(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new a.default({key:this.resourceKey,value:{isPlaceHolder:!0},weight:1,is404:this.is404}),e.abrupt("return",Promise.resolve(t));case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"digest",value:function(e){if(e.is404)return this.is404=e.is404,new s.Object3D;var t=e.value.geometry,r=e.value.material;return this._bbox=e.value.bbox,this.visibilityNeedsUpdate=!0,this.screenAreaNeedsUpdate=!0,this._nextLevelParams=e.value.nextLevelParams,new s.Mesh(t,r)}},{key:"_updateVisibility",value:function(){return!this.is404&&(this._bbox?this.frustumInTree.intersectsBox(this._bbox):!this._estimatedBBox||this.frustumInTree.intersectsBox(this._estimatedBBox))}},{key:"_updateScreenArea",value:function(){return this.is404?0:this._bbox?(0,u.boxScreenArea)(this._bbox,this.treeToScreen,this.level):this._estimatedBBox?(0,u.boxScreenArea)(this._estimatedBBox,this.treeToScreen,this.level):0}},{key:"spawn",value:function(){var e=this,r=this.depth+1;return this._nextLevelParams.forEach(function(n,o){var i={parent:e,name:n.fileName,fileDirectory:n.fileDirectory,fileName:n.fileName,depth:r,estimatedBBox:n.estimatedBBox,sharedOptions:e.sharedOptions};e.nodes[o]=new t(i)}),!0}},{key:"_displayBBox",value:function(){if(!this.__box3helper&&this._bbox){var e=255<<this.depth%3*8;this._nextLevelParams&&0!==this._nextLevelParams.length||(e=16777215),this.__box3helper=new s.Box3Helper(this._bbox,e),this.decoHolder.add(this.__box3helper)}}},{key:"_destroyBBox",value:function(){this.__box3helper&&(this.decoHolder.remove(this.__box3helper),this.__box3helper.geometry.dispose(),this.__box3helper.material.dispose(),this.__box3helper=void 0)}},{key:"resourceKey",get:function(){return this.resourceDirectory+this.fileName}},{key:"resourceDirectory",get:function(){return this._fileDirectory?this._fileDirectory:this.osgInfo.dataPath}},{key:"tileName",get:function(){var e=this.fileName;return e=e.replace(/\.[^/.]+$/,"")}},{key:"expandable",get:function(){return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"expandable",this)&&this.loaded&&null!==this._nextLevelParams&&this._nextLevelParams.length>0}},{key:"depth",get:function(){return this._depth}},{key:"level",get:function(){return this.depth}},{key:"osgInfo",get:function(){return this.sharedOptions.osgInfo}},{key:"debug",get:function(){return this.sharedOptions.debug}},{key:"TILE_DOWNLOAD_TIMEOUT",get:function(){return this.sharedOptions.TILE_DOWNLOAD_TIMEOUT}},{key:"loadWorker",get:function(){return this.sharedOptions.loadWorker}},{key:"treeToScreen",get:function(){return this.sharedOptions.treeToScreen}},{key:"frustumInTree",get:function(){return this.sharedOptions.frustumInTree}}]),t}();function v(e){var t=e.osgGeometry,r=e.groups,n=new s.BufferGeometry;return n.addAttribute("position",new s.BufferAttribute(t.Vertex,3)),n.setIndex(new s.BufferAttribute(t.Indices,1)),n.addAttribute("uv",new s.BufferAttribute(t.TexCoord0,2)),r.length>1&&r.forEach(function(e){n.addGroup(e.start,e.count,e.materialIndex)}),n}function y(e,t){return e.length>1?e.map(function(e){return r(e)}):r(e[0]);function r(e){var r=e.map_Kd;return!t[r]&&t[r+".jpg"]&&(r+=".jpg"),new s.MeshBasicMaterial({map:t[r]})}}t.default=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),i=c(r(25)),a=c(r(9)),s=c(r(26)),u=c(r(56)),l=c(r(61));function c(e){return e&&e.__esModule?e:{default:e}}var f=function(){function e(t,r){var n=r.HOST,a=r.api,s=r.background,u=void 0===s?{transparent:!1,opacity:.8,color:2565927,image:void 0}:s,l=r.debug;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),a&&a.key&&a.apiUrl||console.warn("No api.");var c=this;this.debug=l,this._HOST=n,this._apiParams=a,this.rootContainer=null,this.threeContainer=null,this.renderer=null,this.scene=null,this.camera=null,this.effect=null,this._freeze=!1,this._live=!1,this.layers={},this.control=null,window.viewer=this,function(){if(c.rootContainer=document.getElementById(t),!c.rootContainer)return console.error("Invalid "+t),!1;if(c.threeContainer=i.default.createThree(c.rootContainer,u.image),!c.env.webgl){if(c.env.browser.isWeChat){var e=/iPhone|iPod|iPad/.test(navigator.userAgent)?"Open in Safari":"Open with Browser";return i.default.createMessageDiv(c.rootContainer,'1. Click the button on upper right corner. <br>2. Select "'+e+'".',u.color),!1}return i.default.createMessageDiv(c.rootContainer,"No WebGL Support",u.color,"/support/articles/faq_compatibility"),!1}}(),function(){c.scene=new o.Scene;var e={eye:new o.Vector3(0,0,0),NEAR:c.scale/1e10,FAR:6*c.scale},t=c.width/c.height,r=e.NEAR,n=e.FAR;c.camera=new o.PerspectiveCamera(45,t,r,n),c.scene.add(c.camera),c.camera.position.copy(e.eye);var i=u;c.renderer=new o.WebGLRenderer({antialias:!0,alpha:i.transparent,logarithmicDepthBuffer:!1}),c.renderer.setClearColor(new o.Color(i.color),i.transparent?i.opacity:void 0),c.renderer.autoClear=!1;var a=void 0!==window.devicePixelRatio?window.devicePixelRatio:1,s=Math.max(1.2,.1*(a-1)+1);c.renderer.setPixelRatio(s),c.renderer.setSize(c.width,c.height),c.renderer.context.getExtension("OES_standard_derivatives"),c.threeContainer.appendChild(c.renderer.domElement);var l=new o.AmbientLight(4210752,1);c.scene.add(l);var f=new o.PointLight(13696511,1.1,0);f.color.setHex(16777215),f.position.set(0,0,0),c.camera.add(f),c._lights={ambient:l,point:f}}(),this._live=!0,function e(){if(!c.isUpdating)return;c.control&&c.control.update();c.animate();c.render();c._stats&&c._stats.update();requestAnimationFrame(e)}()}return n(e,[{key:"destruct",value:function(){var e=!0;return this.layers={},this.layersReady=null,this.control&&(e=this.control.destruct()&&e,this.control=void 0),this.renderer.forceContextLoss(),this.renderer.context=null,this.renderer.domElement=null,this.renderer.dispose(),this.renderer=null,this._welcomeMesh&&(this._welcomeMesh.geometry.dispose(),this._welcomeMesh.material.dispose(),this._welcomeMesh=void 0),this._live=!1,window.viewer=void 0,e}},{key:"freeze",value:function(){this._freeze=!0}},{key:"unfreeze",value:function(){this._freeze=!1}},{key:"animate",value:function(){}},{key:"render",value:function(){this.effect?this.effect.render(this.scene,this.camera):(this.renderer.clear(),this.renderer.render(this.scene,this.camera),this.__sceneOrtho&&this.__cameraOrtho&&this.__displayingTexture&&(this.renderer.clearDepth(),this.renderer.render(this.__sceneOrtho,this.__cameraOrtho)))}},{key:"cameraChangeHandler",value:function(){}},{key:"updateViewDependentContent",value:function(){}},{key:"updateViewDependentVisibility",value:function(){}},{key:"attachEffect",value:function(e,t){return this.threeContainer&&this.renderer?(this.effect=new e(this.renderer,t),this.effect&&this.effect.setSize(this.width,this.height),this.effect):(console.error("The renderer has not been initialized"),null)}},{key:"resize",value:function(){this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height),this.effect&&this.effect.setSize(this.width,this.height)}},{key:"_updateVisibility",value:function(){this.camera.updateMatrix(),this.camera.updateMatrixWorld(!0),this.camera.updateProjectionMatrix(),this.camera.matrixWorldInverse.getInverse(this.camera.matrixWorld);var e=new o.Frustum;e.setFromMatrix((new o.Matrix4).multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse));var t={frustum:e};for(var r in this.layers)this.layers[r]&&this.layers[r].updateVisibility(t);return!0}},{key:"_displayTexture",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:256,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:256;void 0===this.__sceneOrtho&&(this.__sceneOrtho=new o.Scene),void 0===this.__textureSprite&&(this.__textureSprite=new o.Sprite,this.__sceneOrtho.add(this.__textureSprite)),void 0===this.__cameraOrtho&&(this.__cameraOrtho=new o.OrthographicCamera(-this.width/2,this.width/2,this.height/2,-this.height/2,1,10),this.__cameraOrtho.position.z=10),this.__textureSprite.visible=!0,this.__textureSprite.scale.set(t,r,1);var n=this.width/2,i=this.height/2,a=t/2,s=r/2;this.__textureSprite.position.set(-n+a,i-s,1),e&&(this.__textureSprite.material.map=e,this.__textureSprite.material.needsUpdate=!0),this.__displayingTexture=!0}},{key:"_hideTexture",value:function(){this.__sceneOrtho&&this.__cameraOrtho&&this.__displayingTexture&&(this.__textureSprite.visible=!1,this.__displayingTexture=!1)}},{key:"env",get:function(){return Object.defineProperty(this,"env",{value:{isMobile:a.default.isMobile,webgl:a.default.webgl,browser:a.default.browser,workers:a.default.workers},writable:!1,configurable:!0}),this.env}},{key:"width",get:function(){return this.threeContainer.clientWidth}},{key:"height",get:function(){return this.threeContainer.clientHeight}},{key:"HOST",get:function(){return this._HOST}},{key:"altizureApi",get:function(){var e,t,r=Object.assign({},{API_HOST:"U2FsdGVkX19l4+V8uQYRigbhRUbtp+TqhjxwRO/FKTliJ0AFJkFXCzSs+ehN700y",API_KEY:"U2FsdGVkX19phGn0b5VCcKo7Vu7x1XAz2BKyuIasob2KrQD1CLAC9Ls72FjPeP+/NBhDGn19Gsh13EumIGZ95w=="},this._apiParams);return e=u.default.decrypt(r.API_HOST,"altizure-environment").toString(l.default),t=u.default.decrypt(r.API_KEY,"altizure-environment").toString(l.default),Object.defineProperty(this,"altizureApi",{value:new s.default({apiUrl:e,key:t,altitoken:r.altitoken}),writable:!1,configurable:!0}),this.altizureApi},set:function(e){var t=e.apiUrl,r=e.key,n=e.altitoken;t&&(this.altizureApi.apiUrl=t),r&&(this.altizureApi.key=r),n&&(this.altizureApi.altitoken=n)}},{key:"countryName",get:function(){var e=this;return this.altizureApi.getCountryName().catch(function(e){return console.warn(e),Promise.resolve("China")}).then(function(t){return Object.defineProperty(e,"countryName",{value:Promise.resolve(t),writable:!1,configurable:!0}),t})}},{key:"lights",get:function(){return this._lights}},{key:"isFreezing",get:function(){return this._freeze}},{key:"isLiving",get:function(){return this._live}},{key:"isUpdating",get:function(){return!this.isFreezing&&this.isLiving}}]),e}();t.default=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={};n.isMobile=/iPhone|iPod|iPad|Android|BlackBerry/.test(navigator.userAgent),n.createDiv=function(e,t,r,n){var o=document.createElement("div");return"undefined"!=typeof id&&(o.id=t+"_div"),void 0!==t&&(o.className=t),void 0!==r&&(o.style.cssText=r),void 0!==n&&(o.innerHTML=n),e.appendChild(o),o},n.createMessageDiv=function(e,t,r,o){var i=["z-index: 2;","position: absolute;","left:0px;","top:0px;","width:100%;","height:100%;","font-size:12pt;","text-align: center;","vertical-align: middle;","text-align: -webkit-center;","vertical-align: -webkit-middle;","background-color: #"+r.toString(16)+";","color: #"+(16777215-r).toString(16)+";","margin:0px;","padding:0px;"].join(""),a=n.createDiv(e,"ErrorDiv",i),s=["position: relative;","top:40%;","font-size:12pt;","text-align: center;","vertical-align: middle;","text-align: -webkit-center;","vertical-align: -webkit-middle;","margin:0px;","padding:0px;"].join(""),u=n.createDiv(a,"ErrorTextDiv",s);return u.innerHTML=t,o&&(u.innerHTML+='<br><br><a href="'+o+'" class="btn-link">Learn More</a>'),a},n.createThree=function(e,t){var r=["z-index: 0;","position: relative;","left:0px;","top:0px;","width:100%;","height:100%;","margin:0px;","overflow: hidden !important;","padding:0px;"];return t&&r.push("background-image: "+t),r=r.join(""),n.createDiv(e,"ThreeDiv",r)},n.displayDepthTexture=function(e,t){var r=window.open("","_blank"),n=e.dimension.width,o=e.dimension.height;r.document.write("\n      <title>"+t+"</title>\n      <p>"+t+'</p>\n      <p>depth</p>\n      <div><canvas id="targetdepth" width='+n+" height="+o+" /></div>\n      ");var i=r.document.getElementById("targetdepth").getContext("2d");i.clearRect(0,0,n,o);for(var a=i.createImageData(n,o),s=0;s<a.data.length;s+=4)a.data[s]=e.buffer[s/4],a.data[s+1]=e.buffer[s/4],a.data[s+2]=e.buffer[s/4],a.data[s+3]=e.buffer[s/4];i.putImageData(a,0,0)},n.displayTexture=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"texture",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"rgb",n=window.open("",t),o=e.dimension.width,i=e.dimension.height;n.document.write("\n      <title>"+t+"</title>\n      <p>"+t+'</p>\n      <p>depth</p>\n      <div><canvas id="textureCanvas" width='+o+" height="+i+" /></div>\n      ");var a=n.document.getElementById("textureCanvas").getContext("2d");a.clearRect(0,0,o,i);var s=a.createImageData(o,i);if("rgb"===r)for(var u=0;u<s.data.length;u+=1)s.data[u]=e.buffer[u];else if("depth"===r)for(var l=0;l<s.data.length;l+=4)s.data[l]=e.buffer[l/4],s.data[l+1]=e.buffer[l/4],s.data[l+2]=e.buffer[l/4],s.data[l+3]=e.buffer[l/4];a.putImageData(s,0,0)},t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(r(55));var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.apiUrl=t.apiUrl,this.key=t.key,this.altitoken=t.altitoken}return n(e,[{key:"destruct",value:function(){return!0}},{key:"project",value:function(e){var t=e.pid,r=e.timeout?e.timeout:1e4,n='{project(id: "'+t+'") { id name owner { id name } isImported views date versionControl cloudPath { key dataUrl } geoInfo { mercatorTransform transformed manualAligned autoAligned minLat minLong maxLat maxLong centerLat centerLong } annotations{edges{node{ id modelx modely modelz title description color glyph createTimestamp editTimestamp cameraPosition {x y z} centerPosition {x y z}}}} modelTransform { origin xDir yDir zDir minBound maxBound xTiles yTiles zTiles floorHeight onLoadTrans lengthUnitToMeter initialCamPos {cameraPos centerPos} }}}';return this._request(n,r).then(function(e){return Promise.resolve(e.data.data.project)}).catch(function(e){return console.error("api:project",e),Promise.reject(e)})}},{key:"my",value:function(e){var t=e&&e.timeout?e.timeout:1e4;return this._request("{my{self{ id name email balance company country joined}\n   projects { edges {node { id name owner {id username name} views date versionControl  cloudPath { key dataUrl }  geoInfo { mercatorTransform transformed manualAligned autoAligned minLat minLong maxLat maxLong centerLat centerLong }  modelTransform { origin xDir yDir zDir minBound maxBound xTiles yTiles zTiles floorHeight onLoadTrans lengthUnitToMeter}}}}}}",t).then(function(e){return Promise.resolve(e.data.data.my)}).catch(function(e){return console.error("api:my",e),Promise.reject(e)})}},{key:"allProjects",value:function(e){var t=e.limit,r=e.timeout?e.timeout:2e4,n="{ allProjects (first: "+t+") { edges { node { id name showLocation visibility geoInfo {autoAligned minLat minLong maxLat maxLong centerLat centerLong } cloudPath {key dataUrl} versionControl  modelTransform { origin xDir yDir zDir minBound maxBound xTiles yTiles zTiles floorHeight onLoadTrans lengthUnitToMeter}  views owner {name joined} date  } } } }";return this._request(n,r).then(function(e){for(var t=[],r=e.data.data.allProjects.edges,n=0;n<r.length;n++)t.push(r[n].node);return Promise.resolve(t)}).catch(function(e){return console.error("api:allProjects",e),Promise.reject(e)})}},{key:"getCountryName",value:function(e){var t=(e=e||{}).timeout?e.timeout:1e4;return this._request("{ getGeoIPInfo { countryName } }",t).then(function(e){var t=e.data.data.getGeoIPInfo.countryName;return Promise.resolve(t)}).catch(function(e){return console.warn("api:getGeoIPInfo",e,"set to China"),Promise.resolve("China")})}},{key:"geoNearProjects",value:function(e){var t=e.limit,r=e.center,n=e.span,o=e.timeout?e.timeout:1e4,i=function(e){var t=e[0],r=e[1];t<-180?t=-180:t>180&&(t=180);r<-90?r=-90:r>90&&(r=90);return[t,r]}([r.lng,r.lat]),a="{geoNearProjects(center: "+("{ latitude: "+i[1]+", longitude:"+i[0]+" }")+", span:"+n+", limit: "+t+") {id name visibility geoInfo {autoAligned minLat minLong maxLat maxLong centerLat centerLong } cloudPath {key dataUrl} versionControl  modelTransform { origin xDir yDir zDir minBound maxBound xTiles yTiles zTiles floorHeight onLoadTrans lengthUnitToMeter}  views owner {name joined} date }}";return this._request(a,o).then(function(e){var t=e.data.data.geoNearProjects;return Promise.resolve(t)}).catch(function(e){return console.error("api:geoNearProjects",e),Promise.reject(e)})}},{key:"getMatchingPose",value:function(e){for(var t=e.intrinsic,r=e.pairs,n=e.timeout,o=void 0===n?1e4:n,i="intrinsic:{u:"+t.u+",v:"+t.v+",f:"+t.f+"}",a="pairs:[",s=0;s<5;++s){var u=r[s],l=u.imageCoord,c=u.objectCoord;a+="{imageCoord:"+h([l[0],l[1]])+",objectCoord:"+h([c[0],c[1],c[2]])+"}",4!==s&&(a+=",")}var f="{utility{poseEstimation(input:{"+i+","+(a+="]")+"}){ok message{en{errorCode description solution}zh_cn{errorCode description solution}} reprojectionError pose}}}";function h(e){for(var t="[",r=0;r<e.length-1;++r)t+=e[r]+",";return t+=e[e.length-1]+"]"}return this._request(f,o).then(function(e){return Promise.resolve(e)}).catch(function(e){return console.error("api:getMatchingPose",e),Promise.reject(e)})}},{key:"_request",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n={key:this.key};this.altitoken&&(n.altitoken=this.altitoken);var i=this;return r--,(0,o.default)({method:"post",url:this.apiUrl,timeout:t,headers:n,data:"query="+e,responseType:"json"}).catch(function(n){return n instanceof Error&&n.message.includes("timeout")&&r>0?i._request(e,2*t,r):Promise.reject(n)})}},{key:"cropMask",value:function(e){var t=e.pid,r=e.timeout?e.timeout:1e4,n='{project(id: "'+t+'") { \n      cropMask { \n        usage \n        maskBox { minX minY maxX maxY } \n        maskInfos { polyNum width height data } \n      } \n    }}';return this._request(n,r).then(function(e){return Promise.resolve(e.data.data.project.cropMask)}).catch(function(e){return console.error("api:cropMask",e),Promise.reject(e)})}},{key:"waterMask",value:function(e){var t=e.pid,r=e.timeout?e.timeout:1e4,n='{project(id: "'+t+'"){\n      waterMask {\n        maskInfos { level alpha wave color polyNum width height data }\n        maskBox { minX minY maxX maxY }\n      }\n    }}';return this._request(n,r).then(function(e){return Promise.resolve(e.data.data.project.waterMask)}).catch(function(e){return console.error("api:waterMask",e),Promise.reject(e)})}},{key:"projectMask",value:function(e){var t=e.pid,r=e.usage;return"crop"===r?this.cropMask({pid:t}):"water"===r?this.waterMask({pid:t}):Promise.reject(new Error("Unknown mask usage "+r))}},{key:"altitoken",set:function(e){this._altitoken=e},get:function(){return this._altitoken}},{key:"key",set:function(e){this._key=e},get:function(){return this._key}}]),e}();t.default=i},function(e,t,r){e.exports=function(e){return function(t){var r=e,n=r.lib,o=n.WordArray,i=n.Hasher,a=r.algo,s=[];!function(){for(var e=0;e<64;e++)s[e]=4294967296*t.abs(t.sin(e+1))|0}();var u=a.MD5=i.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var n=t+r,o=e[n];e[n]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}var i=this._hash.words,a=e[t+0],u=e[t+1],d=e[t+2],p=e[t+3],v=e[t+4],y=e[t+5],m=e[t+6],g=e[t+7],_=e[t+8],b=e[t+9],w=e[t+10],A=e[t+11],x=e[t+12],k=e[t+13],T=e[t+14],O=e[t+15],E=i[0],P=i[1],S=i[2],M=i[3];P=h(P=h(P=h(P=h(P=f(P=f(P=f(P=f(P=c(P=c(P=c(P=c(P=l(P=l(P=l(P=l(P,S=l(S,M=l(M,E=l(E,P,S,M,a,7,s[0]),P,S,u,12,s[1]),E,P,d,17,s[2]),M,E,p,22,s[3]),S=l(S,M=l(M,E=l(E,P,S,M,v,7,s[4]),P,S,y,12,s[5]),E,P,m,17,s[6]),M,E,g,22,s[7]),S=l(S,M=l(M,E=l(E,P,S,M,_,7,s[8]),P,S,b,12,s[9]),E,P,w,17,s[10]),M,E,A,22,s[11]),S=l(S,M=l(M,E=l(E,P,S,M,x,7,s[12]),P,S,k,12,s[13]),E,P,T,17,s[14]),M,E,O,22,s[15]),S=c(S,M=c(M,E=c(E,P,S,M,u,5,s[16]),P,S,m,9,s[17]),E,P,A,14,s[18]),M,E,a,20,s[19]),S=c(S,M=c(M,E=c(E,P,S,M,y,5,s[20]),P,S,w,9,s[21]),E,P,O,14,s[22]),M,E,v,20,s[23]),S=c(S,M=c(M,E=c(E,P,S,M,b,5,s[24]),P,S,T,9,s[25]),E,P,p,14,s[26]),M,E,_,20,s[27]),S=c(S,M=c(M,E=c(E,P,S,M,k,5,s[28]),P,S,d,9,s[29]),E,P,g,14,s[30]),M,E,x,20,s[31]),S=f(S,M=f(M,E=f(E,P,S,M,y,4,s[32]),P,S,_,11,s[33]),E,P,A,16,s[34]),M,E,T,23,s[35]),S=f(S,M=f(M,E=f(E,P,S,M,u,4,s[36]),P,S,v,11,s[37]),E,P,g,16,s[38]),M,E,w,23,s[39]),S=f(S,M=f(M,E=f(E,P,S,M,k,4,s[40]),P,S,a,11,s[41]),E,P,p,16,s[42]),M,E,m,23,s[43]),S=f(S,M=f(M,E=f(E,P,S,M,b,4,s[44]),P,S,x,11,s[45]),E,P,O,16,s[46]),M,E,d,23,s[47]),S=h(S,M=h(M,E=h(E,P,S,M,a,6,s[48]),P,S,g,10,s[49]),E,P,T,15,s[50]),M,E,y,21,s[51]),S=h(S,M=h(M,E=h(E,P,S,M,x,6,s[52]),P,S,p,10,s[53]),E,P,w,15,s[54]),M,E,u,21,s[55]),S=h(S,M=h(M,E=h(E,P,S,M,_,6,s[56]),P,S,O,10,s[57]),E,P,m,15,s[58]),M,E,k,21,s[59]),S=h(S,M=h(M,E=h(E,P,S,M,v,6,s[60]),P,S,A,10,s[61]),E,P,d,15,s[62]),M,E,b,21,s[63]),i[0]=i[0]+E|0,i[1]=i[1]+P|0,i[2]=i[2]+S|0,i[3]=i[3]+M|0},_doFinalize:function(){var e=this._data,r=e.words,n=8*this._nDataBytes,o=8*e.sigBytes;r[o>>>5]|=128<<24-o%32;var i=t.floor(n/4294967296),a=n;r[15+(o+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),r[14+(o+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),e.sigBytes=4*(r.length+1),this._process();for(var s=this._hash,u=s.words,l=0;l<4;l++){var c=u[l];u[l]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8)}return s},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});function l(e,t,r,n,o,i,a){var s=e+(t&r|~t&n)+o+a;return(s<<i|s>>>32-i)+t}function c(e,t,r,n,o,i,a){var s=e+(t&n|r&~n)+o+a;return(s<<i|s>>>32-i)+t}function f(e,t,r,n,o,i,a){var s=e+(t^r^n)+o+a;return(s<<i|s>>>32-i)+t}function h(e,t,r,n,o,i,a){var s=e+(r^(t|~n))+o+a;return(s<<i|s>>>32-i)+t}r.MD5=i._createHelper(u),r.HmacMD5=i._createHmacHelper(u)}(Math),e.MD5}(r(2))},function(e,t,r){e.exports=function(e){return function(){var t=e,r=t.lib,n=r.Base,o=r.WordArray,i=t.algo,a=i.MD5,s=i.EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:a,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r=this.cfg,n=r.hasher.create(),i=o.create(),a=i.words,s=r.keySize,u=r.iterations;a.length<s;){l&&n.update(l);var l=n.update(e).finalize(t);n.reset();for(var c=1;c<u;c++)l=n.finalize(l),n.reset();i.concat(l)}return i.sigBytes=4*s,i}});t.EvpKDF=function(e,t,r){return s.create(r).compute(e,t)}}(),e.EvpKDF}(r(2),r(58),r(59))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function e(t,r,n,o){var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);null!==a&&e(a,r,n,o)}else if("value"in i&&i.writable)i.value=n;else{var s=i.set;void 0!==s&&s.call(o,n)}return n},i=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0},a=c(r(30)),s=c(r(1)),u=c(r(64)),l=r(0);function c(e){return e&&e.__esModule?e:{default:e}}var f=Math.PI/180,h=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));r._mat=new l.Matrix4,r._anchor=new l.Vector3,r._orbitSphDelta=new l.Spherical(0,0,0),r._swirlSphDelta=new l.Spherical(0,0,0),r.needsApplyDelta=!1,r.matNeedsUpdate=!1,r.poseNeedsUpdate=!1;var n=Object.assign({},{earth_scale:1,EARTH_RESOLUTION:6,minTilt:10,maxTilt:40,minNorth:0,maxNorth:360,minAlt:.1,maxAlt:2*s.default.EARTH_RADIUS},e);return r.earth_scale=n.earth_scale,r.EARTH_RESOLUTION=n.EARTH_RESOLUTION,r._minTilt=n.minTilt,r._maxTilt=n.maxTilt,r._minAlt=n.minAlt,r._maxAlt=n.maxAlt,r.minPolarAngleVert=10*f,r.maxPolarAngleVert=170*f,r._updateMat(!0),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),n(t,[{key:"destruct",value:function(){return this.reset(),!0}},{key:"add",value:function(e){return this.lng=this.lng+e.lng,this.lat=this.lat+e.lat,this.alt=this.alt+e.alt,this.north=this.north+e.north,this.tilt=this.tilt+e.tilt,this.up=this.up+e.up,this}},{key:"reset",value:function(){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"reset",this).call(this),this._onPoseChange(),this._updateMat(!0)}},{key:"clone",value:function(){console.warn("ni")}},{key:"_updateMat",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.matNeedsUpdate||e){var t=s.default.getLocalSystemOnEarthSurface(this.EARTH_RESOLUTION,this.lng,this.lat,this.earth_scale),r=t.origin,n=t.alt,o=this.tilt/180*Math.PI,i=this.north/180*Math.PI,a=new l.Spherical(this.alt/s.default.EARTH_RADIUS*this.earth_scale,o,i),u=(new l.Vector3).setFromSpherical(a),c=this._sphereLocalCoordinates(n.clone()),f=c.x.clone().multiplyScalar(u.x).add(c.y.clone().multiplyScalar(u.y)).add(c.z.clone().multiplyScalar(u.z)).add(r),h=c.z.clone().negate();h.applyAxisAngle(c.y.clone(),i);var d=(new l.Matrix4).lookAt(f,r.clone(),h);d.setPosition(f),this._mat.copy(d)}this.matNeedsUpdate=!1}},{key:"_updatePose",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this.poseNeedsUpdate||e)&&this._matToPose(),this.poseNeedsUpdate=!1}},{key:"_matToPose",value:function(e){var r=void 0;if(e&&!e.equals(this.matrix)?r=t._earthPicker.intersect(e.clone()):(e=this.matrix,r=this._centerIntersection()),r){var n=r.clone();return this._matToPoseWithAnchor(e,n)}}},{key:"_matToPoseWithAnchor",value:function(e,r){var n=this.EARTH_RESOLUTION,i=this.earth_scale,a=s.default.earthSurfaceToGeographic(n,r,i),u=a.lng,l=a.lat,c=this._matToAltNorthTiltWithAnchor(e,r),f={lng:u,lat:l,alt:c.alt,north:c.north,tilt:c.tilt,up:0};return f.tilt>=0&&f.tilt<=t.MAX_TILT||(f.tilt=Math.max(0,Math.min(t.MAX_TILT,f.tilt))),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"lng",f.lng,this),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"lat",f.lat,this),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"alt",f.alt,this),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"north",f.north,this),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"tilt",f.tilt,this),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"up",f.up,this),{lng:this._lng,lat:this._lat,alt:this._alt,north:this._north,tilt:this._tilt,up:this._up}}},{key:"_matToAltNorthTiltWithAnchor",value:function(e,t){var r=this.earth_scale,n=(new l.Vector3).setFromMatrixPosition(e),o=this._toEarthLocalSpherical(n,t).sph;return{alt:Math.max(o.radius/r*s.default.EARTH_RADIUS,.1),north:o.theta/Math.PI*180,tilt:o.phi/Math.PI*180}}},{key:"_onPoseChange",value:function(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(this.matNeedsUpdate=!0)}},{key:"_onMatChange",value:function(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&(this.poseNeedsUpdate=!0)}},{key:"_sphereLocalCoordinates",value:function(e,t){var r=new l.Vector3,n=new l.Vector3,o=new l.Vector3;return t||(t=new l.Vector3(0,1,0)),n.copy(e).normalize(),0===n.lengthSq()&&(n.z=1),r.crossVectors(t,n).normalize(),0===r.lengthSq()&&(n.z+=1e-4,r.crossVectors(t,n).normalize()),o.crossVectors(r,n),{x:r,y:n,z:o}}},{key:"_toEarthLocalSpherical",value:function(e,t){var r=this._sphereLocalCoordinates(t),n=e.clone().sub(t),o=new l.Vector3(n.clone().dot(r.x),n.clone().dot(r.y),n.clone().dot(r.z)),i=new l.Spherical;return i.setFromVector3(o),{sph:i,x:r.x,y:r.y,z:r.z}}},{key:"orbitLeft",value:function(e){if(0!==e){var t=this.anchor,r=this.matrix.clone(),n=new l.Vector3(r.elements[12],r.elements[13],r.elements[14]),o=t.distanceTo(n);o=Math.max(1/s.default.EARTH_RADIUS*this.earth_scale,Math.min(o,this.earth_scale));var i=45*Math.PI/180,a=o*Math.tan(i/2),u=2*Math.atan2(a,this.earth_scale);this._orbitSphDelta.theta+=e*u,this.needsApplyDelta=!0}}},{key:"orbitUp",value:function(e){if(e){var t=this.anchor,r=this.matrix.clone(),n=new l.Vector3(r.elements[12],r.elements[13],r.elements[14]),o=t.distanceTo(n);o=Math.max(1/s.default.EARTH_RADIUS*this.earth_scale,Math.min(o,this.earth_scale));var i=45*f,a=o*Math.tan(i/2),u=2*Math.atan2(a,this.earth_scale);this._orbitSphDelta.phi+=e*u,this.needsApplyDelta=!0}}},{key:"dolly",value:function(e){0!==e&&(this._orbitSphDelta.radius+=e,this.needsApplyDelta=!0)}},{key:"swirlLeft",value:function(e){this._swirlSphDelta.theta+=e*f,this.needsApplyDelta=!0}},{key:"swirlUp",value:function(e){this._swirlSphDelta.phi+=e*f,this.needsApplyDelta=!0}},{key:"applyDelta",value:function(){if(this.needsApplyDelta){var e=this.matrix.clone(),t=this.anchor,r=(new l.Vector3).setFromMatrixPosition(e),n=new l.Vector3(1,0,0).transformDirection(e),o=new l.Vector3(0,1,0).transformDirection(e),i=void 0;if(this._orbitSphDelta.radius){var a=s.default.EARTH_RADIUS/this.earth_scale,u=r.clone().sub(t),c=1+this._orbitSphDelta.radius/10;c=Math.max(.01,c);var f=u.length()*c,h=void 0;h=f>this.maxAlt/a?t.clone().addScaledVector(u.clone().normalize(),this.maxAlt/a):f<this.minAlt/a?t.clone().addScaledVector(u.clone().normalize(),this.minAlt/a):t.clone().addScaledVector(u,c),i=e.clone().setPosition(h)}else i=e;var d=i.clone();if(this._swirlSphDelta.theta){var p=t.clone().normalize(),v=(new l.Matrix4).makeRotationAxis(p,this._swirlSphDelta.theta);d.premultiply((new l.Matrix4).getInverse(v))}if(this._swirlSphDelta.phi){var y=(new l.Matrix4).setPosition(t.clone().negate()),m=(new l.Matrix4).makeRotationAxis(n,this._swirlSphDelta.phi),g=(new l.Matrix4).setPosition(t).multiply(m).multiply(y),_=(new l.Matrix4).getInverse(g).multiply(d),b=(new l.Vector3).setFromMatrixPosition(_),w=new l.Vector3(0,1,0).transformDirection(_),A=new l.Vector3(0,0,-1).transformDirection(_).normalize(),x=b.clone().projectOnVector(A).clone().negate().add(b);x.length()>=.98*this.earth_scale||x.clone().dot(w)<=0||d.premultiply((new l.Matrix4).getInverse(g));var k=(new l.Matrix4).getInverse(d),T=(new l.Vector3).setFromMatrixPosition(k);if(0!==T.x){var O=t.clone().applyMatrix4(k),E=T.clone().sub(O).normalize(),P=E.clone().setX(0).normalize(),S=(new l.Matrix4).setPosition(O.clone().negate()).premultiply((new l.Matrix4).makeRotationFromQuaternion((new l.Quaternion).setFromUnitVectors(E,P))).premultiply((new l.Matrix4).setPosition(O.clone()));d.multiply((new l.Matrix4).getInverse(S))}}var M=(new l.Matrix4).identity();if(this._orbitSphDelta.theta){var C=(new l.Matrix4).makeRotationAxis(o,this._orbitSphDelta.theta);M.copy(C)}if(this._orbitSphDelta.phi){var j=(new l.Matrix4).makeRotationAxis(n,this._orbitSphDelta.phi);M.multiply(j)}var L=(new l.Matrix4).getInverse(M).multiply(d);this.matrix=L,this._orbitSphDelta.theta=0,this._orbitSphDelta.phi=0,this._orbitSphDelta.radius=0,this._swirlSphDelta.theta=0,this._swirlSphDelta.phi=0,this._orbitSphDelta.radius=0,this.needsApplyDelta=!1}}},{key:"putAnchor",value:function(e){return e?this._anchor.copy(e):this._updateAnchor()}},{key:"recommendedFrustum",value:function(e){e.camera,e.targetFocus}},{key:"_updateAnchor",value:function(){var e=this._centerIntersection();return e&&this._anchor.copy(e),this.anchor}},{key:"_centerIntersection",value:function(){return t._earthPicker.intersect(this.matrix)}},{key:"matrix",get:function(){return this._updateMat(),this._mat.clone()},set:function(e){e.isMatrix4?e.equals(this.matrix)||(this._mat.copy(e),this._onMatChange()):console.error("Unknown matrix",e)}},{key:"POS",get:function(){var e=new l.Vector3,t=new l.Quaternion,r=new l.Vector3;return this.matrix.clone().decompose(e,t,r),{position:e,orientation:t,scale:r}}},{key:"value",get:function(){return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"value",this)},set:function(e){var t=Object.assign({},this.value,e);this.lng=t.lng,this.lat=t.lat,this.alt=t.alt,this.north=t.north,this.tilt=t.tilt,this.up=t.up}},{key:"lng",set:function(e){isNaN(e)||e===this.lng||(o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"lng",e,this),this._onPoseChange())},get:function(){return this._updatePose(),i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"lng",this)}},{key:"lat",set:function(e){isNaN(e)||e===this.lat||(o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"lat",e,this),this._onPoseChange())},get:function(){return this._updatePose(),i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"lat",this)}},{key:"alt",set:function(e){!isNaN(e)&&e!==this.alt&&e>=.1&&(void 0===this.minAlt&&void 0===this.maxAlt||(e=Math.max(this.minAlt,Math.min(this.maxAlt,e))),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"alt",e,this),this._onPoseChange())},get:function(){return this._updatePose(),i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"alt",this)}},{key:"north",set:function(e){isNaN(e)||e===this.north||(o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"north",e,this),this._onPoseChange())},get:function(){return this._updatePose(),i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"north",this)}},{key:"tilt",set:function(e){e=Math.max(0,Math.min(t.MAX_TILT,e)),isNaN(e)||(o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"tilt",e,this),this._onPoseChange())},get:function(){return this._updatePose(),i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"tilt",this)}},{key:"up",set:function(e){isNaN(e)||e===this.up||(o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"up",e,this),this._onPoseChange())},get:function(){return this._updatePose(),i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"up",this)}},{key:"anchor",set:function(e){this._anchor.copy(e)},get:function(){return this._anchor.clone()}},{key:"maxAlt",set:function(e){(e=Math.max(.1,Math.min(2*s.default.EARTH_RADIUS,e)))<this.minAlt&&(console.warn("altRangeMax",e,this.minAlt),this._minAlt=e),this._maxAlt=e},get:function(){return this._maxAlt}},{key:"minAlt",set:function(e){(e=Math.max(.1,Math.min(2*s.default.EARTH_RADIUS,e)))>this.maxAlt&&(console.warn("altRangeMin",e,this.maxAlt),this._maxAlt=e),this._minAlt=e},get:function(){return this._minAlt}},{key:"maxTilt",set:function(e){(e=Math.max(0,Math.min(t.MAX_TILT,e)))<this.minTilt&&(console.warn("TiltRangeMax",e,this.minTilt),this._minTilt=e),this._maxTilt=e},get:function(){return this._maxTilt}},{key:"minTilt",set:function(e){(e=Math.max(0,Math.min(t.MAX_TILT,e)))>this.maxTilt&&(console.warn("TiltRangeMin",e,this.maxTilt),this._maxTilt=e),this._minTilt=e},get:function(){return this._minTilt}},{key:"distanceToAnchor",get:function(){var e=(new l.Vector3).setFromMatrixPosition(this.matrix),t=this.anchor;return e.distanceTo(t)}}],[{key:"MAX_TILT",get:function(){return 75}}]),t}();h._earthPicker=new u.default,t.default=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(r(1));var i=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.lng,n=void 0===r?0:r,o=t.lat,i=void 0===o?0:o,a=t.alt,s=void 0===a?0:a,u=t.north,l=void 0===u?0:u,c=t.tilt,f=void 0===c?0:c,h=t.up,d=void 0===h?0:h;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.lng=n,this.lat=i,this.alt=s,this.north=l,this.tilt=f,this.up=d}return n(e,[{key:"reset",value:function(){this.lng=0,this.lat=0,this.alt=0,this.north=0,this.tilt=0,this.up=0}},{key:"clone",value:function(){return new e(this.value)}},{key:"equals",value:function(e){return e.lat===this.lat&&e.lng===this.lng&&e.alt===this.alt&&e.north===this.north&&e.tilt===this.tilt&&e.up===this.up}},{key:"add",value:function(e){return this.lng=this.lng+e.lng,this.lat=this.lat+e.lat,this.alt=this.alt+e.alt,this.north=this.north+e.north,this.tilt=this.tilt+e.tilt,this.up=this.up+e.up,this}},{key:"lng",set:function(e){(e%=360)>=180?e-=360:e<=-180&&(e+=360),this._lng=e},get:function(){return this._lng}},{key:"lat",set:function(e){this._lat=Math.max(Math.min(87,e),-87)},get:function(){return this._lat}},{key:"alt",set:function(e){this._alt=Math.max(-1*o.default.EARTH_RADIUS,e)},get:function(){return this._alt}},{key:"north",set:function(e){e=(e%360+360)%360,this._north=e},get:function(){return this._north}},{key:"tilt",set:function(e){this._tilt=e},get:function(){return this._tilt}},{key:"up",set:function(e){this._up=e},get:function(){return this._up}},{key:"value",set:function(e){var t=e.lng,r=e.lat,n=e.alt,o=e.north,i=e.tilt,a=e.up;void 0!==t&&(this._pose.lng=t),void 0!==r&&(this._pose.lat=r),void 0!==n&&(this._pose.alt=n),void 0!==o&&(this._pose.north=o),void 0!==i&&(this._pose.tilt=i),void 0!==a&&(this._pose.up=a)},get:function(){return{lng:this.lng,lat:this.lat,alt:this.alt,north:this.north,tilt:this.tilt,up:this.up}}}]),e}();t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0);var i=function(){function e(t){var r=t.camera,n=t.domElement;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._camera=r,this._domElement=n,this._rayCaster=new o.Raycaster,this.mouseOffsetNeedsUpdate=!0}return n(e,[{key:"destruct",value:function(){return this._camera=void 0,this._domElement=void 0,this._rayCaster=void 0,this.mouseOffsetNeedsUpdate=!1,!0}},{key:"pick",value:function(e,t){var r=this._NDC(e,t),n=r.x,i=r.y;return this._rayCaster.setFromCamera(new o.Vector2(n,i),this.camera),this._rayCaster.intersectObjects(this.targets,!0)}},{key:"_NDC",value:function(e,t){var r=this.mouseOffset;return e-=r.left,t-=r.top,{x:e=e/this.domWidth*2-1,y:t=-t/this.domHeight*2+1}}},{key:"_NDC_inv",value:function(e,t){var r=this.mouseOffset;return{x:(e+1)/2*this.domWidth+r.left,y:(1-t)/2*this.domHeight+r.top}}},{key:"_updateMouseOffset",value:function(){var e=this._domElement.getBoundingClientRect();this._mouseOffset={left:e.left,top:e.top},this.mouseOffsetNeedsUpdate=!1}},{key:"camera",get:function(){return this._camera}},{key:"mouseOffset",get:function(){return this.mouseOffsetNeedsUpdate&&this._updateMouseOffset(),this._mouseOffset}},{key:"domWidth",get:function(){return this._domElement.clientWidth}},{key:"domHeight",get:function(){return this._domElement.clientHeight}},{key:"targets",get:function(){return[]}}]),e}();t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0},a=function(e){return e&&e.__esModule?e:{default:e}}(r(33));var s=function(e){function t(e,r){var n=r.sceneGraphRoot,o=r.name,i=void 0===o?"QuadLodTree":o,a=r.eventHandlers,s=r.maxLevel,u=r.minLevel,l=r.camera,c=r.debug,f=r.TreeMaterialType,h=r.NodeMaterialType;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var d=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,{name:i,sceneGraphRoot:n,eventHandlers:a,maxLevel:s,minLevel:u,debug:c}));return d.sharedOptions.maxLevel=s,d.sharedOptions.minLevel=u,d.camera=l,d._TreeMaterialType=f,d._NodeMaterialType=h,d}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),o(t,[{key:"destruct",value:function(){return this.sharedOptions.maxLevel=0,this.sharedOptions.minLevel=0,this.camera=void 0,i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"expand",value:function(e){if(e.level>=this.maxLevel)return console.warn(e,"exceed max level",this.maxLevel),!1;if(e.nodes.length>0)return console.warn(e,"children exist"),!1;if(0===e.nodes.length){var t=e.x,r=e.y,o={level:e.level+1,parent:e,sharedOptions:this.sharedOptions};return e.nodes[0]=new this.Node(n({x:2*t,y:2*r},o)),e.nodes[1]=new this.Node(n({x:2*t,y:2*r+1},o)),e.nodes[2]=new this.Node(n({x:2*t+1,y:2*r},o)),e.nodes[3]=new this.Node(n({x:2*t+1,y:2*r+1},o)),this.numOfNodes+=4,this.debug&&console.log("tree expand"),!0}return console.warn("unknown expand error"),!1}},{key:"preSceneUpdate",value:function(e){var r=e.camera;return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"preSceneUpdate",this).call(this,{camera:r}),this.camera!==r&&(this.camera&&console.warn("Camera instance Changed.",r,this.camera),this.camera=r),!0}},{key:"material",get:function(){if(!this._material){var e=this._NodeMaterialType,t=this._TreeMaterialType;this._material=new t({tree:this,Type:e})}return this._material},set:function(e){e!==this._material&&(e.tree=this,this._material&&this._material.destruct(),this._material=e,this._TreeMaterialType=e.constructor,this._NodeMaterialType=e.Type,this.sharedOptions.treeMaterial=this._material,this._material.updateMaterial()||console.warn("set material"))}},{key:"TreeMaterialType",get:function(){return this._TreeMaterialType}},{key:"NodeMaterialType",get:function(){return this.material.Type}}]),t}();t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(r(3));var i=function(){function e(t,r){var n=r.name,o=r.sceneGraphRoot,i=r.eventHandlers,a=void 0===i?{}:i,s=r.maxLevel,u=r.minLevel,l=r.debug;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._name=n,this.Node=t,this.sceneGraphRoot=o,this.eventHandlers=a,this.maxLevel=s,this.minLevel=u,this.debug=l,this.root=null,this.numOfNodes=0;var c=a.onTileDownloaded,f=a.onError;this.sharedOptions={sceneGraphRoot:o,debug:l,onError:f,onTileDownloaded:c},this.flags={modelInitialized:!1};var h=this;this.initialized=new Promise(function(e,t){h._onInitSuccess=e,h._onInitFail=t}),this.style={}}return n(e,[{key:"destruct",value:function(){var e=!0;return e=e&&this.dispose(this.root),this.root=null,this._onContentDisposed(),this.tile_retriever&&(console.warn("deprecated"),e=e&&this.tile_retriever.destruct(),this.tile_retriever=null),e}},{key:"expand",value:function(e){return console.error("expand is not implemented"),!1}},{key:"dispose",value:function(e){var t=this.debug;if(void 0===e||null===e)return!0;var r=!0;void 0===e.nodes&&console.warn("inspect",e.info);for(var n=0;n<e.nodes.length;n++)r=this.dispose(e.nodes[n])&&r;return t&&console.log("delete",JSON.stringify(e.info)),r=e.destruct()&&r,e=void 0,this.numOfNodes--,r}},{key:"prune",value:function(e){if(void 0===e)return console.warn("Trying to prune undefined node"),!1;var t=!0;if(e.isInScene||e.displayByPrune(),e.nodes.length>0){for(var r=0;r<e.nodes.length;r++)t=this.dispose(e.nodes[r])&&t;e.nodes=[]}return t}},{key:"traverse",value:function(e,t,r,n){var o=!0;o=t(e,r,n)&&o;for(var i=0;i<e.nodes.length;i++)o=this.traverse(e.nodes[i],t,r,n)&&o;return o}},{key:"preSceneUpdate",value:function(){return this._onCameraChanged(),!0}},{key:"_onCameraChanged",value:function(){return this.root&&this.traverse(this.root,function(e){return e.cameraChanged(),!0}),!0}},{key:"_onContentInitialized",value:function(){this.flags.modelInitialized=!0,this.eventHandlers.onContentInitialized&&this.eventHandlers.onContentInitialized(),this._onInitSuccess(this)}},{key:"_onContentDisposed",value:function(){this.flags.modelInitialized=!1,this.eventHandlers.onContentDisposed&&this.eventHandlers.onContentDisposed()}},{key:"name",get:function(){return this._name}},{key:"visible",get:function(){return this.sceneGraphRoot.visible},set:function(e){this.sceneGraphRoot.visible=e}},{key:"material",get:function(){return Object.defineProperty(this,"material",{value:new o.default({tree:this}),writable:!1,configurable:!0}),console.warn("TreeMaterial is not implemented."),this.material}}]),e}();t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0},i=function(e){return e&&e.__esModule?e:{default:e}}(r(35));var a=function(e){function t(e){var r=e.parent,n=e.x,o=e.y,i=e.level,a=e.name,s=void 0===a?i+" "+n+" "+o:a,u=e.sharedOptions;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var l=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:r,name:s,sharedOptions:u}));return l._level=i,l._x=n,l._y=o,l}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),n(t,[{key:"destruct",value:function(){return this._level=void 0,this._x=void 0,this._y=void 0,o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"level",get:function(){return this._level}},{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"maxLevel",get:function(){return this.sharedOptions.maxLevel}},{key:"minLevel",get:function(){return this.sharedOptions.minLevel}},{key:"camera",get:function(){return this.sharedOptions.camera}},{key:"expandable",get:function(){return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"expandable",this)&&this.level<=this.maxLevel}}]),t}();t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0);function i(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,i){try{var a=t[o](i),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}var a=function(){function e(t){var r=this,n=t.parent,i=t.name,a=t.sharedOptions;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parent=n,this.name=i,this.sharedOptions=a,this.lifeState="empty",this._is404=!1,this.needsPrune=!1,this.shapeHolder=new o.Object3D,this.contentHolder=new o.Object3D,this.decoHolder=new o.Object3D,this.shapeHolder.add(this.contentHolder),this.shapeHolder.add(this.decoHolder),this.content=void 0,this.nodes=[],this.contentLoaded=new Promise(function(e,t){r._onContentLoadCompleted=e,r._onContentLoadFailed=t}),this.visibilityNeedsUpdate=!0,this.screenAreaNeedsUpdate=!0}return n(e,[{key:"preDownload",value:function(){var e=i(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.resolve());case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"downloading",value:function(){var e=i(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="downloading is not implemented",console.warn(r),e.abrupt("return",Promise.reject(new Error(r)));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"postDownload",value:function(){var e=i(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.sharedOptions&&this.sharedOptions.onTileDownloaded&&this.sharedOptions.onTileDownloaded(),e.abrupt("return",Promise.resolve(t));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"cook",value:function(){var e=i(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="cook not implemented",console.warn(r),e.abrupt("return",Promise.reject(new Error(r)));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"defaultCooked",value:function(){var e=i(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="defaultCooked not implemented",console.warn(t),e.abrupt("return",Promise.reject(new Error(t)));case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"digest",value:function(e){console.warn("digest not implemented")}},{key:"_updateVisibility",value:function(){console.error("_updateVisibility is not implemented.")}},{key:"_updateScreenArea",value:function(){console.error("_updateScreenArea is not implemented.")}},{key:"destruct",value:function(){return this.debug&&console.log("destruct",JSON.stringify(this.info)),this.isInScene&&this._removeFromSceneGraph(),this.shapeHolder.remove(this.contentHolder),this.shapeHolder.remove(this.decoHolder),this.contentHolder.remove(this.content),this.content=void 0,this.parent=void 0,this.name=void 0,this.lifeState="expired",this.sharedOptions={},this.nodes=void 0,this._visible=!0,this._isPlaceHolder=!1,!0}},{key:"traverse",value:function(e,t){var r=!0;r=e(this,t)&&r;for(var n=0;n<this.nodes.length;n++)r=this.nodes[n].traverse(e,t)&&r;return r}},{key:"download",value:function(){var e=i(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.preDownload().then(function(e){return t.downloading(e)}).then(function(e){return t.postDownload(e)}));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"onContentLoaded",value:function(e){var t=!0;return this.content?(console.warn("trying to assign content to a loaded tile",this,e),t=!1):(this.content=e,this.contentHolder.add(this.content),this.debug&&console.log("onload",JSON.stringify(this.info)),this.lifeState="loaded",this._onContentLoadCompleted(e)),t}},{key:"cameraChanged",value:function(){this.visibilityNeedsUpdate=!0,this.screenAreaNeedsUpdate=!0}},{key:"displayByload",value:function(){this.debug&&console.log("displayByload",JSON.stringify(this.info));var e=!1;return this.loaded?(this.isRoot?this.loaded&&!this.isInScene&&(e=this._addToSceneAsync()&&e):e=this._replaceParentAttempt()&&e,e):(console.error("not loaded but display attempt"),e=!1)}},{key:"displayByPrune",value:function(){this.debug&&console.log("displayByPrune",JSON.stringify(this.info));var e=!1;return this.loaded?(this.isRoot?this.isInScene?e=!0:this.loaded?(this._addToSceneGraph(),e=!0):e=!1:!function(e){var t=e;for(;null!==t.parent;)t=t.parent;return t.loaded}(this)?e=!1:!function(e){var t=e.parent;for(;null!==t;){if(t.isInScene)return t;t=t.parent}return}(this)?this.isInScene?e=!0:(this.loaded?this._addToSceneGraph():console.error("node is not loaded but descendants in scene"),e=!0):e=!1,e):e=!1}},{key:"_replaceParentAttempt",value:function(){var e=!1;if("loaded"!==this.lifeState)return console.error("not loaded but display atttempt"),e=!1;if(this.isRoot)console.warn("unreachable");else if(this.siblingsLoaded&&this.parent.isInScene){var t=this.parent.nodes;this.parent._removeFromSceneGraph();for(var r=0;r<t.length;r++)t[r]._addToSceneAsync();e=!0}return e}},{key:"_addToSceneAsync",value:function(){return this._addToSceneGraph(),this._beReplacedAttempt(),!0}},{key:"_beReplacedAttempt",value:function(e){var t=!0;if(!this.loaded)return console.error("not loaded but display atttempt"),t=!1;if(!this.isInScene)return console.error("not in scene but be replaced atttempt"),t=!1;if(0===this.nodes.length)t=!1;else if(this.nodes.length>0){if(this.childrenLoaded){this._removeFromSceneGraph();for(var r=0;r<this.nodes.length;r++)this.nodes[r]._addToSceneAsync();t=!0}}else console.error("node with unexpected number of children",this),t=!1;return t}},{key:"_addToSceneGraph",value:function(){var e=this.debug,t=!0;return"loaded"!==this.lifeState?(console.warn(JSON.stringify(this.info)+", content undefined, cannot add to scene"),t=!1):this.isInScene?(console.warn("Twice adding to scene attempt",this.info),t=!1):(this.sceneGraphRoot.add(this.shapeHolder),e&&console.log("add to scene",this.info)),t}},{key:"_removeFromSceneGraph",value:function(){var e=!0;return this.isInScene&&this.content?(this.sceneGraphRoot.remove(this.shapeHolder),this.debug&&console.log("remove from scene",this.info),e):(console.warn("_removeFromSceneGraph fail",this),e=!1)}},{key:"setVisibility",value:function(e){console.warn("deprecated")}},{key:"resourceKey",get:function(){console.error("resourceKey undefined")}},{key:"expandable",get:function(){return!this.is404}},{key:"sceneGraphRoot",get:function(){return this.sharedOptions.sceneGraphRoot}},{key:"debug",get:function(){return this.sharedOptions.debug}},{key:"info",get:function(){return{name:this.name}}},{key:"isRoot",get:function(){return null===this.parent}},{key:"isPlaceHolder",get:function(){return this._isPlaceHolder},set:function(e){this._isPlaceHolder=e}},{key:"is404",get:function(){return this._is404},set:function(e){this.traverse(function(t){t._is404=e,t.screenAreaNeedsUpdate=!0})}},{key:"visible",get:function(){return this.visibilityNeedsUpdate&&(this._visible=this._updateVisibility(),this.visibilityNeedsUpdate=!1),this._visible}},{key:"loaded",get:function(){return"loaded"===this.lifeState}},{key:"expired",get:function(){return"expired"===this.lifeState}},{key:"screenArea",get:function(){return this.screenAreaNeedsUpdate&&(this._screenArea=this._updateScreenArea(),this.screenAreaNeedsUpdate=!1),this._screenArea}},{key:"isInScene",get:function(){return!(null===this.shapeHolder.parent||void 0===this.shapeHolder.parent)}},{key:"siblingsLoaded",get:function(){for(var e=this.parent.nodes,t=!0,r=0;r<e.length&&(t="loaded"===e[r].lifeState&&t);r++);return t}},{key:"childrenLoaded",get:function(){var e=this.nodes;if(e.length>0){for(var t=!0,r=0;r<e.length&&(t="loaded"===e[r].lifeState&&t);r++);return t}return!1}}]),e}();t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(0);var s=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=null,this.name=null,this.owner={},this.owner.id=null,this.owner.name=null,this.isImported=null,this.views=null,this.date=null,this.versionControl=null,this.cloudPath=null,this.geoInfo={},this.modelTransform={},this.modelTransform.origin=null,this.modelTransform.xDir=null,this.modelTransform.yDir=null,this.modelTransform.zDir=null,this.modelTransform.minBound=null,this.modelTransform.maxBound=null,this.modelTransform.xTiles=null,this.modelTransform.yTiles=null,this.modelTransform.zTiles=null,this.modelTransform.floorHeight=null,this.modelTransform.objToOldDisplay=null,this.modelTransform.initialCamPos=null,t&&(this.processProjectInfo(t),this.validate())}return i(e,[{key:"destruct",value:function(){return this.id=null,this.name=null,this.owner.id=null,this.owner.name=null,this.owner={},this.isImported=null,this.views=null,this.date=null,this.versionControl=null,this.cloudPath=null,this.geoInfo.autoAligned=null,this.geoInfo.minLat=null,this.geoInfo.minLong=null,this.geoInfo.maxLat=null,this.geoInfo.maxLong=null,this.geoInfo.centerLat=null,this.geoInfo.centerLong=null,this.geoInfo={},this.modelTransform.origin=null,this.modelTransform.xDir=null,this.modelTransform.yDir=null,this.modelTransform.zDir=null,this.modelTransform.minBound=null,this.modelTransform.maxBound=null,this.modelTransform.xTiles=null,this.modelTransform.yTiles=null,this.modelTransform.zTiles=null,this.modelTransform.floorHeight=null,this.modelTransform.objToOldDisplay=null,this.modelTransform.lengthUnitToMeter=null,this.modelTransform.initialCamPos=null,this.modelTransform={},!0}},{key:"validate",value:function(){for(var e=["id","name","owner","isImported","views","date","versionControl","cloudPath","geoInfo","modelTransform"],t=0;t<e.length;t++)if(null===this[e[t]]||void 0===this[e[t]])return console.error("invalid info[",e[t],"]=",this[e[t]]),!1;e=Object.keys(this.owner);for(var r=0;r<e.length;r++)if(null===this.owner[e[r]]||void 0===this.owner[e[r]])return console.error("invalid info.owner[",e[r],"]=",this[e[r]]),!1;e=Object.keys(this.modelTransform);for(var n=0;n<e.length;n++)if(null===this.modelTransform[e[n]]||void 0===this.modelTransform[e[n]])return console.error("invalid info.modelTransform[",e[n],"]=",this[e[n]]),!1;if(this.cloudPath.length<=0)return console.error("Invalid cloudPath",this.cloudPath),!1;if(this.geoInfo&&!isNaN(this.geoInfo.maxLat)&&!isNaN(this.geoInfo.minLat)&&!isNaN(this.geoInfo.maxLong)&&!isNaN(this.geoInfo.minLong)){var o=Math.max(Math.abs(this.geoInfo.maxLat-this.geoInfo.minLat),Math.abs(this.geoInfo.maxLong-this.geoInfo.minLong));if(o>2)return console.warn("Unusual large(",o,") project ",this.name,this.id),!1}return!0}},{key:"processProjectInfo",value:function(e){this.id=e.id,this.name=e.name,this.owner=e.owner,this.isImported=e.isImported,this.views=e.views,this.date=e.date,this.versionControl=null===e.versionControl?"":e.versionControl,this.cloudPath=e.cloudPath;var t=e.modelTransform;t.lengthUnitToMeter=1,this.modelTransform={origin:n(t.origin),xDir:n(t.xDir),yDir:n(t.yDir),zDir:n(t.zDir),maxBound:n(t.maxBound),minBound:n(t.minBound),xTiles:t.xTiles,yTiles:t.yTiles,zTiles:t.zTiles,floorHeight:t.floorHeight,lengthUnitToMeter:"undefined"===t.lengthUnitToMeter?1:t.lengthUnitToMeter,objToOldDisplay:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;(isNaN(r)||r<=0)&&(console.warn("lengthUnitToMeter",r),r=1);var n=function(e){var t=new a.Matrix4;e instanceof Array?3===e.length?t.makeRotationX(Math.PI*e[0]).multiply((new a.Matrix4).makeRotationY(Math.PI*e[1])).multiply((new a.Matrix4).makeRotationZ(Math.PI*e[2])):16===e.length?t.set.apply(t,e):console.error("AltizureProjectInfo unrecognized onLoadTrans",e):"object"===(void 0===e?"undefined":o(e))&&void 0!==e.x&&void 0!==e.y&&void 0!==e.z&&t.makeRotationX(Math.PI*e.x).multiply((new a.Matrix4).makeRotationY(Math.PI*e.y)).multiply((new a.Matrix4).makeRotationZ(Math.PI*e.z));return t}(e),i=(new a.Matrix4).makeTranslation(-t[0],-t[1],-t[2]),s=(new a.Matrix4).makeScale(r,r,r);return n=n.multiply(i).multiply(s)}(t.onLoadTrans,t.origin,t.lengthUnitToMeter),initialCamPos:{cameraPos:n(t.initialCamPos.cameraPos),centerPos:n(t.initialCamPos.centerPos)}},this.modelTransform.objToDisplay=function(e,t,r){var n=(new a.Euler).setFromRotationMatrix(e);return n.x-=1.5*Math.PI,(new a.Matrix4).multiply((new a.Matrix4).makeRotationFromEuler(n)).multiply((new a.Matrix4).makeTranslation(-t.x*r,-t.y*r,-t.z*r)).multiply((new a.Matrix4).makeScale(r,r,r))}(this.modelTransform.objToOldDisplay,this.modelTransform.origin,this.modelTransform.lengthUnitToMeter);var r=e.geoInfo;return r instanceof Object?this.geoInfo={autoAligned:r.autoAligned,manualAligned:r.manualAligned,centerLat:r.centerLat,centerLong:r.centerLong,maxLat:r.maxLat,minLat:r.minLat,maxLong:r.maxLong,minLong:r.minLong,transformed:r.transformed}:this.geoInfo={},null!==this.geoInfo.centerLat&&void 0!==this.geoInfo.centerLat||(this.geoInfo.centerLat=2.8125),null!==this.geoInfo.centerLong&&void 0!==this.geoInfo.centerLong||(this.geoInfo.centerLong=2.8125),this.minLevel=0,this.maxLevel=function(e,t){var r=Math.max(e,t),n=0;for(;r>1;)r/=2,n++;return n}(t.xTiles,t.yTiles),this.minDisplayLevel=0,this.maxDisplayLevel=this.maxLevel,this;function n(e){return e instanceof Array&&3===e.length?new a.Vector3(e[0],e[1],e[2]):e&&e.x&&e.y&&e.z?new a.Vector3(e.x,e.y,e.z):void console.error("objToVec3 invalid obj",e)}}},{key:"orthoInfo",value:function(e){var t=function(t){var r=t.minBound,n=t.maxBound,i=t.origin,s=t.xDir,u=t.yDir,l=t.zDir,c=new Array(8);c[0]=r.clone(),c[1]=new a.Vector3(r.x,n.y,r.z),c[2]=new a.Vector3(n.x,r.y,r.z),c[3]=new a.Vector3(n.x,n.y,r.z);for(var f=0;f<4;++f)c[f+4]=c[f].clone().setZ(n.z);for(var h=new Array(2),d=0;d<8;++d){var p=o(i,s,u,l,c[d]);p.applyMatrix4(e),0===d?(h[0]=p.clone(),h[1]=p.clone()):(h[0].x=Math.min(h[0].x,p.x),h[0].y=Math.min(h[0].y,p.y),h[0].z=Math.min(h[0].z,p.z),h[1].x=Math.max(h[1].x,p.x),h[1].y=Math.max(h[1].y,p.y),h[1].z=Math.max(h[1].z,p.z))}return h}(n({},this.modelTransform)),r=(new a.Matrix4).extractRotation(e).transpose();return{origin:this.modelTransform.origin.clone(),xDir:new a.Vector3(1,0,0).applyMatrix4(r),yDir:new a.Vector3(0,1,0).applyMatrix4(r),zDir:new a.Vector3(0,0,1).applyMatrix4(r),minBound:t[0],maxBound:t[1],width:t[1].x-t[0].x,height:t[1].z-t[0].z,area:(t[1].x-t[0].x)*(t[1].z-t[0].z)};function o(e,t,r,n,o){var i=t.clone().multiplyScalar(o.x),a=r.clone().multiplyScalar(o.y),s=n.clone().multiplyScalar(o.z);return e.clone().add(i).add(a).add(s)}}},{key:"valid",get:function(){return this.validate()}}]),e}();t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0},i=c(r(32)),a=c(r(20)),s=c(r(13)),u=c(r(3)),l=r(0);function c(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(e,r){var n=r.sceneGraphRoot,o=r.name,i=void 0===o?"AltizureProjectTree":o,c=r.eventHandlers,f=r.debug,h=r.altizureApi,d=r.projInfo,p=r.eventQueue,v=r.countryName,y=r.TreeMaterialType,m=void 0===y?u.default:y,g=r.NodeMaterialType,_=void 0===g?d.isImported?a.default:s.default:g,b=r.loadWorker;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),h||console.warn("AltizureProjectTree altizureApi undefined.");var w=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,{sceneGraphRoot:n,name:i,eventHandlers:c,debug:f,maxLevel:d.maxLevel,minLevel:d.minLevel,TreeMaterialType:m,NodeMaterialType:_}));w._countryName=v,w._altizureApi=h,w.sharedOptions.maxLevel=d.maxLevel,w.sharedOptions.projInfo=d,w.sharedOptions.eventQueue=p,w.sharedOptions.frustumInTree=new l.Frustum,w.sharedOptions.treeToScreen=new l.Matrix4,w.sharedOptions.dataUrl=w.dataUrl,w.sharedOptions.treeMaterial=w.material,w.sharedOptions.loadWorker=b;var A={parent:null,x:0,y:0,level:0,sharedOptions:w.sharedOptions};return w.root=new w.Node(A),w.numOfNodes++,d.isImported&&(w.style.flatShading=!0),w}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),n(t,[{key:"destruct",value:function(){var e=!0;return e=o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)&&e}},{key:"preSceneUpdate",value:function(e){var r=e.camera;return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"preSceneUpdate",this).call(this,{camera:r}),this._updateCameraPose({camera:r}),!0}},{key:"_updateCameraPose",value:function(e){var t=e.camera,r=t.matrixWorldInverse.clone().multiply(this.sceneGraphRoot.matrixWorld);this.sharedOptions.frustumInTree.setFromMatrix((new l.Matrix4).multiplyMatrices(t.projectionMatrix,r)),this.sharedOptions.treeToScreen.multiplyMatrices(t.projectionMatrix,r)}},{key:"altizureApi",get:function(){return this._altizureApi}},{key:"projInfo",get:function(){return this.sharedOptions.projInfo}},{key:"countryName",get:function(){return this._countryName}},{key:"basepath",get:function(){var e=[];"China"===this.countryName?(e[0]="oss_sz",e[1]="s3",e[2]="oss_usw",e[3]="local"):(e[0]="s3",e[1]="oss_usw",e[2]="oss_sz",e[3]="local");for(var t=e,r=this.projInfo.cloudPath,n=void 0,o=0;o<t.length;o++){for(var i=0;i<r.length;i++)if(r[i].key===t[o]){n=r[i].dataUrl;break}if(n)break}return n||console.error("preferredPath error",this.name,r,t),Object.defineProperty(this,"basepath",{value:n,writable:!1,configurable:!0}),this.basepath}},{key:"dataUrl",get:function(){var e=this.basepath;e&&e.length>0&&"/"===e[0]&&(e="https://www.altizure.com"+e);var t=e+"/web/";return Object.defineProperty(this,"dataUrl",{value:t,writable:!1,configurable:!0}),this.dataUrl}}]),t}();t.default=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0},i=r(0),a=y(r(8)),s=y(r(34)),u=y(r(27)),l=y(r(89)),c=y(r(1)),f=y(r(90)),h=r(14),d=r(21),p=r(22),v=r(91);function y(e){return e&&e.__esModule?e:{default:e}}function m(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,i){try{var a=t[o](i),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}var g=function(e){function t(e){var r=e.parent,n=e.x,o=e.y,i=e.level,a=e.showBBox,s=void 0!==a&&a,u=e.sharedOptions;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var l=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:r,x:n,y:o,level:i,sharedOptions:u}));return l.name=i+"_"+l.xId+"_"+l.yId,l.showBBox=s,l.showBBox&&l.decoHolder.add(l.boxMesh),l._bbox=null,l._estimatedBBox=null,l.trial=0,l.maxReloads=2,l.style={map:void 0,color:16777215},l.contentLoaded.then(function(){l.updateBBox()}),l}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),n(t,[{key:"destruct",value:function(){var e=o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this);return this.trial=0,this.style=void 0,this._material&&((0,d.disposeMaterial)(this._material),this._material=void 0),this.showBBox&&(this.decoHolder.remove(this.boxMesh),this.boxMesh.geometry.dispose(),this.boxMesh.material.dispose()),e}},{key:"download",value:function(){var e=m(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._downloadAndDecode());case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"cook",value:function(){var e=m(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._cookDownload(t));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"defaultCooked",value:function(){var e=m(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new f.default({key:this.resourceKey,value:{isPlaceHolder:!0},weight:1,is404:this.is404}),e.abrupt("return",Promise.resolve(t));case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"digest",value:function(e){if(e.is404)return this.is404=e.is404,new i.Object3D;this.geometry=e.value.geometry,this.style=e.value.material;var t=void 0;return this.geometry.index&&this.geometry.index.count>0?t=new i.Mesh(this.geometry,this.material):(this.geometry.index=null,t=new i.Points(this.geometry,new i.PointsMaterial({size:Math.max(1,this.maxLevel+1-this.level)/c.default.EARTH_RADIUS/4,vertexColors:i.VertexColors}))),t}},{key:"_updateVisibility",value:function(){var e=new i.Box3;return e.setFromPoints(this.boundingBox),this.sharedOptions.frustumInTree.intersectsBox(e)}},{key:"_updateScreenArea",value:function(){if(this.is404)return 0;var e=!1,t=this,r=0,n=[{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}];return this.visible?(e&&console.log("visible"),r=o([0,1,2,3])+o([7,6,5,4])+.8*o([3,2,6,7])+.8*o([5,6,2,1])+.8*o([4,5,1,0])+.8*o([0,3,7,4])):(r=0,e&&console.log("inivisible")),e&&console.log(this.info,r),r;function o(r){if(4!==r.length)return console.error("projecting wrong number of vertices",r),0;for(var o=[],i=0;i<r.length;i++){var a=r[i];o[i]=t.boundingBox[a].clone(),o[i].applyMatrix4(t.sharedOptions.treeToScreen)}if(e&&console.log(JSON.stringify(o)),function(e){var t={front:!1,back:!1};return e.forEach(function(e){if(e.z>=1)t.back=!0;else{if(!(e.z<1&&e.z>0))return!1;t.front=!0}}),t.front&&t.back}(o))return Math.max(.1,1/(t.level+.1));var s=(0,h.polygonIntersectArea)(n,o);return Math.max(0,s)}}},{key:"_prefetch",value:function(e){return function e(t,r){return 0!==r&&(t.isRoot||!t.parent.is404&&t.parent.loaded||e(t.parent,r--))}(this,e)}},{key:"updateBBox",value:function(){if(this.is404)return!0;var e=this.projInfo.modelTransform,t=e.zDir.clone(),r=this.content;if(void 0===r||null===r)return console.warn("updateBBox: mesh is not loaded"),this.boundingBox;this._boundingBox=this.estimatedBBox.map(function(e){return e.clone()}),r.geometry.computeBoundingBox();var n=r.geometry.boundingBox,o=n.min.x,a=n.max.x,s=n.min.y,u=n.max.y,l=n.min.z,c=n.max.z,f=[];f[0]=new i.Vector3(o,s,l),f[1]=new i.Vector3(a,s,l),f[2]=new i.Vector3(a,u,l),f[3]=new i.Vector3(o,u,l),f[4]=new i.Vector3(o,s,c),f[5]=new i.Vector3(a,s,c),f[6]=new i.Vector3(a,u,c),f[7]=new i.Vector3(o,u,c);for(var h=0;h<f.length;h++)r.updateMatrix(),f[h].applyMatrix4(r.matrix);for(var d=[],p=0;p<f.length;p++){f[p].sub(e.origin);var v=f[p].clone().dot(t);d[p]=v}for(var y=Math.min.apply(Math,d),m=Math.max.apply(Math,d),g=t.clone().multiplyScalar(y),_=t.clone().multiplyScalar(m),b=this._boundingBox[0].clone().sub(e.origin),w=t.clone().multiplyScalar(b.dot(t)),A=this._boundingBox[4].clone().sub(e.origin),x=t.clone().multiplyScalar(A.dot(t)),k=0;k<4;k++)this._boundingBox[k].sub(w).add(g);for(var T=4;T<this._boundingBox.length;T++)this._boundingBox[T].sub(x).add(_);return this._updateBoxMesh(),function r(n,o,i){for(var a=0;a<n.nodes.length;a++){var s=n.nodes[a];if(!s.loaded){var u=s.estimatedBBox[0].clone();u.sub(e.origin);var l=t.clone().multiplyScalar(u.dot(t)),c=s.estimatedBBox[4].clone();c.sub(e.origin);for(var f=t.clone().multiplyScalar(c.dot(t)),h=0;h<4;h++)s.estimatedBBox[h].sub(l).add(o);for(var d=4;d<8;d++)s.estimatedBBox[d].sub(f).add(i);r(s,o,i)}}}(this,g,_),this.boundingBox}},{key:"_initBBox",value:function(){var e=this.projInfo.modelTransform,t=(e.maxBound.x-e.minBound.x)/e.xTiles,r=(e.maxBound.y-e.minBound.y)/e.yTiles,n=e.xDir.clone().multiplyScalar(e.minBound.x+t*this.xId),o=e.xDir.clone().multiplyScalar(e.minBound.x+t*(this.xId+this.levelBlockSize)),i=e.yDir.clone().multiplyScalar(e.minBound.y+r*this.yId),a=e.yDir.clone().multiplyScalar(e.minBound.y+r*(this.yId+this.levelBlockSize)),s=e.zDir.clone().multiplyScalar(e.minBound.z),u=e.zDir.clone().multiplyScalar(e.maxBound.z);if(this.parent){var l=this.parent.boundingBox[0].clone();l.sub(e.origin),s=e.zDir.clone().multiplyScalar(l.dot(e.zDir));var c=this.parent.boundingBox[4].clone();c.sub(e.origin),u=e.zDir.clone().multiplyScalar(c.dot(e.zDir))}var f=[];return f[0]=e.origin.clone().add(n).add(i).add(s),f[1]=e.origin.clone().add(o).add(i).add(s),f[2]=e.origin.clone().add(o).add(a).add(s),f[3]=e.origin.clone().add(n).add(a).add(s),f[4]=e.origin.clone().add(n).add(i).add(u),f[5]=e.origin.clone().add(o).add(i).add(u),f[6]=e.origin.clone().add(o).add(a).add(u),f[7]=e.origin.clone().add(n).add(a).add(u),f}},{key:"_bBoxMesh",value:function(){var e=new i.BoxGeometry(1,1,1);e.vertices[0]=this.boundingBox[6].clone(),e.vertices[1]=this.boundingBox[2].clone(),e.vertices[2]=this.boundingBox[5].clone(),e.vertices[3]=this.boundingBox[1].clone(),e.vertices[4]=this.boundingBox[3].clone(),e.vertices[5]=this.boundingBox[7].clone(),e.vertices[6]=this.boundingBox[0].clone(),e.vertices[7]=this.boundingBox[4].clone();var t=new a.default({color:function(e){var t=1e4*Math.sin(e++);return 16777215*(t-Math.floor(t))}(this.level+this.x+this.y),wireframe:!0});return new i.Mesh(e,t)}},{key:"_updateBoxMesh",value:function(){var e=this.boxMesh.geometry.vertices;e[0]=this.boundingBox[6].clone(),e[1]=this.boundingBox[2].clone(),e[2]=this.boundingBox[5].clone(),e[3]=this.boundingBox[1].clone(),e[4]=this.boundingBox[3].clone(),e[5]=this.boundingBox[7].clone(),e[6]=this.boundingBox[0].clone(),e[7]=this.boundingBox[4].clone()}},{key:"updateMaterial",value:function(){if(this.is404)return!0;if(this.loaded){var e=this._material;this._material=null,this.content.material=this.material,(0,d.disposeMaterial)(e)}return!0}},{key:"_downloadAndDecode",value:function(){return this.loadWorker.load({resourceKey:this.resourceKey,timeout:3e4})}},{key:"_cookDownload",value:function(e){var t=this,r=e.geometry,n=e.images,o=e.materials,a=(e.bbox,[]),s={};for(var u in o)s[u]=a.length,o[u].name=u,a.push(o[u]);o=void 0,a=(0,d.extractMaterialParams)(a,"phong");var l=new i.BufferGeometry;for(var c in r.attributes)l.addAttribute(c,new i.BufferAttribute(r.attributes[c],v.ATTRIBUTE_SIZE[c])),r.attributes[c]=void 0;return r.attributes=void 0,r.index&&(l.setIndex(new i.BufferAttribute(r.index,1)),r.index=void 0),r.groups.forEach(function(e){l.addGroup(e.start,e.count,s[e.materialName])}),r.groups=void 0,(0,p.stringsToTextures)(n).then(function(e){n=void 0,a.forEach(function(t){t.map&&(t.map=e[t.map]),t.emissiveMap&&(t.emissiveMap=e[t.emissiveMap]),t.specularMap&&(t.specularMap=e[t.specularMap])});var r={geometry:l,material:a,matrix:(new i.Matrix4).identity()},o={key:t.resourceKey,value:r,weight:1};return Promise.resolve(new f.default(o))})}},{key:"resourceKey",get:function(){var e=this.dataUrl+this.encryptName+".ab";return Object.defineProperty(this,"resourceKey",{value:e,writable:!1,configurable:!0}),this.resourceKey}},{key:"expandable",get:function(){return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"expandable",this)&&this.level<this.maxDisplayLevel&&this._prefetch(2)}},{key:"maxLevel",get:function(){return this.sharedOptions.maxLevel}},{key:"projInfo",get:function(){return this.sharedOptions.projInfo}},{key:"maxDisplayLevel",get:function(){return this.sharedOptions.projInfo.maxDisplayLevel}},{key:"eventQueue",get:function(){return this.sharedOptions.eventQueue}},{key:"loadWorker",get:function(){return this.sharedOptions.loadWorker}},{key:"dataUrl",get:function(){return this.sharedOptions.dataUrl}},{key:"levelBlockSize",get:function(){return Object.defineProperty(this,"levelBlockSize",{value:Math.pow(2,this.maxLevel-this.level),writable:!1,configurable:!0}),this.levelBlockSize}},{key:"xId",get:function(){return Object.defineProperty(this,"xId",{value:this.x*this.levelBlockSize,writable:!1,configurable:!0}),this.xId}},{key:"yId",get:function(){return Object.defineProperty(this,"yId",{value:this.y*this.levelBlockSize,writable:!1,configurable:!0}),this.yId}},{key:"versionControl",get:function(){return this.projInfo.versionControl}},{key:"encryptName",get:function(){var e=this.versionControl,t=(0,u.default)(this.name+e).toString(l.default);return Object.defineProperty(this,"encryptName",{value:t,writable:!1,configurable:!0}),this.encryptName}},{key:"boundingBox",get:function(){return this._boundingBox?this._boundingBox:this.estimatedBBox}},{key:"estimatedBBox",get:function(){return Object.defineProperty(this,"estimatedBBox",{value:this._initBBox(),writable:!1,configurable:!0}),this.estimatedBBox}},{key:"boxMesh",get:function(){return Object.defineProperty(this,"boxMesh",{value:this._bBoxMesh(),writable:!1,configurable:!0}),this.boxMesh}},{key:"material",get:function(){var e=this;if(!this._material)if(this.style instanceof Array){this._material=[];var t={},r=this;this.style.forEach(function(n){var o={style:n,tree:{style:t},geometry:r.geometry},i=e.sharedOptions.treeMaterial.generateTileMaterial(o);i.needsUpdate=!0,e._material.push(i)})}else this._material=this.sharedOptions.treeMaterial.generateTileMaterial(this),this._material.needsUpdate=!0;return this._material}}]),t}();g.stat={download:{time:0,count:0},processing:{time:0,count:0},cook:{time:0,count:0}},t.default=g},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(r(93));var i=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.worker=new o.default,this.listeners=new Map,this.worker.onmessage=function(e){var r=e.data.resourceKey,n=e.data.status,o=e.data.payload;if(t.listeners.has(r)){var i=t.listeners.get(r);t.listeners.delete(r),i.forEach(function(e){var t=e.resolve,r=e.reject;200===n?t(o):r(o)})}else console.error("AltizureLoader",r)},this.worker.onerror=function(e){console.error("AltizureLoader",e)}}return n(e,[{key:"destruct",value:function(){return this.listeners.clear(),this.terminate()}},{key:"terminate",value:function(){if(this.worker)try{this.worker.terminate()}catch(e){return console.error("AltizureLoader terminate failed",e),!1}return!0}},{key:"load",value:function(e){var t=this,r=e.resourceKey,n=e.timeout,o=void 0===n?3e4:n;return new Promise(function(e,n){var i={resolve:e,reject:n};if(t.listeners.has(r)){t.listeners.get(r).push(i)}else{t.listeners.set(r,[i]);var a={resourceKey:r,timeout:o};t.worker.postMessage(a)}})}},{key:"numOfTasks",get:function(){return this.listeners.size}}]),e}();t.default=i},function(e,t,r){"use strict";var n=window.URL||window.webkitURL;e.exports=function(e,t){try{try{var r;try{(r=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder)).append(e),r=r.getBlob()}catch(t){r=new Blob([e])}return new Worker(n.createObjectURL(r))}catch(t){return new Worker("data:application/javascript,"+encodeURIComponent(e))}}catch(e){if(!t)throw Error("Inline worker is not supported");return new Worker(t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=s(r(33)),i=s(r(23)),a=r(0);function s(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.default,r=arguments[1],n=r.name,o=r.sceneGraphRoot,s=r.eventHandlers,u=r.maxLevel,l=r.minLevel,c=r.debug,f=r.osgInfo,h=r.loadWorker;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var d=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,{name:n,sceneGraphRoot:o,eventHandlers:s,maxLevel:u,minLevel:l,debug:c}));d.osgInfo=f,d.sharedOptions.osgInfo=f,d.sharedOptions.TILE_DOWNLOAD_TIMEOUT=3e4,d.sharedOptions.loadWorker=h,d.sharedOptions.frustumInTree=new a.Frustum,d.sharedOptions.treeToScreen=new a.Matrix4;var p={parent:null,name:"root",fileName:f.rootFileName,sharedOptions:d.sharedOptions,depth:0};return d.root=new d.Node(p),d}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),n(t,[{key:"preSceneUpdate",value:function(e){var r=e.camera;return function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"preSceneUpdate",this).call(this,{camera:r}),this._updateCameraPose({camera:r}),!0}},{key:"_updateCameraPose",value:function(e){var t=e.camera,r=t.matrixWorldInverse.clone().multiply(this.sceneGraphRoot.matrixWorld);this.sharedOptions.frustumInTree.setFromMatrix((new a.Matrix4).multiplyMatrices(t.projectionMatrix,r)),this.sharedOptions.treeToScreen.multiplyMatrices(t.projectionMatrix,r)}},{key:"expand",value:function(e){return e.level>this.maxLevel?(console.warn("exceed max level",e.level,this.maxLevel),!1):e.nodes.length>0?(console.warn(e,"children exist"),!1):0!==e.nodes.length||e.spawn()}}]),t}();t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=u(r(3)),i=u(r(43)),a=u(r(44)),s=r(0);function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.tree,n=e.Type;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{tree:r,Type:n}));return o._projectorUniforms={projectors:{value:[]},depthTexture:{value:[]},count:{type:"i",value:0}},o.renderer=new s.WebGLRenderer({antialias:!0,premultipliedAlpha:!1,alpha:!1,logarithmicDepthBuffer:!1}),o.renderer.setClearColor(new s.Color(.15294117647058825,.15294117647058825,.15294117647058825),void 0),o.renderer.setPixelRatio(1),o.renderer.setSize(1024,1024),o.renderer.context.getExtension("OES_standard_derivatives"),o.renderer.name="Projector renderer",o.offline_renderer=new a.default(o.renderer),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),n(t,[{key:"destruct",value:function(){var e=!0;return this.clearProjectors(),e=this.offline_renderer.destruct()&&e,this.offline_renderer=null,this.renderer.dispose(),this.renderer.forceContextLoss(),this.renderer.context=null,this.renderer.domElement=null,this.renderer=null,e=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)&&e}},{key:"generateTileMaterial",value:function(e){var t={map:e.style.map,projectorUniforms:this._projectorUniforms};return new this.Type(t)}},{key:"addProjector",value:function(e){var t=e.options,r=e.ProjectorType,n=new(void 0===r?i.default:r)(t);return this._projectorUniforms.projectors.value.push(n),this._projectorUniforms.depthTexture.value.push(n.depthTexture),this._projectorUniforms.count.value+=1,n}},{key:"getProjectorIndex",value:function(e){if(!e)return-1;for(var t=-1,r=0;r<this.projectors.length;++r)if(this.projectors[r].ID===e.ID){t=r;break}return t}},{key:"clearProjectors",value:function(){this._projectorUniforms.count.value=0;var e=this._projectorUniforms.projectors.value.map(function(e){return e});this._projectorUniforms.projectors.value.splice(0,this._projectorUniforms.projectors.value.length),this._projectorUniforms.depthTexture.value.splice(0,this._projectorUniforms.depthTexture.value.length),this._projectorUniforms.videoTexture.value.splice(0,this._projectorUniforms.videoTexture.value.length),e.map(function(e){e.destruct()})}},{key:"removeProjectorByIndex",value:function(e){var t=this._projectorUniforms.projectors.value[e];t&&(this._projectorUniforms.count.value-=1,this._projectorUniforms.projectors.value.splice(e,1),this._projectorUniforms.depthTexture.value.splice(e,1),t.destruct())}},{key:"_updateMaterials",value:function(){this.tree.traverse(this.tree.root,function(e){if(e&&e.content&&e.content.material){var t=e.content.material;if(Array.isArray(t))for(var r=0;r<t.length;++r)t[r].update&&t[r].update();else t.update&&t.update()}})}},{key:"projectors",get:function(){return this._projectorUniforms.projectors.value}}]),t}();t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0);var i=function(){function e(t){var r=t.camera,n=t.target,i=t.parent,a=t.sceneGraphRoot,s=t.offline_renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.camera=r,this.parent=i,this.sceneGraphRoot=a,this.offline_renderer=s,this._target=n,this.ID=this.camera.uuid,this.sceneGraphRoot.add(this.camera),this.camera.updateProjectionMatrix(),this.camera.updateMatrix(),this.camera.updateMatrixWorld(),this.depthTexture=new o.DataTexture(new Float32Array([0,0,0]),1,1,o.RGBFormat,o.FloatType,o.UVMapping),this.localToVideo=(new o.Matrix4).getInverse(this.camera.matrix),this.videoProjectionMatrix=this.camera.projectionMatrix,this.projectorLogDepthBufferFC=2/(Math.log(1+this.camera.far)/Math.LN2),this.visible=!0}return n(e,[{key:"updateDepthTexture",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;this.camera.updateProjectionMatrix(),this.camera.updateMatrix(),this.camera.updateMatrixWorld();var r=this.offline_renderer.renderDepthSnapshot(this.camera,[this.sceneGraphRoot],e,t,{side:o.DoubleSide});this.depthTexture&&this.depthTexture.dispose&&this.depthTexture.dispose();for(var n=new Float32Array(3*e*t),i=0;i<r.length;++i){var a=3*i,s=r[i];n[a]=s,n[a+1]=s,n[a+2]=s}this.depthTexture.image={data:n,width:e,height:t},this.depthTexture.needsUpdate=!0}},{key:"destruct",value:function(){return this.sceneGraphRoot.remove(this.camera),this.depthTexture&&this.depthTexture.dispose&&(this.depthTexture.dispose(),this.depthTexture=null),this.camera=null,this.parent=null,this.sceneGraphRoot=null,!0}},{key:"lookAt",value:function(e,t,r){e&&this.camera.position.set(e.x,e.y,e.z),t&&this.camera.up.set(t.x,t.y,t.z),r&&(this._target=r,this.camera.matrix.setPosition(this.camera.position).lookAt(this.camera.position,new o.Vector3(r.x,r.y,r.z),this.camera.up)),this.camera.matrix.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.localToVideo.copy((new o.Matrix4).getInverse(this.camera.matrix))}},{key:"near",get:function(){return this.camera.near},set:function(e){this.camera.near=e,this.camera.updateProjectionMatrix()}},{key:"far",get:function(){return this.camera.far},set:function(e){this.camera.far=e,this.camera.updateProjectionMatrix(),this.projectorLogDepthBufferFC=2/(Math.log(1+this.camera.far)/Math.LN2)}},{key:"position",get:function(){return this.camera.position.clone()},set:function(e){var t=e.x,r=e.y,n=e.z;this.lookAt(new o.Vector3(t,r,n),this.up,this.target)}},{key:"up",get:function(){return this.camera.up.clone()},set:function(e){var t=e.x,r=e.y,n=e.z;this.lookAt(this.position,new o.Vector3(t,r,n),this.target)}},{key:"target",get:function(){return this._target},set:function(e){this.lookAt(void 0,void 0,e)}}]),e}();t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0);var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderer=t,this.normalTarget=new o.WebGLRenderTarget,this.normalTarget.texture.format=o.RGBAFormat,this.normalTarget.texture.minFilter=o.NearestFilter,this.normalTarget.texture.magFilter=o.NearestFilter,this.normalTarget.texture.generateMipmaps=!1,this.scene=new o.Scene,this.depthShaderMaterial=new o.ShaderMaterial({uniforms:{logDepthBufFC:{type:"f",value:1}},vertexShader:"\n      #ifdef USE_LOGDEPTHBUF\n        #ifdef USE_LOGDEPTHBUF_EXT\n          varying float vFragDepth;\n        #else\n          uniform float logDepthBufFC;\n        #endif\n      #endif\n      void main() {\n        vec3 transformed = vec3( position );\n        vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n        gl_Position = projectionMatrix * mvPosition;\n        #ifdef USE_LOGDEPTHBUF\n          #ifdef USE_LOGDEPTHBUF_EXT\n            vFragDepth = 1.0 + gl_Position.w;\n          #else\n            gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n            gl_Position.z *= gl_Position.w;\n          #endif\n        #endif\n      }",fragmentShader:"\n      float shift_right(float v, float amt) {\n        v = floor(v) + 0.5;\n        return floor(v / exp2(amt));\n      }\n      float shift_left(float v, float amt) {\n        return floor(v * exp2(amt) + 0.5);\n      }\n      float mask_last(float v, float bits) {\n        return mod(v, shift_left(1.0, bits));\n      }\n      float extract_bits(float num, float from, float to) {\n        from = floor(from + 0.5);\n        to = floor(to + 0.5);\n        return mask_last(shift_right(num, from), to - from);\n      }\n      vec4 encode_float(float val) {\n        if (val == 0.0)\n          return vec4(0, 0, 0, 0);\n        float sign = val > 0.0 ? 0.0 : 1.0;\n        val = abs(val);\n        float exponent = floor(log2(val));\n        float biased_exponent = exponent + 127.0;\n        float fraction = ((val / exp2(exponent)) - 1.0) * 8388608.0;\n        \n        float t = biased_exponent / 2.0;\n        float last_bit_of_biased_exponent = fract(t) * 2.0;\n        float remaining_bits_of_biased_exponent = floor(t);\n        \n        float byte4 = extract_bits(fraction, 0.0, 8.0) / 255.0;\n        float byte3 = extract_bits(fraction, 8.0, 16.0) / 255.0;\n        float byte2 = (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0;\n        float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n        return vec4(byte4, byte3, byte2, byte1);\n      }\n      #if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n        uniform float logDepthBufFC;\n        varying float vFragDepth;\n      #endif\n      void main() {\n        #if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n          float depth = log2( vFragDepth ) * logDepthBufFC * 0.5;\n          gl_FragDepthEXT = depth;\n          gl_FragColor = encode_float(depth);\n        #else\n          gl_FragColor = encode_float(gl_FragCoord.z);\n        #endif\n      }"})}return n(e,[{key:"destruct",value:function(){return this.normalTarget.texture.dispose(),this.normalTarget.dispose(),this.depthShaderMaterial.dispose(),this.normalTarget.texture=null,this.normalTarget=null,this.scene=null,this.depthShaderMaterial=null,!0}},{key:"renderColorSnapshot",value:function(e,t,r,n){this.scene.overrideMaterial=void 0,this.normalTarget.setSize(r,n),this.scene.children=t;var o=this.renderer.getClearColor(),i=this.renderer.getClearAlpha();this.renderer.setClearColor(16777215,0),this.renderer.render(this.scene,e,this.normalTarget),this.renderer.setClearColor(o,i);var a=new Uint8Array(4*r*n);return this.renderer.readRenderTargetPixels(this.normalTarget,0,0,r,n,a),this.scene.children=[],a}},{key:"renderDepthSnapshot",value:function(e,t,r,n,i){var a={side:this.depthShaderMaterial.side};i&&void 0!==i.side&&(this.depthShaderMaterial.side=i.side),this.scene.overrideMaterial=this.depthShaderMaterial,this.scene.overrideMaterial.uniforms.logDepthBufFC.value=2/(Math.log(e.far+1)/Math.LN2),this.normalTarget.setSize(r,n),this.scene.children=t;var s=this.renderer.getClearColor(),u=this.renderer.getClearAlpha();this.renderer.setClearColor(new o.Color(0,0,128/255),63/255),this.renderer.render(this.scene,e,this.normalTarget),this.renderer.setClearColor(s,u);var l=new Uint8Array(4*r*n);this.renderer.readRenderTargetPixels(this.normalTarget,0,0,r,n,l);var c=new Float32Array(l.buffer);return this.scene.children=[],this.depthShaderMaterial.side=a.side,c}}]),e}();t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0);var a=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.level,o=e.x,i=e.y,a=e.projectorUniforms,s=e.map,u=(e.color,e.transparent),l=void 0!==u&&u,c=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(e,["level","x","y","projectorUniforms","map","color","transparent"]);!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var f=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,c));return f.level=r,f.x=o,f.y=i,f.uniforms=n({map:{type:"t",value:s}},a),f.update(),f.transparent=l,f}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.ShaderMaterial),o(t,[{key:"update",value:function(){var e=this.uniforms.count.value;if(e>=1){var t=l.slice(),r=c.slice();this.vertexShader=t.replace(/MAX_COUNT/g,e),this.fragmentShader=r.replace(/MAX_COUNT/g,e)}else this.vertexShader=s,this.fragmentShader=u;this.needsUpdate=!0}}]),t}(),s="\nvarying vec2 textureCoord;\n#include <logdepthbuf_pars_vertex>\nvoid main(){\n  vec3 transformed = vec3( position );\n  vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n  gl_Position = projectionMatrix * mvPosition;\n  textureCoord=uv;\n  #include <logdepthbuf_vertex>\n}\n",u="\nvarying vec2 textureCoord;\nuniform sampler2D map;\n#include <logdepthbuf_pars_fragment>\nvoid main(){\n  #include <logdepthbuf_fragment>\n  gl_FragColor=texture2D(map,textureCoord);\n}",l="\n// The model-view-projection matrix for the projector\n// This matrix is used to calculate the texture coordinates for the vertex. \nstruct Projector {\n  mat4 videoProjectionMatrix;\n  mat4 localToVideo;\n  float projectorLogDepthBufferFC;\n  bool visible;\n};\nuniform Projector projectors[MAX_COUNT];\nuniform sampler2D depthTexture[MAX_COUNT];\nuniform sampler2D videoTexture[MAX_COUNT];\nuniform int count;\n\n// varying vec3 transformedPosition;\n// varying vec3 transformedNormal;\nvarying vec2 textureCoord;\nvarying vec4 textureCoordProj[MAX_COUNT];\n\nmat4 scaleBiasedMatrix = mat4(0.5, 0.0, 0.0, 0.0,\n  0.0, 0.5, 0.0, 0.0,\n  0.0, 0.0, 0.5, 0.0,\n  0.5, 0.5, 0.5, 1.0);\n\n// #include <logdepthbuf_pars_vertex>\n\n#ifdef USE_LOGDEPTHBUF\n  #ifdef USE_LOGDEPTHBUF_EXT\n    varying float vFragDepth;\n\n    varying float videoFragDepth[MAX_COUNT];\n  #endif\n  uniform float logDepthBufFC;\n#endif\n\nvoid main() {\n  vec4 inPosition = vec4(position, 1.0);\n  vec3 transformed = vec3( position );\n  vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n  gl_Position = projectionMatrix * mvPosition;\n  textureCoord = uv;\n  \n  #pragma unroll_loop\n  for ( int i = 0; i < MAX_COUNT; i ++ ) {\n    textureCoordProj[ i ] = projectors[ i ].visible ?\n    scaleBiasedMatrix * projectors[ i ].videoProjectionMatrix * projectors[ i ].localToVideo * inPosition : textureCoordProj[ i ];\n  }\n  \n  // #include <logdepthbuf_vertex>\n  #ifdef USE_LOGDEPTHBUF\n    #ifdef USE_LOGDEPTHBUF_EXT\n      vFragDepth = 1.0 + gl_Position.w;\n\n      #pragma unroll_loop\n      for ( int i = 0; i < MAX_COUNT; i ++ ) {\n        videoFragDepth[ i ] = projectors[ i ].visible ?\n        1.0 + (projectors[ i ].videoProjectionMatrix * projectors[ i ].localToVideo * inPosition).w : videoFragDepth[ i ];\n      }\n    // #else\n    //   gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n    //   gl_Position.z *= gl_Position.w;\n    #endif\n  #endif\n}\n",c="\nstruct Projector {\n  mat4 videoProjectionMatrix;\n  mat4 localToVideo;\n  float projectorLogDepthBufferFC;\n  bool visible;\n};\nuniform Projector projectors[MAX_COUNT];\nuniform sampler2D depthTexture[MAX_COUNT];\nuniform sampler2D videoTexture[MAX_COUNT];\nuniform sampler2D map;\nuniform int count;\n\n// varying vec3 transformedPosition;\nvarying vec2 textureCoord;\nvarying vec4 textureCoordProj[MAX_COUNT];\n\n// #include <logdepthbuf_pars_fragment>\n#ifdef USE_LOGDEPTHBUF\n  uniform float logDepthBufFC;\n  #ifdef USE_LOGDEPTHBUF_EXT\n    varying float vFragDepth;\n\n    varying float videoFragDepth[MAX_COUNT];\n  #endif\n#endif\n\nbool inFustrum (vec4 texCoordProj) {\n  float videoY = texCoordProj.y / texCoordProj.w;\n  float videoX = texCoordProj.x / texCoordProj.w;\n  float videoZ = texCoordProj.z / texCoordProj.w;\n  float a = step(0.0, videoX) - step(1.0, videoX); // want 1.0 (inside range)\n  float b = step(0.0, videoY) - step(1.0, videoY); // want 1.0 (inside range)\n  float c = step(0.0, videoZ) - step(1.0, videoZ);\n\n  return (a == 1.0 && b == 1.0 && c == 1.0);\n}\nbool videoEffective (vec4 texCoordProj, sampler2D depthTex, float fragmentDepth) {\n  float bias = 0.01; // 0.05;\n  float depth = texture2DProj(depthTex, texCoordProj).x;\n  // depth = texture2D(depthTex, vec2(0.5, 0.5)).x;\n\n  float fragCoordZBiased = depth + bias;\n\n  float d = step(fragmentDepth, fragCoordZBiased);\n  return (d == 1.0);\n}\n\nvoid main() {\n  float videoFragDepthEXT[MAX_COUNT];\n\n  // #include <logdepthbuf_fragment>\n  #if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n    gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n\n    // for (int i = 0; i < MAX_COUNT; i += 1) {\n    //   videoFragDepthEXT[i] = log2( videoFragDepth[i] ) * projectors[i].projectorLogDepthBufferFC * 0.5;\n    // }\n  #endif\n\n  // For regular texture mapping\n  vec4 color = texture2D(map, textureCoord);\n\n  float fragmentDepth;\n  bool useVideo;\n  bool videoInFustrum;\n  vec4 videoTextureColor;\n\n  #pragma unroll_loop\n  for ( int i = 0; i < MAX_COUNT; i ++ ) {\n    // For perspective projection effect\n    fragmentDepth = projectors[ i ].visible ? textureCoordProj[ i ].z / textureCoordProj[ i ].w : fragmentDepth;\n    #if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n      fragmentDepth = projectors[ i ].visible ?\n      log2( videoFragDepth[ i ] ) * projectors[ i ].projectorLogDepthBufferFC * 0.5 : fragmentDepth;\n    #endif\n    videoInFustrum = projectors[ i ].visible ? inFustrum(textureCoordProj[ i ]) : false;\n    useVideo = videoInFustrum ?\n    videoEffective(textureCoordProj[ i ], depthTexture[ i ], fragmentDepth) : false;\n\n    videoTextureColor = projectors[ i ].visible ?\n    texture2DProj(videoTexture[ i ], textureCoordProj[ i ]) : videoTextureColor;\n\n    color = mix(color, videoTextureColor, float(useVideo));\n  }\n\n  gl_FragColor = vec4(color.xyz, 1.0);\n}\n";t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0);var a=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.level,o=e.x,i=e.y,a=e.map,l=e.cropSharedUniforms,c=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(e,["level","x","y","map","cropSharedUniforms"]);!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var f=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,c));return f.level=r,f.x=o,f.y=i,f.uniforms=n({map:{ype:"t",value:a}},l),f.vertexShader=s,f.fragmentShader=u,f}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.ShaderMaterial),o(t,[{key:"update",value:function(){this.needsUpdate=!0}}]),t}(),s="\nuniform vec3 origin;\nuniform vec3 xDir;\nuniform vec3 yDir;\nuniform vec3 zDir;\nuniform vec3 minBound;\nuniform vec3 maxBound;\nvarying vec2 textureCoord;\nvarying vec2 vMaskUv;\n#include <logdepthbuf_pars_vertex>\n\nvoid main(){\n  vec3 transformed = vec3( position );\n  vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n  gl_Position = projectionMatrix * mvPosition;\n  textureCoord = uv;\n  vec3 vori = position - origin;\n  vec3 vViewPosition = vec3(dot(vori, xDir), dot(vori, yDir), dot(vori, zDir));\n  vMaskUv = ((vViewPosition - minBound)/(maxBound - minBound)).xz;\n  #include <logdepthbuf_vertex>\n}\n",u="\nuniform sampler2D map;\nuniform sampler2D cropMask;\nvarying vec2 textureCoord;\nvarying vec2 vMaskUv;\n#include <logdepthbuf_pars_fragment>\n\nvoid main() {\n  #include <logdepthbuf_fragment>\n  // gl_FragColor = texture2D(map, textureCoord);\n\n  // use green chanel to reserve, red to cut\n  float os_val = texture2D(cropMask, vMaskUv).y;\n  if(os_val < 0.05) {discard;}\n  gl_FragColor = vec4(os_val * texture2D(map, textureCoord).xyz, 1.0);\n}\n";t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadMaskAPI=void 0;var n=function(e){return e&&e.__esModule?e:{default:e}}(r(109));var o=3e4;t.loadMaskAPI=function(e){var t=e.api,r=e.pid,i=e.type,a=e.debug,s=void 0!==a&&a;switch(i){case"crop":return function(e){var t=e.api,r=e.pid,i=e.debug;return t?t.cropMask({pid:r,timeout:o}).then(function(e){var t=0;i&&(t=Date.now());var r=n.default.unpackToImage(e.maskInfos[0]),o=e.maskInfos[0].height;return i&&console.log("decode time",Date.now()-t),e=void 0,Promise.resolve({image:r,maskSize:o})}):Promise.reject(new Error("No api"))}({api:t,pid:r,debug:s});case"water":return function(e){var t=e.api,r=e.pid,i=e.debug;return t?t.waterMask({pid:r,timeout:o}).then(function(e){if(null===e)return Promise.reject(new Error("No water exists."));var t=0;i&&(t=Date.now());var r=e.maskInfos.map(function(e){var t=e.level,r=e.alpha,o=e.wave,i=e.speed,a=void 0===i?.5:i,s=e.color,u=e.polyNum,l=e.width,c=e.height;return{image:n.default.unpackToImage(e),level:t,alpha:r,wave:o,speed:a,color:s,polyNum:u,width:l,height:c}});return i&&console.log("decode time",Date.now()-t),e=void 0,Promise.resolve(r)}):Promise.reject(new Error("No api"))}({api:t,pid:r,debug:s});default:var u="Uknown mask type"+i;return console.warn(u),Promise.reject(new Error(u))}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0);var i=function(){function e(t){var r=t.maskSize,n=void 0===r?4:r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._maskSize=n,this.canvas=document.createElement("canvas"),this.canvas.width=this.maskSize,this.canvas.height=this.maskSize,this.canvas.id="ProjectBooleanMask";var o=this.canvas.getContext("2d");o.fillStyle="#fff",o.fillRect(0,0,n,n),this.needsUpdate=!0}return n(e,[{key:"destruct",value:function(){return this.canvas=void 0,!0}},{key:"paintPolygon",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#000",r=this.canvas.getContext("2d"),n=e.length;if(!(n<3)){r.fillStyle=t,r.strokeStyle="#0f0",r.beginPath();var o=this.maskSize,i=e.map(function(e){var t=e.u,r=e.v;return{x:Math.floor(t*o),y:o-Math.floor(r*o)}}),a=i[--n];for(r.moveTo(a.x,a.y);n--;)r.lineTo(i[n].x,i[n].y);return r.closePath(),r.fill(),this.needsUpdate=!0,!0}}},{key:"clear",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"#0f0";return this.paintPolygon([{u:0,v:0},{u:0,v:1},{u:1,v:1},{u:1,v:0},{u:0,v:0}],e)}},{key:"maskSize",get:function(){return this._maskSize},set:function(e){e!==this.maskSize&&(this.canvas.width=e,this.canvas.height=e,this._maskSize=e)}},{key:"imageData",get:function(){return this.canvas.getContext("2d").getImageData(0,0,this.canvas.width,this.canvas.height).data},set:function(e){var t=e.uint8,r=e.maskSize;this.maskSize=r;var n=new ImageData(t,r,r);this.canvas.getContext("2d").putImageData(n,0,0),this.needsUpdate=!0}},{key:"texture",get:function(){if(this.needsUpdate){this._texture&&this._texture.dispose();var e=new Uint8Array(this.imageData,1);this._texture=new o.DataTexture(e,this.maskSize,this.maskSize,o.RGBAFormat,o.UnsignedByteType),this._texture.needsUpdate=!0}return this.needsUpdate=!1,this._texture}}]),e}();t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0);var a=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.level,o=e.x,a=e.y,s=e.projectorUniforms,u=e.transparent,l=void 0!==u&&u,c=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(e,["level","x","y","projectorUniforms","transparent"]);!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var f=c.map;f||console.warn("no map");new i.Color(1,1,1),new i.Color(0,0,0);var h=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return h.level=r,h.x=o,h.y=a,h.uniforms=n({map:{value:f}},s),h.update(),h.transparent=l,h}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.ShaderMaterial),o(t,[{key:"update",value:function(){var e=this.uniforms.count.value;if(e>=1){var t=l.slice(),r=c.slice();this.vertexShader=t.replace(/MAX_COUNT/g,e),this.fragmentShader=r.replace(/MAX_COUNT/g,e)}else this.vertexShader=s,this.fragmentShader=u;this.needsUpdate=!0}}]),t}(),s=["varying vec2 textureCoord;","#include <logdepthbuf_pars_vertex>","void main(){","vec3 transformed = vec3( position );","vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );","gl_Position = projectionMatrix * mvPosition;","textureCoord = uv;","#include <logdepthbuf_vertex>","}"].join("\n"),u=["varying vec2 textureCoord;","uniform sampler2D map;","#include <logdepthbuf_pars_fragment>","void main(){","#include <logdepthbuf_fragment>","gl_FragColor=texture2D(map,textureCoord);","}"].join("\n"),l=["struct Projector {","mat4 videoProjectionMatrix;","mat4 localToVideo;","float projectorLogDepthBufferFC;","bool visible;","};","uniform Projector projectors[MAX_COUNT];","uniform sampler2D depthTexture[MAX_COUNT];","uniform int count;","varying vec2 textureCoord;","varying vec4 textureCoordProj[MAX_COUNT];","mat4 scaleBiasedMatrix = mat4(0.5, 0.0, 0.0, 0.0,","0.0, 0.5, 0.0, 0.0,","0.0, 0.0, 0.5, 0.0,","0.5, 0.5, 0.5, 1.0);","#ifdef USE_LOGDEPTHBUF","#ifdef USE_LOGDEPTHBUF_EXT","varying float vFragDepth;","varying float videoFragDepth[MAX_COUNT];","#endif","uniform float logDepthBufFC;","#endif","void main() {","vec4 inPosition = vec4(position, 1.0);","vec3 transformed = vec3( position );","vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );","gl_Position = projectionMatrix * mvPosition;","textureCoord = uv;","#pragma unroll_loop","for ( int i = 0; i < MAX_COUNT; i ++ ) {","textureCoordProj[ i ] = projectors[ i ].visible ? scaleBiasedMatrix * projectors[ i ].videoProjectionMatrix * projectors[ i ].localToVideo * inPosition : textureCoordProj[ i ];","}","#ifdef USE_LOGDEPTHBUF","#ifdef USE_LOGDEPTHBUF_EXT","vFragDepth = 1.0 + gl_Position.w;","#pragma unroll_loop","for ( int i = 0; i < MAX_COUNT; i ++ ) {","videoFragDepth[ i ] = projectors[ i ].visible ? 1.0 + (projectors[ i ].videoProjectionMatrix * projectors[ i ].localToVideo * inPosition).w : videoFragDepth[ i ];","}","#endif","#endif","}"].join("\n"),c=["struct Projector {","mat4 videoProjectionMatrix;","mat4 localToVideo;","float projectorLogDepthBufferFC;","bool visible;","};","uniform Projector projectors[MAX_COUNT];","uniform sampler2D depthTexture[MAX_COUNT];","uniform int count;","varying vec2 textureCoord;","varying vec4 textureCoordProj[MAX_COUNT];","#ifdef USE_LOGDEPTHBUF","#ifdef USE_LOGDEPTHBUF_EXT","varying float vFragDepth;","varying float videoFragDepth[MAX_COUNT];","#endif","uniform float logDepthBufFC;","#endif","bool inFustrum (vec4 texCoordProj) {","float videoY = texCoordProj.y / texCoordProj.w;","float videoX = texCoordProj.x / texCoordProj.w;","float videoZ = texCoordProj.z / texCoordProj.w;","float a = step(0.0, videoX) - step(1.0, videoX);","float b = step(0.0, videoY) - step(1.0, videoY);","float c = step(0.0, videoZ) - step(1.0, videoZ);","return (a == 1.0 && b == 1.0 && c == 1.0);","}","bool videoEffective (vec4 texCoordProj, sampler2D depthTex, float fragmentDepth) {","float bias = 0.01;","float depth = texture2DProj(depthTex, texCoordProj).x;","float fragCoordZBiased = depth + bias;","float d = step(fragmentDepth, fragCoordZBiased);","return (d == 1.0);","}","uniform sampler2D map;","void main() {","float videoFragDepthEXT[MAX_COUNT];","#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )","gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;","#endif","vec4 mapColor = texture2D(map, textureCoord);","vec4 redColor = mix(vec4(1.0, 0.0, 0.0, 1.0), mapColor, 0.5);","vec4 greenColor = mix(vec4(0.0, 1.0, 0.0, 1.0), mapColor, 0.5);","vec4 color = mapColor;","float fragmentDepth;","bool useVideo;","bool videoInFustrum;","vec4 videoTextureColor;","#pragma unroll_loop","for ( int i = 0; i < MAX_COUNT; i ++ ) {","fragmentDepth = projectors[ i ].visible ? textureCoordProj[ i ].z / textureCoordProj[ i ].w : fragmentDepth;","#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )","fragmentDepth = projectors[ i ].visible ?","log2( videoFragDepth[ i ] ) * projectors[ i ].projectorLogDepthBufferFC * 0.5 : fragmentDepth;","#endif","videoInFustrum = projectors[ i ].visible ? inFustrum(textureCoordProj[ i ]) : false;","color = videoInFustrum ? redColor : color;","useVideo = videoInFustrum ?","videoEffective(textureCoordProj[ i ], depthTexture[ i ], fragmentDepth) : false;","color = useVideo ? greenColor : color;","}","gl_FragColor = vec4(color.xyz, 1.0);","}"].join("\n");t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=r(0);var i=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.level,i=e.x,u=e.y,l=e.map,c=(e.color,e.emissive,e.shininess,e.specular,e.specularMap,e.contourLineUniforms),f=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(e,["level","x","y","map","color","emissive","shininess","specular","specularMap","contourLineUniforms"]);!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var h=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,f));return h.level=r,h.x=i,h.y=u,h.uniforms=n({map:{value:l}},c),h.transparent=!0,h.vertexShader=a,h.fragmentShader=s,h.extensions.derivatives=!0,h.depthWrite=!0,h.side=o.DoubleSide,h}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.ShaderMaterial),t}(),a=["varying vec3 localPosition;","varying float slope;","varying vec2 vUv;","varying vec3 vPosition;","#include <logdepthbuf_pars_vertex>","void main() {","vUv = uv;","localPosition = position;","slope = abs(normalize(normal).z);","vec4 inPosition = vec4(position, 1.0);","vec3 transformed = vec3( position );","vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vPosition = (modelViewMatrix * inPosition).xyz;","#include <logdepthbuf_vertex>","}"].join("\n"),s=["varying vec3 localPosition;","varying float slope;","varying vec2 vUv;","varying vec3 vPosition;","uniform vec3 color;","uniform float heightInterval;","uniform float lineWidth;","uniform float mapAlpha;","uniform float distanceLimit;","uniform float worldToMeters;","uniform sampler2D map;","#include <logdepthbuf_pars_fragment>","void main() {","#include <logdepthbuf_fragment>","float distanceInMeters = worldToMeters * length(cameraPosition - vPosition);","float multiply = distanceInMeters / distanceLimit + 1.0;","multiply = multiply > 3.0 ? clamp(6.0 - multiply, 0.0, 3.0) : multiply;","float adaptedHeightInterval = heightInterval;","float adaptedLineWidth = min(lineWidth * multiply, heightInterval);","float f = abs(2.0 * fract(localPosition.z / adaptedHeightInterval) - 1.0);","float df = fwidth(localPosition.z / adaptedHeightInterval);","float fLimit0 = adaptedLineWidth * (1.0 + slope);","float fLimit1 = df * min(adaptedLineWidth, 10.0);","float fLimit = min(fLimit0, fLimit1);","float lineMix = f < fLimit ? f / fLimit : 1.0;","vec4 lineColor = vec4(color, 1.0);","vec4 mapColor = texture2D(map, vUv);","mapColor.a = mapAlpha;","gl_FragColor = mix(lineColor, mapColor, lineMix);","}"].join("\n");t.default=i},function(e,t,r){r(52),e.exports=r(53)},function(e,t){!function(t){"use strict";var r,n=Object.prototype,o=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag",l="object"==typeof e,c=t.regeneratorRuntime;if(c)l&&(e.exports=c);else{(c=t.regeneratorRuntime=l?e.exports:{}).wrap=b;var f="suspendedStart",h="suspendedYield",d="executing",p="completed",v={},y={};y[a]=function(){return this};var m=Object.getPrototypeOf,g=m&&m(m(C([])));g&&g!==n&&o.call(g,a)&&(y=g);var _=k.prototype=A.prototype=Object.create(y);x.prototype=_.constructor=k,k.constructor=x,k[u]=x.displayName="GeneratorFunction",c.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===x||"GeneratorFunction"===(t.displayName||t.name))},c.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,k):(e.__proto__=k,u in e||(e[u]="GeneratorFunction")),e.prototype=Object.create(_),e},c.awrap=function(e){return{__await:e}},T(O.prototype),O.prototype[s]=function(){return this},c.AsyncIterator=O,c.async=function(e,t,r,n){var o=new O(b(e,t,r,n));return c.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},T(_),_[u]="Generator",_[a]=function(){return this},_.toString=function(){return"[object Generator]"},c.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},c.values=C,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=r)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,o){return s.type="throw",s.arg=e,t.next=n,o&&(t.method="next",t.arg=r),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var u=o.call(a,"catchLoc"),l=o.call(a,"finallyLoc");if(u&&l){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),S(r),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;S(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=r),v}}}function b(e,t,r,n){var o=t&&t.prototype instanceof A?t:A,i=Object.create(o.prototype),a=new M(n||[]);return i._invoke=function(e,t,r){var n=f;return function(o,i){if(n===d)throw new Error("Generator is already running");if(n===p){if("throw"===o)throw i;return j()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=E(a,r);if(s){if(s===v)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===f)throw n=p,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=d;var u=w(e,t,r);if("normal"===u.type){if(n=r.done?p:h,u.arg===v)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n=p,r.method="throw",r.arg=u.arg)}}}(e,r,a),i}function w(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}function A(){}function x(){}function k(){}function T(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function O(e){var t;this._invoke=function(r,n){function i(){return new Promise(function(t,i){!function t(r,n,i,a){var s=w(e[r],e,n);if("throw"!==s.type){var u=s.arg,l=u.value;return l&&"object"==typeof l&&o.call(l,"__await")?Promise.resolve(l.__await).then(function(e){t("next",e,i,a)},function(e){t("throw",e,i,a)}):Promise.resolve(l).then(function(e){u.value=e,i(u)},function(e){return t("throw",e,i,a)})}a(s.arg)}(r,n,t,i)})}return t=t?t.then(i,i):i()}}function E(e,t){var n=e.iterator[t.method];if(n===r){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=r,E(e,t),"throw"===t.method))return v;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var o=w(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,v;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=r),t.delegate=null,v):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,v)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function C(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(o.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=r,t.done=!0,t};return i.next=i}}return{next:j}}function j(){return{value:r,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FunctionUtil=t.HtmlHelper=t.LoadUtil=t.EventUtil=t.BrowserCapatibility=t.RefreshQueue=t.AltizureProjectInfo=t.AltizureApi=t.MeshBasicMaterial2=t.ProjectBooleanMask=t.OfflineRendererClass=t.MaskLoader=t.presetTexture=t.ContourLineMaterial=t.VisibilityTileMaterial2=t.VisibilityTileMaterial=t.VisibilityTreeMaterial=t.TileWireframeMaterial=t.TileFlatMaterial=t.CropTileMaterial=t.CropTreeMaterial=t.VideoMaterial=t.TilePhysicalMaterial=t.TilePhongMaterial=t.PhongTreeMaterial=t.TileBasicMaterial=t.ContourLineTreeMaterial=t.ProjectorTreeMaterial=t.TreeMaterial=t.EarthMath=t.EarthConstants=t.OSGTile=t.OSGTree=t.OSGInfo=t.AltizureLoader=t.AltizureProjectTree=t.AltizureProjectTile=t.HyperLayer=t.HyperEntity=t.HyperNode=t.LodForest=t.EarthViewer=t.HyperViewer=t.testfunc3=t.testfunc2=t.testfunc1=void 0;var n=X(r(54)),o=X(r(24)),i=X(r(62)),a=X(r(11)),s=X(r(10)),u=X(r(12)),l=X(r(5)),c=X(r(38)),f=X(r(37)),h=X(r(39)),d=X(r(101)),p=X(r(41)),v=X(r(23)),y=X(r(7)),m=X(r(1)),g=X(r(3)),_=X(r(13)),b=X(r(102)),w=X(r(20)),A=X(r(103)),x=X(r(104)),k=X(r(105)),T=X(r(106)),O=X(r(45)),E=X(r(108)),P=X(r(46)),S=X(r(110)),M=X(r(111)),C=X(r(49)),j=X(r(112)),L=X(r(50)),B=K(r(16)),R=K(r(47)),I=X(r(44)),D=X(r(48)),U=X(r(113)),N=X(r(26)),F=X(r(36)),z=X(r(114)),G=X(r(9)),V=K(r(4)),W=K(r(22)),H=X(r(25)),Y=X(r(18));function K(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function X(e){return e&&e.__esModule?e:{default:e}}r(115);console.log(n.default.description,n.default.version),t.testfunc1=function(e){console.log(e)},t.testfunc2=function(e,t){return e+t},t.testfunc3=function(e){e.forEach(function(e){console.log(e+1)})},t.HyperViewer=o.default,t.EarthViewer=i.default,t.LodForest=a.default,t.HyperNode=l.default,t.HyperEntity=u.default,t.HyperLayer=s.default,t.AltizureProjectTile=c.default,t.AltizureProjectTree=f.default,t.AltizureLoader=h.default,t.OSGInfo=d.default,t.OSGTree=p.default,t.OSGTile=v.default,t.EarthConstants=y.default,t.EarthMath=m.default,t.TreeMaterial=g.default,t.ProjectorTreeMaterial=T.default,t.ContourLineTreeMaterial=j.default,t.TileBasicMaterial=_.default,t.PhongTreeMaterial=b.default,t.TilePhongMaterial=w.default,t.TilePhysicalMaterial=A.default,t.VideoMaterial=O.default,t.CropTreeMaterial=E.default,t.CropTileMaterial=P.default,t.TileFlatMaterial=x.default,t.TileWireframeMaterial=k.default,t.VisibilityTreeMaterial=S.default,t.VisibilityTileMaterial=M.default,t.VisibilityTileMaterial2=C.default,t.ContourLineMaterial=L.default,t.presetTexture=B,t.MaskLoader=R,t.OfflineRendererClass=I.default,t.ProjectBooleanMask=D.default,t.MeshBasicMaterial2=U.default,t.AltizureApi=N.default,t.AltizureProjectInfo=F.default,t.RefreshQueue=z.default,t.BrowserCapatibility=G.default,t.EventUtil=V,t.LoadUtil=W,t.HtmlHelper=H.default,t.FunctionUtil=Y.default},function(e){e.exports={name:"altizure-gl-engine",version:"2.3.15",description:"Altizure webgl engine",main:"./release/altizure-gl-engine.min.js",scripts:{lint:"eslint ./src/",test:"jest --runInBand",release:"rm -rf ./release/* && webpack --config webpack.config.release.js",debug:"rm -rf ./build/* && webpack --config webpack.config.debug.js",build:"npm run debug",doc:"jsdoc -c ./docs/jsdoc.tui.dev.json -r ./src/","setup-examples":"ln -s ../engine.examples/ engine.examples",example:"cp ./release/altizure-gl-engine.min.js ./engine.examples/public/js/altizure-gl-engine.min.js",prepublishOnly:"git checkout master && git merge beta && yarn && yarn release && npm version patch",postpublish:"git push bitbucket master && git checkout beta && git merge master && git push bitbucket beta",push:"git push bitbucket beta && git push github beta && git push gitlab beta"},repository:{type:"git",url:"git+ssh://git@bitbucket.org/jingbo/altizure.gl-engine2.git"},keywords:["altizure","webgl","engine"],author:"Jingbo LIU",license:"ISC",homepage:"https://bitbucket.org/jingbo/altizure.gl-engine2#readme",devDependencies:{"babel-cli":"^6.26.0","babel-core":"^6.26.3","babel-eslint":"^8.2.3","babel-jest":"^23.6.0","babel-loader":"^7.1.5","babel-preset-env":"^1.6.1","babel-preset-stage-2":"^6.24.1","es6-promise":"^4.2.5",eslint:"^4.19.1","eslint-config-standard":"^12.0.0-alpha.0","eslint-plugin-import":"^2.11.0","eslint-plugin-node":"^6.0.1","eslint-plugin-promise":"^3.7.0","eslint-plugin-standard":"^3.1.0",jest:"^23.6.0",jsdoc:"^3.5.5",path:"^0.12.7","regenerator-runtime":"^0.12.1","tui-jsdoc-template":"^1.2.2",webpack:"^4.17.0","webpack-bundle-analyzer":"^2.11.2","webpack-cli":"^3.1.0"},peerDependencies:{},dependencies:{axios:"^0.18.0",cmask:"^1.0.2","crypto-js":"^3.1.9-1","normalize-path":"^3.0.0",three:"0.97.0","worker-loader":"^2.0.0"}}},function(e,r){e.exports=t},function(e,t,r){e.exports=function(e){return function(){var t=e,r=t.lib.BlockCipher,n=t.algo,o=[],i=[],a=[],s=[],u=[],l=[],c=[],f=[],h=[],d=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var r=0,n=0;for(t=0;t<256;t++){var p=n^n<<1^n<<2^n<<3^n<<4;p=p>>>8^255&p^99,o[r]=p,i[p]=r;var v=e[r],y=e[v],m=e[y],g=257*e[p]^16843008*p;a[r]=g<<24|g>>>8,s[r]=g<<16|g>>>16,u[r]=g<<8|g>>>24,l[r]=g,g=16843009*m^65537*y^257*v^16843008*r,c[p]=g<<24|g>>>8,f[p]=g<<16|g>>>16,h[p]=g<<8|g>>>24,d[p]=g,r?(r=v^e[e[e[m^v]]],n^=e[e[n]]):r=n=1}}();var p=[0,1,2,4,8,16,32,64,128,27,54],v=n.AES=r.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,r=e.sigBytes/4,n=4*((this._nRounds=r+6)+1),i=this._keySchedule=[],a=0;a<n;a++)if(a<r)i[a]=t[a];else{var s=i[a-1];a%r?r>6&&a%r==4&&(s=o[s>>>24]<<24|o[s>>>16&255]<<16|o[s>>>8&255]<<8|o[255&s]):(s=o[(s=s<<8|s>>>24)>>>24]<<24|o[s>>>16&255]<<16|o[s>>>8&255]<<8|o[255&s],s^=p[a/r|0]<<24),i[a]=i[a-r]^s}for(var u=this._invKeySchedule=[],l=0;l<n;l++)a=n-l,s=l%4?i[a]:i[a-4],u[l]=l<4||a<=4?s:c[o[s>>>24]]^f[o[s>>>16&255]]^h[o[s>>>8&255]]^d[o[255&s]]}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,a,s,u,l,o)},decryptBlock:function(e,t){var r=e[t+1];e[t+1]=e[t+3],e[t+3]=r,this._doCryptBlock(e,t,this._invKeySchedule,c,f,h,d,i),r=e[t+1],e[t+1]=e[t+3],e[t+3]=r},_doCryptBlock:function(e,t,r,n,o,i,a,s){for(var u=this._nRounds,l=e[t]^r[0],c=e[t+1]^r[1],f=e[t+2]^r[2],h=e[t+3]^r[3],d=4,p=1;p<u;p++){var v=n[l>>>24]^o[c>>>16&255]^i[f>>>8&255]^a[255&h]^r[d++],y=n[c>>>24]^o[f>>>16&255]^i[h>>>8&255]^a[255&l]^r[d++],m=n[f>>>24]^o[h>>>16&255]^i[l>>>8&255]^a[255&c]^r[d++],g=n[h>>>24]^o[l>>>16&255]^i[c>>>8&255]^a[255&f]^r[d++];l=v,c=y,f=m,h=g}v=(s[l>>>24]<<24|s[c>>>16&255]<<16|s[f>>>8&255]<<8|s[255&h])^r[d++],y=(s[c>>>24]<<24|s[f>>>16&255]<<16|s[h>>>8&255]<<8|s[255&l])^r[d++],m=(s[f>>>24]<<24|s[h>>>16&255]<<16|s[l>>>8&255]<<8|s[255&c])^r[d++],g=(s[h>>>24]<<24|s[l>>>16&255]<<16|s[c>>>8&255]<<8|s[255&f])^r[d++],e[t]=v,e[t+1]=y,e[t+2]=m,e[t+3]=g},keySize:8});t.AES=r._createHelper(v)}(),e.AES}(r(2),r(57),r(27),r(28),r(60))},function(e,t,r){e.exports=function(e){return function(){var t=e,r=t.lib.WordArray;t.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,n=this._map;e.clamp();for(var o=[],i=0;i<r;i+=3)for(var a=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,s=0;s<4&&i+.75*s<r;s++)o.push(n.charAt(a>>>6*(3-s)&63));var u=n.charAt(64);if(u)for(;o.length%4;)o.push(u);return o.join("")},parse:function(e){var t=e.length,n=this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var i=0;i<n.length;i++)o[n.charCodeAt(i)]=i}var a=n.charAt(64);if(a){var s=e.indexOf(a);-1!==s&&(t=s)}return function(e,t,n){for(var o=[],i=0,a=0;a<t;a++)if(a%4){var s=n[e.charCodeAt(a-1)]<<a%4*2,u=n[e.charCodeAt(a)]>>>6-a%4*2;o[i>>>2]|=(s|u)<<24-i%4*8,i++}return r.create(o,i)}(e,t,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),e.enc.Base64}(r(2))},function(e,t,r){e.exports=function(e){return function(){var t=e,r=t.lib,n=r.WordArray,o=r.Hasher,i=[],a=t.algo.SHA1=o.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],o=r[1],a=r[2],s=r[3],u=r[4],l=0;l<80;l++){if(l<16)i[l]=0|e[t+l];else{var c=i[l-3]^i[l-8]^i[l-14]^i[l-16];i[l]=c<<1|c>>>31}var f=(n<<5|n>>>27)+u+i[l];f+=l<20?1518500249+(o&a|~o&s):l<40?1859775393+(o^a^s):l<60?(o&a|o&s|a&s)-1894007588:(o^a^s)-899497514,u=s,s=a,a=o<<30|o>>>2,o=n,n=f}r[0]=r[0]+n|0,r[1]=r[1]+o|0,r[2]=r[2]+a|0,r[3]=r[3]+s|0,r[4]=r[4]+u|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=Math.floor(r/4294967296),t[15+(n+64>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA1=o._createHelper(a),t.HmacSHA1=o._createHmacHelper(a)}(),e.SHA1}(r(2))},function(e,t,r){e.exports=function(e){!function(){var t=e,r=t.lib,n=r.Base,o=t.enc,i=o.Utf8,a=t.algo;a.HMAC=n.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=i.parse(t));var r=e.blockSize,n=4*r;t.sigBytes>n&&(t=e.finalize(t)),t.clamp();for(var o=this._oKey=t.clone(),a=this._iKey=t.clone(),s=o.words,u=a.words,l=0;l<r;l++)s[l]^=1549556828,u[l]^=909522486;o.sigBytes=a.sigBytes=n,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,r=t.finalize(e);t.reset();var n=t.finalize(this._oKey.clone().concat(r));return n}})}()}(r(2))},function(e,t,r){e.exports=function(e){e.lib.Cipher||function(t){var r=e,n=r.lib,o=n.Base,i=n.WordArray,a=n.BufferedBlockAlgorithm,s=r.enc,u=(s.Utf8,s.Base64),l=r.algo,c=l.EvpKDF,f=n.Cipher=a.extend({cfg:o.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){a.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){e&&this._append(e);var t=this._doFinalize();return t},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?x:b}return function(t){return{encrypt:function(r,n,o){return e(n).encrypt(t,r,n,o)},decrypt:function(r,n,o){return e(n).decrypt(t,r,n,o)}}}}()}),h=(n.StreamCipher=f.extend({_doFinalize:function(){var e=this._process(!0);return e},blockSize:1}),r.mode={}),d=n.BlockCipherMode=o.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),p=h.CBC=function(){var e=d.extend();function r(e,r,n){var o=this._iv;if(o){var i=o;this._iv=t}else var i=this._prevBlock;for(var a=0;a<n;a++)e[r+a]^=i[a]}return e.Encryptor=e.extend({processBlock:function(e,t){var n=this._cipher,o=n.blockSize;r.call(this,e,t,o),n.encryptBlock(e,t),this._prevBlock=e.slice(t,t+o)}}),e.Decryptor=e.extend({processBlock:function(e,t){var n=this._cipher,o=n.blockSize,i=e.slice(t,t+o);n.decryptBlock(e,t),r.call(this,e,t,o),this._prevBlock=i}}),e}(),v=r.pad={},y=v.Pkcs7={pad:function(e,t){for(var r=4*t,n=r-e.sigBytes%r,o=n<<24|n<<16|n<<8|n,a=[],s=0;s<n;s+=4)a.push(o);var u=i.create(a,n);e.concat(u)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},m=(n.BlockCipher=f.extend({cfg:f.cfg.extend({mode:p,padding:y}),reset:function(){f.reset.call(this);var e=this.cfg,t=e.iv,r=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=r.createEncryptor;else{var n=r.createDecryptor;this._minBufferSize=1}this._mode&&this._mode.__creator==n?this._mode.init(this,t&&t.words):(this._mode=n.call(r,this,t&&t.words),this._mode.__creator=n)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else{var t=this._process(!0);e.unpad(t)}return t},blockSize:4}),n.CipherParams=o.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}})),g=r.format={},_=g.OpenSSL={stringify:function(e){var t=e.ciphertext,r=e.salt;if(r)var n=i.create([1398893684,1701076831]).concat(r).concat(t);else var n=t;return n.toString(u)},parse:function(e){var t=u.parse(e),r=t.words;if(1398893684==r[0]&&1701076831==r[1]){var n=i.create(r.slice(2,4));r.splice(0,4),t.sigBytes-=16}return m.create({ciphertext:t,salt:n})}},b=n.SerializableCipher=o.extend({cfg:o.extend({format:_}),encrypt:function(e,t,r,n){n=this.cfg.extend(n);var o=e.createEncryptor(r,n),i=o.finalize(t),a=o.cfg;return m.create({ciphertext:i,key:r,iv:a.iv,algorithm:e,mode:a.mode,padding:a.padding,blockSize:e.blockSize,formatter:n.format})},decrypt:function(e,t,r,n){n=this.cfg.extend(n),t=this._parse(t,n.format);var o=e.createDecryptor(r,n).finalize(t.ciphertext);return o},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),w=r.kdf={},A=w.OpenSSL={execute:function(e,t,r,n){n||(n=i.random(8));var o=c.create({keySize:t+r}).compute(e,n),a=i.create(o.words.slice(t),4*r);return o.sigBytes=4*t,m.create({key:o,iv:a,salt:n})}},x=n.PasswordBasedCipher=b.extend({cfg:b.cfg.extend({kdf:A}),encrypt:function(e,t,r,n){var o=(n=this.cfg.extend(n)).kdf.execute(r,e.keySize,e.ivSize);n.iv=o.iv;var i=b.encrypt.call(this,e,t,o.key,n);return i.mixIn(o),i},decrypt:function(e,t,r,n){n=this.cfg.extend(n),t=this._parse(t,n.format);var o=n.kdf.execute(r,e.keySize,e.ivSize,t.salt);n.iv=o.iv;var i=b.decrypt.call(this,e,t,o.key,n);return i}})}()}(r(2),r(28))},function(e,t,r){e.exports=function(e){return e.enc.Utf8}(r(2))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0},i=r(0),a=v(r(24)),s=v(r(7)),u=v(r(5)),l=v(r(63)),c=v(r(71)),f=r(4),h=v(r(86)),d=v(r(100)),p=v(r(18));function v(e){return e&&e.__esModule?e:{default:e}}function y(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,i){try{var a=t[o](i),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}var m=function(e){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.HOST,o=r.api,a=r.camera,s=void 0===a?{poseTo:{lat:22.335836,lng:114.263885,alt:1e7,north:6.6,tilt:60,up:0}}:a,p=r.renderItems,v=void 0===p?{planet:"earth",earthUseTexture:!0,orbitRing:!1,tileBox:!1}:p,y=r.eventHandlers,m=void 0===y?{}:y,g=r.develop,_=void 0!==g&&g,b=r.debug,w=void 0!==b&&b;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var A=v.background,x=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,{HOST:n,api:o,background:A,debug:w})),k=x;return x._renderItems=v,x._type="EarthViewer",window.viewer=x,x.earthNode=new u.default(null),x.earthNode.sceneNode.name="earthNode",x.earthNode.sceneNode.matrixAutoUpdate=!1,x.initialized=function(){k.scene.add(k.earthNode.sceneNode),k._welcomeMesh=new i.Mesh(new i.SphereBufferGeometry(1,32,32),new i.MeshBasicMaterial({wireframe:!0})),k._welcomeMesh.name="welcomeMesh",k.earthNode.sceneNode.add(k._welcomeMesh);var e=k.earthNode,t=k.env.isMobile,r=k.scale,n=k.resolution;return Promise.all([function(){if(!k.renderItems.planet)return k.earthNode.sceneNode.remove(k._welcomeMesh),Promise.resolve();return k.countryName.then(function(o){return k.layers.earth=new c.default(e,{isMobile:t,renderItems:{orbitRing:k.renderItems.orbitRing},eventHandlers:{onContentInitialized:function(){m.onContentInitialized&&m.onContentInitialized(),k.earthNode.sceneNode.remove(k._welcomeMesh)}},scale:r,resolution:n,useColor:!0,planet:k.renderItems.planet,useTexture:k.renderItems.earthUseTexture,maxAnisotropy:k.renderer.capabilities.getMaxAnisotropy(),fullScene:!0,countryName:o}),k.layers.earth.import()}).then(function(e){k._spotLights=e.map(function(e){var t=new d.default({renderer:k.renderer,color:65280});return t.addToScene(e.sceneNode),t})}).catch(function(e){return console.error("initScene",e),Promise.reject(e)})}(),k.countryName.then(function(o){k.layers.project=new h.default(e,{isMobile:t,scale:r,resolution:n,countryName:o,altizureApi:k.altizureApi,onTileDownloaded:function(){k.updateScene()}})})]).then(function(){return Promise.resolve(k)})}(),k.__updateSceneTimed=(0,f.throttle)(k._updateScene,2500),x.openning=function(){return k.control=new l.default({camera:k.camera,openning:{poseTo:s.poseTo},handlers:void 0,earthNode:k.earthNode,layers:k.layers,domElement:k.renderer.domElement,showAnchor:_}),k.updateScene(),k.control.addEventListener("onCameraChange",function(){k.updateScene()}),window.addEventListener("resize",function(){k.resize()},!1),s.flyTo?k.initialized.then(function(){return k.control.flyToPose(s.flyTo,s.time)}):k.initialized}(),x}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),n(t,[{key:"destruct",value:function(){var e=!0;return this.control&&(this.control.destruct(),this.control=void 0),e=this.earthNode.destruct()&&e,e=o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)&&e,p.default.disposeMesh(this._welcomeMesh),this._welcomeMesh=void 0,this._renderItems=void 0,window.viewer=void 0,this.earthNode=void 0,this.initialized=void 0,this.openning=void 0,this.__updateScene=void 0,this._spotLights=void 0,e}},{key:"_addEarthLayer",value:function(){var e=y(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.showEarth){e.next=4;break}return e.abrupt("return",Promise.resolve());case 4:return e.abrupt("return",Promise.reject(new Error("Hide earth")));case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"animate",value:function(){var e=(new i.Matrix4).multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse),r=new i.Frustum;r.setFromMatrix(e.clone());var n=Date.now()/1e3,a={camera:this.camera,pvmatrix:e,frustum:r,viewportSize:this.renderer.getSize(),currentTime:n};this.earthNode&&this.earthNode.animate(a),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"animate",this).call(this)}},{key:"updateVisibility",value:function(){return this.updateScene()}},{key:"updateScene",value:function(e){if(!function(e){var t=e.camera;if(isNaN(t.far)||isNaN(t.near))return!1;return!0}({camera:this.camera}))return!1;e?this._updateScene():this.__updateSceneTimed()}},{key:"_updateScene",value:function(){for(var e in this.layers)this.layers[e]&&this.layers[e].sceneUpdated({camera:this.camera})}},{key:"_updateFrustum",value:function(e){}},{key:"addAltizureProject",value:function(){var e=y(regeneratorRuntime.mark(function e(t){var r=t.projInfo,n=t.pid,o=t.position;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initialized.then(function(e){return e.layers.project.addAltizure({pid:n,projInfo:r,position:o})}).catch(function(e){return console.warn("Failed to add Altizure project",n,e),Promise.resolve()}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"addOSGProject",value:function(e){var t=e.osgInfo,r=e.position;return this.initialized.then(function(e){return e.layers.project.addOSG({osgInfo:t,position:r})}).catch(function(e){return console.warn("Failed to add OSG project",e),Promise.resolve()})}},{key:"scale",get:function(){return s.default.scale}},{key:"resolution",get:function(){return s.default.resolution}},{key:"renderItems",get:function(){var e=this;return Object.defineProperty(this,"renderItems",{value:{get planet(){return e._renderItems.planet},set planet(e){console.warn("No support")},get earth(){return e.showEarth},set earth(t){e.showEarth=t},get earthUseTexture(){return e.showEarthTexture},set earthUseTexture(t){e.showEarthTexture=t},get orbitRing(){return e.showOrbitRing},set orbitRing(t){e.showOrbitRing=t}},writable:!1,configurable:!0}),this.renderItems}},{key:"showEarth",set:function(e){e!==this.showEarth&&(this._renderItems.earth=e)},get:function(){return this._renderItems.earth}},{key:"showEarthTexture",set:function(e){this.showEarth&&e!==this.showEarthTexture&&(this._renderItems.earthUseTexture=e)},get:function(){return this._renderItems.earthUseTexture}},{key:"showOrbitRing",set:function(e){this.showEarth&&e!==this.showOrbitRing&&(this._renderItems.orbitRing=e)},get:function(){return this._renderItems.orbitRing}},{key:"spotLights",get:function(){return this._spotLights}}]),t}();t.default=m},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(4),i=d(r(29)),a=d(r(65)),s=d(r(67)),u=d(r(1)),l=d(r(68)),c=d(r(69)),f=d(r(70)),h=r(0);function d(e){return e&&e.__esModule?e:{default:e}}function p(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var v={NONE:0,ORBIT:1,DOLLY:2,SWIRL:3,TOUCH_ORBIT:11,TOUCH_DOLLY:12,TOUCH_SWIRL:13,FLYTO:21},y=h.MOUSE.LEFT,m=h.MOUSE.MIDDLE,g=h.MOUSE.RIGHT,_=function(e){function t(e){var r=e.camera,n=e.openning,a=void 0===n?{}:n,u=e.handlers,d=e.earthNode,y=e.layers,m=e.domElement,g=e.showAnchor,_=void 0===g||g;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var b=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{camera:r,handlers:u}));b.dd=!0;var w=b;return b.earth_scale=1,b.EARTH_RESOLUTION=6,b._pose=new i.default({earth_scale:b.earth_scale,EARTH_RESOLUTION:b.EARTH_RESOLUTION}),b._cameraPath=null,b.earthNode=d,b.layers=y,b.domElement=m,function(){w.preventDefault=w._preventDefault.bind(w),w.onMouseDown=w._onMouseDown.bind(w),w.onMouseMove=w._onMouseMove.bind(w),w.onMouseUp=w._onMouseUp.bind(w);var e=w._onMouseWheel.bind(w),t=(0,o.debounce)(function(e){w._wheelBursting=!1},500);w.___wheelThrottlePrev=Date.now(),w.onMouseWheel=function(r){r.preventDefault(),w.___wheelThrottleNow=Date.now();var n=w.___wheelThrottleNow-w.___wheelThrottlePrev;n<45||(w.___wheelThrottlePrev=w.___wheelThrottleNow,e(r),t(r))},w.onDragStart=w._onDragStart.bind(w),w.onDrag=w._onDrag.bind(w),w.onDragEnd=w._onDragEnd.bind(w),w.onTwoFingerStart=w._onTwoFingerStart.bind(w),w.onTwoFinger=w._onTwoFinger.bind(w),w.onTwoFingerEnd=w._onTwoFingerEnd.bind(w)}(),b.gestureRecognizer=new f.default(b.domElement,{debug:!1}),b.orbitSpeed=.1,b.swirlSpeed=12,b.dollySpeed=2.5,b.enabled=!0,b._enabledDamping=!1,b._state=v.NONE,b._orbitStart=new h.Vector2(0,0),b._orbitEnd=new h.Vector2(0,0),b._swirlStart=new h.Vector2(0,0),b._swirlEnd=new h.Vector2(0,0),b._dollyPoint=new h.Vector2(0,0),b._dollyStart=0,b._dollyEnd=0,b._wheelBursting=!1,b._showAnchor=_,b.showContact=!1,b._anchorScaleFactor=1,b._targetCenterFocus=null,b._picker=new l.default({camera:r,layers:y,domElement:m}),b._earthPicker=new c.default({camera:r,domElement:m,control:b,scale:b.earth_scale,resolution:b.EARTH_RESOLUTION}),function(){var e=a.poseTo,t=Object.assign({},{lat:22.335836,lng:114.263885,alt:1e6,north:0,tilt:60,up:0},e),r=Object.assign({},t,e),n=Date.now();w._cameraPath=new s.default(new i.default(r),new i.default(r),{start:n-1,current:n,end:n}),w._pose.value=r}(),w._updateFrustum=(0,o.throttle)(function(){w.__updateFrustum()},30),w._updateNearFar=(0,o.throttle)(function(){w.__updateNearFar()},300),b}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.default),n(t,[{key:"destruct",value:function(){return this.enabled=!1,this._cameraPath&&this._cameraPath.destruct(),this._cameraPath=void 0,this._pose&&this._pose.destruct(),this._pose=void 0,this.gestureRecognizer&&this.gestureRecognizer.destruct(),this.gestureRecognizer=void 0,this._picker&&this._picker.destruct(),this._picker=void 0,this._earthPicker&&this._earthPicker.destruct(),this._earthPicker=void 0,this._updateFrustum&&(this._updateFrustum=void 0),this._updateNearFar&&(this._updateNearFar=void 0),this.earthNode=void 0,this._orbitStart=void 0,this._orbitEnd=void 0,this._swirlStart=void 0,this._swirlEnd=void 0,this._dollyPoint=void 0,function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"cameraPose",value:function(){return this._pose.value}},{key:"freeze",value:function(){this.enabled=!1}},{key:"unfreeze",value:function(){this.enabled=!0}},{key:"tiltRange",value:function(){console.warn("tiltRange is under construction.")}},{key:"altRange",value:function(e){var t=e.max,r=e.min;return void 0!==r&&(this._pose.minAlt=r),void 0!==t&&(this._pose.maxAlt=t),{max:this._pose.maxAlt,min:this._pose.minAlt}}},{key:"flyToPose",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3,n=this;return this.state!==v.FLYTO&&(this.cameraPath.sync(this._pose.matrix),this.state=v.FLYTO),this._putAnchor(),this.cameraPath.destinate(e,r).then(function(){return n._pose.value=n.cameraPath.dst.value,t._putAnchor(),n.state=v.NONE,n.onCameraChange(),Promise.resolve()}).catch(function(e){return t._putAnchor(),n.onCameraChange(),"destination changed"===e.message?(n._pose.matrix=n.cameraPath.dst.matrix,Promise.resolve(e.message)):"disabled"===e.message?Promise.resolve(e.message):(n._pose.matrix=n.cameraPath.dst.matrix,Promise.reject(e))})}},{key:"flyToMat",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=this;return this.state!==v.FLYTO&&(this.cameraPath.sync(this._pose.matrix),this.state=v.FLYTO),this._putAnchor(),r&&r.isVector3?this._targetCenterFocus=r.clone():this._targetCenterFocus=null,this.cameraPath.destinate(e,t).then(function(){return n._pose.matrix=n.cameraPath.dst.matrix,n._putAnchor(),n.state=v.NONE,n.onCameraChange(),Promise.resolve()}).catch(function(e){return n._putAnchor(),n.onCameraChange(),"destination changed"===e.message?(n._pose.matrix=n.cameraPath.dst.matrix,Promise.resolve(e.message)):"disabled"===e.message?Promise.resolve(e.message):(n._pose.matrix=n.cameraPath.dst.matrix,Promise.reject(e))})}},{key:"flyToMatNorthUp",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=new h.Vector3,o=new h.Quaternion,i=new h.Vector3;e.decompose(n,o,i);var a=n.clone(),s=i.clone(),u=n.clone().normalize(),l=new h.Vector3(0,0,-1).applyQuaternion(o.clone()),c=l.clone().cross(u).normalize(),f=c.clone().cross(l).normalize();(new h.Matrix4).makeBasis(c.normalize(),f.normalize(),l.negate().normalize()).decompose(n,o,i);var d=o.clone(),p=(new h.Matrix4).compose(a,d,s);return this.flyToMat(p,t,r)}},{key:"flyToMatWithFocus",value:function(e,t,r){return this._targetCenterFocus=r.clone(),console.log("flyToMatWithFocus",this._targetCenterFocus),this.flyToMat(e,t)}},{key:"breakDamping",value:function(){console.warn("ni")}},{key:"stopFlying",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.state===v.FLYTO){var t=e?new Error("destination changed"):new Error("stopFlying");this.cameraPath.interrupt(t),this.state=v.NONE}}},{key:"restoreView",value:function(){this._targetCenterFocus=null;var e=this._camera,t=e.view,r=this;return t?new Promise(function(n,o){setTimeout(function(){e.setViewOffset(t.fullWidth,t.fullHeight,0,0,t.fullWidth,t.fullHeight),r._handlers._onCameraChange(),n()},1e3)}):Promise.reject(new Error("No view"))}},{key:"update",value:function(){if(!this.cameraPath)return!1;var e=void 0;if(this.state!==v.FLYTO)this._pose.applyDelta(),e=this._pose.matrix;else{var t=this.cameraPath.pose;if(t){var r=t.matrix;this._pose.matrix=r,e=r,this.__updateFrustum()}else e=this._pose.matrix}if(!this.__prevCamToEarth||!e.equals(this.__prevCamToEarth)){try{var n=(new h.Matrix4).getInverse(e,!0)}catch(e){return console.error("no inverse"),!1}if(this.earthNode.setMatrix(n),this._handlers._onCameraChange(),this.__prevCamToEarth?this.__prevCamToEarth.copy(e):this.__prevCamToEarth=e,(this.showContact||this.showAnchor)&&this.earthEntity){var o=(new h.Vector3).setFromMatrixPosition(e),i=this._pose.anchor,a=o.distanceTo(i),s=.002*this._anchorScaleFactor*a,u=this.earthEntity.focusPoint;if(this.showAnchor?(u.position.copy(i),u.scale.set(s,s,s),u.visible=!0):u.visible=!1,this.showContact)this.earthEntity.contactPoint.scale.set(s,s,s)}}return!0}},{key:"_mount",value:function(){this.domElement.addEventListener("contextmenu",this.preventDefault),this.domElement.addEventListener("mousedown",this.onMouseDown),this.domElement.addEventListener("mousewheel",this.onMouseWheel),this.domElement.addEventListener("MozMousePixelScroll",this.onMouseWheel),this.gestureRecognizer.addEventListener("drag-start",this.onDragStart,!1),this.gestureRecognizer.addEventListener("pinch-start",this.onTwoFingerStart,!1),this.gestureRecognizer.addEventListener("twofingersweep-start",this.onTwoFingerStart,!1),this.gestureRecognizer.addEventListener("rotate-start",this.onTwoFingerStart,!1)}},{key:"_unmount",value:function(){this.domElement.removeEventListener("contextmenu",this.preventDefault,!1),this.domElement.removeEventListener("mousedown",this.onMouseDown,!1),this.domElement.removeEventListener("mousewheel",this.onMouseWheel,!1),this.domElement.removeEventListener("MozMousePixelScroll",this.onMouseWheel,!1),this.gestureRecognizer.removeEventListener("drag-start",this.onDragStart,!1),this.gestureRecognizer.removeEventListener("pinch-start",this.onTwoFingerStart,!1),this.gestureRecognizer.removeEventListener("twofingersweep-start",this.onTwoFingerStart,!1),this.gestureRecognizer.removeEventListener("rotate-start",this.onTwoFingerStart,!1)}},{key:"_preventDefault",value:function(e){e.preventDefault()}},{key:"_onMouseDown",value:function(e){if(this.enabled){if(e.preventDefault(),this.stopFlying(!0),e.button===y){if(!this.enabledOrbit)return;this._handleOrbitStart(e.clientX,e.clientY),this.state=v.ORBIT}else if(e.button===m){if(!this.enabledDolly)return;this.state=v.DOLLY}else if(e.button===g){if(!this.enabledSwirl)return;this._handleSwirlStart(e.clientX,e.clientY),this.state=v.SWIRL}this.state!==v.NONE&&(this.domElement.addEventListener("mousemove",this.onMouseMove),this.domElement.addEventListener("mouseup",this.onMouseUp),this.domElement.addEventListener("mouseout",this.onMouseUp),this._handlers._onCameraStart(e))}}},{key:"_onMouseWheel",value:function(e){if(this.enabled&&this.enabledDolly){e.preventDefault();var t=0;void 0!==e.wheelDelta?t=e.wheelDelta:void 0!==e.detail&&(t=-e.detail),t>0?t=this.dollySpeed:t<0&&(t=-this.dollySpeed),this._wheelBursting||(this.stopFlying(!0),this._pose.distanceToAnchor>.1*this.earth_scale?this._putAnchor():this._putAnchor({x:e.clientX,y:e.clientY}),this._wheelBursting=!0),this.dolly(-t)}}},{key:"_onMouseMove",value:function(e){if(this.enabled){e.preventDefault();var t=this.state;if(t===v.ORBIT){if(!this.enabledOrbit)return;this._handleOrbitMove(e.clientX,e.clientY)}else if(t===v.DOLLY){if(!this.enabledDolly)return}else if(t===v.SWIRL){if(!this.enabledSwirl)return;this._handleSwirl(e.clientX,e.clientY)}if(this.showContact&&this.earthEntity){var r={x:e.clientX,y:e.clientY},n=this.pickProjectContactPointInEarth({rawX:r.x,rawY:r.y},"project");if(n){var o=this.earthEntity.contactPoint;o.position.copy(n),o.visible=!0}}}}},{key:"_onMouseUp",value:function(e){this.enabled&&(this.state===v.ORBIT?(this.enabledOrbit&&this._handlers._onCameraEnd(e),this.state=v.NONE):this.state===v.DOLLY?(this.enabledDolly&&this._handlers._onCameraEnd(e),this.state=v.NONE):this.state===v.SWIRL&&(this.enabledSwirl&&this._handlers._onCameraEnd(e),this.state=v.NONE),this.domElement.removeEventListener("mousemove",this.onMouseMove),this.domElement.removeEventListener("mouseup",this.onMouseUp),this.domElement.removeEventListener("mouseout",this.onMouseUp))}},{key:"_onDragStart",value:function(e){if(this.enabledOrbit){this.stopFlying(!0);var t=e.touchEvent,r=t.touches[0].pageX,n=t.touches[0].pageY;this._handleOrbitStart(r,n),this.state=v.ORBIT,this.gestureRecognizer.addEventListener("drag",this.onDrag),this.gestureRecognizer.addEventListener("drag-end",this.onDragEnd),this._handlers._onCameraStart(t)}}},{key:"_onDrag",value:function(e){if(this.enabledOrbit){var t=e.touchEvent;this._handleOrbitMove(t.touches[0].pageX,t.touches[0].pageY),this.state=v.ORBIT}}},{key:"_onDragEnd",value:function(e){if(this.enabledOrbit){var t=e.touchEvent;this.gestureRecognizer.removeEventListener("drag",this.onDrag),this.gestureRecognizer.removeEventListener("drag-end",this.onDragEnd),this._handlers._onCameraEnd(t),console.log("_onDragEnd"),this.state=v.NONE}}},{key:"_onTwoFingerStart",value:function(e){if(this.enabledSwirl||this.enabledDolly){this.stopFlying(!0);var t=e.center;this._handleSwirlStart(t.pageX,t.pageY),this.state=v.SWIRL;var r=this.__twoTouchPoints(e),n=r.p,o=r.q,i=n.distanceTo(o);isNaN(i)||(this._dollyStart=i),this.gestureRecognizer.addEventListener("pinch",this.onTwoFinger),this.gestureRecognizer.addEventListener("pinch-end",this.onTwoFingerEnd),this.gestureRecognizer.addEventListener("twofingersweep",this.onTwoFinger),this.gestureRecognizer.addEventListener("twofingersweep-end",this.onTwoFingerEnd),this.gestureRecognizer.addEventListener("rotate",this.onTwoFinger),this.gestureRecognizer.addEventListener("rotate-end",this.onTwoFingerEnd),this._handlers._onCameraStart(event)}}},{key:"_onTwoFinger",value:function(e){if(this.enabledSwirl||this.enabledDolly){var t=e.center;this._handleSwirl(t.pageX,t.pageY);var r=this.__twoTouchPoints(e),n=r.p,o=r.q,i=n.distanceTo(o);if(!isNaN(i)){if(this._dollyEnd=i,0!==this._dollyStart){var a=(this._dollyEnd-this._dollyStart)/-50;this.dolly(a*this.dollySpeed)}this._dollyStart=this._dollyEnd}this.state=v.SWIRL}}},{key:"_onTwoFingerEnd",value:function(e){if(this._onDragEnd(e),this.enabledSwirl||this.enabledDolly){var t=e.touchEvent;this._dollyStart=this._dollyEnd=0,this.gestureRecognizer.removeEventListener("pinch",this.onTwoFinger),this.gestureRecognizer.removeEventListener("pinch-end",this.onTwoFingerEnd),this.gestureRecognizer.removeEventListener("twofingersweep",this.onTwoFinger),this.gestureRecognizer.removeEventListener("twofingersweep-end",this.onTwoFingerEnd),this.gestureRecognizer.removeEventListener("rotate",this.onTwoFinger),this.gestureRecognizer.removeEventListener("rotate-end",this.onTwoFingerEnd),this._handlers._onCameraEnd(t),console.log("_onTwoFingerEnd"),this.state=v.NONE}}},{key:"_handleOrbitStart",value:function(e,t){this._putAnchor({x:e,y:t}),this._orbitStart.set(e,t)}},{key:"_handleOrbitMove",value:function(e,t){this._orbitEnd.set(e,t);var r=(new h.Vector3).subVectors(this._orbitEnd,this._orbitStart);r.lengthSq()>100&&(console.warn("Abnormal large orbit move."),r.normalize().multiplyScalar(10));var n=Math.min(this.domElement.clientHeight,this.domElement.clientWidth,50);this.orbitLeft(r.x/n*this.orbitSpeed),this.orbitUp(r.y/n*this.orbitSpeed),this._orbitStart.copy(this._orbitEnd)}},{key:"_handleSwirlStart",value:function(e,t){this._putAnchor({x:e,y:t}),this._swirlStart.set(e,t)}},{key:"_handleSwirl",value:function(e,t){this._swirlEnd.set(e,t);var r=(new h.Vector3).subVectors(this._swirlEnd,this._swirlStart),n=Math.min(this.domElement.clientHeight,this.domElement.clientWidth,50);this.swirlLeft(r.x/n*this.swirlSpeed),this.swirlUp(r.y/n*this.swirlSpeed),this._swirlStart.copy(this._swirlEnd)}},{key:"_putAnchor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._pose;if(e){var r=this.pickProjectContactPointInEarth({rawX:e.x,rawY:e.y},"marker");return r||(r=this.pickProjectContactPointInEarth({rawX:e.x,rawY:e.y})),void(r&&r.lengthSq()<4*this.earth_scale*this.earth_scale?t.putAnchor(r):t.putAnchor())}t.putAnchor()}},{key:"__updateNearFar",value:function(){var e=this._camera,t=void 0,r=void 0,n=this._pose.matrix,o=(new h.Vector3).setFromMatrixPosition(n),i=this._pose.anchor,a=o.distanceTo(i),s=o.length();i.length()<.8*this.earth_scale?(t=1e-5,r=s):(t=.01*a,r=s+Math.min(Math.max(10*a,s),2*this.earth_scale)),e.near=t,e.far=r,e.updateProjectionMatrix()}},{key:"__updateFrustum",value:function(){var e=this._targetCenterFocus;if(e){var t=this._camera,r=this._pose.matrix;if(!t.view)return void console.warn("No view ready.");0;var n=e.clone(),o=(new h.Matrix4).getInverse(r);n.applyMatrix4(o);var i=t.fov,a=t.aspect,s=t.near,u=t.far,l=new h.PerspectiveCamera(i,a,s,u),c=n.project(l);0;var f=(c.x+1)/2*this.domWidth,d=(1-c.y)/2*this.domHeight,p=t.view,v=f-(p.offsetX+p.width/2),y=d-(p.offsetY+p.height/2),m=p.offsetX+v,g=p.offsetY+y;0,t.setViewOffset(p.fullWidth,p.fullHeight,m,g,p.width,p.height)}}},{key:"__twoTouchPoints",value:function(e){var t=e.touchEvent.touches;return{p:new h.Vector2(t[0].pageX,t[0].pageY),q:new h.Vector2(t[1].pageX,t[1].pageY)}}},{key:"putCenterAnchor",value:function(){var e=this.domWidth/2,t=this.domHeight/2;return this._putAnchor({x:e,y:t})}},{key:"orbitLeft",value:function(e){0!==e&&this._pose.orbitLeft(e)}},{key:"orbitUp",value:function(e){0!==e&&this._pose.orbitUp(e)}},{key:"dolly",value:function(e){if(0!==e){var t=e;this._pose.dolly(t)}}},{key:"swirlLeft",value:function(e){this.enabledSwirlLeft&&e&&this._pose.swirlLeft(e)}},{key:"swirlUp",value:function(e){this.enabledSwirlUp&&e&&this._pose.swirlUp(e)}},{key:"pickEarthContactPoint",value:function(e){var t=e.rawX,r=e.rawY,n=this._earthPicker.pick(t,r);if(n.length>0){var o=this._pose.matrix,i=n[0].point.clone();i.applyMatrix4(o);var a=u.default.earthSurfaceToGeographic(this.EARTH_RESOLUTION,i,this.earth_scale);return{lng:a.lng,lat:a.lat,alt:0}}}},{key:"pickProjectContactPoint",value:function(e){var t=e.rawX,r=e.rawY,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"project",o=this.pickProjectContactPointInEarth({rawX:t,rawY:r},n);if(o)return u.default.getLngLatAltFromNoneGroundCartesian(this.EARTH_RESOLUTION,o,this.earth_scale)}},{key:"pickProjectContactPointInEarth",value:function(e){var t=e.rawX,r=e.rawY,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"project";this._picker.layerName=n;var o=this._picker.pick(t,r);if(o.length>0){var i=this._pose.matrix,a=o[0].point.clone();return a.applyMatrix4(i),a}}},{key:"mapToWindow",value:function(e,t){return this._picker._NDC_inv(e,t)}},{key:"onCameraChange",value:function(){this._updateNearFar()}},{key:"cameraPath",get:function(){return this._cameraPath}},{key:"pose",get:function(){return this._pose.value},set:function(e){this._pose.value=e,this._handlers._onCameraChange()}},{key:"camToEarth",get:function(){return this._pose.matrix}},{key:"POS",get:function(){return this._pose.POS}},{key:"state",set:function(e){this._state=e},get:function(){return this._state}},{key:"enabled",set:function(e){this._enabled=e,this.enabledOrbit=e,this.enabledDolly=e,this.enabledSwirl=e,e?this._mount():(this._unmount(),this.state=v.NONE,this.cameraPath.interrupt(new Error("disabled")))},get:function(){return this._enabled}},{key:"enabledOrbit",set:function(e){this._enabledOrbit=e},get:function(){return this._enabledOrbit}},{key:"enabledDolly",set:function(e){this._enabledDolly=e},get:function(){return this._enabledDolly}},{key:"enabledSwirl",set:function(e){this._enabledSwirl=e,this._enabledSwirlLeft=e,this._enabledSwirlUp=e},get:function(){return this._enabledSwirl}},{key:"enabledSwirlUp",set:function(e){this._enabledSwirlUp=e,e&&(this._enabledSwirl=!0)},get:function(){return this._enabledSwirlUp}},{key:"enabledSwirlLeft",set:function(e){this._enabledSwirlLeft=e,e&&(this._enabledSwirl=!0)},get:function(){return this._enabledSwirlLeft}},{key:"enableRotate",set:function(e){this.enabledOrbit=e}},{key:"focus",get:function(){return this._pose.value}},{key:"domWidth",get:function(){return this.domElement.clientWidth}},{key:"domHeight",get:function(){return this.domElement.clientHeight}},{key:"showAnchor",get:function(){return this._showAnchor},set:function(e){this._showAnchor=e}}]),t}();t.default=_},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=s(r(1)),i=s(r(7)),a=r(0);function s(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.dd=!0,this.scale=1,this.resolution=i.default.resolution,this.rayCaster=new a.Raycaster,this.proxy=this._createProxy(),this.tempCam=new a.PerspectiveCamera(40,1,1e-7,2.5)}return n(e,[{key:"destruct",value:function(){return this.proxy&&(this.proxy.geometry.dispose(),this.proxy.material.dispose(),this.proxy=void 0),this.rayCaster=void 0,this.tempCam=void 0,!0}},{key:"intersect",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new a.Vector2(0,0);this.tempCam.matrix.identity(),this.tempCam.applyMatrix(e),this.tempCam.updateMatrixWorld(!0),this.rayCaster.setFromCamera(t,this.tempCam);var r=this.rayCaster.intersectObject(this.proxy,!1);if(r.length>0)return r[0].point}},{key:"_createProxy",value:function(){var e=o.default.getTileCartesianGeometryByGrid(0,0,0,this.scale,Math.pow(2,this.resolution));return new a.Mesh(e)}}]),e}();t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(r(66));function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var a=function(e){function t(e){var r=e.camera,n=e.handlers;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),a=o,s=["onCameraChange","onCameraStart","onCameraEnd"];if(!function(){if(!r)return!1;n&&s.forEach(function(e){n&&n[e]&&(a[e]=n[e])});return!0}())return i(o,void 0);return o._camera=r,o._enabled=!0,o._handlers={},s.forEach(function(e){a._handlers["_"+e]=function(t){if(a.dispatchEvent({type:e}),a[e])return a[e](t)}}),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),n(t,[{key:"destruct",value:function(){return!0}},{key:"triggerChangeEvent",value:function(){this.dispatchEvent({type:"onCameraChange"})}},{key:"camera",get:function(){return this._camera}}]),t}();t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,[{key:"addEventListener",value:function(e,t){void 0===this._listeners&&(this._listeners={});var r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)}},{key:"hasEventListener",value:function(e,t){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)}},{key:"removeEventListener",value:function(e,t){if(void 0!==this._listeners){var r=this._listeners[e];if(void 0!==r){var n=r.indexOf(t);-1!==n&&r.splice(n,1)}}}},{key:"dispatchEvent",value:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var r=t.slice(0),n=0,o=r.length;n<o;n++)r[n].call(this,e)}}}}]),e}();t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=u(r(30)),i=r(4),a=u(r(29)),s=r(0);function u(e){return e&&e.__esModule?e:{default:e}}var l=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t instanceof a.default&&r instanceof a.default&&n instanceof Object&&void 0!==n.start&&void 0!==n.end?(this.src=t,this.dst=r,this.time=n,this._enabled=!1):console.error("EarthCameraPath",t,r,n)}return n(e,[{key:"destruct",value:function(){var e=!0;return this.enabled=!1,e=this.src.destruct()&&e,e=this.dst.destruct()&&e,this.time={},e}},{key:"sync",value:function(e){e instanceof o.default?this.src.value=e.value:e.isMatrix4&&(this.src.matrix=e)}},{key:"destinate",value:function(t,r){!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.onFail(new Error("destination changed")),t.isMatrix4)this.dst.matrix=t;else{if(!(t instanceof Object))return Promise.reject(new Error("unknown destination type"));this.dst.value=t}this.duration=r,this.enabled=!0;var n=this;return this.destinated=(0,i.timedPromise)(new Promise(function(e,t){n._onDestinated=e,n._onInterrupted=t}),e.MAX_FLY_DURATION),this.destinated}},{key:"interrupt",value:function(e){this.onFail(e)}},{key:"_interpolateMatirx",value:function(e){var t=this.src.POS,r=t.position,n=t.orientation,o=this.dst.POS,i=o.position,u=o.orientation,l=r.clone().lerp(i,e),c=n.clone().slerp(u,e).normalize(),f=new s.Vector3(1,1,1),h=(new s.Matrix4).compose(l,c,f),d=new a.default;return d.matrix=h,d}},{key:"_interpolatePose",value:function(e){var t=this.src.value,r=this.dst.value,n={};return["lng","lat","alt","north","tilt","up"].forEach(function(o){n[o]=function(e,t,r){return e*(1-r)+r*t}(t[o],r[o],e)}),new a.default(n)}},{key:"_interpolateSpherical",value:function(e){var t=this.src.POS,r=t.position,n=t.orientation,o=this.dst.POS,i=o.position,u=o.orientation,l=(new s.Spherical).setFromVector3(r.clone()),c=(new s.Spherical).setFromVector3(i.clone()),f=new s.Spherical((1-e)*l.radius+e*c.radius,(1-e)*l.phi+e*c.phi,(1-e)*l.theta+e*c.theta),h=(new s.Vector3).setFromSpherical(f),d=n.clone().slerp(u,e).normalize(),p=new s.Vector3(1,1,1),v=(new s.Matrix4).compose(h,d,p),y=new a.default;return y.matrix=v,y}},{key:"orbitLeft",value:function(e,t){}},{key:"swirlLeft",value:function(e,t){}},{key:"onComplete",value:function(){this.src.value=this.dst.value,this.enabled=!1,this._onDestinated()}},{key:"_onDestinated",value:function(){}},{key:"onFail",value:function(e){if(this.enabled){var t=this.pose;if(t){var r=t.matrix;this.src.matrix=r,this.dst.matrix=r}this.enabled=!1,this._onInterrupted(e)}}},{key:"_onInterrupted",value:function(){}},{key:"reset",value:function(){this.src.reset(),this.dst.reset(),this.duration=0,this.onFail()}},{key:"enabled",set:function(e){this._enabled=e},get:function(){return this._enabled}},{key:"focus",get:function(){return new s.Vector3}},{key:"pose",get:function(){if(this.enabled){this.time.current=Date.now();var e=this.time.current-this.time.start,t=e/(this.time.end-this.time.start);return isNaN(t)?(console.error("pose",t),void this.onFail()):(t>1?t=1:t<0?(console.warn(e/1e3+" seconds to start."),t=0):(t=.50005*(Math.sin((t-.5)*Math.PI)+1),t=Math.min(Math.max(t,0),1)),t>=1?(this.onComplete(),this.dst):this._interpolateSpherical(t))}}},{key:"duration",set:function(t){if(t<0||t>e.MAX_FLY_DURATION)console.error("EarthCameraPath.duration",t);else{var r=Date.now();this.time.start=r-1,this.time.current=r,this.time.end=r+t}}}],[{key:"MAX_FLY_DURATION",get:function(){return 3e5}}]),e}();t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(r(31));var i=function(e){function t(e){var r=e.camera,n=e.layers,o=e.domElement;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{camera:r,domElement:o}));return i._layers=n,i.layerName="project",i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),n(t,[{key:"destruct",value:function(){return this._layers=void 0,this.layerName=void 0,function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"layer",get:function(){return this._layers[this.layerName]},set:function(e){this.layerName=e}},{key:"targets",get:function(){if(!this.layer)return[];for(var e=[],t=0;t<this.layer.children.length;t++){var r=this.layer.children[t],n=r.treeNode;n&&(r.sceneNode&&(r.sceneNode.updateMatrix(),r.sceneNode.updateMatrixWorld()),e.push(n))}return e},set:function(e){console.warn("Not allowed")}}]),t}();t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=s(r(31)),i=s(r(1)),a=r(0);function s(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e){var r=e.camera,n=e.domElement,o=e.control,i=e.scale,a=e.resolution;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{camera:r,domElement:n}));return s._control=o,s.scale=i,s.resolution=a,s.proxy=s._createProxy(),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),n(t,[{key:"destruct",value:function(){return this._control=void 0,this.proxy&&(this.proxy.geometry.dispose(),this.proxy.material.dispose(),this.proxy=void 0),function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"_createProxy",value:function(){var e=i.default.getTileCartesianGeometryByGrid(0,0,0,this.scale,Math.pow(2,this.resolution)),t=new a.Mesh(e);return t.matrixAutoUpdate=!1,t}},{key:"earthToCam",get:function(){var e=this._control._pose.matrix;return(new a.Matrix4).getInverse(e)}},{key:"targets",get:function(){return this.proxy.matrix.identity(),this.proxy.applyMatrix(this.earthToCam),this.proxy.updateMatrixWorld(!0),[this.proxy]},set:function(e){console.warn("Not allowed")}}]),t}();t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=function(e,t){if(void 0!==e){(t=t||{}).handlers=t.handlers||{},t.thresholds=t.thresholds||{},this.domElement=e,this.enabled=!0,this.debug=t.debug||!1,this.rawTouchDebug=!1,this.handlers={tap:t.handlers.tap||null,"double-tap":t.handlers["double-tap"]||null,"drag-start":t.handlers["drag-start"]||null,drag:t.handlers.drag||null,"drag-end":t.handlers["drag-end"]||null,"pinch-start":t.handlers["pinch-start"]||null,pinch:t.handlers.pinch||null,"pinch-end":t.handlers["pinch-end"]||null,"rotate-start":t.handlers["rotate-start"]||null,rotate:t.handlers.rotate||null,"rotate-end":t.handlers["rotate-end"]||null,"twofingersweep-start":t.handlers["twofingersweep-start"]||null,twofingersweep:t.handlers.twofingersweep||null,"twofingersweep-end":t.handlers["twofingersweep-end"]||null},this.thresholds={doubleTapTimeout:void 0===t.thresholds.doubleTapTimeout?500:t.thresholds.doubleTapTimeout,singleTapTimeout:250,holdTapTimeout:600,twoFingerSweepTorlerance:4,twoFingerSweepOffset:void 0===t.thresholds.twoFingerSweepOffset?2:t.thresholds.twoFingerSweepOffset,gestureQueueLength:void 0===t.thresholds.gestureQueueLength?3:t.thresholds.gestureQueueLength,gestureConsistency:void 0===t.thresholds.gestureConsistency?.66:t.thresholds.gestureConsistency},this.thresholds.twoFingerSweepOffset=Math.max(1,this.thresholds.twoFingerSweepOffset),this.thresholds.twoFingerSweepTorlerance=Math.max(1,this.thresholds.twoFingerSweepTorlerance),this.debug&&console.log("Init recognizer",this.handlers,this.thresholds);var r=-1,o=0,i=0,a=null,s=null,u={NONE:-1,TOUCHSTART:0,TOBETAP:1,TOBEDOUBLETAP:2,TAP:3,DOUBLETAP:4,TOBEDRAG:10,DRAGSTART:11,DRAGGING:12,DRAGEND:13,TOBEPINCH:20,PINCHSTART:21,PINCH:22,PINCHEND:22,TOBEROTATE:30,ROTATESTART:31,ROTATE:32,ROTATEEND:33,TOBETWOFINGERSWEEP:40,TWOFINGERSWEEPSTART:41,TWOFINGERSWEEP:42,TWOFINGERSWEEPEND:43,DBLTAPDRAGSTART:51,DBLTAPDRAGGING:52,DBLTAPDRAGEND:53};this.recognizerState=u.NONE,this.recognizerStateQueue=[];var l=this;l.domElement.addEventListener("touchstart",y,!1),this.removeListeners=function(){l.domElement.removeEventListener("touchstart",y,!1)}}else console.error("Invalid domElement");function c(e){l.debug&&e!==l.recognizerState&&console.log("RecognizerState =>",e),l.recognizerState=e}function f(e){return{identifier:e.identifier,pageX:e.pageX,pageY:e.pageY}}function h(e){for(var t={touches:[]},r=0;r<e.touches.length;++r)t.touches.push(f(e.touches[r]));return t.type=e.type,t}function d(e){for(;l.recognizerStateQueue.length>=l.thresholds.gestureQueueLength;)l.recognizerStateQueue.shift();l.recognizerStateQueue.push(e),l.debug&&console.log(l.recognizerStateQueue)}function p(){l.recognizerStateQueue=[]}function v(e){if(l.recognizerStateQueue.length!==l.thresholds.gestureQueueLength)return!1;for(var t=0,r=0;r<l.recognizerStateQueue.length;++r)l.recognizerStateQueue[r]===e&&(t+=1);return t/l.thresholds.gestureQueueLength>=l.thresholds.gestureConsistency}function y(e){if(l.debug&&console.log("onTouchStart"),l.rawTouchDebug&&console.log(e),!1!==l.enabled)switch(!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform)&&e.preventDefault(),l.domElement.addEventListener("touchend",g,!1),l.domElement.addEventListener("touchmove",m,!1),l.debug&&console.log(l.recognizerState),r=0,o=Date.now(),a=h(e),e.touches.length){case 1:l.recognizerState===u.TOBETAP?c(u.TOBEDOUBLETAP):c(u.TOUCHSTART);break;case 2:if(l.recognizerState===u.NONE)c(u.TOUCHSTART),p();else if(l.recognizerState===u.DRAGGING){c(u.TOUCHSTART),p();var t={type:"drag-end"};t.touchEvent=e,l.dispatchEvent(t)}}}function m(e){if(l.debug&&console.log("onTouchMove"),l.rawTouchDebug&&console.log(e),!1!==l.enabled){e.preventDefault(),e.stopPropagation(),r+=1;var t=Date.now();if(i>1e3/60)return l.debug&&console.log("skip the events",i),i=0,void(o=t);switch(e.touches.length){case 1:if(l.recognizerState===u.TOUCHSTART){if(d(u.TOBEDRAG),v(u.TOBEDRAG)){c(u.DRAGSTART);var f={type:"drag-start"};f.touchEvent=null===s?a:s,l.dispatchEvent(f)}}else if(l.recognizerState===u.TOBEDOUBLETAP&&(d(u.TOBEDRAG),v(u.TOBEDRAG))){c(u.DBLTAPDRAGSTART);var p={type:"dbltap-drag-start"};p.touchEvent=null===s?a:s,l.dispatchEvent(p)}if(l.recognizerState===u.DRAGSTART||l.recognizerState===u.DRAGGING){c(u.DRAGGING);var y={type:"drag"};y.touchEvent=e,l.dispatchEvent(y)}else if(l.recognizerState===u.DBLTAPDRAGSTART||l.recognizerState===u.DBLTAPDRAGGING){c(u.DBLTAPDRAGGING);var m={type:"dbltap-drag"};m.touchEvent=e,l.dispatchEvent(m)}break;case 2:if(l.recognizerState===u.TOUCHSTART||l.recognizerState===u.TOBEROTATE||l.recognizerState===u.TOBEPINCH||l.recognizerState===u.TOBETWOFINGERSWEEP){for(var g=[new n.Vector2,new n.Vector2],_=[new n.Vector2,new n.Vector2],b=0;b<2;++b)g[b].set(a.touches[b].pageX,a.touches[b].pageY);for(var w=0;w<2;++w)_[w].set(e.touches[w].pageX,e.touches[w].pageY);for(var A=[new n.Vector2,new n.Vector2],x=0;x<2;++x)A[x].subVectors(_[x],g[x]);var k=[new n.Vector2,new n.Vector2];k[0].subVectors(g[1],g[0]),k[1].subVectors(g[0],g[1]);var T=[new n.Vector2,new n.Vector2];T[0].subVectors(_[1],_[0]),T[1].subVectors(_[0],_[1]);var O=k[0].length()*T[0].length(),E=k[0].dot(T[0])/O,P=new n.Vector3(k[0].x,k[0].y,0),S=new n.Vector3(T[0].x,T[0].y,0),M=P.cross(S).z/O,C=Math.atan2(M,E),j=Math.abs(T[0].length()-k[0].length()),L=Math.abs(k[0].length()*C);if(l.debug&&(console.log("last",g,"current",_,"delta",A),console.log("dir-angle",180*C/Math.PI,"scale-delta",j,"rotate-delta",L)),j-L>l.thresholds.twoFingerSweepTorlerance||j>L&&L>l.thresholds.twoFingerSweepTorlerance){for(var B=j;B>l.thresholds.twoFingerSweepTorlerance;)d(u.TOBEPINCH),B-=l.thresholds.twoFingerSweepTorlerance;if(v(u.TOBEPINCH)){c(u.PINCHSTART),a=null===s?a:s;var R={type:"pinch-start",scale:1,rotation:0},I=new n.Vector2;I.addVectors(g[0],g[1]),I.multiplyScalar(.5),R.center={pageX:I.x,pageY:I.y},R.deltaTime=1e3/60,R.touchEvent=a,R.deltaX=0,R.deltaY=0,l.dispatchEvent(R),R.type="pinchrotate-start",l.dispatchEvent(R)}}else if(L-j>l.thresholds.twoFingerSweepTorlerance||j<L&&j>l.thresholds.twoFingerSweepTorlerance){for(var D=L;D>l.thresholds.twoFingerSweepTorlerance;)d(u.TOBEROTATE),D-=l.thresholds.twoFingerSweepTorlerance;if(v(u.TOBEROTATE)){c(u.ROTATESTART);var U={type:"rotate-start",scale:1,rotation:0},N=new n.Vector2;N.addVectors(g[0],g[1]),N.multiplyScalar(.5),U.center={pageX:N.x,pageY:N.y},U.deltaTime=1e3/60,U.touchEvent=a,U.deltaX=0,U.deltaY=0,l.dispatchEvent(U),U.type="pinchrotate-start",l.dispatchEvent(U)}}else if(A[0].y*A[1].y>0&&Math.abs(A[0].y)>l.thresholds.twoFingerSweepOffset&&Math.abs(A[1].y)>l.thresholds.twoFingerSweepOffset){for(var F=.5*(Math.abs(A[0].y)+Math.abs(A[1].y));F>l.thresholds.twoFingerSweepOffset;)d(u.TOBETWOFINGERSWEEP),F-=l.thresholds.twoFingerSweepOffset;if(v(u.TOBETWOFINGERSWEEP)){c(u.TWOFINGERSWEEPSTART);var z={type:"twofingersweep-start",scale:1,rotation:0},G=new n.Vector2;G.addVectors(g[0],g[1]),G.multiplyScalar(.5),z.center={pageX:G.x,pageY:G.y},z.deltaTime=1e3/60,z.touchEvent=a,z.deltaX=0,z.deltaY=0,l.dispatchEvent(z)}}else d(u.TOUCHSTART)}if(l.recognizerState===u.TWOFINGERSWEEPSTART||l.recognizerState===u.TWOFINGERSWEEP){c(u.TWOFINGERSWEEP);for(var V=[new n.Vector2,new n.Vector2],W=0;W<2;++W)V[W].set(e.touches[W].pageX,e.touches[W].pageY);var H={type:"twofingersweep",scale:1,rotation:0},Y=new n.Vector2;Y.addVectors(V[0],V[1]),Y.multiplyScalar(.5),H.center={pageX:Y.x,pageY:Y.y},H.deltaTime=1e3/60,H.touchEvent=e,H.deltaX=0,H.deltaY=0,l.dispatchEvent(H)}else if(l.recognizerState===u.PINCHSTART||l.recognizerState===u.PINCH){for(var K=[new n.Vector2,new n.Vector2],X=0;X<2;++X)K[X].set(a.touches[X].pageX,a.touches[X].pageY);c(u.PINCH);for(var Z=[new n.Vector2,new n.Vector2],Q=0;Q<2;++Q)Z[Q].set(e.touches[Q].pageX,e.touches[Q].pageY);var q={type:"pinch"},J=new n.Vector2;J.subVectors(K[1],K[0]);var $=new n.Vector2;$.subVectors(Z[1],Z[0]);var ee=J.length(),te=$.length(),re=J.dot($)/(ee*te),ne=new n.Vector3(J.x,J.y,0),oe=new n.Vector3($.x,$.y,0),ie=ne.cross(oe).z/(ee*te);q.scale=te/ee,Math.abs(ee)<1e-7&&(q.scale=1),q.rotation=180*Math.atan2(ie,re)/Math.PI;var ae=new n.Vector2;ae.addVectors(Z[0],Z[1]),ae.multiplyScalar(.5),q.center={pageX:ae.x,pageY:ae.y},q.deltaTime=1e3/60,q.touchEvent=e,q.deltaX=0,q.deltaY=0,l.dispatchEvent(q),q.type="pinchrotate",l.dispatchEvent(q)}else if(l.recognizerState===u.ROTATESTART||l.recognizerState===u.ROTATE){for(var se=[new n.Vector2,new n.Vector2],ue=0;ue<2;++ue)se[ue].set(a.touches[ue].pageX,a.touches[ue].pageY);c(u.ROTATE);for(var le=[new n.Vector2,new n.Vector2],ce=0;ce<2;++ce)le[ce].set(e.touches[ce].pageX,e.touches[ce].pageY);var fe={type:"rotate"},he=new n.Vector2;he.subVectors(se[1],se[0]);var de=new n.Vector2;de.subVectors(le[1],le[0]);var pe=he.length(),ve=de.length(),ye=he.dot(de)/(pe*ve),me=new n.Vector3(he.x,he.y,0),ge=new n.Vector3(de.x,de.y,0),_e=me.cross(ge).z/(pe*ve);fe.scale=ve/pe,Math.abs(pe)<1e-7&&(fe.scale=1),fe.rotation=180*Math.atan2(_e,ye)/Math.PI;var be=new n.Vector2;be.addVectors(le[0],le[1]),be.multiplyScalar(.5),fe.center={pageX:be.x,pageY:be.y},fe.deltaTime=1e3/60,fe.touchEvent=e,fe.deltaX=0,fe.deltaY=0,l.dispatchEvent(fe),fe.type="pinchrotate",l.dispatchEvent(fe)}break;default:l.debug&&console.log(e)}s=h(e),i=Date.now()-t,l.debug&&console.log("touchMove",o,"ms")}}function g(e){if(l.debug&&console.log("onTouchEnd"),l.rawTouchDebug&&console.log(e),!1!==l.enabled){l.debug&&console.log(r),l.debug&&console.log(l.handlers),l.debug&&console.log(e),l.debug&&console.log(a),l.debug&&console.log(l.recognizerState);var t=Date.now();if(l.recognizerState===u.TWOFINGERSWEEP){c(u.NONE),p();var n={type:"twofingersweep-end"};n.touchEvent=s,l.dispatchEvent(n)}else if(l.recognizerState===u.ROTATE){c(u.NONE),p();var i={type:"rotate-end"};i.touchEvent=s,l.dispatchEvent(i),i.type="pinchrotate-end",l.dispatchEvent(i)}if(l.recognizerState===u.PINCH){c(u.NONE),p();var f={type:"pinch-end"};f.touchEvent=s,l.dispatchEvent(f),f.type="pinchrotate-end",l.dispatchEvent(f)}else switch(a.touches.length){case 1:if(0===r){if(t-o>l.thresholds.singleTapTimeout){c(u.NONE),l.debug&&console.log("Cancel a tap because it is hold for too long");break}if(l.recognizerState!==u.TOBEDOUBLETAP)l.debug&&console.log("first Tapping"),c(u.TOBETAP),setTimeout(function(){var e=a;return function(){if(l.recognizerState===u.TOBETAP){c(u.TAP);var t={type:"tap"};t.touchEvent=e,l.dispatchEvent(t),c(u.NONE)}}}(),l.thresholds.doubleTapTimeout);else{l.debug&&console.log("second Tapping"),c(u.DOUBLETAP);var h={type:"double-tap"};h.touchEvent=a,l.dispatchEvent(h),c(u.NONE)}}else if(l.recognizerState===u.DRAGGING){c(u.NONE),p();var d={type:"drag-end"};d.touchEvent=e,l.dispatchEvent(d)}else if(l.recognizerState===u.DBLTAPDRAGGING){c(u.NONE),p();var v={type:"dbltap-drag-end"};v.touchEvent=e,l.dispatchEvent(v)}}r=-1,a=null,s=null,l.domElement.removeEventListener("touchend",g,!1),l.domElement.removeEventListener("touchmove",m,!1)}}};(o.prototype=Object.create(n.EventDispatcher.prototype)).constructor=o,o.prototype.destruct=function(){return this.removeListeners(),this.enabled=!1,this.domElement=void 0,this.handlers=void 0,this.thresholds=void 0,this.recognizerStateQueue=void 0,!0},t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=u(r(10)),a=u(r(11)),s=u(r(79));function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(e,r){var n=r.isMobile,o=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(r,["isMobile"]);!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i.MAX_LEVEL=n?9:14,i.forest=new a.default({FOREST_CAPACITY:n?80:150,CACHE_CAPACITY:n?110:200,MAX_DOWNLOAD_CONCURRENCY:n?4:8,MIN_AREA:n?.6:.4,MAX_LEVEL:i.MAX_LEVEL,allowWorker:!1,name:"EarthLayer Forest",debug:!1}),i.earthEntityOptions=o,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),o(t,[{key:"destruct",value:function(){var e=!0;return e=this.forest.destruct()&&e,this.forest=null,e=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)&&e}},{key:"import",value:function(){for(var e=[n({name:"EarthEntity",forest:this.forest,maxLevel:this.MAX_LEVEL,minLevel:0},this.earthEntityOptions)],t=[],r=0;r<e.length;r++){var o=new s.default(this,e[r]).import();t.push(o)}return Promise.all(t)}},{key:"sceneUpdated",value:function(e){var t=e.camera;this.applyToChildren(function(e,t){e.sceneUpdated(t)},{camera:t}),this.forest.sceneUpdated({camera:t})}}]),t}();t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(r(73));var o=function(e){this.heap=new n.default(e)};o.prototype.constructor=o,o.prototype.enqueue=function(e,t){return this.heap.insert(e,t)},o.prototype.dequeue=function(){return this.heap.extractMinimum()},o.prototype.clear=function(){this.heap.clear()},o.prototype.isEmpty=function(){return this.heap.isEmpty()},t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){this.minNode=void 0,this.nodeCount=0,e&&(this.compare=e)};n.prototype.clear=function(){this.minNode=void 0,this.nodeCount=0},n.prototype.decreaseKey=function(e,t){if(void 0===e)throw new Error("Cannot decrease key of non-existent node");if(this.compare({key:t},{key:e.key})>0)throw new Error("New key is larger than old key");e.key=t;var r=e.parent;r&&this.compare(e,r)<0&&(i(e,r,this.minNode,this.compare),a(r,this.minNode,this.compare)),this.compare(e,this.minNode)<0&&(this.minNode=e)},n.prototype.delete=function(e){var t=e.parent;t&&(i(e,t,this.minNode,this.compare),a(t,this.minNode,this.compare)),this.minNode=e,this.extractMinimum()},n.prototype.extractMinimum=function(){var e=this.minNode;if(e){if(e.child){var t=e.child;do{t.parent=void 0,t=t.next}while(t!==e.child)}var r;e.next!==e&&(r=e.next),s(e),this.nodeCount--,this.minNode=l(r,e.child,this.compare),r&&(this.minNode=r,this.minNode=function(e,t){var r=[],n=new o(e);for(;n.hasNext();){for(var i=n.next();r[i.degree];){if(t(i,r[i.degree])>0){var a=i;i=r[i.degree],r[i.degree]=a}u(r[i.degree],i,t),r[i.degree]=void 0,i.degree++}r[i.degree]=i}e=void 0;for(var s=0;s<r.length;s++)r[s]&&(r[s].next=r[s],r[s].prev=r[s],e=l(e,r[s],t));return e}(this.minNode,this.compare))}return e},n.prototype.findMinimum=function(){return this.minNode},n.prototype.insert=function(e,t){var r=new function(e,t){this.key=e,this.value=t,this.prev=this,this.next=this,this.degree=0,this.parent=void 0,this.child=void 0,this.isMarked=void 0}(e,t);return this.minNode=l(this.minNode,r,this.compare),this.nodeCount++,r},n.prototype.isEmpty=function(){return void 0===this.minNode},n.prototype.size=function(){return this.isEmpty()?0:function e(t){var r=0;var n=t;do{r++,n.child&&(r+=e(n.child)),n=n.next}while(n!==t);return r}(this.minNode)},n.prototype.union=function(e){this.minNode=l(this.minNode,e.minNode,this.compare),this.nodeCount+=e.nodeCount},n.prototype.compare=function(e,t){return e.key>t.key?1:e.key<t.key?-1:0};var o=function(e){this.items=[];var t=e;do{this.items.push(t),t=t.next}while(e!==t)};function i(e,t,r,n){return t.degree--,e.next===e?t.child=void 0:t.child=e.next,s(e),r=l(r,e,n),e.isMarked=!1,r}function a(e,t,r){var n=e.parent;return n&&(e.isMarked?t=a(n,t=i(e,n,t,r),r):e.isMarked=!0),t}function s(e){var t=e.prev,r=e.next;t.next=r,r.prev=t,e.next=e,e.prev=e}function u(e,t,r){s(e),t.child=l(e,t.child,r),e.parent=t,e.isMarked=!1}function l(e,t,r){if(e||t){if(!e)return t;if(!t)return e;var n=e.next;return e.next=t.next,e.next.prev=e,t.next=n,t.next.prev=t,r(e,t)<0?e:t}}o.prototype.hasNext=function(){return this.items.length>0},o.prototype.next=function(){return this.items.shift()},t.default=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=(a(r(9)),a(r(75))),i=a(r(77));function a(e){return e&&e.__esModule?e:{default:e}}var s=function(){function e(t){var r=t.cacheCapacity,n=t.dockCapacity,a=t.debug,s=void 0!==a&&a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.debug=s,this.cache=new o.default({capacity:r,debug:s}),this.dock=new i.default({capacity:n,debug:s}),this.status="working"}return n(e,[{key:"destruct",value:function(){this.status="destructing";var e=!0;return e=this.dock.destruct()&&e,(e=this.cache.destruct()&&e)||console.warn("ForestNodeRetriever destruct failed."),this.status="destructed",e}},{key:"abortPending",value:function(){var e=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,i){try{var a=t[o](i),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.dock.abortPending());case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"clear",value:function(){var e=!0;return e=this.dock.clear()&&e,(e=this.cache.clear()&&e)||console.warn("ForestNodeRetriever clear failed."),e}},{key:"request",value:function(e){if("working"!==this.status)return console.warn("ForestNodeRetriever destructing",e.info,"request failed"),!1;var t=this,r=this.cache.getTile(e);return r?Promise.resolve(r):this.dock.queue(e).catch(function(t){return e.expired?Promise.resolve(void 0):"[Dock] abortPending"===t.message?Promise.reject(t):"404"===t.message?(e.is404=!0,e.defaultCooked()):"timeout"===t.message?Promise.reject(new Error("timeout")):"expired"===t.message?Promise.reject(t):(console.warn("unknown load error",t),Promise.reject(t))}).then(function(r){return void 0!==r&&t.cache.putTile(e,r),Promise.resolve(r)})}},{key:"info",get:function(){return{cache:this.cache.info,dock:this.dock.info}}}]),e}();t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0},i=function(e){return e&&e.__esModule?e:{default:e}}(r(76));var a=function(e){function t(e){var r=e.capacity,n=e.debug,o=void 0!==n&&n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r));return i.capacity=r,i.debug=o,i._stat={hit:0,miss:0},i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),n(t,[{key:"destruct",value:function(){var e=this.clear();return this.capacity=0,e}},{key:"clear",value:function(){var e=!0;return(e=this.removeAll()&&e)||console.warn("ForestNodeCache clear failed"),this._stat.hit=0,this._stat.miss=0,e}},{key:"getTile",value:function(e){var t=e.resourceKey,r=this.get(t);if(void 0===r)this.debug&&console.log("miss"),this._stat.miss++;else{if(this.debug&&console.log("hit"),!r.valid)return console.error("ForestNodeCache provides invalid mesh",r),this.remove(t),void r.destruct();this._stat.hit++}return this.debug&&console.log("get",e.name,JSON.stringify(this.stat)),r}},{key:"putTile",value:function(e,t){if(t.valid){var r=e.resourceKey;return!this.get(r)&&(this.put(r,t),this.debug&&console.log("put",e.name),!0)}return console.warn("[ForestNodeCache] receives invalid tile."),!1}},{key:"shift",value:function(){var e=o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"shift",this).call(this);return e.value.destruct(),this.debug&&console.log("shift",e),e}},{key:"removeAll",value:function(){for(var e=this.capacity+1;this.head&&e>=0;)this.shift(),e--;return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"removeAll",this).call(this),e>=0||(console.warn("cache removeAll error"),!1)}},{key:"_validateMesh",value:function(e){console.warn("deprecated.")}},{key:"stat",get:function(){return this._stat}},{key:"info",get:function(){return{stat:this.stat,size:this.size}}}]),t}();t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e){this.size=0,this.limit=e,this._keymap={}}o.prototype.put=function(e,t){var r={key:e,value:t};if(this._keymap[e]=r,this.tail?(this.tail.newer=r,r.older=this.tail):this.head=r,this.tail=r,this.size===this.limit)return this.shift();this.size++},o.prototype.shift=function(){var e=this.head;return e&&(this.head.newer?(this.head=this.head.newer,this.head.older=void 0):this.head=void 0,e.newer=e.older=void 0,delete this._keymap[e.key]),e},o.prototype.get=function(e,t){var r=this._keymap[e];if(void 0!==r)return r===this.tail?t?r:r.value:(r.newer&&(r===this.head&&(this.head=r.newer),r.newer.older=r.older),r.older&&(r.older.newer=r.newer),r.newer=void 0,r.older=this.tail,this.tail&&(this.tail.newer=r),this.tail=r,t?r:r.value)},o.prototype.find=function(e){return this._keymap[e]},o.prototype.set=function(e,t){var r,n=this.get(e,!0);return n?(r=n.value,n.value=t):(r=this.put(e,t))&&(r=r.value),r},o.prototype.remove=function(e){var t=this._keymap[e];if(t)return delete this._keymap[t.key],t.newer&&t.older?(t.older.newer=t.newer,t.newer.older=t.older):t.newer?(t.newer.older=void 0,this.head=t.newer):t.older?(t.older.newer=void 0,this.tail=t.older):this.head=this.tail=void 0,this.size--,t.value},o.prototype.removeAll=function(){this.head=this.tail=void 0,this.size=0,this._keymap={}},"function"==typeof Object.keys?o.prototype.keys=function(){return Object.keys(this._keymap)}:o.prototype.keys=function(){var e=[];for(var t in this._keymap)e.push(t);return e},o.prototype.forEach=function(e,t,r){var o;if(!0===t?(r=!0,t=void 0):"object"!==(void 0===t?"undefined":n(t))&&(t=this),r)for(o=this.tail;o;)e.call(t,o.key,o.value,this),o=o.older;else for(o=this.head;o;)e.call(t,o.key,o.value,this),o=o.newer},o.prototype.toJSON=function(){for(var e=[],t=this.head;t;)e.push({key:t.key.toJSON(),value:t.value.toJSON()}),t=t.newer;return e},o.prototype.toString=function(){for(var e="",t=this.head;t;)e+=String(t.key)+":"+t.value,(t=t.newer)&&(e+=" < ");return e},t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(r(78)),i=r(4);function a(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,i){try{var a=t[o](i),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}var s=function(){function e(t){var r=t.capacity,n=t.debug,i=void 0!==n&&n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._capacity=r,this.debug=i,this._size=0,this.waitQueue=new o.default,this._taskMap=new Map,this.status="live"}return n(e,[{key:"destruct",value:function(){return this.waitQueue.clear(),this.waitQueue=null,this._capacity=0,this._size=0,this._taskMap.clear(),this._taskMap=null,this.status="dead",!0}},{key:"clear",value:function(){this.waitQueue.clear(),this._size=0,this._taskMap.clear()}},{key:"abortPending",value:function(){var e=a(regeneratorRuntime.mark(function e(){var t,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(t=[];!this.waitQueue.isEmpty();)r=this.waitQueue.dequeue(),n=r.reject(new Error("[Dock] abortPending")),t.push(n);return e.abrupt("return",Promise.all(t));case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"fill",value:function(){for(var e=this.waitQueue,t=this,r=this.capacity-this.size;r>0&&!e.isEmpty();){var n=e.dequeue();this.act(n).then(function(){t._size--,t.fill()}).catch(function(e){console.error("Dock.add",e)}),r=this.capacity-this.size}}},{key:"act",value:function(){var e=a(regeneratorRuntime.mark(function e(t){var r,n,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._size++,r=t.func,n=t.resolve,o=t.reject,e.abrupt("return",(0,i.timedPromise)(r(),12e4).then(function(e){return n(e),Promise.resolve()}).catch(function(e){return o(e),Promise.resolve()}));case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"queue",value:function(e){var t=this,r=e.resourceKey,n=null;if(this._taskMap.has(r)){var o=this._taskMap.get(r);o.tiles.add(e),n=o.task}else{var i=new Set;i.add(e);var a=new Promise(function(e,n){t.waitQueue.enqueue({func:u,resolve:function(n){return"live"===t.status&&t._taskMap.delete(r),e(n)},reject:function(e){return"live"===t.status&&t._taskMap.delete(r),n(e)}})});n=a;var s={task:a,tiles:i};this._taskMap.set(r,s),this.fill()}return n;function u(){var e=null,n=t._taskMap.get(r).tiles;return n.forEach(function(t){t.expired||(e=t)}),n.clear(),null===e?Promise.reject(new Error("[Dock] No active node")):t._downloadTask(e).then(function(t){return e.cook(t)})}}},{key:"_downloadTask",value:function(e,t){return this.debug&&console.log("_download",e.resourceKey),e.download()}},{key:"size",get:function(){return this._size}},{key:"capacity",get:function(){return this._capacity}},{key:"info",get:function(){return{capacity:this.capacity,size:this.size,queue:this.waitQueue.getLength()}}}]),e}();t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=[],t=0;this.getLength=function(){return e.length-t},this.isEmpty=function(){return 0===e.length},this.enqueue=function(t){e.push(t)},this.dequeue=function(){if(0!==e.length){var r=e[t];return 2*++t>=e.length&&(e=e.slice(t),t=0),r}},this.peek=function(){return e.length>0?e[t]:void 0},this.clear=function(){e=[],t=0}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(0),s=v(r(12)),u=v(r(80)),l=v(r(82)),c=v(r(1)),f=r(15),h=v(r(85)),d=r(16),p=v(r(18));function v(e){return e&&e.__esModule?e:{default:e}}var y=function(e){function t(e,r){var n=r.name,i=void 0===n?"EarthEntity":n,s=r.forest,u=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(r,["name","forest"]);!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var l=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,{name:i}));l.sceneNode.name=i+" sceneNode",l.earthTreeOptions=u,l._scale=u.scale,l._resolution=u.resolution,l._useTexture=u.useTexture,l._maxAnisotropy=u.maxAnisotropy,l.renderItems=u.renderItems;var c=u.planet;return(void 0===c?"undefined":o(c))===o(!0)&&(l.visible=c),l.northCap=null,l.southCap=null,l.atmosphere=null,l._treeNode=new a.Object3D,l._treeNode.name="_treeNode",l.sceneNode.add(l._treeNode),l._tree=null,l._forest=s,l}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),i(t,[{key:"destruct",value:function(){var e=!0;return this._tree&&(e=this._tree.destruct()&&e,this._tree=null),this.sceneNode.remove(this._treeNode),this.sceneNode.remove(this.northCap),this.sceneNode.remove(this.southCap),e=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)&&e,this.earthTreeOptions=void 0,this.renderItems=void 0,this.atmosphere=void 0,this._treeNode=void 0,this._forest=void 0,p.default.disposeMesh(this.northCap),p.default.disposeMesh(this.southCap),this.northCap=void 0,this.southCap=void 0,e}},{key:"import",value:function(){var e=this,t=this;return t._tree=new u.default(l.default,n({sceneGraphRoot:t._treeNode,name:"Earth Tree"},t.earthTreeOptions)),t._tree.visible=this.visible,this._forest&&this._forest.add(t._tree),t._tree.initialized.then(function(){return e.initUI()}).then(function(){return t.initOptionalItems()}).then(function(){return Promise.resolve(t)})}},{key:"initUI",value:function(){var e=this,t={radius:e._scale,polar:"north",imageUrl:"north"},r={radius:e._scale,polar:"south",imageUrl:"south"};return n(t).then(function(t){return t.name="northCap",e.northCap=t,e.sceneNode.add(t),n(r)}).then(function(t){return t.name="southCap",e.southCap=t,e.sceneNode.add(t),Promise.resolve()}).then(function(){return e.atmosphere=new h.default({earthEntity:e,scale:e._scale}),Promise.resolve()}).catch(function(e){return console.warn("EarthEntity initUI error:",e),Promise.resolve()});function n(t){for(var r=t.radius,n=t.polar,o=t.imageUrl,i="north"===n,s=e._resolution,u=Math.pow(2,s),l=c.default.EQUATOR/2,h=-l,p=i?l:-l,v=i?r:-r,y=void 0,m=(l-h)/u,g=new Float32Array(9*u),_=new Float32Array(6*u),b=0;b<u;b++){g[9*b]=0,g[9*b+1]=v,g[9*b+2]=0,_[6*b]=.5,_[6*b+1]=.5;var w=i?b:(b+1)%u,A=O(h+m*w,p);g[9*b+3]=A.x,g[9*b+4]=A.y,g[9*b+5]=A.z,_[6*b+2]=.5+.5*Math.cos(2*Math.PI*w/u),_[6*b+3]=.5+.5*Math.sin(2*Math.PI*w/u);var x=i?(b+1)%u:b,k=O(h+m*x,p);g[9*b+6]=k.x,g[9*b+7]=k.y,g[9*b+8]=k.z,_[6*b+4]=.5+.5*Math.cos(2*Math.PI*x/u),_[6*b+5]=.5+.5*Math.sin(2*Math.PI*x/u)}var T=new a.BufferGeometry;return T.addAttribute("position",new a.BufferAttribute(g,3)),T.addAttribute("uv",new a.BufferAttribute(_,2)),function(t){return function(e){return new Promise(function(t,r){var n=null;n="north"===e?"data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAeAAD/7gAOQWRvYmUAZMAAAAAB/9sAhAAQCwsLDAsQDAwQFw8NDxcbFBAQFBsfFxcXFxcfHhcaGhoaFx4eIyUnJSMeLy8zMy8vQEBAQEBAQEBAQEBAQEBAAREPDxETERUSEhUUERQRFBoUFhYUGiYaGhwaGiYwIx4eHh4jMCsuJycnLis1NTAwNTVAQD9AQEBAQEBAQEBAQED/wAARCAIAAgADASIAAhEBAxEB/8QAdAABAQEBAQEBAQAAAAAAAAAAAAECAwQFBgcBAQEBAQEAAAAAAAAAAAAAAAABAgMEEAEBAAICAgIBBAIBBQAAAAAAARECITESA0FRBGEiMhNxBYGhwUIjBhEBAQEBAQEAAwEAAAAAAAAAAAERAjEhQVESA//aAAwDAQACEQMRAD8A9/qnu/3X5l9nsn/o1vT6s/1l9ms00/8AVrOH0Px/xPR+J6/HSTWTuxz/ADvZ7tfT5fjzynzW71vyMY+R/s/wfV+N6pdtvLHNr8d+f7dfZ7rdOZnh9H/cfkfk+d139lsver4vEvHz8PT/AJc5Ncu6VFtR0rmAAKIoqCiEY22Xa4c9qlrUhawtrNrNq4uTLHkTNqauLtblvSJ4t6xYlSy1rWYa4Z8pGkaSs3dm7ouOiVjzx2XfJo1lLamTIJSzgysuUWOWcVo9mmOYkvAqmeEvSS/CC5WVkzc4po1bglQnBpjS8JnKWqjfayOetrXlVGjhMog0YjOTyUarO2uWvKJ5QHK6UuuI3vtnpzxte2asSZMNYwzcopFTKXZBfJMoCmUBAAFAAAyA/p3t/wBlr6tNtvZ7L44fI0/+k/I9Ot00/fptb39Mfma6fmba6+y3TWfykfL/ANl6/wAb0ezx/F2u2uPn7TjiWsddWOf5v5m35Xs223mLl5VvPfaV6Mk+Rz9QFQRUFALwxtsDeYl2crul3S1cdNtpXPas3ZPJnWpC1nbbhLvm4LEqr6+XSas6Y1jXlSFa4iX2MeSzmLrOL/ZmJdk4hf0NXDJlBNVbys6YWUMaMpbwmVRrFJNsktTyuUVrabWdMSWOnlcM3blRi7cou11+lm2tnSaGUal1+kuPgVAWIJLlUFRqKzF+AxchOhUAyAnJhVyDOBbWbUIM1crwNOdjOHbETxiYa48q6eES6pYSsCiKiZXB4gmV7MLgES1rB4mD+l/7P8D8T0aX2+raZk/fMvxf5e+v9tmvOuX6P/6Db8bG+3p3vlt/KZfl7z21/jPm1n/T3EKcDq5iKgB0W4Y22TVNtnLbZbsxWbVkMmUTKNLWdtsRXOy2/olWGvNzXXOXONZBVymQFMoKmNcMcyqIpkAA5goCcAIuT5ZymTVx1ljG/aZwZyamLMWYrOLKLnM5FItAAAAAFQFFlW3hnmKaixcsy4b/AG1UTWpvw1Jou2utgrnOYl5a8eMRma7SpQxhLlrpLQSWnkcmKil2ymaYwZBi0/w34ZT+vCKzyuFxhYmFqLwuEw0i8JgBX6f/AH23489909FtxeXyP8tezffbe7bXOay3zMjj1dqANAzdsLa5bVLSF2ZtZtTLNrcis0yIqBQVEw0iCKACoAohkFAAABFAAADDPy0lBFAEMKoIqUBRAFAABAaQAGs8MZXKosbvTnlZuGJnnCbSzkvay/FRUlysSzHSwGuGbRAMhUgGblfJCQFsyi8gLCgIyRan+BX0M55EV1chFPgHPauVrpu5VmtREq1mstAiggCKAAYRUoAAAAC5QBRAFEyuQAACwARKoCKAAAAACoAogChkBEaQEKAKimAJlUAUCA3NZWbrhZcLa0yx+hJ9tSfKIpQAQ5akhQYo34xLJgHsBMujkpkTKVWN3Ouu3TlYjUYqYasTCVqJgvCliCIshQZFEVAAAAAAAQFAAAAiouQAAQVAAAAABFAAAAAAAAAAAioZBcJzFlbmssUc/JYzZ47YamE/Iq5Qio3MJdYnRlUTDWElXIpZhC2oC5S0Khj11nJaxltjHXLJnhm3kGqxtFtwzaixmmFEVmhQVApOQZqRqxEVDCiCAAAAgKAAAAABAVFSgAAAAIoCKAAAAAAgCgAAAIUAy3rthghBv2TNzGTKiEqoqgAAHABmRLtFmmbyv9UBz8k8nT+s/r4Sxdd9mZ26WOe3FdGG/hk03nybdiGWaqIomVTCKzaTJvMJrRWuMJr2RM/uBdkXZEEBM8igCAAAAAAAAAAAAAAAAAAAACooCAoIAAAAACI0gI18IsBFgfALBFAVAGliLVSrlfJgyqNXZm7VKiar1fDF7dJOHPZusRnBm5BloBMgUyhdaDWJtHL+OzprrszvptnIoxe8tW2RnOUGs5MJOFzgVKzW5zGbASVWY0gAgKAAAAAAAAAAAAAABgAUAAAABBUAAAABBUBRFBKp2AAAsAAVAFAlVFMCXgHq1vDNia7cNZjUYY2mGMum3LlZilWGUq4T5wy0SltSd4KDWtq7ViXDVssBnySb4vSS4q7TPMRV8v0XMsYiwgvwzhekyoYFEEwjSABFoIAAAAAAACEpYQFEUBUWAAoIKAgqACmARGqgCKgAAAAAAAAKAAAAYVYqJMrgURvXaeOIzrvi8vH6/dvO29fZdrb8M89zxq8PX5ZmSYrlrtw3rcN6zhvMdMZw7cbOW+uNgLPmI18M91FMI0nYM4JmNCKmCLgUEwoDOFBALABIUAAABMmQUAAVAEKoJSFTMBpWZeWoCqkaVKhWsJtqqazgs4ahUVhZ2l7UF26c46YyxeKBFSdqioKAgAGBUAABRFAVAFWVBUaLElUR48Lpbrf0FjlJ9dbXTWuvw5azMdJ1h0jnV0ty6byXX9XKN+WWolMXDMmK6w29fGTDXK3nCY5Z1/lXSxFSzhlus4AnIsLAQVLwAioAAiiKgAAJUnbSAozaeciDaMzY8jRqoZZ5UW0EQJw1KzkyaOmvLWcMa7yQ1zeaspjtpc1u4ctbhZs2zY3dY57S5xHTOYSZEc7ricsx03c2WoSm3IUGVKiKZVAAAAIoIoAAACgIqKINZ4ZawqV5L2ShHN1am1jpNrXKNRZWa7SrHOVuNxl116y66/ujnpZjCzMvDUZrHs9eLmMS84ei2Vx8MVLFlS8pVsxM/LPcRVUiAFBRErVSxBlcAioAAACC1kF8PJm+nZc2Nz2/Zg43TeJmzt2tlTGtTBiXhPKytTxhvIikvCWpKZRQTICzt0m3w5NSrKldosrnNmtdsVuVmx3nSxjTaVvqtMue/NwxZi4dd5nlz74RYIuMCKliLemcZFVBUEUAMAAAAUgsABcKiBeCAqyAo8axIri6KsqEWI6RuVzlXW8txmvRHSVz0sreZG5WLFsNbzippbstxKqOe85s+GJOcOvs6y56xmtRUawzRQFBKi1EGakjVjORVEECgAM2NICVmt2J4wGZtg7axqlnPDK4zjC2pazyCoZPlFBQEyZQTVbla8nKVY1qWPR6rh18+cV5ZvXWbZn6tysWO21Tw+Wc5dJyqOVvODHDW2uOWJeQhLxymGrEiKmBqxkABFAAAAFQBqCCotmScGQFyIWXCo8oK5OiLKAK1GYqwb12sddbby4x10vw3GLHSbWThJk1rfDTLGUkxTeY6JftBSwKKyq4KGspVwzv/GpVLtMds5n2wlZ/prHTM+y2fbl8lllxZip/RjpmfZmfbmH9GOoa/wAYrSIljWYzaDNiZ4aZqVdSzK44I1rhBzuJUv263TW8udlSqhVSioIIqrGVgjTetwxHTXFnLXLNdZ0TaxNeBtl11s2mHPx8dmvXcL/K5VGNyRvbTMZxhDU2Id8GMQVNiRPlqAxcykq7THKf4RVAAAAXKAKIqouVt4ZX4B5p0JRzbUAFWIQG466Ocb1uG4zXSrqx5NRplq4Z2n0lpNgJVNpxmJKDQCjOzHs/jW9o57z9tZvixyKO3r9c1n9vs6nUYk2tW4vp9WP3bd/Ea93q85mfyn/Vn1b32ezba/E4/R133xMTt25nN5z8MW3XiG/brz5T/lzlcOplx0l121/jCpreIZmW5WUpLL0b3j/LP8dp+pauNW4OE2vCbZ4ZtMazJ/yzbipdrMJtmmi+dXyzHPnOF+cJqqlLcM28pVgGftOUVoIKLlZsxmrklSx1m9dNOs1582ct/wBl8eGpWbHby54b0v24S7SZxw3N9rMycNzpmx38oWOWu2Zl01uWvWbGPCzbPwzds3D04ljzba3XfPwlmLKti/BmUvSKl5jGGkKEEEVRMqAAAqAKuUWRUeadDOVly5NmVLBQWIqjereXOVqVYzY3K35Ofwnk1qY3nK4wzq1dl1Mb1qbTF4Z8k22toOkS3DOaUFyz7P40lN8eFS+VYx6NdNvZJv1/3dvyddbed8Y61eadt32TbXx9nM+NvmJLMvP7Wy7rXpxNd8XK/B69PH17Z5zeKm20177+nSfOZvxn2s7Z+Hn2znjp0vstvPX0s8bHLvr+vG5MYm1kWbR18dfGYYvriSGs25vHwlt+a1rpYbafKYFsuuTfqMycYW88Cpt8FuP8mCyXkCcf5T/yMfqWZQTbuJ8teKfJViX4OfsphFJ0Xo+Fx8AJ9GF46EX4Jcak1/VcfCjeeHTS/tjlJmYb14mG4xW9P4x20mY4azjDrpthuM10025xT2aSnfJm/LTLhizYt5dNpO3LbthuBYTtb0DAiooACiAKIAq5ZUHlWXlJFjk23cWMg0iqgCxplYo3nhJ2mSLqY3lPJm1ZBGo3GZhctI0m/SZbkzMKMa1Nv40s8dl7/wAIOOeVrW2uv0vjrfhn+a1rGu+2ut1l4qOnhr9F01+jL+zY41OY63XX6Zus+kvNNXXbiHl9J4fRZYahnbK23CWs+RVAEUAARQERURRFQVRBAAEbi5YlF1G5WvJzlajUpXbXrLpry5yyR0045bjFdJwvDN+1y0yzteHLZvfKeOIlWMxYnyRFTbio1eWalBMiCtJlMmQaTJlYCGVrIOKyFgw2KiiACCiLFFEWKLFygMtZWVlY1BpvXPwxK3rtfhUTfW5zhM4jpdrhjyn0oxnJOF8tZelzr9JqmScr+2pIDNjLV7MIM22JnLVjFiLqVlpm8VBQ7EUAABAEBFARFUQAAAVFEI1KyLCuk2zXfW8PNHfS8OnNYsdtdskc5XTXpphZym/DUY9ijmLtPoZaSot6QolZaqIrItZQXLUrIK1blkAc85Exiqw0ogqKIAqoAqoKNCKIqxlYo1GpWFVHTMsc84p5YQqY1tMzM7SVJcLxRVi9JBQyGImEBmrWUVErScIM4WWLcJ4WglqJyqKFEFAEEARQABUUAAAARY667cOLUrUSu025ddN83DzeTfruOW5WbHqTeZjHnjDVvDbGOf6GG/GXlmosZQoipQTKKliYayAzzBqoioCVBnsIiKAgqiKAqKIqoKKACiAjULUyAs5axwzK1NlRE5KmbgG5cwykoouUtEAqKiKJhTKC+ML+jOUtFSpktTLKhlLUNFyIqKAAAAogCoAKAoEAiK1NqwuVlSx3024xW5eMOGrtLw6SsWOkvGEsyTpVRnxiYawzUol1Twa8vtLsipZGatrPIqUXCIqCpUGMjNWcstAAACixQEFRQFQUURQFQBQBABUWKyGi5MplMmq0lpazlNFyiZMpq4VKAM2o1ZlPGplWEXeTxRLmxNCKkmFFEAFEUAABUAVAAVBRSAI3LhrXbNc41rxWpUsenWtTFjlreGtb8OkrnXT4S65anSxUcLozY6783DF4uEsWM4xEasZsZaES1MooM3a5XKK52GWjDNVmVTgAABVRVQVFAAAABckQBQMguTLIqLlMgABUVMplMplNXGsiZAxQyfKjWszWt7rJidpt7NdZw5zO1zS2eJiTtdtcUkxVvKKztwkWzIgI3NcxnaeNCVFRYKAAAAAAoAAAg1GVWDtrtw1rtiuOta8m5WbHp02lb6rz+q4dfPnFblYsXeZ5c++HTap4fIMWMWN284TCKx4H9eWs4Wbcorlv6/pJHbGcudzLylmErkAy2mBcogAKKsSKIAAoAAAAAAAAACKAnJzU2uF165BJCxflKCFakS9pisi4RAxlf0QBWp0wsqwFnaazlfkHTWRj24wZZ25W+JJ9YlaJCstaCKAAAqAKgAKigAKhKsRYo3N66zbM/Vwb1uGuaxY75y6TlynRNrG9Zsa21xyxK662bTDn442sKRmxnWO10vjlzneEs+q1rGPbrZy663C7SbzBZsNyvEgOToHRQBUFGhIogAAqKAAAAAAAAAACYUAQKALNcrrM1rfaaa4X56lrne8JhNL8tfKetMWcrh0xKm8xDDWMJDa/RGRV7IKFmEXe5kwa/qCLg274IqJYy3WbEqgRUVBQEABRBQAAWAI1HTXFnLllZssqWPRrwOU3rpp1mtys46eu4Xu5c/LnhvW4uL20zY1nDPjLctWJnFKOdt13xW5cHt08pmdxz02zxe08X2PMA5OgAAfKwqiNIogAAACiAKIAoAAAIoAAAgKBLhjaXa8tmC/oSTCgDWuJMue212uPhrnCa6lGcF1w6zWN7aTxP5TXngnMpWWm5jHKXnplvSLPoWYF2ZVAX5S9gx8q1iJhFEUFQBABQEVAUBQIAlajc3uMObcaiV0047Xa5uYxK3ry1GW5tcL6+e3K3Fw6aXFX8s118cPNvPHd6+LHD3ac5i9ROa8YDi7ARQAVUQUQAAAAAFAABUAVAAVFAAAwAAZAAAAakjPs2k4ihmxf7LjDM6VNokxWPG5bkXxnZhrm1rvhbI5/LPi+tZtrVjM4XyWIp2hFFswl6bxnVgVAEVAEBUUBFQBUUADKorUZjUWI1GtbisStRqVLF3/dizt211l0/VxddNmozV13uvFdP5RjbWbTM7X15xitRmvAGV7cXYVFEAEAAAAAAABQAAAAAAABRFAAAAAAAyzjnLQUIBFBQgM7T4ZuuHRLMpmmuYt1wjPiz63rym3Ca3DW1lWBrU2IZVEARUARQAAAAABUBGosrDUWI1GsskaG5WpWI3OViN6bcu0mJl59eK9Ov8W+WK+bhcKOToiggAAAAAKIKAAAAAAAAAAAKgCgAAAAAAAAAKiwAAEvTle3W8sWYSkZWAkaqiC6ioCAAKAAAAAAAALKgI1lcsi6Y3l09blHTXaSNys10xy7ziOHrvy667NxivEA5OgAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAgCWKgMXhYtjPTLSgAAAAAAAAAAAAAAoIoAZayysqxHbSukuK46V0y6SsWOADDQAAAAAAAAAAAAAAKgAAAAAAKIoAAAAAAAACAACAqAAze2jCKyG0EUBMgpLk7QFEUAAAAAAFAAEUABUa1uHSXLjK15NSpYouCwGRUQAAAAAAAABQEUAEVAAAAAAAFQBQAAAAAEVABUAQQVcmQAAELGHSs4SxWb0jdjOExdGvHjLMjXlxgRiVUnbRFDKAKIoAAKIAEFABFFEUR//9k=":"data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAeAAD/7gAOQWRvYmUAZMAAAAAB/9sAhAAQCwsLDAsQDAwQFw8NDxcbFBAQFBsfFxcXFxcfHhcaGhoaFx4eIyUnJSMeLy8zMy8vQEBAQEBAQEBAQEBAQEBAAREPDxETERUSEhUUERQRFBoUFhYUGiYaGhwaGiYwIx4eHh4jMCsuJycnLis1NTAwNTVAQD9AQEBAQEBAQEBAQED/wAARCAIAAgADASIAAhEBAxEB/8QAggABAQEBAQEBAAAAAAAAAAAAAAECAwQFBgEBAQEBAAAAAAAAAAAAAAAAAAECAxABAQACAQQBAQMICAQHAQAAAAERAgMhMRIEQQVRExRhcbHRIlM0FTJygpKisiNzkaFCYvCBwVLCQzUzEQEBAQEBAQEAAAAAAAAAAAAAARECMSFB/9oADAMBAAIRAxEAPwD9ris+Vjeu0rXjKDOuzXeM+OF7A47cV8suHLpvrtmPbnqXXXbuDzcVtxl6PHMJpJ2bnQHn5fXm8w+d/LLx8t3j7FrO0liD4vNpya9mvS9nbXfx2r6O/DrtOzwbentOXy1B9S+PJx5c9OKy5c+LbbTXFdNeaZw1IlreLjDnvxXD0yyzLPJZNchr53JbpetdOCzbtXk9zmztZHb0OPfGaYa92ureEzhZmitdDGUsWIHjAAAFAAAAAAEIqIKACyrlgtBvyZu0+E7r4gnWp4t4UGJDbXMaysB4t7tx7ZdNOebdLXfk49dp1eXk9Wy51B3mL2quPDNpcV6ZjAMYalLE7A1kwzK0CVFpAErTAKAAEXAIqUgLhQBw1lldpsmISAtoiglhMqQAAAUBiyM2TLdjFBnbSOe3HPh2vVZIupjnr5w5NrdcO2JYl0hqY+Tv6223J5V9D19PHTGHaaa/Y1JPg1cZmrUjWIlFEAAAAAAACplcGAJS0wAigAAgItZBqLKgDSWpkBI0kaBOphTIM3SGK1agM9TLSXUEWVMANd0TKgJe5UsyB5C+JYAqSKCUyWIDcq4YlxXSA5LKvcxhQICAAACUFyuWQGmbqq5Biani2gJFBQIAGaAAAAAACZBpMGTIKJlMgomVyAAAAgGBKCpkwmAaRYuAYyspYSAuTJgknyBkMLgEMrgwBUw1WQLEarICpU6g3DDMq2gVILgFx0YsxWpU26gjWtZjQMS2NZylizsAYqVddooLBMoKBkDBQwCRTAAAoAIAAAAAAACgmFUGcGGkoJgVKAuEi5AwGUBciKgCKosS07IA1lmKgtRKZBcnczCbAvYtZtMguTKAFqS1qariAJhb0ICJhagGDCgIoUCJQAwZMoCrEsSA1YxjFbZ2BYGtWwElKlIDWqoAAKgAAAAAigAAAAAACglUsBDAWgCKAqKAISgplAAFBGkEErNbSwGZK1IswqiYSxUtQIqar3Bc4Z8lrOALcrEwuAVMFzFgLIWEUGMr3WwwDItSAhFsQGrGWspYAADMuK2xhqAuCTAAAKgAAAAAAAKAICooIAAAopQBDAZBMGFXAMrEqSg3hnC5QAFwCKJQUSNYAiUuydwAW9gTyE8asQMUjVTxUS1LSxZOgE7LOiCC25EigplDILKvdhrIFjLWWe4KYMKDMVrxTAM0XCWAYWRIuQLUydTAGSGFwoAAC4QAAQAFAEBUUBAAAUUQAQUEjUrFWUFrFbrIJMtQkKCiRQAUGWmMrkEpmi4AkWdBm3qDfRm3qW9EmAayvlGLmmAazKrMioCLIUEEqwFZrSWARUhQCCwBUJQaygAgoCYXAQDAlpFFBMgqVcs0Gp1LElaBkEBQAAEAAAAAQUFwLAQKgLYkitYBlmtJjIEpeq+J2AkwJkBS1CgzYsirQRnPVpj5BuGEXAJTC4S34BeixmRpAAoLEpkBmkKsBYVYzaCNRBRUVEFEUCKy1ACiUEyuWRRcmcJJSwGpSmpQQXBgEjXwi5BmmSpYDWSRmNyguGVyUEBcIISLgBLEaygArNUBYUEy1LlzpLYDoZZ8gF8kzkwuMAki24TKbARvHRiNygzhcLQGbCRqsgsMhgCUBAAAKZSgDMtqgtRUBciKAqKoAIAsAZajKwFKAJhZqGVFwlLsx5dQbhSVKCmUyk7gtRTAIsiYMguEwZWUDCXKylAXKEQVMqmAIZak6M2AsSxMrlQKZATB4rGgY8TDTNBclrFrWvUCdVusXszaCXoTZL1JrgFuzUZky0C5ZqXKgZWJglwC0BABMguCmTIJiRF7gM2rLlnbusvRUXIxaa7A38rEqZRWlZi5BoQBFgAokVREy1hnAJeqYbwYBnNjUPEAAAUnRroDF6s2OmOpYDEi4OxkFwRMmQKRUQXIiguUqZMqGEaliWASAAKhAWphUyCWEuCpJQatyli4KDM7t2dGcYq3boCXoSp3Aa6JlOtMA1lARFAFHO7yXq3a8XvTk8Ltp8A9ssrnyb4fO9H2+Ta+O718udp0VHTj5ZejtLHz+uvVvXnoPXZlcOenLLMr97KK1iJNeqTbJN+qDa4mEly1IDKW4aseXm5NptiA9OuzTy8e+3y76b5B0ShQFjKxRUW1AUMpkFqRMrKC1nOFtyzYC+RN8JhnaA3N289HKStAtSxqFBkXCYBYuEjU7AyKUGajSyAxi5bNklAsUSgGcJlO4LnKkKAvZJEoNZS1kBb2TFWNTGAYiVqzqSAzMtLiAghkiCgCsckuOjhdsy616bHPfSdweC+t47eWr1cGts/aTe4TTmkuFiOvJxSzo8u/Hdeseq8nRjbbXaKjw8ns7ccb9b25v0qe1weWl2nw8nBxbf0s4/IzfVj7et08cys77a46PHpvtrr42t6b23FXDXSc/jTb3ZqxtxXa9EvqZgPRxe3rv0dLprtcvn/c7ce3R69OT9jr3KO3hrhm/s049rsm8s61FehFQEMlIolpKtjINZS1FwApIoEhhYAM2NJQIUAMmUUDJUUEWUMAZMpSAqypUgN1lpmgGMo0CYVMqCLImFyBamEysBMLhamQS3Bk2iQFFgCAAKigAIDG86Ns2A4bcd26fa8947x7vfZ8uPJx+VyDN08tcuV12ldppvF21uFRjXWWYryb+pt97nXpq9WtsrpkR5567Xhiul3kc99/kHo4tZjq6WR5OPnzcO15cCxnn16Pm+xzbcfSPo7ck2jxe5wXbS7a9z8F9P3J08q9+/Lptpn4fG4eLWSftYv2PXpenhlIPrItQVKsCKFiYaATBhcmQRUyoCWlTGQWAAAAYXCAAABkMAVFwYBAWAsSrEoJlcs0lBrC4SVcglStVASRcL2TIFQMAlo1NSzAEEUAAAAABAAATCoBhnaNAOPhLW7rJCzDny8t10qo4clu22I1OG7fs1y4OXy5Osevl2xPKIseKf6fLh6dpLrmV5uXi22vlO9NeHmx3IL1mzvp47a2Xq4cmu0n5XPi5NpyYvZUZno73mu07PVr6lly9Gu2uGrczog6gCpRWQWVrLMiqJaZFx0BMrGflqAohaAIoAICwIAAAAILBFBCAoVKqAsMJnC5BMCymQSrKUAAAwsRQXyY2quHu/wfPf8As2/QBPa9X99x/wB6frX8X6v77j/v6/rflhB+q/F+r++4/wC/r+s/F+p++4/7+v635fTj35Nppx63fe9tZM1myy4vSzvAfqvxfq/vuP8Av6/rPxfqfvuP+/r+t+VAfr5ZtJdbmXtYPJ9K/gOL+1/mr1gAAJQoJlUjSozs53SbdK3tUkoOenBppbWrtrt+yzy7WRnj21zm9wdtOKfLO88ezX3kkeXl555Yphr0cfFrvOrny+vx69Z3deLeTWW/LPPt06A4cfJrNsbPXr47dnxfZ5Ntbbr3T1ff3lk2B94BFDAAqLlnKiqgCWKACKAkihaAmFAAcvb5/wAN6+/Njy8ZMT8tuAdB4L7nvcGn33s8Ot4vnwv7Wue2cpx+5794vxO/DreCzONbfOa/b1QfQV5PX96b+lfb5pNZrnMn5Lhz19n6ny6ffcXDpOO9dddrfKwHvHk0+o8W3qb+ztLrePpvp8zb7HKe19T+7/EfcafdY8vDN8/EH0Bz9f2NPZ4debj7bfF7y/YvNy6cPFty7/0dJmg2Pn6+z9T5NPvuPg0nHeuum1vnY6a+3y+x633vqaS8s2xvx7/GO/2KPXUjx+r7/Jz+1twb8f3d00ztL3m0smPzOvq+ztzc3sce2sk4dvGWfPfv/wAAenBI823t76+/p6vjPHbTyu3z8/qefb3/AHfxe3racWnlM3TyuPLX4sB9Jx4fZ4ue7zjz/p7eO2ZjrGPX5Pe23x7HFpppjvrc3Ljw+1z82nPeHj1+849/HWdpt170HsnLx7a3bXabTXvi5xhn1+fj9jjnLx58bmTPTs+Z9L25/Dnl1n3d22u22es2x2en6P8AwOn59v0oO/s+7wer4/fWzzzjEz2dpZZLOsvWV8vfin1D3+eXrx8Ol49b/wB1+f8Ajl6fpXNeT1Zpv/T4bePafm7A9jh7v8Hz/wBTb9Du4e9/B8/9Tb9Cj8ud+k7j2+jwXWz2NulnXj/WSW3IluTX1vpP0/8AC8f3vJP9fedf+2f+39bj9X+mfeZ9ngn+pOvJpP8Aqn2z8r3et7WvJpjk2k3nfPTLxfVPa5PT9zg5+Prrtrdd9fjaS5/9Syz0l18EfU+oenx83F/MPT68e3Xk0n/Tfm4/S+Wiv0n0r+A4v7X+avW8n0r+A4v7X+avWAABWLltLAZlXODGC4sVHPfb7Hl/HeHJ4bR6rq4cnq67bTbHUHTe+euY4zpXp11k0w57ceeyxKlvlriPPy8G1/aejSeN6u18dtewPnTl5ZjW9o9E389cXu1vx6157fCgzy+tbLcPJeCzbth9Lj5ptMU34tdp0B7wGWgAEpFAAFAAAAAAARQHk+q/wHL/AGf82r1ufscGvscO3DvbNdsZs79LkHL6h/Ac39U9T+A4v9ufodebh15uHbh2tmu0xbO68fFrx8OvDrbdddfGW98IPj667bfQ7j43zfzeT7HBtrtwce2v9G6zH/Bj1/V4uDg/DzO2lzny+cvN/K/GXTi9jl4+K/8A1y9OoOPrcvDpy+9zckz6/nPjymc34fTm+l45vLPCzMvxjDnxepwcXBfX11/07nyl+c/a838qmPu5z8s4L/8AXnpj7AT6Ln8Nvf8AovJbr+bEd/qPHpyepvryb/d6dLd8eXa/ZHS+txfh762s8eO6+PTvinF6/HxevPX/AKXHJZfL5l+0Hl4/W9y8et4/dzpZPHHHr2+HP6RNvP2rdvOXfHn28r1zXT+VyS6cfscunFe/HL0evg4OP1+OcXFMaz/nftoPHx//ALPL/tT/AOKfTtp+M93T5884/JnZ6562k9rb2pb57a+Nnxj/AMRx2+mcV335dN99OXfa7eetxZnvPzA58n/7XF/tX/5O3vep+I0m2l8efj68e/5fsPW9DTg5Nubbfbl5dpi77/Yxv9Nm292/Ec08rbibdJkG/R9z8RpdOSePPx9OTT/1cfpXf2v92t8H03j4Oec85N995mXysuczHXo3r6OmnHy6acm+v323ndpcWXPwDz/S/wD+Hs/7m36E9HmnB9JvLf8Ap8sfnz0ez1vU4/W4bxaW2bW3ba97a5X6bw31Z6vntOObeWemb/yB5PQ9X6hrwTk4uXXScv7dm2ub+hr1pzep9RvHz7Tb8TM+UmJ5R9TXWa6zXXpNZiT8kcvZ9Tj9i8e21uu3FfLXbXuDs4e9/B8/9Tb9Du4e9/B8/wDU2/Qo/NcM47y6/eXGmer60xiY7fGHxnXh9nk4b066/Ot7NcdZ6x1zr6jX1Li4uX1/V25N/CSWZ/8AKfqceHn4+afs3G3zre71e1623tehwyba6Tj2t3327a6zOa139ksTj5bGfpXH6/FyXXi9mcnnOvD064+XzPqXH6/H7e+vr3OneydtdvmRvl9vi4dL6/o510vTk57/AE+T832R4nJ0fpPpX8Bxf2v81et5PpX8Bxf2v81etQAQAASpexaijPVZMrhqCMb411cpct80tnRx0lNTHSa5rW08NKzxyy9Wua/sqPFvzbSs/wBOLvrrtXbh49fH8qaY8enJOHezf57Ov387ztT2vV+82l+xNeCeOPsJVfWARQAAAABQAABKCwpFoMrEqgAAAAAAAAIACoAoABgATAqWAZKkaBmVrLOOqiK4e9/B8/8AU2/Q7G2uu2t12mddpiy/MoPyI/Sfyr0P3X+Lb9Z/KvQ/df4tv1or83LZcy4s7WO3L7nscvFrw77/AOnr18Z0zfy/a+9/KvQ/df4tv1n8q9D91/i2/Wo/Nj9J/KvQ/df4tv1n8q9D91/i2/WgfSv4Di/tf5q9bPHx6cWk4+OeOmvSSNKACAlVATCYaMCMqlWKJesY8cOmGaDnvv4vPze1rNbPl158XV8n2v2Lm9k0XX28ctl7PZw+zM/nfDt+83/Yb15eTj2k2TVfpsTbTMeXbfx2w8/r/UdfGa7Pbprpz4wqPbUVBQAABQAAABUqpQSNMqACAoAAAAgAAAAAACiAKIoBQBFjNuF1ohRayCioCiKAAKAAAIAAAACVWaCNRMKAzY1WaqOe2kvd5vZ9Oc0w9G+Z1OPeXpTB8nX6d91tbJl5vb4N5c2Yfd3sm2Xk9vWctkwzivlacWt1znq9fq+7eHbxtNvQ8J5SvHzcdlz9hzKlr9YioqgAACgJlQAAWJSLQZUQFCAAACAAAAAAAAAAAAqKAAIljPy2zYCypSFBZVsYlw38AgAKAAAKAIAAAADLSAAAJhUBjbTLn93Zcx3qYUea6b2peC7PViLgHi24rJivDzetttez7W2krjvpMdjWXqRpKjSCKoIoCLEICggKAgAAAAAKCKAgAAAAAAAAKCKAgAAACYFQGbOrUqUgNIqAKgCiKAAigAAACKgCooICAUBRQAKl1yqxEJVSNCsgKAAIKABgQFQAAAAAAUBFBAAAAAAFAAAAAAAQAArMaSwEABQKAZEoKEAURQAEUAARTAEAoJUKAAKKAgohFRoZt6mUVpAAMiKKsRQAKggEAFQAABFQBYgoqKgAACgAAAAAAAAIAAAAjLSWARSRQQoAAoIACiKAAKACBREEUwKqAALEaggYE7AWLImWpcop2RaAM1osUQADICARFgKioAAAACAKKAAACKAAAAAAAAAAAgAAioAqKCUVAFiEBagAAAKgCgAAAgqUBAAjSKBgq/CUVKutRZqgbVItidgaMiAqAoKCDNWFSA0igIAAAAAoAAAAIqAoAAAAAAAAAAAgACCoCoAAAAAAAAACoooigESqlEQhjLQEMdSL8inwi1KCNeTK4QW1J1qYWAUynemMUFABVSKozU+Wqz8oNJlfhAAFAAAAAAAAAAAAAAAAAAAAAAQAAABBUAAAAABYCC1BRUaAAAQAJEWkAhQBUKAlixnLUQLWbWrEwCRfkkamARcGFBAFBj5bZoNQqarQQAAAAAAAAAAAAAAAAAAAAAAAQAAAAABBUAAAVAVQQFEUAAAyM3rUFq46HTBOoJFXCY6gXsQvSJKoNdEhUF6YROoDXRJOphYCWhsmQaElyoCWKlBI0xO7aiAAAgKmQBTKEBRAFAAAAAAAAAAAAAAAAAEAAEUBABQAFRUAAgKKlBMmEndoBe0XCVAT5DUDbqi1lRqKioJSFJQLFz0RAMphcAM5w6TZnxLAbylZigigAAAgAgqWqLCs5awCC4QFyuWVQXJlm0gNAAAKAAAAAACgCBUBQAAAEVAAAURoEwogGTCfK0EpFx0LEGs9Ge6y9GZeoCxWb3A+U+Wr2Zio0sTIil6pg7LM0EmVmtbkXMBnCYM9U22oATsmeoKWiYyBMtIuQQVAQMJlRcdGLG52TawEjcjMalQEw1lMgki4S3CTbILhcYIUAAABQAgArIKQgCgAiNVkFAAAAABBQAACpFSIKKz2oNFEoJ2axgW9QZTYvcvVYhOwvaIDXhiIu1Y65RWqS4JCg15M2sgLFJGoDFuOhGrhAWTAmTKi4Zq5EEjSRQSsVus2KM3aue21dLGfHIia7V08nPxwXIOsuWnLWunlEVLMsyYreYlmQalmBnGFgKAAAAQFFQAAAUABKqUEikABRBFEAAABFCkKRBpKZAChKBL1atZ+SgWZRZeiKGTafMK1J06iFMJMqipU7tVOwF1JCWqAlFBAsIBhcAomDC2s5BTKZEFAUSxMNAM4ZsdMJgHPFMbOmDOEHPGGpVsys0BJmq1jCYADBgAMGAAwuFGVhYSAUVMICgAYAASqCUAFQAAAAFEFgABUAwmVyC4Zrc7M/KiQwoCLAEf/2Q==";var o=new Image;o.src=n,o.onload=function(){var e=new a.Texture(o);e.needsUpdate=!0,t(e)}})}(t).then(function(t){return y=t,e._maxAnisotropy&&(y.anisotropy=e._maxAnisotropy),Promise.resolve(y)})}(o).then(function(t){var r=void 0;if(e._useTexture)r=new f.GroundSelfShaderMaterial({map:t});else{var n=(0,d.solidColorTexture)(73,92,105);r=new f.GroundSelfShaderMaterial({map:n})}var o=new a.Mesh(T,r);return Promise.resolve(o)}).catch(function(e){console.warn("Loading logo failed.",e);var t=new a.Mesh(T);return Promise.resolve(t)});function O(e,t){var n=c.default.webMercatorToDegreeGeographic(e,t);return c.default.geographicToCartesianCoord(n[0],n[1],r)}}}},{key:"initOptionalItems",value:function(){var e=this,t=[];if(this.renderItems&&(this._items=new a.Object3D,this.sceneNode.add(this._items),this.renderItems.orbitRing))var r=new Promise(function(n,o){for(var i=new a.Object3D,s=1.1*e._scale,u=Math.PI/180,l=new a.LineBasicMaterial({linewidth:.5,color:7329264,transparent:!0,opacity:.4}),c=new a.Geometry,f=0;f<360;f++){var h=s*Math.cos(u*f),d=s*Math.sin(u*f);c.vertices.push(new a.Vector3(.985*h,0,.985*d)),c.vertices.push(new a.Vector3(h,0,d)),f%30==0?(c.vertices.push(new a.Vector3(.935*h,0,.935*d)),c.vertices.push(new a.Vector3(h,0,d)),c.vertices.push(new a.Vector3(.935*h,0,.935*d)),c.vertices.push(new a.Vector3(h,0,d))):f%5==0&&(c.vertices.push(new a.Vector3(.965*h,0,.965*d)),c.vertices.push(new a.Vector3(h,0,d)),c.vertices.push(new a.Vector3(.965*h,0,.965*d)),c.vertices.push(new a.Vector3(h,0,d)))}var p=new a.LineSegments(c,l),v=new a.LineSegments(c,l);v.rotation.z=Math.PI/2,i.add(p),i.add(v),e._items.add(i),n(),t.push(r)});return Promise.all(t)}},{key:"treeNode",get:function(){return this._treeNode}}]),t}();t.default=y},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0},i=l(r(32)),a=l(r(81)),s=l(r(3)),u=r(15);function l(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(e,r){var n=r.sceneGraphRoot,o=r.name,i=void 0===o?"QuadLodTree":o,l=r.eventHandlers,c=r.maxLevel,f=r.minLevel,h=r.debug,d=void 0!==h&&h,p=r.scale,v=r.resolution,y=r.useColor,m=r.planet,g=r.useTexture,_=r.maxAnisotropy,b=r.fullScene,w=r.countryName,A=r.TreeMaterialType,x=void 0===A?s.default:A,k=r.NodeMaterialType,T=void 0===k?u.GroundSelfShaderMaterial:k;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var O=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,{sceneGraphRoot:n,name:i,eventHandlers:l,maxLevel:c,minLevel:f,debug:d,TreeMaterialType:x,NodeMaterialType:T}));return O.sharedOptions.scale=p,O.sharedOptions.resolution=v,O.sharedOptions.useColor=y,O.sharedOptions.planet=m,O.sharedOptions.useTexture=g,O.sharedOptions.maxAnisotropy=_,O.sharedOptions.fullScene=b,O.sharedOptions.countryName=w,O.sharedOptions.earthGrid=new a.default({resolution:v,scale:p,sceneGraphRoot:O.sceneGraphRoot}),O.sceneGraphRoot.add(O.sharedOptions.earthGrid.instance),O.sharedOptions.treeMaterial=O.material,O.root=new O.Node({parent:null,name:"Earth Tile root",x:0,y:0,level:0,sharedOptions:O.sharedOptions}),O.numOfNodes++,O.style.flatShading=!0,O}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),n(t,[{key:"destruct",value:function(){var e=!0;return this.sceneGraphRoot.remove(this.sharedOptions.earthGrid),e=this.sharedOptions.earthGrid.destruct()&&e,e=o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)&&e}},{key:"preSceneUpdate",value:function(e){var r=e.camera;return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"preSceneUpdate",this).call(this,{camera:r}),this.sharedOptions.earthGrid&&this.sharedOptions.earthGrid.update({camera:r,force:!0,visualize:!1}),!0}}]),t}();t.default=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),i=function(e){return e&&e.__esModule?e:{default:e}}(r(1)),a=r(14);var s=function(){function e(t){var r=t.resolution,n=t.scale,o=t.sceneGraphRoot;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r&&n&&o?(this.name="EarthGrid",this._resolution=r,this._scale=n,this._sceneGraphRoot=o,this._needsUpdate=!1,this._gridVertices=this._constructGridVertices(),this._normals=this._constructBlockNormals(),this._centroids=this._constructBlockCentroids(),this.cameraChanged=!1,this._visibility=[],this._screenSpaceArea=new Float64Array(this.size*this.size),this.__instance=void 0,this.__vertices=void 0,this.__normals=void 0,this.debug=!1,this.__earthToScreen=void 0,this.__frustumInEarth=void 0,this.__camPositionInEarth=void 0):console.error("EarthGrid constructor",arguments)}return n(e,[{key:"destruct",value:function(){return this._gridVertices=void 0,this._normals=void 0,this._centroids=void 0,this._screenSpaceArea=void 0,this.__instance&&(this.__normals&&(this.__instance.remove(this.__normals),this.__normals.geometry.dispose(),this.__normals.material.dispose()),this.__vertices&&(this.__instance.remove(this.__vertices),this.__vertices.geometry.dispose(),this.__vertices.material.dispose())),!0}},{key:"vertex",value:function(e,t){var r=this.resolution,n=3*(e+t*(Math.pow(2,r)+1)),i=this._gridVertices;return new o.Vector3(i[n],i[n+1],i[n+2])}},{key:"block",value:function(e,t){return[this.vertex(e,t),this.vertex(e,t+1),this.vertex(e+1,t+1),this.vertex(e+1,t)]}},{key:"normal",value:function(e,t){return this._normals[e+t*this.size].clone()}},{key:"centroid",value:function(e,t){return this._centroids[e+t*this.size].clone()}},{key:"isFrontFacing",value:function(e,t,r){var n=r.cameraDirection,o=r.visualize,i=this.normal(e,t).dot(n);if(o){var a=this.size,s=this.__normals.geometry.attributes.color.array,u=3*(e+t*a)*2,l=(i+1)/2;if(Math.abs(l-.5)<.05){for(var c=0;c<6;c++)s[u+c]=0;s[u]=1,s[u+3]=1}else for(var f=0;f<6;f++)s[u+f]=l}return i<0}},{key:"isInFrustum",value:function(e,t,r){var n=r.frustumInEarth,i=r.visualize,a=this.block(e,t),s=new o.Sphere;s.center=this.centroid(e,t).clone(),s.radius=s.center.clone().distanceTo(a[0]);var u=n.intersectsSphere(s);if(i){var l=this.size,c=this.__normals.geometry.attributes.color.array,f=3*(e+t*l)*2;u&&(c[f+1]=1,c[f+4]=1)}return u}},{key:"visibility",value:function(e,t){return this._visibility[e+t*this.size]}},{key:"screenSpaceArea",value:function(e,t){return this._screenSpaceArea[e+t*this.size]}},{key:"update",value:function(e){var t=e.camera,r=e.force,n=void 0!==r&&r,o=e.visualize,i=void 0!==o&&o;return(this.needsUpdate||n)&&(this.updateVisibility({camera:t,visualize:i}),this.udpateScreenSpaceAreas({camera:t,visualize:i}),this.__camera=t),this.needsUpdate=!1,!0}},{key:"_constructGridVertices",value:function(){for(var e=this.scale,t=this.resolution,r=i.default.EQUATOR/2,n=2*r/Math.pow(2,t),o=Math.pow(2,t)+1,a=new Float32Array(o*o*3),s=0;s<o;s++)for(var u=0;u<o;u++){var l=s*n-r,c=r-u*n,f=i.default.webMercatorToDegreeGeographic(l,c);f[0]=Math.min(Math.max(-180,f[0]),180);var h=i.default.geographicToEarthSurface(t,f[0],f[1],e);(isNaN(h.x)||isNaN(h.y)||isNaN(h.z))&&console.warn(s,u,l,c,f,h);var d=3*(s+u*o);a[d]=h.x,a[d+1]=h.y,a[d+2]=h.z}return a}},{key:"_constructBlockNormals",value:function(){for(var e=this.size,t=[],r=0;r<e;r++)for(var n=0;n<e;n++){var o=this.block(n,r),i=o[2].clone().sub(o[1]).cross(o[0].clone().sub(o[1])).normalize();t.push(i)}return t}},{key:"_constructBlockCentroids",value:function(){for(var e=this.size,t=[],r=0;r<e;r++)for(var n=0;n<e;n++){var o=this.block(n,r);t.push(i(o))}return t;function i(e){var t=e[0].distanceTo(e[3]),r=e[1].distanceTo(e[2]),n=e[0].clone().lerp(e[3],.5),o=e[1].clone().lerp(e[2],.5),i=n.distanceTo(o),a=i*(Math.sqrt(2*t*t+2*r*r)-2*t)/(2*(r-t));return n.lerp(o,a/i)}}},{key:"updateVisibility",value:function(e){var t=e.camera,r=e.visualize,n=this.size,i=new o.Vector3;t.getWorldDirection(i);var a=(new o.Matrix4).getInverse(this.sceneGraphRoot.matrixWorld);i.transformDirection(a);var s=t.matrixWorldInverse.clone().multiply(this.sceneGraphRoot.matrixWorld),u=(new o.Frustum).setFromMatrix((new o.Matrix4).multiplyMatrices(t.projectionMatrix,s));this.__frustumInEarth=u;for(var l=0;l<n;l++)for(var c=0;c<n;c++)this._visibility[l+c*n]=this.isFrontFacing(l,c,{cameraDirection:i,visualize:r})&&this.isInFrustum(l,c,{frustumInEarth:u,visualize:r});r&&(this.__normals.geometry.attributes.color.needsUpdate=!0)}},{key:"udpateScreenSpaceAreas",value:function(e){var t=e.camera,r=this.size,n=(new o.Matrix4).getInverse(this.sceneGraphRoot.matrixWorld).clone().multiply(t.matrixWorld);this.__camPositionInEarth=t.position.clone().applyMatrix4(n);var i=(new o.Matrix4).multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse).multiply(this.sceneGraphRoot.matrixWorld);this.__earthToScreen=i;for(var a=0;a<r;a++)for(var s=0;s<r;s++)this._screenSpaceArea[a+s*r]=this.visibility(a,s)?this.standaloneScreenArea(this.block(a,s),i):0;return!0}},{key:"isOnPlane",value:function(e){var t={front:!1,back:!1};return e.forEach(function(e){if(e.z>=1)t.back=!0;else{if(!(e.z<1&&e.z>0))return!1;t.front=!0}}),t.front&&t.back}},{key:"_blockRetriver",value:function(e,t,r){var n=this.size;return[o(e,t),o(e,t+1),o(e+1,t+1),o(e+1,t)];function o(e,t){var o=3*(e+t*n);return[r[o],r[o+1],r[o+2]]}}},{key:"standaloneScreenArea",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.__earthToScreen;if(!t)return console.error("no earthToScreen"),0;if(this.standaloneCloseToPlane(e))return 4;var r=e.map(function(e){return e.clone().applyMatrix4(t)});if(this.isOnPlane(r))return 4;var n=(0,a.polygonIntersectArea)([{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],r);return Math.max(0,n)}},{key:"standaloneInFrustum",value:function(e){var t=new o.Sphere;return t.center=e[0].clone().add(e[1]).add(e[2]).add(e[3]).multiplyScalar(.25),t.radius=t.center.distanceTo(e[0]),this.__frustumInEarth.intersectsSphere(t)}},{key:"standaloneCloseToPlane",value:function(e){var t=e[0].clone().add(e[1]).add(e[2]).add(e[3]).multiplyScalar(.25),r=t.distanceToSquared(e[0]);return this.__camPositionInEarth.clone().distanceToSquared(t)<r}},{key:"needsUpdate",get:function(){return this._needsUpdate},set:function(e){this._needsUpdate=e}},{key:"resolution",get:function(){return this._resolution}},{key:"scale",get:function(){return this._scale}},{key:"sceneGraphRoot",get:function(){return this._sceneGraphRoot}},{key:"debug",set:function(e){this.instance.visible=!!e}},{key:"size",get:function(){return Object.defineProperty(this,"size",{value:Math.pow(2,this._resolution),writable:!1,configurable:!0}),this.size}},{key:"instance",get:function(){var e=new o.Object3D;e.name="EarthGrid";var t=new o.BufferGeometry;t.addAttribute("position",new o.BufferAttribute(this._gridVertices,3));var r=new o.PointsMaterial({color:16777215*Math.random(),size:.01}),n=new o.Points(t,r);this.__vertices=n,e.add(n);for(var i=this.size,a=new o.BufferGeometry,s=[],u=[],l=0;l<i;l++)for(var c=0;c<i;c++){var f=this.centroid(c,l),h=this.normal(c,l);s.push(f.x,f.y,f.z,f.x+.05*h.x,f.y+.05*h.y,f.z+.05*h.z),u.push(h.x,h.y,h.z,h.x,h.y,h.z)}a.addAttribute("position",new o.Float32BufferAttribute(s,3)),a.addAttribute("color",new o.Float32BufferAttribute(u,3));var d=new o.LineBasicMaterial({color:16777215,vertexColors:o.VertexColors}),p=new o.LineSegments(a,d);return this.__normals=p,e.add(p),this.__instance=e,Object.defineProperty(this,"instance",{value:e,writable:!1,configurable:!0}),this.instance}}]),e}();t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),i=c(r(34)),a=c(r(1)),s=c(r(83)),u=r(16),l=c(r(84));function c(e){return e&&e.__esModule?e:{default:e}}function f(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,i){try{var a=t[o](i),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}var h=function(e){function t(e){var r=e.parent,n=e.name,o=e.x,i=e.y,a=e.level,s=e.sharedOptions;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var u=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{parent:r,name:n,x:o,y:i,level:a,sharedOptions:s}));return u.__geometry=void 0,u._material=void 0,u._color=16777215,u.__vertices=[],u.style={map:void 0,color:16777215,level:a,x:o,y:i},u}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),n(t,[{key:"downloading",value:function(){var e=f(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.resourceKey&&this.resourceKey.length){e.next=2;break}return e.abrupt("return",Promise.reject(new Error("404")));case 2:return e.abrupt("return",this.useTexture?this._downloadTexture():Promise.resolve(this._solidColorTexture));case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"cook",value:function(){var e=f(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=new l.default({key:this.resourceKey,value:t,weight:1}),e.abrupt("return",Promise.resolve(r));case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"defaultCooked",value:function(){var e=f(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new l.default({key:this.resourceKey,value:{isPlaceHolder:!1},weight:1,is404:this.is404}),e.abrupt("return",Promise.resolve(t));case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"digest",value:function(e){return this.style.map=e.value,new o.Mesh(this.geometry,this.material)}},{key:"_updateVisibility",value:function(){var e=this;return!(this.grids.length<=0)&&this.grids.map(function(t){var r=t.col,n=t.row;return e.earthGrid.visibility(r,n)}).reduce(function(e,t){return t||e},!1)}},{key:"_updateScreenArea",value:function(){var e=this;if(this.grids.length<=0){var t=this.__standaloneVertices;if(!this.earthGrid.standaloneInFrustum(t))return 0;var r=this.earthGrid.standaloneScreenArea(t);return r>3.9&&(r=1+r/this.level),r}var n=this.grids.map(function(t){var r=t.col,n=t.row;return e.earthGrid.screenSpaceArea(r,n)}).reduce(function(e,t){return e+t},0);return n}},{key:"destruct",value:function(){var e=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this);return this.__geometry&&this.__geometry.dispose(),this._material&&this._material.dispose(),e}},{key:"dispose",value:function(){console.warn("deprecated.")}},{key:"_downloadTexture",value:function(){return function(e){return new Promise(function(t,r){var n=new o.TextureLoader;n.crossOrigin="",n.load(e,function(e){t(e)},function(e){},function(e){r(new Error("404"))})})}(this.resourceKey)}},{key:"resourceKey",get:function(){var e=this.planet,t="";return void 0===e||"earth"===e?t="China"===this.countryName?this.level<=8?s.default.getBlueMarbleCNImageUrl(this.level,this.x,this.y):s.default.getGoogleCNImageUrl(this.level,this.x,this.y):this.level<=8?s.default.getBlueMarbleImageUrl(this.level,this.x,this.y):s.default.getGoogleImageUrl(this.level,this.x,this.y):"lunar"===e?t=s.default.getNasaMoonTrekImageUrl(this.level,this.x,this.y):"mars"===e?t=s.default.getNasaMarsTrekImageUrl(this.level,this.x,this.y):"function"==typeof e&&(t=e(this.level,this.x,this.y)),Object.defineProperty(this,"resourceKey",{value:t,writable:!1,configurable:!0}),this.resourceKey}},{key:"siblingsLoaded",get:function(){for(var e=this.parent.nodes,t=!0,r=0;r<e.length&&(t="loaded"===e[r].lifeState&&!e[r].is404&&t);r++);return t}},{key:"info",get:function(){return Object.defineProperty(this,"info",{value:{level:this.level,x:this.x,y:this.y},writable:!1,configurable:!0}),this.info}},{key:"geometry",get:function(){var e=this.resolution,t=this.scale,r=void 0;if(this.level>e)r=a.default.getTileCartesianGeometryOnEarthSurface(this.level,this.x,this.y,t,1,e);else{var n=Math.pow(2,e)/Math.pow(2,this.level);isNaN(n)&&console.warn(this,e,this.level),r=a.default.getTileCartesianGeometryByGrid(this.level,this.x,this.y,t,n)}return this.__geometry=r,Object.defineProperty(this,"geometry",{value:r,writable:!1,configurable:!0}),this.geometry}},{key:"material",get:function(){return this._material||(this._material=this.sharedOptions.treeMaterial.generateTileMaterial(this)),this._material}},{key:"color",set:function(e){e.isColor?this._color=e.clone():this._color=new o.Color(e),this._material&&this._material.color&&(this._material.color=this._color,this._material.needsUpdate=!0)},get:function(){return this._color}},{key:"scale",get:function(){return this.sharedOptions.scale}},{key:"resolution",get:function(){return this.sharedOptions.resolution}},{key:"useColor",get:function(){return this.sharedOptions.useColor}},{key:"planet",get:function(){return this.sharedOptions.planet}},{key:"useTexture",get:function(){return this.sharedOptions.useTexture}},{key:"maxAnisotropy",get:function(){return this.sharedOptions.maxAnisotropy}},{key:"fullScene",get:function(){return this.sharedOptions.fullScene}},{key:"countryName",get:function(){return this.sharedOptions.countryName}},{key:"earthGrid",get:function(){return this.sharedOptions.earthGrid}},{key:"grids",get:function(){var e=[];if(this.resolution>=this.level)for(var t=Math.pow(2,this.resolution-this.level),r=0;r<t;r++)for(var n=0;n<t;n++)e.push({col:r+this.x*t,row:n+this.y*t});return Object.defineProperty(this,"grids",{value:e,writable:!1,configurable:!0}),this.grids}},{key:"__standaloneVertices",get:function(){var e=this.resolution,t=this.scale,r=[];return this.level>e?r=a.default.getTileCartesianEnvelopOnEarthSurface(this.level,this.x,this.y,t,e):console.warn("Try to build stand alone vertices",this.level,e),Object.defineProperty(this,"__standaloneVertices",{value:r,writable:!1,configurable:!0}),this.__standaloneVertices}},{key:"_solidColorTexture",get:function(){var e=(0,u.solidColorTexture)(73,92,105);return Object.defineProperty(this,"_solidColorTexture",{value:e,writable:!1,configurable:!0}),this._solidColorTexture}}]),t}();t.default=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(r(1));var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"getBlueMarbleCNImageUrl",value:function(e,t,r){return"https://cdn-china.altizure.cn/bluemarble/wtb200401/"+e+"/"+t+"/"+r+".jpg"}},{key:"getBlueMarbleImageUrl",value:function(e,t,r){return"https://cdn-inter.altizure.com/bluemarble/wtb200401/"+e+"/"+t+"/"+r+".jpg"}},{key:"getOSMImageUrl",value:function(e,t,r){return"http://"+["a","b","c"][(e+r+t)%3]+".tile.openstreetmap.org/"+e+"/"+t+"/"+r+".png"}},{key:"getBingImageUrl",value:function(e,t,r){var n,i=t,a=r,s=o.default.numerationSystemFrom10(2,i),u=o.default.numerationSystemFrom10(2,a),l=s.length-u.length;if(l>0)for(n=0;n<l;n++)u="0"+u;else if(l<0)for(l=-l,n=0;n<l;n++)s="0"+s;var c="";for(n=0;n<u.length;n++){c+=u[n]+s[n]}var f=o.default.numerationSystemChange(2,4,c);if(f.length<e)for(l=e-f.length,n=0;n<l;n++)f="0"+f;return"//ecn.t"+(e+r+t)%8+".tiles.virtualearth.net/tiles/h"+f+".jpeg?g=1239&mkt=en-us"}},{key:"getCartoImageUrl",value:function(e,t,r){return"//cartodb-basemaps-c.global.ssl.fastly.net/light_all/"+e+"/"+t+"/"+r+".png"}},{key:"getGoogleCNImageUrl",value:function(e,t,r){return"http://mt"+["0","1","2","3"][(e+r+t)%4]+".google.cn/vt/lyrs=s&x="+t+"&y="+r+"&z="+e}},{key:"getGoogleImageUrl",value:function(e,t,r){return"https://mts"+["1","2","3","0"][(e+r+t)%4]+".google.com/vt/lyrs=s&x="+t+"&y="+r+"&z="+e}},{key:"getGaodeImageUrl",value:function(e,t,r){return"https://wprd0"+["1","2","3","4"][(e+r+t)%4]+".is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=6&x="+t+"&y="+r+"&z="+e}},{key:"getTencentImageUrl",value:function(e,t,r){var n=["0","1","2","3"][(e+r+t)%4],o=t,i=Math.pow(2,e)-1-r;return"http://p"+n+".map.gtimg.com/sateTiles/"+e+"/"+Math.floor(o/16)+"/"+Math.floor(i/16)+"/"+o+"_"+i+".jpg?version=117"}},{key:"getOpenCycleImageUrl",value:function(e,t,r){return"https://"+["a","b","c"][(e+r+t)%3]+".tile.opencyclemap.org/cycle/"+e+"/"+t+"/"+r+".png"}},{key:"getGoogleMoonImageUrl",value:function(e,t,r){return"https://crossorigin.me/http://mw"+["1","2"][(e+(r=Math.pow(2,e)-1-r)+t)%2]+".google.com/mw-planetary/lunar/lunarmaps_v1/clem_bw/"+e+"/"+t+"/"+r+".jpg"}},{key:"getGoogleMoonApolloImageUrl",value:function(e,t,r){return"https://mw"+["1","2"][(e+(r=Math.pow(2,e)-1-r)+t)%2]+".google.com/mw-planetary/lunar/lunarmaps_v1/apollo/"+e+"/"+t+"/"+r+".jpg"}},{key:"getHiriseMarsVisibleImageUrl",value:function(e,t,r){return"https://crossorigin.me/http://gmaps-bkup.uahirise.org/mars/visible/"+e+"/"+t+"/"+(r=Math.pow(2,e)-1-r)+".jpg"}},{key:"getNasaMarsTrekImageUrl",value:function(e,t,r){return"https://trektiles.jpl.nasa.gov/trektiles/Mars/EQ/Mars_Viking_MDIM21_ClrMosaic_global_232m/1.0.0//default/default028mm/"+e+"/"+r+"/"+t+".png"}},{key:"getNasaMoonTrekImageUrl",value:function(e,t,r){return"https://moontrek.jpl.nasa.gov/trektiles/Moon/EQ/LRO_WAC_Mosaic_Global_303ppd_v02/1.0.0//default/default028mm/"+e+"/"+r+"/"+t+".jpg?api_key=29i0fx486NeK5hQx7Z3AIiNBwEcJV2fJypTet3WW"}},{key:"getEsriLunarImageUrl",value:function(e,t,r){return"https://crossorigin.me/https://webgis2.wr.usgs.gov/Lunar_Global_GIS/ESRI.ArcGIS.ADF.Web.DataSources.ArcGISServer.TileHandler.ashx?tile=c2d7c76d558f4dfb8ffde861c9229b2e&level="+e+"&column="+t+"&row="+r}}]),e}();t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(r(17));var i=function(e){function t(e){var r=e.key,n=e.value,o=e.weight,i=void 0===o?100:o,a=e.is404,s=void 0!==a&&a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var u=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{key:r,value:n,weight:i}));return u._is404=s,u}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),n(t,[{key:"destruct",value:function(){return this._value.dispose(),function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"valid",get:function(){return this._value&&this._value.image||this.is404}},{key:"is404",get:function(){return this._is404}}]),t}();t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(r(5)),i=r(15),a=r(0);var s=function(e){function t(e){var r=e.earthEntity,n=e.scale;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r)),s=new a.SphereBufferGeometry(1.00505*n,512,512);return o.material=new i.AtmosphereSelfShaderMaterial,o.mesh=new a.Mesh(s,o.material),o.mesh.name="Atmosphere mesh",o.sceneNode.name="Atmosphere Class",o.sceneNode.add(o.mesh),o.height=0,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),n(t,[{key:"destruct",value:function(){return this.sceneNode.remove(this.mesh),this.mesh.geometry.dispose(),this.mesh.material.map&&this.mesh.material.map.dispose(),this.mesh.material.dispose(),this.mesh=null,function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}}]),t}();t.default=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=d(r(10)),a=d(r(11)),s=d(r(19)),u=d(r(88)),l=d(r(92)),c=d(r(39)),f=d(r(94)),h=d(r(98));function d(e){return e&&e.__esModule?e:{default:e}}var p=function(e){function t(e,r){var n=r.isMobile,o=r.scale,i=r.resolution,s=r.countryName,u=r.altizureApi,c=r.allowWorker,f=void 0===c||c,h=r.onTileDownloaded;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var d=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));d.name="ProjectLayer";var p=localStorage.getItem("FOREST_CAPACITY"),v=void 0===p||null===p?n?140:250:parseInt(p,10),y=localStorage.getItem("CACHE_CAPACITY"),m=void 0===y||null===p?n?160:285:parseInt(y,10);console.log("forest/cache",v,m);var g={FOREST_CAPACITY:v,MAX_DOWNLOAD_CONCURRENCY:n?3:8,MIN_AREA:n?.1:.01,MAX_LEVEL:n?10:14,allowWorker:!1,trees:[],CACHE_CAPACITY:m,name:"ProjectLayer Forest",debug:!1};return d.forest=new a.default(g),d.eventQueue=new l.default,d._scale=o,d._resolution=i,d._countryName=s,d._altizureApi=u,d._allowWorker=f,d.onTileDownloaded=h,d}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),o(t,[{key:"destruct",value:function(){var e=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this);return e=this.forest.destruct()&&e,this._altizureBundleLoader&&(this._altizureBundleLoader.terminate(),this._altizureBundleLoader=null),this._osgBundleLoader&&(this._osgBundleLoader.terminate(),this._osgBundleLoader=null),e}},{key:"addEntity",value:function(e){return new s.default(this,n({forest:this.forest,earthScale:this.scale,earthResolution:this.resolution},e)).import()}},{key:"addAltizure",value:function(e){var t=e.pid,r=e.projInfo,n=e.position;return new u.default(this,{forest:this.forest,earthScale:this.scale,earthResolution:this.resolution,pid:t,position:n,altizureApi:this._altizureApi,eventQueue:this.eventQueue,countryName:this._countryName,loadWorker:this.altizureBundleLoader,onTileDownloaded:this.onTileDownloaded}).import(r)}},{key:"addOSG",value:function(e){var t=e.osgInfo,r=e.position;return new f.default(this,{forest:this.forest,earthScale:this.scale,earthResolution:this.resolution,osgInfo:t,position:r,loadWorker:this.osgBundleLoader,onTileDownloaded:this.onTileDownloaded}).import()}},{key:"remove",value:function(){}},{key:"sceneUpdated",value:function(e){var t=e.camera;this.applyToChildren(function(e,t){e.sceneUpdated(t)},{camera:t}),this.forest.sceneUpdated({camera:t})}},{key:"scale",get:function(){return this._scale}},{key:"resolution",get:function(){return this._resolution}},{key:"countryname",get:function(){return this._countryName}},{key:"altizureBundleLoader",get:function(){var e=new c.default;return this._altizureBundleLoader=e,Object.defineProperty(this,"altizureBundleLoader",{value:e,writable:!1,configurable:!0}),this.altizureBundleLoader}},{key:"osgBundleLoader",get:function(){var e=this._allowWorker?new h.default:null;return this._osgBundleLoader=e,Object.defineProperty(this,"osgBundleLoader",{value:e,writable:!1,configurable:!0}),this.osgBundleLoader}}]),t}();t.default=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(r(12));var i=function(e){function t(e,r){var n=r.name,o=void 0===n?"LodTreeEntity":n,i=r.forest;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,{name:o}));return a.name="LodTreeEntity",a._tree=null,a._forest=i,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),n(t,[{key:"destruct",value:function(){var e=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this);return this.treeNode&&(this.treeNode.parent&&this.treeNode.parent.remove(this.treeNode),this._treeNode=void 0),this.tree&&(e=this.tree.destruct()&&e,this._tree=void 0),this._forest=void 0,e}},{key:"import",value:function(){return Promise.reject(new Error("Not implemented"))}},{key:"treeNode",get:function(){return this._treeNode}},{key:"tree",get:function(){return this._tree}},{key:"material",get:function(){if(this._tree)return this._tree.material;console.warn("Tree is not created, material not ready.")},set:function(e){this._tree?this._tree.material=e:console.warn("Tree is not ready.")}}]),t}();t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0},i=l(r(19)),a=l(r(36)),s=l(r(37)),u=l(r(38));function l(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(e,r){var n=r.name,o=r.forest,i=r.earthScale,a=r.earthResolution,s=r.altizureApi,u=r.eventQueue,l=r.countryName,c=r.loadWorker,f=r.onTileDownloaded,h=r.pid,d=r.position,p=void 0===d?{lng:114,lat:22.25,alt:0}:d;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var v=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,{name:n,forest:o,earthScale:i,earthResolution:a,position:p}));return v._altizureApi=s,v._eventQueue=u,v._countryName=l,v._loadWorker=c,v.onTileDownloaded=f,v._pid=h,v._projInfo={},v}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),n(t,[{key:"destruct",value:function(){var e=!0;return this._tree&&(this._forest.remove(this._tree),e=this.tree.destruct()&&e,this._tree=void 0),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)&&e}},{key:"import",value:function(){var e=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,i){try{var a=t[o](i),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}(regeneratorRuntime.mark(function e(t){var r,n,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this,n=t){e.next=7;break}return e.next=5,this.altizureApi.project({pid:this.pid});case 5:o=e.sent,n=new a.default(o);case 7:return r._projInfo=n,r.name=r._projInfo.name,e.abrupt("return",r._createTree(r._projInfo));case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"_createTree",value:function(e){var t=this;if(!e||!e.valid)return Promise.reject(new Error("Invalid projInfo."));var r=this,n=this._treeNode,o=e.name,i=this.altizureApi,a=this._eventQueue,l=this._countryName;return new Promise(function(c,f){r._tree=new s.default(u.default,{sceneGraphRoot:n,name:o,eventHandlers:{onTileDownloaded:r.onTileDownloaded,onContentInitialized:function(){console.log(o+"initialized.",r),c(r)}},debug:!1,altizureApi:i,projInfo:e,eventQueue:a,countryName:l,loadWorker:r._loadWorker}),r._tree.visible=r.visible,t._forest.add(r._tree)})}},{key:"altizureApi",get:function(){return this._altizureApi}},{key:"pid",get:function(){return this._pid}},{key:"projInfo",get:function(){return this._projInfo}},{key:"visible",set:function(e){!function e(t,r,n,o){var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);null!==a&&e(a,r,n,o)}else if("value"in i&&i.writable)i.value=n;else{var s=i.set;void 0!==s&&s.call(o,n)}return n}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visible",e,this),this._tree&&(this._tree.visible=e)},get:function(){return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visible",this)}}]),t}();t.default=c},function(e,t,r){e.exports=function(e){return e.enc.Hex}(r(2))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(r(17)),i=r(21);var a=function(e){function t(e){var r=e.key,n=e.value,o=e.weight,i=void 0===o?100:o,a=e.is404,s=void 0!==a&&a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var u=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{key:r,value:n,weight:i}));return u._is404=s,u}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),n(t,[{key:"destruct",value:function(){return!!this.is404||(this._value.geometry.dispose(),this._value.material&&((0,i.disposeMap)(this._value.material),this._value.material=null),function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this))}},{key:"valid",get:function(){return this.is404||this._value&&this._value.geometry}},{key:"is404",get:function(){return this._is404}}]),t}();t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ATTRIBUTE_SIZE={position:3,uv:2,color:3,normal:3}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function(){var e=this,t=null,r=[];this.add=function(n,o,i,a,s,u){if(n)return r.push([n,o,i,a,s,u]),void(1===r.length&&function n(o){t=setTimeout(function(){o=e.add(),r.length&&n(o)},o||0)}(u));var l=r.shift();return l?(l[0].call(l[1],l[2],l[3],l[4]),l[5]):0},this.clear=function(){clearTimeout(t),r=[]}}},function(e,t,r){e.exports=function(){return r(40)('!function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=1)}([function(t,e){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";var n=r(2),i=function(t){return t&&t.__esModule?t:{default:t}}(r(11));r(14),onmessage=function(t){var e=t.data.resourceKey,r=t.data.timeout;(0,n.downloadEntries)({url:e,timeout:r}).then(function(t){var r=new i.default({resourceKey:e,utf8:t}),n=r.rdutf8;postMessage({resourceKey:e,status:200,payload:n}),r.destruct()}).catch(function(t){if("downloadEntries"===t.message)postMessage({resourceKey:e,status:-1,payload:t});else{var r=parseInt(t.message,10);postMessage({resourceKey:e,status:r,payload:{message:t.message}})}})},onerror=function(t){throw console.error("AltizureBinaryLoader.worker.js",t),t}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.downloadEntries=e.readBundle=e.readImageData=e.readPNG=e.downloadPNG=void 0;var n=o(r(3)),i=o(r(10));function o(t){return t&&t.__esModule?t:{default:t}}function a(t){var e=t.url,r=t.timeout,n=new XMLHttpRequest;return n.open("GET",e,!0),n.timeout=r,n.responseType="arraybuffer",new Promise(function(t,e){n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status){var r=n.response;t(r)}else e(new Error(n.status.toString()))},n.send()})}function s(t){return new Promise(function(e,r){new n.default(t).parse(function(t,n){t?(console.error(t),r(new Error("readPNG"))):e(n)})})}function u(t){var e=t.pixels,r=t.imgWidth,n=t.imgHeight;try{var o=new i.default;return o.parseBundle(e,r,n,{}),Promise.resolve(o)}catch(t){return console.error(t),Promise.reject(new Error("readImageData"))}}function f(t){return new Promise(function(e,r){try{var n={};t.entries.map(function(e){var r=void 0,i=e.path;i.endsWith(".osgjs")?r=t.readJSON(i):i.endsWith(".jpg")?r=t.readImg(i):i.endsWith(".aa")?r=decodeURIComponent(escape(t.readText(i))):i.endsWith(".txt")?r=t.readJSON(i):i.endsWith(".info")?r=t.readJSON(i):console.warn("unknown entry",e.path),n[i]=r}),t.clearData(),e(n)}catch(e){t.clearData(),console.error(e),r(new Error("readBundle"))}})}e.downloadPNG=a,e.readPNG=s,e.readImageData=u,e.readBundle=f,e.downloadEntries=function(t){var e=t.url,r=t.trials,n=void 0===r?3:r,i=t.timeout;return function t(e){var r=e.trials,n=e.url,i=e.timeout;return r<=0?Promise.reject(new Error("0")):a({url:n,timeout:i}).catch(function(e){return i*=2,--r<=0?Promise.reject(e):"404"===e.message||"403"===e.message?Promise.reject(e):t({trials:r,url:n,timeout:i})})}({trials:n,url:e,timeout:void 0===i?3e4:i}).then(function(t){return s(t)}).then(function(t){return u({pixels:t.pixels,imgWidth:t.getWidth(),imgHeight:t.getHeight()})}).then(function(t){return f(t)}).catch(function(t){return"readPNG"===t.message||"readImageData"===t.message||"readBundle"===t.message?Promise.reject(new Error("downloadEntries")):Promise.reject(t)})}},function(t,e,r){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=r(8),o=function(t){return t&&t.__esModule?t:{default:t}}(r(9));var a=Array.prototype.slice,s=Object.prototype.toString;function u(t,e){return(t[e]<<24)+(t[e+1]<<16)+(t[e+2]<<8)+(t[e+3]<<0)}function f(t,e){return t[e]<<0}function h(t){if("string"==typeof t){var e=t;t=new Array(e.length);for(var r=0,n=e.length;r<n;r++)t[r]=e[r].charCodeAt(0)}else{"ArrayBuffer"===s.call(t).slice(8,-1)&&(t=new Uint8Array(t))}this.i=0,this.bytes=t,this.png=new o.default,this.dataChunks=[]}h.prototype.readBytes=function(t){var e=this.i+t;if(e>this.bytes.length)throw new Error("Unexpectedly reached end of file");var r=a.call(this.bytes,this.i,e);return this.i=e,r},h.prototype.decodeHeader=function(){if(0!==this.i)throw new Error("file pointer should be at 0 to read the header");var t=this.readBytes(8);if(!function(t,e){if(t.length!==e.length)return!1;for(var r=t.length;r--;)if(t[r]!==e[r])return!1;return!0}(t,[137,80,78,71,13,10,26,10]))throw new Error("invalid PNGReader file (bad signature)");this.header=t},h.prototype.decodeChunk=function(){var t=u(this.readBytes(4),0);if(t<0)throw new Error("Bad chunk length "+(4294967295&t));var e=function(t){for(var e="",r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e}(this.readBytes(4)),r=this.readBytes(t);this.readBytes(4);switch(e){case"IHDR":this.decodeIHDR(r);break;case"PLTE":this.decodePLTE(r);break;case"IDAT":this.decodeIDAT(r);break;case"IEND":this.decodeIEND(r)}return e},h.prototype.decodeIHDR=function(t){var e=this.png;e.setWidth(u(t,0)),e.setHeight(u(t,4)),e.setBitDepth(f(t,8)),e.setColorType(f(t,9)),e.setCompressionMethod(f(t,10)),e.setFilterMethod(f(t,11)),e.setInterlaceMethod(f(t,12))},h.prototype.decodePLTE=function(t){this.png.setPalette(t)},h.prototype.decodeIDAT=function(t){this.dataChunks.push(t)},h.prototype.decodeIEND=function(){},h.prototype.decodePixels=function(e){var r,n,o,a,s=this.png,u=this,f=0;for(a=this.dataChunks.length;a--;)f+=this.dataChunks[a].length;var h=new t(f);for(r=0,o=0,a=this.dataChunks.length;r<a;r++){var c=this.dataChunks[r];for(n=0;n<c.length;n++)h[o++]=c[n]}!function(t,e){try{e(null,(0,i.inflate)(t))}catch(t){e(t)}}(h,function(t,r){if(t)return e(t);try{0===s.getInterlaceMethod()?u.interlaceNone(r):u.interlaceAdam7(r)}catch(t){return e(t)}e()})},h.prototype.interlaceNone=function(e){for(var r,n=this.png,i=Math.max(1,n.colors*n.bitDepth/8),o=i*n.width,s=new t(i*n.width*n.height),u=0,h=0;h<e.length;h+=o+1){switch(r=a.call(e,h+1,h+o+1),f(e,h)){case 0:this.unFilterNone(r,s,i,u,o);break;case 1:this.unFilterSub(r,s,i,u,o);break;case 2:this.unFilterUp(r,s,i,u,o);break;case 3:this.unFilterAverage(r,s,i,u,o);break;case 4:this.unFilterPaeth(r,s,i,u,o);break;default:throw new Error("unkown filtered scanline")}u+=o}n.pixels=s},h.prototype.interlaceAdam7=function(t){throw new Error("Adam7 interlacing is not implemented yet")},h.prototype.unFilterNone=function(t,e,r,n,i){for(var o=0,a=i;o<a;o++)e[n+o]=t[o]},h.prototype.unFilterSub=function(t,e,r,n,i){for(var o=0;o<r;o++)e[n+o]=t[o];for(;o<i;o++)e[n+o]=t[o]+e[n+o-r]&255},h.prototype.unFilterUp=function(t,e,r,n,i){var o=0;if(n-i<0)for(;o<i;o++)e[n+o]=t[o];else for(;o<i;o++){var a=t[o],s=e[n+o-i];e[n+o]=a+s&255}},h.prototype.unFilterAverage=function(t,e,r,n,i){var o=0;if(n-i<0){for(;o<r;o++)e[n+o]=t[o];for(;o<i;o++)e[n+o]=t[o]+(e[n+o-r]>>1)&255}else{for(;o<r;o++)e[n+o]=t[o]+(e[n-i+o]>>1)&255;for(;o<i;o++){var a=t[o],s=e[n+o-r],u=e[n+o-i];e[n+o]=a+(s+u>>1)&255}}},h.prototype.unFilterPaeth=function(t,e,r,n,i){var o=0;if(n-i<0){for(;o<r;o++)e[n+o]=t[o];for(;o<i;o++)e[n+o]=t[o]+e[n+o-r]&255}else{for(;o<r;o++)e[n+o]=t[o]+e[n+o-i]&255;for(;o<i;o++){var a=t[o],s=e[n+o-r],u=e[n+o-i],f=e[n+o-i-r],h=s+u-f,c=Math.abs(h-s),l=Math.abs(h-u),d=Math.abs(h-f),p=void 0;p=c<=l&&c<=d?s:l<=d?u:f,e[n+o]=a+p&255}}},h.prototype.parse=function(t,e){"function"==typeof t&&(e=t),"object"!==(void 0===t?"undefined":n(t))&&(t={});try{for(this.decodeHeader();this.i<this.bytes.length;){var r=this.decodeChunk();if("IHDR"===r&&!1===t.data||"IEND"===r)break}var i=this.png;this.decodePixels(function(t){e(t,i)})}catch(t){e(t)}},e.default=h}).call(this,r(4).Buffer)},function(t,e,r){"use strict";(function(t){\n/*!\n * The buffer module from node.js, for the browser.\n *\n * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>\n * @license  MIT\n */\nvar n=r(5),i=r(6),o=r(7);function a(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(t,e){if(a()<e)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=u.prototype:(null===t&&(t=new u(e)),t.length=e),t}function u(t,e,r){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(t,e,r);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return c(this,t)}return f(this,t,e,r)}function f(t,e,r,n){if("number"==typeof e)throw new TypeError(\'"value" argument must not be a number\');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,r,n){if(e.byteLength,r<0||e.byteLength<r)throw new RangeError("\'offset\' is out of bounds");if(e.byteLength<r+(n||0))throw new RangeError("\'length\' is out of bounds");e=void 0===r&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,r):new Uint8Array(e,r,n);u.TYPED_ARRAY_SUPPORT?(t=e).__proto__=u.prototype:t=l(t,e);return t}(t,e,r,n):"string"==typeof e?function(t,e,r){"string"==typeof r&&""!==r||(r="utf8");if(!u.isEncoding(r))throw new TypeError(\'"encoding" must be a valid string encoding\');var n=0|p(e,r),i=(t=s(t,n)).write(e,r);i!==n&&(t=t.slice(0,i));return t}(t,e,r):function(t,e){if(u.isBuffer(e)){var r=0|d(e.length);return 0===(t=s(t,r)).length?t:(e.copy(t,0,0,r),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||function(t){return t!=t}(e.length)?s(t,0):l(t,e);if("Buffer"===e.type&&o(e.data))return l(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function h(t){if("number"!=typeof t)throw new TypeError(\'"size" argument must be a number\');if(t<0)throw new RangeError(\'"size" argument must not be negative\')}function c(t,e){if(h(e),t=s(t,e<0?0:0|d(e)),!u.TYPED_ARRAY_SUPPORT)for(var r=0;r<e;++r)t[r]=0;return t}function l(t,e){var r=e.length<0?0:0|d(e.length);t=s(t,r);for(var n=0;n<r;n+=1)t[n]=255&e[n];return t}function d(t){if(t>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|t}function p(t,e){if(u.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var r=t.length;if(0===r)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return F(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return Y(t).length;default:if(n)return F(t).length;e=(""+e).toLowerCase(),n=!0}}function g(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function y(t,e,r,n,i){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return-1;r=t.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof e&&(e=u.from(e,n)),u.isBuffer(e))return 0===e.length?-1:v(t,e,r,n,i);if("number"==typeof e)return e&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):v(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function v(t,e,r,n,i){var o,a=1,s=t.length,u=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;a=2,s/=2,u/=2,r/=2}function f(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}if(i){var h=-1;for(o=r;o<s;o++)if(f(t,o)===f(e,-1===h?0:o-h)){if(-1===h&&(h=o),o-h+1===u)return h*a}else-1!==h&&(o-=o-h),h=-1}else for(r+u>s&&(r=s-u),o=r;o>=0;o--){for(var c=!0,l=0;l<u;l++)if(f(t,o+l)!==f(e,l)){c=!1;break}if(c)return o}return-1}function m(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var a=0;a<n;++a){var s=parseInt(e.substr(2*a,2),16);if(isNaN(s))return a;t[r+a]=s}return a}function w(t,e,r,n){return Z(F(e,t.length-r),t,r,n)}function b(t,e,r,n){return Z(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,n)}function _(t,e,r,n){return b(t,e,r,n)}function k(t,e,r,n){return Z(Y(e),t,r,n)}function E(t,e,r,n){return Z(function(t,e){for(var r,n,i,o=[],a=0;a<t.length&&!((e-=2)<0);++a)r=t.charCodeAt(a),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(e,t.length-r),t,r,n)}function A(t,e,r){return 0===e&&r===t.length?n.fromByteArray(t):n.fromByteArray(t.slice(e,r))}function S(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var o,a,s,u,f=t[i],h=null,c=f>239?4:f>223?3:f>191?2:1;if(i+c<=r)switch(c){case 1:f<128&&(h=f);break;case 2:128==(192&(o=t[i+1]))&&(u=(31&f)<<6|63&o)>127&&(h=u);break;case 3:o=t[i+1],a=t[i+2],128==(192&o)&&128==(192&a)&&(u=(15&f)<<12|(63&o)<<6|63&a)>2047&&(u<55296||u>57343)&&(h=u);break;case 4:o=t[i+1],a=t[i+2],s=t[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(u=(15&f)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&u<1114112&&(h=u)}null===h?(h=65533,c=1):h>65535&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|1023&h),n.push(h),i+=c}return function(t){var e=t.length;if(e<=T)return String.fromCharCode.apply(String,t);var r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=T));return r}(n)}e.Buffer=u,e.SlowBuffer=function(t){+t!=t&&(t=0);return u.alloc(+t)},e.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=a(),u.poolSize=8192,u._augment=function(t){return t.__proto__=u.prototype,t},u.from=function(t,e,r){return f(null,t,e,r)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(t,e,r){return function(t,e,r,n){return h(e),e<=0?s(t,e):void 0!==r?"string"==typeof n?s(t,e).fill(r,n):s(t,e).fill(r):s(t,e)}(null,t,e,r)},u.allocUnsafe=function(t){return c(null,t)},u.allocUnsafeSlow=function(t){return c(null,t)},u.isBuffer=function(t){return!(null==t||!t._isBuffer)},u.compare=function(t,e){if(!u.isBuffer(t)||!u.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,n=e.length,i=0,o=Math.min(r,n);i<o;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},u.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(t,e){if(!o(t))throw new TypeError(\'"list" argument must be an Array of Buffers\');if(0===t.length)return u.alloc(0);var r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var n=u.allocUnsafe(e),i=0;for(r=0;r<t.length;++r){var a=t[r];if(!u.isBuffer(a))throw new TypeError(\'"list" argument must be an Array of Buffers\');a.copy(n,i),i+=a.length}return n},u.byteLength=p,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)g(this,e,e+1);return this},u.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)g(this,e,e+3),g(this,e+1,e+2);return this},u.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)g(this,e,e+7),g(this,e+1,e+6),g(this,e+2,e+5),g(this,e+3,e+4);return this},u.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?S(this,0,t):function(t,e,r){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return B(this,e,r);case"utf8":case"utf-8":return S(this,e,r);case"ascii":return x(this,e,r);case"latin1":case"binary":return P(this,e,r);case"base64":return A(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}.apply(this,arguments)},u.prototype.equals=function(t){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===u.compare(this,t)},u.prototype.inspect=function(){var t="",r=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(t+=" ... ")),"<Buffer "+t+">"},u.prototype.compare=function(t,e,r,n,i){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),e<0||r>t.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&e>=r)return 0;if(n>=i)return-1;if(e>=r)return 1;if(e>>>=0,r>>>=0,n>>>=0,i>>>=0,this===t)return 0;for(var o=i-n,a=r-e,s=Math.min(o,a),f=this.slice(n,i),h=t.slice(e,r),c=0;c<s;++c)if(f[c]!==h[c]){o=f[c],a=h[c];break}return o<a?-1:a<o?1:0},u.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},u.prototype.indexOf=function(t,e,r){return y(this,t,e,r,!0)},u.prototype.lastIndexOf=function(t,e,r){return y(this,t,e,r,!1)},u.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-e;if((void 0===r||r>i)&&(r=i),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return m(this,t,e,r);case"utf8":case"utf-8":return w(this,t,e,r);case"ascii":return b(this,t,e,r);case"latin1":case"binary":return _(this,t,e,r);case"base64":return k(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,t,e,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var T=4096;function x(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}function P(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function B(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=e;o<r;++o)i+=j(t[o]);return i}function R(t,e,r){for(var n=t.slice(e,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function U(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function O(t,e,r,n,i,o){if(!u.isBuffer(t))throw new TypeError(\'"buffer" argument must be a Buffer instance\');if(e>i||e<o)throw new RangeError(\'"value" argument is out of bounds\');if(r+n>t.length)throw new RangeError("Index out of range")}function C(t,e,r,n){e<0&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-r,2);i<o;++i)t[r+i]=(e&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function I(t,e,r,n){e<0&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-r,4);i<o;++i)t[r+i]=e>>>8*(n?i:3-i)&255}function M(t,e,r,n,i,o){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function D(t,e,r,n,o){return o||M(t,0,r,4),i.write(t,e,r,n,23,4),r+4}function N(t,e,r,n,o){return o||M(t,0,r,8),i.write(t,e,r,n,52,8),r+8}u.prototype.slice=function(t,e){var r,n=this.length;if(t=~~t,e=void 0===e?n:~~e,t<0?(t+=n)<0&&(t=0):t>n&&(t=n),e<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t),u.TYPED_ARRAY_SUPPORT)(r=this.subarray(t,e)).__proto__=u.prototype;else{var i=e-t;r=new u(i,void 0);for(var o=0;o<i;++o)r[o]=this[o+t]}return r},u.prototype.readUIntLE=function(t,e,r){t|=0,e|=0,r||U(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n},u.prototype.readUIntBE=function(t,e,r){t|=0,e|=0,r||U(t,e,this.length);for(var n=this[t+--e],i=1;e>0&&(i*=256);)n+=this[t+--e]*i;return n},u.prototype.readUInt8=function(t,e){return e||U(t,1,this.length),this[t]},u.prototype.readUInt16LE=function(t,e){return e||U(t,2,this.length),this[t]|this[t+1]<<8},u.prototype.readUInt16BE=function(t,e){return e||U(t,2,this.length),this[t]<<8|this[t+1]},u.prototype.readUInt32LE=function(t,e){return e||U(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},u.prototype.readUInt32BE=function(t,e){return e||U(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},u.prototype.readIntLE=function(t,e,r){t|=0,e|=0,r||U(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*e)),n},u.prototype.readIntBE=function(t,e,r){t|=0,e|=0,r||U(t,e,this.length);for(var n=e,i=1,o=this[t+--n];n>0&&(i*=256);)o+=this[t+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*e)),o},u.prototype.readInt8=function(t,e){return e||U(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},u.prototype.readInt16LE=function(t,e){e||U(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt16BE=function(t,e){e||U(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt32LE=function(t,e){return e||U(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},u.prototype.readInt32BE=function(t,e){return e||U(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},u.prototype.readFloatLE=function(t,e){return e||U(t,4,this.length),i.read(this,t,!0,23,4)},u.prototype.readFloatBE=function(t,e){return e||U(t,4,this.length),i.read(this,t,!1,23,4)},u.prototype.readDoubleLE=function(t,e){return e||U(t,8,this.length),i.read(this,t,!0,52,8)},u.prototype.readDoubleBE=function(t,e){return e||U(t,8,this.length),i.read(this,t,!1,52,8)},u.prototype.writeUIntLE=function(t,e,r,n){(t=+t,e|=0,r|=0,n)||O(this,t,e,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[e]=255&t;++o<r&&(i*=256);)this[e+o]=t/i&255;return e+r},u.prototype.writeUIntBE=function(t,e,r,n){(t=+t,e|=0,r|=0,n)||O(this,t,e,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+r},u.prototype.writeUInt8=function(t,e,r){return t=+t,e|=0,r||O(this,t,e,1,255,0),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},u.prototype.writeUInt16LE=function(t,e,r){return t=+t,e|=0,r||O(this,t,e,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):C(this,t,e,!0),e+2},u.prototype.writeUInt16BE=function(t,e,r){return t=+t,e|=0,r||O(this,t,e,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):C(this,t,e,!1),e+2},u.prototype.writeUInt32LE=function(t,e,r){return t=+t,e|=0,r||O(this,t,e,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):I(this,t,e,!0),e+4},u.prototype.writeUInt32BE=function(t,e,r){return t=+t,e|=0,r||O(this,t,e,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):I(this,t,e,!1),e+4},u.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);O(this,t,e,r,i-1,-i)}var o=0,a=1,s=0;for(this[e]=255&t;++o<r&&(a*=256);)t<0&&0===s&&0!==this[e+o-1]&&(s=1),this[e+o]=(t/a>>0)-s&255;return e+r},u.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);O(this,t,e,r,i-1,-i)}var o=r-1,a=1,s=0;for(this[e+o]=255&t;--o>=0&&(a*=256);)t<0&&0===s&&0!==this[e+o+1]&&(s=1),this[e+o]=(t/a>>0)-s&255;return e+r},u.prototype.writeInt8=function(t,e,r){return t=+t,e|=0,r||O(this,t,e,1,127,-128),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},u.prototype.writeInt16LE=function(t,e,r){return t=+t,e|=0,r||O(this,t,e,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):C(this,t,e,!0),e+2},u.prototype.writeInt16BE=function(t,e,r){return t=+t,e|=0,r||O(this,t,e,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):C(this,t,e,!1),e+2},u.prototype.writeInt32LE=function(t,e,r){return t=+t,e|=0,r||O(this,t,e,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):I(this,t,e,!0),e+4},u.prototype.writeInt32BE=function(t,e,r){return t=+t,e|=0,r||O(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):I(this,t,e,!1),e+4},u.prototype.writeFloatLE=function(t,e,r){return D(this,t,e,!0,r)},u.prototype.writeFloatBE=function(t,e,r){return D(this,t,e,!1,r)},u.prototype.writeDoubleLE=function(t,e,r){return N(this,t,e,!0,r)},u.prototype.writeDoubleBE=function(t,e,r){return N(this,t,e,!1,r)},u.prototype.copy=function(t,e,r,n){if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var i,o=n-r;if(this===t&&r<e&&e<n)for(i=o-1;i>=0;--i)t[i+e]=this[i+r];else if(o<1e3||!u.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+e]=this[i+r];else Uint8Array.prototype.set.call(t,this.subarray(r,r+o),e);return o},u.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!u.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;var o;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(o=e;o<r;++o)this[o]=t;else{var a=u.isBuffer(t)?t:F(new u(t,n).toString()),s=a.length;for(o=0;o<r-e;++o)this[o+e]=a[o%s]}return this};var L=/[^+\\/0-9A-Za-z-_]/g;function j(t){return t<16?"0"+t.toString(16):t.toString(16)}function F(t,e){var r;e=e||1/0;for(var n=t.length,i=null,o=[],a=0;a<n;++a){if((r=t.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(a+1===n){(e-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;o.push(r)}else if(r<2048){if((e-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function Y(t){return n.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\\s+|\\s+$/g,"")}(t).replace(L,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function Z(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}}).call(this,r(0))},function(t,e,r){"use strict";e.byteLength=function(t){var e=f(t),r=e[0],n=e[1];return 3*(r+n)/4-n},e.toByteArray=function(t){for(var e,r=f(t),n=r[0],a=r[1],s=new o(function(t,e,r){return 3*(e+r)/4-r}(0,n,a)),u=0,h=a>0?n-4:n,c=0;c<h;c+=4)e=i[t.charCodeAt(c)]<<18|i[t.charCodeAt(c+1)]<<12|i[t.charCodeAt(c+2)]<<6|i[t.charCodeAt(c+3)],s[u++]=e>>16&255,s[u++]=e>>8&255,s[u++]=255&e;2===a&&(e=i[t.charCodeAt(c)]<<2|i[t.charCodeAt(c+1)]>>4,s[u++]=255&e);1===a&&(e=i[t.charCodeAt(c)]<<10|i[t.charCodeAt(c+1)]<<4|i[t.charCodeAt(c+2)]>>2,s[u++]=e>>8&255,s[u++]=255&e);return s},e.fromByteArray=function(t){for(var e,r=t.length,i=r%3,o=[],a=0,s=r-i;a<s;a+=16383)o.push(c(t,a,a+16383>s?s:a+16383));1===i?(e=t[r-1],o.push(n[e>>2]+n[e<<4&63]+"==")):2===i&&(e=(t[r-2]<<8)+t[r-1],o.push(n[e>>10]+n[e>>4&63]+n[e<<2&63]+"="));return o.join("")};for(var n=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,u=a.length;s<u;++s)n[s]=a[s],i[a.charCodeAt(s)]=s;function f(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=e),[r,r===e?0:4-r%4]}function h(t){return n[t>>18&63]+n[t>>12&63]+n[t>>6&63]+n[63&t]}function c(t,e,r){for(var n,i=[],o=e;o<r;o+=3)n=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(255&t[o+2]),i.push(h(n));return i.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(t,e){e.read=function(t,e,r,n,i){var o,a,s=8*i-n-1,u=(1<<s)-1,f=u>>1,h=-7,c=r?i-1:0,l=r?-1:1,d=t[e+c];for(c+=l,o=d&(1<<-h)-1,d>>=-h,h+=s;h>0;o=256*o+t[e+c],c+=l,h-=8);for(a=o&(1<<-h)-1,o>>=-h,h+=n;h>0;a=256*a+t[e+c],c+=l,h-=8);if(0===o)o=1-f;else{if(o===u)return a?NaN:1/0*(d?-1:1);a+=Math.pow(2,n),o-=f}return(d?-1:1)*a*Math.pow(2,o-n)},e.write=function(t,e,r,n,i,o){var a,s,u,f=8*o-i-1,h=(1<<f)-1,c=h>>1,l=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:o-1,p=n?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=h):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),(e+=a+c>=1?l/u:l*Math.pow(2,1-c))*u>=2&&(a++,u/=2),a+c>=h?(s=0,a=h):a+c>=1?(s=(e*u-1)*Math.pow(2,i),a+=c):(s=e*Math.pow(2,c-1)*Math.pow(2,i),a=0));i>=8;t[r+d]=255&s,d+=p,s/=256,i-=8);for(a=a<<i|s,f+=i;f>0;t[r+d]=255&a,d+=p,a/=256,f-=8);t[r+d-p]|=128*g}},function(t,e){var r={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==r.call(t)}},function(t,e,r){var n;t.exports=function t(e,r,i){function o(s,u){if(!r[s]){if(!e[s]){var f="function"==typeof n&&n;if(!u&&f)return n(s,!0);if(a)return a(s,!0);var h=new Error("Cannot find module \'"+s+"\'");throw h.code="MODULE_NOT_FOUND",h}var c=r[s]={exports:{}};e[s][0].call(c.exports,function(t){var r=e[s][1][t];return o(r||t)},c,c.exports,t,e,r,i)}return r[s].exports}for(var a="function"==typeof n&&n,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(t,e,r){"use strict";function n(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;r.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var r=e.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var i in r)n(r,i)&&(t[i]=r[i])}}return t},r.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var o={arraySet:function(t,e,r,n,i){if(e.subarray&&t.subarray)t.set(e.subarray(r,r+n),i);else for(var o=0;o<n;o++)t[i+o]=e[r+o]},flattenChunks:function(t){var e,r,n,i,o,a;for(n=0,e=0,r=t.length;e<r;e++)n+=t[e].length;for(a=new Uint8Array(n),i=0,e=0,r=t.length;e<r;e++)o=t[e],a.set(o,i),i+=o.length;return a}},a={arraySet:function(t,e,r,n,i){for(var o=0;o<n;o++)t[i+o]=e[r+o]},flattenChunks:function(t){return[].concat.apply([],t)}};r.setTyped=function(t){t?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,o)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,a))},r.setTyped(i)},{}],2:[function(t,e,r){"use strict";function n(t,e){if(e<65537&&(t.subarray&&a||!t.subarray&&o))return String.fromCharCode.apply(null,i.shrinkBuf(t,e));for(var r="",n=0;n<e;n++)r+=String.fromCharCode(t[n]);return r}var i=t("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(t){o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){a=!1}for(var s=new i.Buf8(256),u=0;u<256;u++)s[u]=u>=252?6:u>=248?5:u>=240?4:u>=224?3:u>=192?2:1;s[254]=s[254]=1,r.string2buf=function(t){var e,r,n,o,a,s=t.length,u=0;for(o=0;o<s;o++)55296==(64512&(r=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(n=t.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(n-56320),o++),u+=r<128?1:r<2048?2:r<65536?3:4;for(e=new i.Buf8(u),a=0,o=0;a<u;o++)55296==(64512&(r=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(n=t.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(n-56320),o++),r<128?e[a++]=r:r<2048?(e[a++]=192|r>>>6,e[a++]=128|63&r):r<65536?(e[a++]=224|r>>>12,e[a++]=128|r>>>6&63,e[a++]=128|63&r):(e[a++]=240|r>>>18,e[a++]=128|r>>>12&63,e[a++]=128|r>>>6&63,e[a++]=128|63&r);return e},r.buf2binstring=function(t){return n(t,t.length)},r.binstring2buf=function(t){for(var e=new i.Buf8(t.length),r=0,n=e.length;r<n;r++)e[r]=t.charCodeAt(r);return e},r.buf2string=function(t,e){var r,i,o,a,u=e||t.length,f=new Array(2*u);for(i=0,r=0;r<u;)if((o=t[r++])<128)f[i++]=o;else if((a=s[o])>4)f[i++]=65533,r+=a-1;else{for(o&=2===a?31:3===a?15:7;a>1&&r<u;)o=o<<6|63&t[r++],a--;a>1?f[i++]=65533:o<65536?f[i++]=o:(o-=65536,f[i++]=55296|o>>10&1023,f[i++]=56320|1023&o)}return n(f,i)},r.utf8border=function(t,e){var r;for((e=e||t.length)>t.length&&(e=t.length),r=e-1;r>=0&&128==(192&t[r]);)r--;return r<0?e:0===r?e:r+s[t[r]]>e?r:e}},{"./common":1}],3:[function(t,e,r){"use strict";e.exports=function(t,e,r,n){for(var i=65535&t|0,o=t>>>16&65535|0,a=0;0!==r;){r-=a=r>2e3?2e3:r;do{o=o+(i=i+e[n++]|0)|0}while(--a);i%=65521,o%=65521}return i|o<<16|0}},{}],4:[function(t,e,r){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],5:[function(t,e,r){"use strict";var n=function(){for(var t,e=[],r=0;r<256;r++){t=r;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e}();e.exports=function(t,e,r,i){var o=n,a=i+r;t^=-1;for(var s=i;s<a;s++)t=t>>>8^o[255&(t^e[s])];return-1^t}},{}],6:[function(t,e,r){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],7:[function(t,e,r){"use strict";e.exports=function(t,e){var r,n,i,o,a,s,u,f,h,c,l,d,p,g,y,v,m,w,b,_,k,E,A,S,T;r=t.state,n=t.next_in,S=t.input,i=n+(t.avail_in-5),o=t.next_out,T=t.output,a=o-(e-t.avail_out),s=o+(t.avail_out-257),u=r.dmax,f=r.wsize,h=r.whave,c=r.wnext,l=r.window,d=r.hold,p=r.bits,g=r.lencode,y=r.distcode,v=(1<<r.lenbits)-1,m=(1<<r.distbits)-1;t:do{p<15&&(d+=S[n++]<<p,p+=8,d+=S[n++]<<p,p+=8),w=g[d&v];e:for(;;){if(d>>>=b=w>>>24,p-=b,0==(b=w>>>16&255))T[o++]=65535&w;else{if(!(16&b)){if(0==(64&b)){w=g[(65535&w)+(d&(1<<b)-1)];continue e}if(32&b){r.mode=12;break t}t.msg="invalid literal/length code",r.mode=30;break t}_=65535&w,(b&=15)&&(p<b&&(d+=S[n++]<<p,p+=8),_+=d&(1<<b)-1,d>>>=b,p-=b),p<15&&(d+=S[n++]<<p,p+=8,d+=S[n++]<<p,p+=8),w=y[d&m];r:for(;;){if(d>>>=b=w>>>24,p-=b,!(16&(b=w>>>16&255))){if(0==(64&b)){w=y[(65535&w)+(d&(1<<b)-1)];continue r}t.msg="invalid distance code",r.mode=30;break t}if(k=65535&w,p<(b&=15)&&(d+=S[n++]<<p,(p+=8)<b&&(d+=S[n++]<<p,p+=8)),(k+=d&(1<<b)-1)>u){t.msg="invalid distance too far back",r.mode=30;break t}if(d>>>=b,p-=b,k>(b=o-a)){if((b=k-b)>h&&r.sane){t.msg="invalid distance too far back",r.mode=30;break t}if(E=0,A=l,0===c){if(E+=f-b,b<_){_-=b;do{T[o++]=l[E++]}while(--b);E=o-k,A=T}}else if(c<b){if(E+=f+c-b,(b-=c)<_){_-=b;do{T[o++]=l[E++]}while(--b);if(E=0,c<_){_-=b=c;do{T[o++]=l[E++]}while(--b);E=o-k,A=T}}}else if(E+=c-b,b<_){_-=b;do{T[o++]=l[E++]}while(--b);E=o-k,A=T}for(;_>2;)T[o++]=A[E++],T[o++]=A[E++],T[o++]=A[E++],_-=3;_&&(T[o++]=A[E++],_>1&&(T[o++]=A[E++]))}else{E=o-k;do{T[o++]=T[E++],T[o++]=T[E++],T[o++]=T[E++],_-=3}while(_>2);_&&(T[o++]=T[E++],_>1&&(T[o++]=T[E++]))}break}}break}}while(n<i&&o<s);n-=_=p>>3,d&=(1<<(p-=_<<3))-1,t.next_in=n,t.next_out=o,t.avail_in=n<i?i-n+5:5-(n-i),t.avail_out=o<s?s-o+257:257-(o-s),r.hold=d,r.bits=p}},{}],8:[function(t,e,r){"use strict";function n(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function i(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=_,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new l.Buf32(E),e.distcode=e.distdyn=new l.Buf32(A),e.sane=1,e.back=-1,w):b}function o(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,i(t)):b}function a(t,e){var r,n;return t&&t.state?(n=t.state,e<0?(r=0,e=-e):(r=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?b:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=r,n.wbits=e,o(t))):b}function s(t,e){var r,n;return t?(n=new function(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new l.Buf16(320),this.work=new l.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0},t.state=n,n.window=null,(r=a(t,e))!==w&&(t.state=null),r):b}function u(t){if(S){var e;for(h=new l.Buf32(512),c=new l.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(y(v,t.lens,0,288,h,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;y(m,t.lens,0,32,c,0,t.work,{bits:5}),S=!1}t.lencode=h,t.lenbits=9,t.distcode=c,t.distbits=5}function f(t,e,r,n){var i,o=t.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new l.Buf8(o.wsize)),n>=o.wsize?(l.arraySet(o.window,e,r-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((i=o.wsize-o.wnext)>n&&(i=n),l.arraySet(o.window,e,r-n,i,o.wnext),(n-=i)?(l.arraySet(o.window,e,r-n,n,0),o.wnext=n,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0}var h,c,l=t("../utils/common"),d=t("./adler32"),p=t("./crc32"),g=t("./inffast"),y=t("./inftrees"),v=1,m=2,w=0,b=-2,_=1,k=12,E=852,A=592,S=!0;r.inflateReset=o,r.inflateReset2=a,r.inflateResetKeep=i,r.inflateInit=function(t){return s(t,15)},r.inflateInit2=s,r.inflate=function(t,e){var r,i,o,a,s,h,c,E,A,S,T,x,P,B,R,U,O,C,I,M,D,N,L,j,F=0,Y=new l.Buf8(4),Z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return b;(r=t.state).mode===k&&(r.mode=13),s=t.next_out,o=t.output,c=t.avail_out,a=t.next_in,i=t.input,h=t.avail_in,E=r.hold,A=r.bits,S=h,T=c,N=w;t:for(;;)switch(r.mode){case _:if(0===r.wrap){r.mode=13;break}for(;A<16;){if(0===h)break t;h--,E+=i[a++]<<A,A+=8}if(2&r.wrap&&35615===E){r.check=0,Y[0]=255&E,Y[1]=E>>>8&255,r.check=p(r.check,Y,2,0),E=0,A=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&E)<<8)+(E>>8))%31){t.msg="incorrect header check",r.mode=30;break}if(8!=(15&E)){t.msg="unknown compression method",r.mode=30;break}if(A-=4,D=8+(15&(E>>>=4)),0===r.wbits)r.wbits=D;else if(D>r.wbits){t.msg="invalid window size",r.mode=30;break}r.dmax=1<<D,t.adler=r.check=1,r.mode=512&E?10:k,E=0,A=0;break;case 2:for(;A<16;){if(0===h)break t;h--,E+=i[a++]<<A,A+=8}if(r.flags=E,8!=(255&r.flags)){t.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){t.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=E>>8&1),512&r.flags&&(Y[0]=255&E,Y[1]=E>>>8&255,r.check=p(r.check,Y,2,0)),E=0,A=0,r.mode=3;case 3:for(;A<32;){if(0===h)break t;h--,E+=i[a++]<<A,A+=8}r.head&&(r.head.time=E),512&r.flags&&(Y[0]=255&E,Y[1]=E>>>8&255,Y[2]=E>>>16&255,Y[3]=E>>>24&255,r.check=p(r.check,Y,4,0)),E=0,A=0,r.mode=4;case 4:for(;A<16;){if(0===h)break t;h--,E+=i[a++]<<A,A+=8}r.head&&(r.head.xflags=255&E,r.head.os=E>>8),512&r.flags&&(Y[0]=255&E,Y[1]=E>>>8&255,r.check=p(r.check,Y,2,0)),E=0,A=0,r.mode=5;case 5:if(1024&r.flags){for(;A<16;){if(0===h)break t;h--,E+=i[a++]<<A,A+=8}r.length=E,r.head&&(r.head.extra_len=E),512&r.flags&&(Y[0]=255&E,Y[1]=E>>>8&255,r.check=p(r.check,Y,2,0)),E=0,A=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&((x=r.length)>h&&(x=h),x&&(r.head&&(D=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),l.arraySet(r.head.extra,i,a,x,D)),512&r.flags&&(r.check=p(r.check,i,x,a)),h-=x,a+=x,r.length-=x),r.length))break t;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===h)break t;x=0;do{D=i[a+x++],r.head&&D&&r.length<65536&&(r.head.name+=String.fromCharCode(D))}while(D&&x<h);if(512&r.flags&&(r.check=p(r.check,i,x,a)),h-=x,a+=x,D)break t}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===h)break t;x=0;do{D=i[a+x++],r.head&&D&&r.length<65536&&(r.head.comment+=String.fromCharCode(D))}while(D&&x<h);if(512&r.flags&&(r.check=p(r.check,i,x,a)),h-=x,a+=x,D)break t}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;A<16;){if(0===h)break t;h--,E+=i[a++]<<A,A+=8}if(E!==(65535&r.check)){t.msg="header crc mismatch",r.mode=30;break}E=0,A=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=k;break;case 10:for(;A<32;){if(0===h)break t;h--,E+=i[a++]<<A,A+=8}t.adler=r.check=n(E),E=0,A=0,r.mode=11;case 11:if(0===r.havedict)return t.next_out=s,t.avail_out=c,t.next_in=a,t.avail_in=h,r.hold=E,r.bits=A,2;t.adler=r.check=1,r.mode=k;case k:if(5===e||6===e)break t;case 13:if(r.last){E>>>=7&A,A-=7&A,r.mode=27;break}for(;A<3;){if(0===h)break t;h--,E+=i[a++]<<A,A+=8}switch(r.last=1&E,A-=1,3&(E>>>=1)){case 0:r.mode=14;break;case 1:if(u(r),r.mode=20,6===e){E>>>=2,A-=2;break t}break;case 2:r.mode=17;break;case 3:t.msg="invalid block type",r.mode=30}E>>>=2,A-=2;break;case 14:for(E>>>=7&A,A-=7&A;A<32;){if(0===h)break t;h--,E+=i[a++]<<A,A+=8}if((65535&E)!=(E>>>16^65535)){t.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&E,E=0,A=0,r.mode=15,6===e)break t;case 15:r.mode=16;case 16:if(x=r.length){if(x>h&&(x=h),x>c&&(x=c),0===x)break t;l.arraySet(o,i,a,x,s),h-=x,a+=x,c-=x,s+=x,r.length-=x;break}r.mode=k;break;case 17:for(;A<14;){if(0===h)break t;h--,E+=i[a++]<<A,A+=8}if(r.nlen=257+(31&E),E>>>=5,A-=5,r.ndist=1+(31&E),E>>>=5,A-=5,r.ncode=4+(15&E),E>>>=4,A-=4,r.nlen>286||r.ndist>30){t.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;A<3;){if(0===h)break t;h--,E+=i[a++]<<A,A+=8}r.lens[Z[r.have++]]=7&E,E>>>=3,A-=3}for(;r.have<19;)r.lens[Z[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,L={bits:r.lenbits},N=y(0,r.lens,0,19,r.lencode,0,r.work,L),r.lenbits=L.bits,N){t.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;F=r.lencode[E&(1<<r.lenbits)-1],U=F>>>16&255,O=65535&F,!((R=F>>>24)<=A);){if(0===h)break t;h--,E+=i[a++]<<A,A+=8}if(O<16)E>>>=R,A-=R,r.lens[r.have++]=O;else{if(16===O){for(j=R+2;A<j;){if(0===h)break t;h--,E+=i[a++]<<A,A+=8}if(E>>>=R,A-=R,0===r.have){t.msg="invalid bit length repeat",r.mode=30;break}D=r.lens[r.have-1],x=3+(3&E),E>>>=2,A-=2}else if(17===O){for(j=R+3;A<j;){if(0===h)break t;h--,E+=i[a++]<<A,A+=8}A-=R,D=0,x=3+(7&(E>>>=R)),E>>>=3,A-=3}else{for(j=R+7;A<j;){if(0===h)break t;h--,E+=i[a++]<<A,A+=8}A-=R,D=0,x=11+(127&(E>>>=R)),E>>>=7,A-=7}if(r.have+x>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=30;break}for(;x--;)r.lens[r.have++]=D}}if(30===r.mode)break;if(0===r.lens[256]){t.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,L={bits:r.lenbits},N=y(v,r.lens,0,r.nlen,r.lencode,0,r.work,L),r.lenbits=L.bits,N){t.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,L={bits:r.distbits},N=y(m,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,L),r.distbits=L.bits,N){t.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===e)break t;case 20:r.mode=21;case 21:if(h>=6&&c>=258){t.next_out=s,t.avail_out=c,t.next_in=a,t.avail_in=h,r.hold=E,r.bits=A,g(t,T),s=t.next_out,o=t.output,c=t.avail_out,a=t.next_in,i=t.input,h=t.avail_in,E=r.hold,A=r.bits,r.mode===k&&(r.back=-1);break}for(r.back=0;F=r.lencode[E&(1<<r.lenbits)-1],U=F>>>16&255,O=65535&F,!((R=F>>>24)<=A);){if(0===h)break t;h--,E+=i[a++]<<A,A+=8}if(U&&0==(240&U)){for(C=R,I=U,M=O;F=r.lencode[M+((E&(1<<C+I)-1)>>C)],U=F>>>16&255,O=65535&F,!(C+(R=F>>>24)<=A);){if(0===h)break t;h--,E+=i[a++]<<A,A+=8}E>>>=C,A-=C,r.back+=C}if(E>>>=R,A-=R,r.back+=R,r.length=O,0===U){r.mode=26;break}if(32&U){r.back=-1,r.mode=k;break}if(64&U){t.msg="invalid literal/length code",r.mode=30;break}r.extra=15&U,r.mode=22;case 22:if(r.extra){for(j=r.extra;A<j;){if(0===h)break t;h--,E+=i[a++]<<A,A+=8}r.length+=E&(1<<r.extra)-1,E>>>=r.extra,A-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;F=r.distcode[E&(1<<r.distbits)-1],U=F>>>16&255,O=65535&F,!((R=F>>>24)<=A);){if(0===h)break t;h--,E+=i[a++]<<A,A+=8}if(0==(240&U)){for(C=R,I=U,M=O;F=r.distcode[M+((E&(1<<C+I)-1)>>C)],U=F>>>16&255,O=65535&F,!(C+(R=F>>>24)<=A);){if(0===h)break t;h--,E+=i[a++]<<A,A+=8}E>>>=C,A-=C,r.back+=C}if(E>>>=R,A-=R,r.back+=R,64&U){t.msg="invalid distance code",r.mode=30;break}r.offset=O,r.extra=15&U,r.mode=24;case 24:if(r.extra){for(j=r.extra;A<j;){if(0===h)break t;h--,E+=i[a++]<<A,A+=8}r.offset+=E&(1<<r.extra)-1,E>>>=r.extra,A-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===c)break t;if(x=T-c,r.offset>x){if((x=r.offset-x)>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=30;break}x>r.wnext?(x-=r.wnext,P=r.wsize-x):P=r.wnext-x,x>r.length&&(x=r.length),B=r.window}else B=o,P=s-r.offset,x=r.length;x>c&&(x=c),c-=x,r.length-=x;do{o[s++]=B[P++]}while(--x);0===r.length&&(r.mode=21);break;case 26:if(0===c)break t;o[s++]=r.length,c--,r.mode=21;break;case 27:if(r.wrap){for(;A<32;){if(0===h)break t;h--,E|=i[a++]<<A,A+=8}if(T-=c,t.total_out+=T,r.total+=T,T&&(t.adler=r.check=r.flags?p(r.check,o,T,s-T):d(r.check,o,T,s-T)),T=c,(r.flags?E:n(E))!==r.check){t.msg="incorrect data check",r.mode=30;break}E=0,A=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;A<32;){if(0===h)break t;h--,E+=i[a++]<<A,A+=8}if(E!==(4294967295&r.total)){t.msg="incorrect length check",r.mode=30;break}E=0,A=0}r.mode=29;case 29:N=1;break t;case 30:N=-3;break t;case 31:return-4;case 32:default:return b}return t.next_out=s,t.avail_out=c,t.next_in=a,t.avail_in=h,r.hold=E,r.bits=A,(r.wsize||T!==t.avail_out&&r.mode<30&&(r.mode<27||4!==e))&&f(t,t.output,t.next_out,T-t.avail_out)?(r.mode=31,-4):(S-=t.avail_in,T-=t.avail_out,t.total_in+=S,t.total_out+=T,r.total+=T,r.wrap&&T&&(t.adler=r.check=r.flags?p(r.check,o,T,t.next_out-T):d(r.check,o,T,t.next_out-T)),t.data_type=r.bits+(r.last?64:0)+(r.mode===k?128:0)+(20===r.mode||15===r.mode?256:0),(0===S&&0===T||4===e)&&N===w&&(N=-5),N)},r.inflateEnd=function(t){if(!t||!t.state)return b;var e=t.state;return e.window&&(e.window=null),t.state=null,w},r.inflateGetHeader=function(t,e){var r;return t&&t.state?0==(2&(r=t.state).wrap)?b:(r.head=e,e.done=!1,w):b},r.inflateSetDictionary=function(t,e){var r,n=e.length;return t&&t.state?0!==(r=t.state).wrap&&11!==r.mode?b:11===r.mode&&d(1,e,n,0)!==r.check?-3:f(t,e,n,n)?(r.mode=31,-4):(r.havedict=1,w):b},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":1,"./adler32":3,"./crc32":5,"./inffast":7,"./inftrees":9}],9:[function(t,e,r){"use strict";var n=t("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,r,u,f,h,c,l){var d,p,g,y,v,m,w,b,_,k=l.bits,E=0,A=0,S=0,T=0,x=0,P=0,B=0,R=0,U=0,O=0,C=null,I=0,M=new n.Buf16(16),D=new n.Buf16(16),N=null,L=0;for(E=0;E<=15;E++)M[E]=0;for(A=0;A<u;A++)M[e[r+A]]++;for(x=k,T=15;T>=1&&0===M[T];T--);if(x>T&&(x=T),0===T)return f[h++]=20971520,f[h++]=20971520,l.bits=1,0;for(S=1;S<T&&0===M[S];S++);for(x<S&&(x=S),R=1,E=1;E<=15;E++)if(R<<=1,(R-=M[E])<0)return-1;if(R>0&&(0===t||1!==T))return-1;for(D[1]=0,E=1;E<15;E++)D[E+1]=D[E]+M[E];for(A=0;A<u;A++)0!==e[r+A]&&(c[D[e[r+A]]++]=A);if(0===t?(C=N=c,m=19):1===t?(C=i,I-=257,N=o,L-=257,m=256):(C=a,N=s,m=-1),O=0,A=0,E=S,v=h,P=x,B=0,g=-1,y=(U=1<<x)-1,1===t&&U>852||2===t&&U>592)return 1;for(;;){w=E-B,c[A]<m?(b=0,_=c[A]):c[A]>m?(b=N[L+c[A]],_=C[I+c[A]]):(b=96,_=0),d=1<<E-B,S=p=1<<P;do{f[v+(O>>B)+(p-=d)]=w<<24|b<<16|_|0}while(0!==p);for(d=1<<E-1;O&d;)d>>=1;if(0!==d?(O&=d-1,O+=d):O=0,A++,0==--M[E]){if(E===T)break;E=e[r+c[A]]}if(E>x&&(O&y)!==g){for(0===B&&(B=x),v+=S,R=1<<(P=E-B);P+B<T&&!((R-=M[P+B])<=0);)P++,R<<=1;if(U+=1<<P,1===t&&U>852||2===t&&U>592)return 1;f[g=O&y]=x<<24|P<<16|v-h|0}}return 0!==O&&(f[v+O]=E-B<<24|64<<16|0),l.bits=x,0}},{"../utils/common":1}],10:[function(t,e,r){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],11:[function(t,e,r){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],"/lib/inflate.js":[function(t,e,r){"use strict";function n(t){if(!(this instanceof n))return new n(t);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var r=o.inflateInit2(this.strm,e.windowBits);if(r!==u.Z_OK)throw new Error(f[r]);this.header=new c,o.inflateGetHeader(this.strm,this.header)}function i(t,e){var r=new n(e);if(r.push(t,!0),r.err)throw r.msg||f[r.err];return r.result}var o=t("./zlib/inflate"),a=t("./utils/common"),s=t("./utils/strings"),u=t("./zlib/constants"),f=t("./zlib/messages"),h=t("./zlib/zstream"),c=t("./zlib/gzheader"),l=Object.prototype.toString;n.prototype.push=function(t,e){var r,n,i,f,h,c,d=this.strm,p=this.options.chunkSize,g=this.options.dictionary,y=!1;if(this.ended)return!1;n=e===~~e?e:!0===e?u.Z_FINISH:u.Z_NO_FLUSH,"string"==typeof t?d.input=s.binstring2buf(t):"[object ArrayBuffer]"===l.call(t)?d.input=new Uint8Array(t):d.input=t,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new a.Buf8(p),d.next_out=0,d.avail_out=p),(r=o.inflate(d,u.Z_NO_FLUSH))===u.Z_NEED_DICT&&g&&(c="string"==typeof g?s.string2buf(g):"[object ArrayBuffer]"===l.call(g)?new Uint8Array(g):g,r=o.inflateSetDictionary(this.strm,c)),r===u.Z_BUF_ERROR&&!0===y&&(r=u.Z_OK,y=!1),r!==u.Z_STREAM_END&&r!==u.Z_OK)return this.onEnd(r),this.ended=!0,!1;d.next_out&&(0!==d.avail_out&&r!==u.Z_STREAM_END&&(0!==d.avail_in||n!==u.Z_FINISH&&n!==u.Z_SYNC_FLUSH)||("string"===this.options.to?(i=s.utf8border(d.output,d.next_out),f=d.next_out-i,h=s.buf2string(d.output,i),d.next_out=f,d.avail_out=p-f,f&&a.arraySet(d.output,d.output,i,f,0),this.onData(h)):this.onData(a.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(y=!0)}while((d.avail_in>0||0===d.avail_out)&&r!==u.Z_STREAM_END);return r===u.Z_STREAM_END&&(n=u.Z_FINISH),n===u.Z_FINISH?(r=o.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===u.Z_OK):n!==u.Z_SYNC_FLUSH||(this.onEnd(u.Z_OK),d.avail_out=0,!0)},n.prototype.onData=function(t){this.chunks.push(t)},n.prototype.onEnd=function(t){t===u.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},r.Inflate=n,r.inflate=i,r.inflateRaw=function(t,e){return(e=e||{}).raw=!0,i(t,e)},r.ungzip=i},{"./utils/common":1,"./utils/strings":2,"./zlib/constants":4,"./zlib/gzheader":6,"./zlib/inflate":8,"./zlib/messages":10,"./zlib/zstream":11}]},{},[])("/lib/inflate.js")},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){this.width=0,this.height=0,this.bitDepth=0,this.colorType=0,this.compressionMethod=0,this.filterMethod=0,this.interlaceMethod=0,this.colors=0,this.alpha=!1,this.pixelBits=0,this.palette=null,this.pixels=null};n.prototype.getWidth=function(){return this.width},n.prototype.setWidth=function(t){this.width=t},n.prototype.getHeight=function(){return this.height},n.prototype.setHeight=function(t){this.height=t},n.prototype.getBitDepth=function(){return this.bitDepth},n.prototype.setBitDepth=function(t){if(-1===[2,4,8,16].indexOf(t))throw new Error("invalid bith depth "+t);this.bitDepth=t},n.prototype.getColorType=function(){return this.colorType},n.prototype.setColorType=function(t){var e=0,r=!1;switch(t){case 0:e=1;break;case 2:e=3;break;case 3:e=1;break;case 4:e=2,r=!0;break;case 6:e=4,r=!0;break;default:throw new Error("invalid color type")}this.colors=e,this.alpha=r,this.colorType=t},n.prototype.getCompressionMethod=function(){return this.compressionMethod},n.prototype.setCompressionMethod=function(t){if(0!==t)throw new Error("invalid compression method "+t);this.compressionMethod=t},n.prototype.getFilterMethod=function(){return this.filterMethod},n.prototype.setFilterMethod=function(t){if(0!==t)throw new Error("invalid filter method "+t);this.filterMethod=t},n.prototype.getInterlaceMethod=function(){return this.interlaceMethod},n.prototype.setInterlaceMethod=function(t){if(0!==t&&1!==t)throw new Error("invalid interlace method "+t);this.interlaceMethod=t},n.prototype.setPalette=function(t){if(t.length%3!=0)throw new Error("incorrect PLTE chunk length");if(t.length>3*Math.pow(2,this.bitDepth))throw new Error("palette has more colors than 2^bitdepth");this.palette=t},n.prototype.getPalette=function(){return this.palette},n.prototype.getPixel=function(t,e){if(!this.pixels)throw new Error("pixel data is empty");if(t>=this.width||e>=this.height)throw new Error("x,y position out of bound");var r=this.colors*this.bitDepth/8*(e*this.width+t),n=this.pixels;switch(this.colorType){case 0:return[n[r],n[r],n[r],255];case 2:return[n[r],n[r+1],n[r+2],255];case 3:return[this.palette[3*n[r]+0],this.palette[3*n[r]+1],this.palette[3*n[r]+2],255];case 4:return[n[r],n[r],n[r],n[r+1]];case 6:return[n[r],n[r+1],n[r+2],n[r+3]]}},e.default=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();var i=!1;function o(){var t;i&&(t=console).log.apply(t,arguments)}var a=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.data={},this.entries=[],this.buffer=null,this.storeBuffer=null!=e&&e}return n(t,[{key:"_Uint8ToString",value:function(t){var e=[];if(Uint8Array.prototype.subarray)for(var r=0;r<t.byteLength;r+=32768)e.push(String.fromCharCode.apply(null,t.subarray(r,Math.min(r+32768,t.byteLength))));else if(Uint8Array.prototype.slice)for(var n=0;n<t.byteLength;n+=32768)e.push(String.fromCharCode.apply(null,t.slice(n,Math.min(n+32768,t.byteLength))));else for(var i=0;i<t.byteLength;i+=32768){for(var o=new Uint8Array(Math.min(32768,t.byteLength-i)),a=0;a<o.byteLength;++a)o[a]=t[i+a];e.push(String.fromCharCode.apply(null,o))}return e.join("")}},{key:"_parseImgURI",value:function(t,e){if(t instanceof Uint8Array)return null==e?"data:;base64,"+btoa(this._Uint8ToString(t)):"data:"+e+";base64,"+btoa(this._Uint8ToString(t));if(t instanceof ArrayBuffer){var r=new Uint8Array(t);return null==e?"data:;base64,"+btoa(this._Uint8ToString(r)):"data:"+e+";base64,"+btoa(this._Uint8ToString(r))}console.error("Unknow type ",t)}},{key:"parseBundle",value:function(t,e,r,n){n=n||{};var a=0,s="",u=new Uint8Array(e*r*3),f=n.password||"";this.storeBuffer&&(this.buffer=u);for(var h=0;h<t.length;h++)(h+1)%4!=0&&(u[a++]=t[h]);if(o("Extracted Uint8Array",u.length,u),i){for(var c="",l=500;l<800;l++)c+=u[l]+",";console.log("500 to 800 bytes"),console.log(c)}for(a=0;a<u.length&&!(u[a]<5);)s+=String.fromCharCode(u[a++]);o("Found the string 0 char at index "+a+" with value "+u[a]),o(s),a++;var d=0;if(""!==f)for(var p=a;p<u.length;p++){var g=u[p];g^=f.charCodeAt(d),u[p]=g,d=(d+1)%f.length}this.entries=[];var y=s.split("\\n");y=(s=y.join("")).split(";");for(var v=0;v<y.length;v++)if(""!==y[v]){var m=y[v].split(",");this.entries.push({path:m[0],type:m[1],length:parseInt(m[2],10)})}o("this.entries",this.entries);for(var w=0;w<this.entries.length;w++){var b=this.entries[w],_=u.subarray(a,a+b.length);o("Extracting "+b.path+": length "+_.length),o("Starts at "+a+" with value "+_[0]),o("Ends at "+(a+b.length)+" with value "+_[_.length-1]),a+=b.length,this.data[b.path]=_}}},{key:"read",value:function(t){return null===this.data[t]&&console.error("Bundle: ["+t+"] not found."),this.data[t]}},{key:"readText",value:function(t){var e="",r=this.read(t);if(null==r)return e;for(var n=0;n<r.length;n++)e+=String.fromCharCode(r[n]);return e}},{key:"readJSON",value:function(t){var e=this.readText(t);return""===e?{}:JSON.parse(e)}},{key:"readImg",value:function(t){var e=this.read(t);return null===e?(console.error("Cannot read ",t),""):this._parseImgURI(e,"image/jpeg")}},{key:"clearData",value:function(){this.data={}}}]),t}();e.default=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),i=r(12),o=r(13);function a(t,e,r){for(var n=r.decodeOffsets,i=r.decodeScales,o=e.attribRange[0],a=e.attribRange[1],s=r.decodeScales.length,u=new Float32Array(s*a),f=o,h=0;h<s;h++){var c=f+a,l=i[h],d=n[h];l&&y(t,f,c,u,h,s,d,l),f=c}var p=3*e.indexRange[1],g=new Uint32Array(p);return function(t,e,r,n,i){for(var o=0,a=0,s=0;s<r;s++)a=t.charCodeAt(e+s),n[s]=o-a,0===a&&o++}(t,f,p,g),{attribsOut:u,indicesOut:g};function y(t,e,r,n,i,o,a,s){for(var u=0,f=0,h=e;h<r;h++)u+=(f=t.charCodeAt(h))>>1^-(1&f),n[i]=s*(u+a),i+=o}}var s=function(){function t(e){var r=e.resourceKey,n=e.utf8;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.resourceKey=r,this.utf8=n,this._dutf8=null,this._rdutf8=null}return n(t,[{key:"destruct",value:function(){for(var t in this.resourceKey=null,this.utf8)this.utf8[t]=null;return this.utf8=null,this._dutf8=null,!0}},{key:"decode",value:function(){var t=this.meshFiles,e={};for(var r in t){var n=t[r],i=this._meshBuffer(r);e[r]=[];for(var o=0;o<n.length;o++){var s=n[o],u=s.indexRange;if(e[r][o]={},u){var f=u[0]+3*u[1];if(i.length<f){console.error("utf8 decode out of range.");break}var h=this.decodeParams;s.decodeParam&&(s.decodeParam.decodeScales.length!==this.stride&&console.error("Component decode param in consistent",s.decodeParam,this.decodeParams),h=Object.assign({},h,s.decodeParam));var c=a(i,s,h),l=c.attribsOut,d=c.indicesOut;e[r][o].attributes=l,e[r][o].indices=d,e[r][o].materialName=s.material}}}this._dutf8={geometryArrays:e,materialParams:this.manifest.materials,imageStrings:this.imageStrings}}},{key:"_clearDutf8",value:function(){if(this._dutf8){for(var t in this._dutf8.geometryArrays){for(var e=this._dutf8.geometryArrays[t],r=0;r<e.length;r++)this._dutf8.geometryArrays[t][r].attributes=null,this._dutf8.geometryArrays[t][r].indices=null,this._dutf8.geometryArrays[t][r].materialName=null;this._dutf8.geometryArrays[t]=null}this._dutf8.geometryArrays=null,this._dutf8.materialParams=null,this._dutf8.imageStrings=null,this._dutf8=null}}},{key:"_meshBuffer",value:function(t){return t.endsWith(".aa")||(t=t+=".aa"),this.utf8[t]}},{key:"basename",get:function(){var t=(0,i.basename)(this.resourceKey);return Object.defineProperty(this,"fileName",{value:t,writable:!1,configurable:!0}),this.fileName}},{key:"decodeParams",get:function(){var t=this.manifest.decodeParams,e=t.decodeOffsets,r=t.decodeScales,n=t.decodeTarget,i=t.decodeFormat;return n||(n=["position","uv","normal"]),i||(i=[3,2,3]),Object.defineProperty(this,"decodeParams",{value:{decodeOffsets:e,decodeScales:r,decodeTarget:n,decodeFormat:i},writable:!1,configurable:!0}),this.decodeParams}},{key:"stride",get:function(){var t,e=this.decodeParams.decodeScales.length,r=this.decodeParams.decodeOffsets.length,n=this.decodeParams.decodeFormat.reduce(function(t,e){return t+e},0);return e===r&&r===n||console.error("decodeParams",this.decodeParams),t=e,Object.defineProperty(this,"stride",{value:t,writable:!1,configurable:!0}),this.stride}},{key:"meshFiles",get:function(){return this.manifest.urls}},{key:"dutf8",get:function(){return this._dutf8||this.decode(),this._dutf8}},{key:"rdutf8",get:function(){var t=this;if(this._rdutf8)return this._rdutf8;var e=this.dutf8,r=[];for(var n in e.geometryArrays)for(var i=e.geometryArrays[n],a=0;a<i.length;a++){var s=i[a];r.push(s)}var u=0;r.forEach(function(e,r){if(r>0)for(var n=0,i=e.indices.length;n<i;n++)e.indices[n]+=u;u+=e.attributes.length/t.stride});var f=r.reduce(function(t,e){return t+e.attributes.length},0),h=new Float32Array(f),c=r.reduce(function(t,e){return t+e.indices.length},0),l=new Uint32Array(c),d=[],p=0,g=0;c>0?r.forEach(function(t,e){h.set(t.attributes,p),l.set(t.indices,g),d.push({start:g,count:t.indices.length,materialName:t.materialName}),p+=t.attributes.length,g+=t.indices.length}):r.forEach(function(e,r){h.set(e.attributes,p),d.push({start:p,count:e.attributes.length/t.stride,materialName:e.materialName}),p+=e.attributes.length});var y=e.materialParams,v=e.imageStrings;this._clearDutf8();var m={groups:d};l.length>0&&(m.index=l);for(var w=f/this.stride,b=this.decodeParams.decodeTarget,_=this.decodeParams.decodeFormat,k=[0],E=1;E<_.length;E++)k[E]=k[E-1]+_[E-1];var A={};b.forEach(function(e,r){var n=o.ATTRIBUTE_SIZE[e],i=k[r];if(n){var a=function(t,e,r,n,i){for(var o=new Float32Array(r*i),a=0,s=n*i,u=e;u<s;u+=n)for(var f=0;f<r;f++)o[a++]=t[u+f];return o}(h,i,n,t.stride,w);A[e]=a}}),m.attributes=A;var S=function(t){var e=[-1/0,-1/0,-1/0],r=[1/0,1/0,1/0];if(!t)return{max:[0,0,0],min:[0,0,0]};for(var n=0,i=t.length;n<i;n+=3)for(var o=0;o<3;o++){var a=t[n+o];a>e[o]&&(e[o]=a),a<r[o]&&(r[o]=a)}return{max:e,min:r}}(A.position);return A=null,h=null,{geometry:m,materials:y,images:v,bbox:S}}},{key:"imageStrings",get:function(){var t=this,e={},r=["map_Ka","map_Kd","map_Ks"],n=function(n){var i=t.manifest.materials[n];r.forEach(function(r){var n=i[r];(function(t,e){return t&&"string"==typeof t&&t.length>0&&e[t]&&"string"==typeof e[t]})(n,t.utf8)&&(e[n]=t.utf8[n])})};for(var i in this.manifest.materials)n(i);return e}},{key:"manifest",get:function(){var t=null;for(var e in this.utf8)if(e.endsWith(".txt")){t=e;break}return t||console.error("UTF8Decoder::manifest missing."),Object.defineProperty(this,"manifest",{value:this.utf8[t],writable:!1,configurable:!0}),this.manifest}}]),t}();e.default=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.basename=function(t){return t.replace(/.*\\/|\\.[^.]*$/g,"")},e.filename=function(t){return t.replace(/^.*[\\\\/]/,"")}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.ATTRIBUTE_SIZE={position:3,uv:2,color:3,normal:3}},function(t,e,r){(function(e,r){t.exports=function(){"use strict";function t(t){return"function"==typeof t}function n(){var t=setTimeout;return function(){return t(i,1)}}function i(){for(var t=0;t<w;t+=2){var e=P[t],r=P[t+1];e(r),P[t]=void 0,P[t+1]=void 0}w=0}function o(t,e){var r=this,n=new this.constructor(s);void 0===n[R]&&v(n);var i=r._state;if(i){var o=arguments[i-1];k(function(){return y(i,n,o,r._result)})}else p(r,n,t,e);return n}function a(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=new this(s);return h(e,t),e}function s(){}function u(t){try{return t.then}catch(t){return I.error=t,I}}function f(e,r,n){r.constructor===e.constructor&&n===o&&r.constructor.resolve===a?function(t,e){e._state===O?l(t,e._result):e._state===C?d(t,e._result):p(e,void 0,function(e){return h(t,e)},function(e){return d(t,e)})}(e,r):n===I?(d(e,I.error),I.error=null):void 0===n?l(e,r):t(n)?function(t,e,r){k(function(t){var n=!1,i=function(t,e,r,n){try{t.call(e,r,n)}catch(t){return t}}(r,e,function(r){n||(n=!0,e!==r?h(t,r):l(t,r))},function(e){n||(n=!0,d(t,e))},t._label);!n&&i&&(n=!0,d(t,i))},t)}(e,r,n):l(e,r)}function h(t,e){t===e?d(t,new TypeError("You cannot resolve a promise with itself")):function(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)}(e)?f(t,e,u(e)):l(t,e)}function c(t){t._onerror&&t._onerror(t._result),g(t)}function l(t,e){t._state===U&&(t._result=e,t._state=O,0!==t._subscribers.length&&k(g,t))}function d(t,e){t._state===U&&(t._state=C,t._result=e,k(c,t))}function p(t,e,r,n){var i=t._subscribers,o=i.length;t._onerror=null,i[o]=e,i[o+O]=r,i[o+C]=n,0===o&&t._state&&k(g,t)}function g(t){var e=t._subscribers,r=t._state;if(0!==e.length){for(var n=void 0,i=void 0,o=t._result,a=0;a<e.length;a+=3)n=e[a],i=e[a+r],n?y(r,n,i,o):i(o);t._subscribers.length=0}}function y(e,r,n,i){var o=t(n),a=void 0,s=void 0,u=void 0,f=void 0;if(o){if((a=function(t,e){try{return t(e)}catch(t){return I.error=t,I}}(n,i))===I?(f=!0,s=a.error,a.error=null):u=!0,r===a)return void d(r,new TypeError("A promises callback cannot return that same promise."))}else a=i,u=!0;r._state!==U||(o&&u?h(r,a):f?d(r,s):e===O?l(r,a):e===C&&d(r,a))}function v(t){t[R]=M++,t._state=void 0,t._result=void 0,t._subscribers=[]}var m=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},w=0,b=void 0,_=void 0,k=function(t,e){P[w]=t,P[w+1]=e,2===(w+=2)&&(_?_(i):B())},E="undefined"!=typeof window?window:void 0,A=E||{},S=A.MutationObserver||A.WebKitMutationObserver,T="undefined"==typeof self&&void 0!==e&&"[object process]"==={}.toString.call(e),x="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,P=new Array(1e3),B=void 0;B=T?function(){return e.nextTick(i)}:S?function(){var t=0,e=new S(i),r=document.createTextNode("");return e.observe(r,{characterData:!0}),function(){r.data=t=++t%2}}():x?function(){var t=new MessageChannel;return t.port1.onmessage=i,function(){return t.port2.postMessage(0)}}():void 0===E?function(){try{var t=Function("return this")().require("vertx");return void 0!==(b=t.runOnLoop||t.runOnContext)?function(){b(i)}:n()}catch(t){return n()}}():n();var R=Math.random().toString(36).substring(2),U=void 0,O=1,C=2,I={error:null},M=0,D=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(s),this.promise[R]||v(this.promise),m(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?l(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&l(this.promise,this._result))):d(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===U&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var r=this._instanceConstructor,n=r.resolve;if(n===a){var i=u(t);if(i===o&&t._state!==U)this._settledAt(t._state,e,t._result);else if("function"!=typeof i)this._remaining--,this._result[e]=t;else if(r===N){var h=new r(s);f(h,t,i),this._willSettleAt(h,e)}else this._willSettleAt(new r(function(e){return e(t)}),e)}else this._willSettleAt(n(t),e)},t.prototype._settledAt=function(t,e,r){var n=this.promise;n._state===U&&(this._remaining--,t===C?d(n,r):this._result[e]=r),0===this._remaining&&l(n,this._result)},t.prototype._willSettleAt=function(t,e){var r=this;p(t,void 0,function(t){return r._settledAt(O,e,t)},function(t){return r._settledAt(C,e,t)})},t}(),N=function(){function e(t){this[R]=M++,this._result=this._state=void 0,this._subscribers=[],s!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(t,e){try{e(function(e){h(t,e)},function(e){d(t,e)})}catch(e){d(t,e)}}(this,t):function(){throw new TypeError("Failed to construct \'Promise\': Please use the \'new\' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.finally=function(e){var r=this,n=r.constructor;return t(e)?r.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})}):r.then(e,e)},e}();return N.prototype.then=o,N.all=function(t){return new D(this,t).promise},N.race=function(t){var e=this;return new e(m(t)?function(r,n){for(var i=t.length,o=0;o<i;o++)e.resolve(t[o]).then(r,n)}:function(t,e){return e(new TypeError("You must pass an array to race."))})},N.resolve=a,N.reject=function(t){var e=new this(s);return d(e,t),e},N._setScheduler=function(t){_=t},N._setAsap=function(t){k=t},N._asap=k,N.polyfill=function(){var t=void 0;if(void 0!==r)t=r;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===n&&!e.cast)return}t.Promise=N},N.Promise=N,N.polyfill(),N}()}).call(this,r(15),r(0))},function(t,e){var r,n,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(r===setTimeout)return setTimeout(t,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(t){r=o}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(t){n=a}}();var u,f=[],h=!1,c=-1;function l(){h&&u&&(h=!1,u.length?f=u.concat(f):c=-1,f.length&&d())}function d(){if(!h){var t=s(l);h=!0;for(var e=f.length;e;){for(u=f,f=[];++c<e;)u&&u[c].run();c=-1,e=f.length}u=null,h=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function g(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];f.push(new p(t,e)),1!==f.length||h||s(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}}]);',r.p+"ff78057be6bb8e2b9e61.worker.js")}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0},i=u(r(19)),a=u(r(41)),s=u(r(23));function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(e,r){var n=r.name,o=r.forest,i=r.earthScale,a=r.earthResolution,s=r.position,u=void 0===s?{lng:114,lat:22.25}:s,l=r.osgInfo,c=r.loadWorker,f=r.onTileDownloaded;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var h=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,{name:n,forest:o,earthScale:i,earthResolution:a,position:u}));h.osgInfo=l,h.loadWorker=c,h.onTileDownloaded=f;var d=l.modelTransform,p=d.position,v=d.quaternion,y=d.scale;return h.displayHolder.position.copy(p),h.displayHolder.quaternion.copy(v),h.displayHolder.scale.copy(y),h.displayHolder.updateMatrix(),h}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),n(t,[{key:"destruct",value:function(){return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"import",value:function(){var e=this.osgInfo;return this._createTree(e)}},{key:"_createTree",value:function(e){if(!e||!e.valid)return Promise.reject(new Error("Invalid osgInfo."));var t=this._treeNode,r=e.name,n=e.maxLevel,o=e.minLevel,i={onTileDownloaded:this.onTileDownloaded};return this._tree=new a.default(s.default,{name:r,sceneGraphRoot:t,maxLevel:n,minLevel:o,debug:!1,eventHandlers:i,osgInfo:e,loadWorker:this.loadWorker}),this._tree.visible=this.visible,this._forest.add(this._tree),this._tree.initialized}},{key:"pid",get:function(){return this.osgInfo.id}},{key:"projInfo",get:function(){return this.osgInfo}},{key:"visible",set:function(e){!function e(t,r,n,o){var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);null!==a&&e(a,r,n,o)}else if("value"in i&&i.writable)i.value=n;else{var s=i.set;void 0!==s&&s.call(o,n)}return n}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visible",e,this),this._tree&&(this._tree.visible=e)},get:function(){return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"visible",this)}}]),t}();t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(r(17)),i=r(21);var a=function(e){function t(e){var r=e.key,n=e.value,o=e.weight,i=void 0===o?100:o,a=e.is404,s=void 0!==a&&a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var u=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{key:r,value:n,weight:i}));return u._is404=s,u}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),n(t,[{key:"destruct",value:function(){this.is404||(this._value.geometry.dispose(),this._value.material&&((0,i.disposeMap)(this._value.material),(0,i.disposeMaterial)(this._value.material),this._value.material=null),this._value.nextLevelParams=null);return function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"valid",get:function(){return this.is404||this._value}},{key:"is404",get:function(){return this._is404}}]),t}();t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isOnPlane=t.boxScreenArea=void 0;var n=r(0),o=r(14);function i(e){var t={front:!1,back:!1};return e.forEach(function(e){if(e.z>=1)t.back=!0;else{if(!(e.z<1&&e.z>0))return!1;t.front=!0}}),t.front&&t.back}t.boxScreenArea=function(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=[{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],s=[e.min.x,e.max.x],u=[e.min.y,e.max.y],l=[e.min.z,e.max.z],c=[],f=0;f<2;f++)for(var h=0;h<2;h++)for(var d=0;d<2;d++)c.push(new n.Vector3(s[f],u[h],l[d]).applyMatrix4(t));return[[0,1,3,2],[1,5,7,3],[5,4,6,7],[0,2,6,4],[2,3,7,6],[1,0,4,5]].reduce(function(e,t){var n=t.map(function(e){return c[e]}),s=0;return s=i(n)?Math.max(.1,1/(r+.1)):(0,o.polygonIntersectArea)(a,n),Math.max(0,s)+e},0)},t.isOnPlane=i},function(e,t){
/*!
 * normalize-path <https://github.com/jonschlinkert/normalize-path>
 *
 * Copyright (c) 2014-2018, Jon Schlinkert.
 * Released under the MIT License.
 */
e.exports=function(e,t){if("string"!=typeof e)throw new TypeError("expected path to be a string");if("\\"===e||"/"===e)return"/";var r=e.length;if(r<=1)return e;var n="";if(r>4&&"\\"===e[3]){var o=e[2];"?"!==o&&"."!==o||"\\\\"!==e.slice(0,2)||(e=e.slice(2),n="//")}var i=e.split(/[/\\]+/);return!1!==t&&""===i[i.length-1]&&i.pop(),n+i.join("/")}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(r(99));var i=function(){function e(){var t=this,r=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).workerSize,n=void 0===r?6:r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.listeners=new Map,this.workerSize=n,this.workers=[],this.jobs=[];for(var i=function(e){t.workers.push(new o.default),t.jobs.push(0),t.workers[e].onmessage=function(r){var n=r.data.resourceKey,o=r.data.status,i=r.data.payload;if(t.listeners.has(n)){var a=t.listeners.get(n);t.listeners.delete(n),a.forEach(function(e){var t=e.resolve,r=e.reject;if(0===o)r(i);else if(1===o)t(i);else{var n="uknown worker status";console.error(n,o),r(new Error(n))}})}else console.error("Worker cannot find callback for tile",n);t.jobs[e]--},t.workers[e].onerror=function(e){console.error("OSGLoader",e)}},a=0;a<this.workerSize;a++)i(a)}return n(e,[{key:"destruct",value:function(){return this.listeners.clear(),this.terminate()}},{key:"terminate",value:function(){var e=!0;if(this.workers&&this.workers.length>0)try{e=this.workers.reduce(function(e,t){return t.terminate()&&e},!0),this.workers=[],this.jobs=[]}catch(e){return console.error("LoadWorker terminate failed",e),!1}return e}},{key:"load",value:function(e){var t=this,r=e.resourceKey,n=e.timeout,o=void 0===n?3e4:n;return new Promise(function(e,n){var i={resolve:e,reject:n};if(t.listeners.has(r)){t.listeners.get(r).push(i)}else{t.listeners.set(r,[i]);var a={resourceKey:r,timeout:o},s=t.jobs.reduce(function(e,t,r,n){return t<n[e]?r:e},0);t.jobs[s]++,t.workers[s].postMessage(a)}})}}]),e}();t.default=i},function(e,t,r){e.exports=function(){return r(40)('!function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=1)}([function(t,e){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";var n=r(2);r(13),onmessage=function(t){var e=t.data.resourceKey,r=t.data.timeout;return(0,n.downloadSerialized)({url:e,timeout:r}).then(function(t){postMessage({resourceKey:e,status:1,payload:t})}).catch(function(t){console.warn("osg worker",t),postMessage({resourceKey:e,status:0,payload:t.message})})},onerror=function(t){throw console.error("BundleLoader onerror",t),t}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.downloadSerialized=void 0;var n=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=r(3),o=r(4);function a(t,e){var r=new(0,t[0][e].constructor)(t.reduce(function(t,r){return t+r[e].length},0)),n=0;return t.forEach(function(t){t[e]&&(r.set(t[e],n),n+=t[e].length)}),r}e.downloadSerialized=function(t){var e=t.url,r=t.trials,s=void 0===r?3:r,u=t.timeout;return(0,o.downloadEntries)({url:e,trials:s,timeout:u}).then(function(t){var e=null,r={};for(var n in t)n.endsWith(".osgjs")?e=t[n]:n.endsWith(".jpg")&&(r[n]=t[n]);return e?Promise.all([(0,i.osgJsonReader)(e),r]):Promise.reject(new Error("No osgjs."))}).then(function(t){var e=n(t,2),r=e[0],o=e[1],s=r.geometry,u=s.map(function(t){return function(t){for(var e=t.Vertex,r=[-1/0,-1/0,-1/0],n=[1/0,1/0,1/0],i=0,o=e.length;i<o;i+=3)for(var a=0;a<3;a++){var s=e[i+a];s>r[a]&&(r[a]=s),s<n[a]&&(n[a]=s)}return{max:r,min:n}}(t)}),f=r.nextLevelParams,h=function(t){if(0!==t.length){var e={},r=[],n={};t.forEach(function(t,e){var i=h(t.StateSet),o=function(t){return t.TextureAttributeList&&t.TextureAttributeList[0]&&t.TextureAttributeList[0][0]&&t.TextureAttributeList[0][0]["osg.Texture"]&&t.TextureAttributeList[0][0]["osg.Texture"].File&&t.TextureAttributeList[0][0]["osg.Texture"].File.length>0?t.TextureAttributeList[0][0]["osg.Texture"].File:void 0}(t.StateSet);if(void 0!==n[i]){var a=n[i];!r[a].map_Kd&&o&&(r[a].map_Kd=o,delete r[a].Kd)}else{var s=r.length;n[i]=s,r[s]={Ka:[0,0,0],Ks:[0,0,0],d:1,Ns:0},o?r[s].map_Kd=o:r[s].Kd=[255,255,255]}});var o=[],s=0,u=[];for(var f in t.forEach(function(t){u.push(s),s+=t.Vertex.length/3}),t.forEach(function(t,e){s=u[e];for(var r=0,i=t.Indices.length;r<i;r++)t.Indices[r]+=s;o.push({start:s,count:t.Indices.length,materialIndex:n[h(t.StateSet)]})}),t[0])"StateSet"!==f&&(e[f]=a(t,f));return{osgGeometry:new i.OsgGeometry(e),groups:o,materials:r}}function h(t){return t.UniqueID}console.error("Empty osg geometry")}(s),l=h.osgGeometry,c=h.groups,d=h.materials,p=function(t){for(var e=t[0].max,r=t[0].min,n=1,i=t.length;n<i;n++)for(var o=t[n],a=0;a<3;a++)o.max[a]>e[a]&&(e[a]=o.max[a]),o.min[a]<r[a]&&(r[a]=o.min[a]);return{max:e,min:r}}(u);if(f.length===u.length)for(var g=0,y=f.length;g<y;g++)f[g].estimatedBBox=u[g];else for(var v=0,w=f.length;v<w;v++)f[v].estimatedBBox=p;var m={osgGeometry:l,groups:c,materials:d,nextLevelParams:f,images:o,bbox:p};return Promise.resolve(m)})}},function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function t(e){var r=e.RangeDataList,i=e.UserCenter;n(this,t),r["File 0"]&&".osgjs"===r["File 0"]&&r["File 1"]&&r["File 1"].endsWith(".osgjs")||console.warn("Unexpected",r);var o=r["File 1"]?r["File 1"]:r["File 0"];this.fileName=o.replace(/\\.[^/.]+$/,".ab"),this.userCenter=i,this.estimatedBBox=null},o=function t(e){n(this,t),Object.assign(this,e)},a=function t(e){var r=e.Indices,i=e.Vertex,o=e.TexCoord0,a=e.StateSet;n(this,t),this.Indices=r,this.Vertex=i,this.TexCoord0=o,this.StateSet=a};function s(t){return t["osg.Node"]?function(t){return u(t.Children,{geometry:[],nextLevelParams:[]})}(t["osg.Node"]):t["osg.PagedLOD"]?function(t){var e=t.Children,r=t.RangeDataList,n=t.UserCenter,o=new i({RangeDataList:r,UserCenter:n}),a={geometry:[],nextLevelParams:".ab"===o.fileName?[]:[o]};return u(e,a)}(t["osg.PagedLOD"]):t["osg.Geometry"]?function(t){var e=new Uint32Array(t.PrimitiveSetList[0].DrawElementsUInt.Indices.Array.Uint32Array.Elements),r=new Float32Array(t.VertexAttributeList.TexCoord0.Array.Float32Array.Elements),n=new Float32Array(t.VertexAttributeList.Vertex.Array.Float32Array.Elements),i=new o(t.StateSet["osg.StateSet"]);return{geometry:[new a({Indices:e,TexCoord0:r,Vertex:n,StateSet:i})],nextLevelParams:[]}}(t["osg.Geometry"]):void console.error("Unknown structure",t)}function u(t,e){return t&&t instanceof Array&&t.length>0?t.reduce(function(t,e,r){return function(t,e){return{geometry:t.geometry.concat(e.geometry),nextLevelParams:t.nextLevelParams.concat(e.nextLevelParams)}}(t,s(e))},e):e}e.osgJsonReader=function(t){"OpenSceneGraph 3.1.7"===t.Generator&&9===t.Version||console.warn(t.Generator,"version: ",t.Version,"may not be supported.");var e=s(t);return Promise.resolve(e)},e.OsgGeometry=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.downloadEntries=e.readBundle=e.readImageData=e.readPNG=e.downloadPNG=void 0;var n=o(r(5)),i=o(r(12));function o(t){return t&&t.__esModule?t:{default:t}}function a(t){var e=t.url,r=t.timeout,n=new XMLHttpRequest;return n.open("GET",e,!0),n.timeout=r,n.responseType="arraybuffer",new Promise(function(t,e){n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status){var r=n.response;t(r)}else e(new Error(n.status.toString()))},n.send()})}function s(t){return new Promise(function(e,r){new n.default(t).parse(function(t,n){t?(console.error(t),r(new Error("readPNG"))):e(n)})})}function u(t){var e=t.pixels,r=t.imgWidth,n=t.imgHeight;try{var o=new i.default;return o.parseBundle(e,r,n,{}),Promise.resolve(o)}catch(t){return console.error(t),Promise.reject(new Error("readImageData"))}}function f(t){return new Promise(function(e,r){try{var n={};t.entries.map(function(e){var r=void 0,i=e.path;i.endsWith(".osgjs")?r=t.readJSON(i):i.endsWith(".jpg")?r=t.readImg(i):i.endsWith(".aa")?r=decodeURIComponent(escape(t.readText(i))):i.endsWith(".txt")?r=t.readJSON(i):i.endsWith(".info")?r=t.readJSON(i):console.warn("unknown entry",e.path),n[i]=r}),t.clearData(),e(n)}catch(e){t.clearData(),console.error(e),r(new Error("readBundle"))}})}e.downloadPNG=a,e.readPNG=s,e.readImageData=u,e.readBundle=f,e.downloadEntries=function(t){var e=t.url,r=t.trials,n=void 0===r?3:r,i=t.timeout;return function t(e){var r=e.trials,n=e.url,i=e.timeout;return r<=0?Promise.reject(new Error("0")):a({url:n,timeout:i}).catch(function(e){return i*=2,--r<=0?Promise.reject(e):"404"===e.message||"403"===e.message?Promise.reject(e):t({trials:r,url:n,timeout:i})})}({trials:n,url:e,timeout:void 0===i?3e4:i}).then(function(t){return s(t)}).then(function(t){return u({pixels:t.pixels,imgWidth:t.getWidth(),imgHeight:t.getHeight()})}).then(function(t){return f(t)}).catch(function(t){return"readPNG"===t.message||"readImageData"===t.message||"readBundle"===t.message?Promise.reject(new Error("downloadEntries")):Promise.reject(t)})}},function(t,e,r){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=r(10),o=function(t){return t&&t.__esModule?t:{default:t}}(r(11));var a=Array.prototype.slice,s=Object.prototype.toString;function u(t,e){return(t[e]<<24)+(t[e+1]<<16)+(t[e+2]<<8)+(t[e+3]<<0)}function f(t,e){return t[e]<<0}function h(t){if("string"==typeof t){var e=t;t=new Array(e.length);for(var r=0,n=e.length;r<n;r++)t[r]=e[r].charCodeAt(0)}else{"ArrayBuffer"===s.call(t).slice(8,-1)&&(t=new Uint8Array(t))}this.i=0,this.bytes=t,this.png=new o.default,this.dataChunks=[]}h.prototype.readBytes=function(t){var e=this.i+t;if(e>this.bytes.length)throw new Error("Unexpectedly reached end of file");var r=a.call(this.bytes,this.i,e);return this.i=e,r},h.prototype.decodeHeader=function(){if(0!==this.i)throw new Error("file pointer should be at 0 to read the header");var t=this.readBytes(8);if(!function(t,e){if(t.length!==e.length)return!1;for(var r=t.length;r--;)if(t[r]!==e[r])return!1;return!0}(t,[137,80,78,71,13,10,26,10]))throw new Error("invalid PNGReader file (bad signature)");this.header=t},h.prototype.decodeChunk=function(){var t=u(this.readBytes(4),0);if(t<0)throw new Error("Bad chunk length "+(4294967295&t));var e=function(t){for(var e="",r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e}(this.readBytes(4)),r=this.readBytes(t);this.readBytes(4);switch(e){case"IHDR":this.decodeIHDR(r);break;case"PLTE":this.decodePLTE(r);break;case"IDAT":this.decodeIDAT(r);break;case"IEND":this.decodeIEND(r)}return e},h.prototype.decodeIHDR=function(t){var e=this.png;e.setWidth(u(t,0)),e.setHeight(u(t,4)),e.setBitDepth(f(t,8)),e.setColorType(f(t,9)),e.setCompressionMethod(f(t,10)),e.setFilterMethod(f(t,11)),e.setInterlaceMethod(f(t,12))},h.prototype.decodePLTE=function(t){this.png.setPalette(t)},h.prototype.decodeIDAT=function(t){this.dataChunks.push(t)},h.prototype.decodeIEND=function(){},h.prototype.decodePixels=function(e){var r,n,o,a,s=this.png,u=this,f=0;for(a=this.dataChunks.length;a--;)f+=this.dataChunks[a].length;var h=new t(f);for(r=0,o=0,a=this.dataChunks.length;r<a;r++){var l=this.dataChunks[r];for(n=0;n<l.length;n++)h[o++]=l[n]}!function(t,e){try{e(null,(0,i.inflate)(t))}catch(t){e(t)}}(h,function(t,r){if(t)return e(t);try{0===s.getInterlaceMethod()?u.interlaceNone(r):u.interlaceAdam7(r)}catch(t){return e(t)}e()})},h.prototype.interlaceNone=function(e){for(var r,n=this.png,i=Math.max(1,n.colors*n.bitDepth/8),o=i*n.width,s=new t(i*n.width*n.height),u=0,h=0;h<e.length;h+=o+1){switch(r=a.call(e,h+1,h+o+1),f(e,h)){case 0:this.unFilterNone(r,s,i,u,o);break;case 1:this.unFilterSub(r,s,i,u,o);break;case 2:this.unFilterUp(r,s,i,u,o);break;case 3:this.unFilterAverage(r,s,i,u,o);break;case 4:this.unFilterPaeth(r,s,i,u,o);break;default:throw new Error("unkown filtered scanline")}u+=o}n.pixels=s},h.prototype.interlaceAdam7=function(t){throw new Error("Adam7 interlacing is not implemented yet")},h.prototype.unFilterNone=function(t,e,r,n,i){for(var o=0,a=i;o<a;o++)e[n+o]=t[o]},h.prototype.unFilterSub=function(t,e,r,n,i){for(var o=0;o<r;o++)e[n+o]=t[o];for(;o<i;o++)e[n+o]=t[o]+e[n+o-r]&255},h.prototype.unFilterUp=function(t,e,r,n,i){var o=0;if(n-i<0)for(;o<i;o++)e[n+o]=t[o];else for(;o<i;o++){var a=t[o],s=e[n+o-i];e[n+o]=a+s&255}},h.prototype.unFilterAverage=function(t,e,r,n,i){var o=0;if(n-i<0){for(;o<r;o++)e[n+o]=t[o];for(;o<i;o++)e[n+o]=t[o]+(e[n+o-r]>>1)&255}else{for(;o<r;o++)e[n+o]=t[o]+(e[n-i+o]>>1)&255;for(;o<i;o++){var a=t[o],s=e[n+o-r],u=e[n+o-i];e[n+o]=a+(s+u>>1)&255}}},h.prototype.unFilterPaeth=function(t,e,r,n,i){var o=0;if(n-i<0){for(;o<r;o++)e[n+o]=t[o];for(;o<i;o++)e[n+o]=t[o]+e[n+o-r]&255}else{for(;o<r;o++)e[n+o]=t[o]+e[n+o-i]&255;for(;o<i;o++){var a=t[o],s=e[n+o-r],u=e[n+o-i],f=e[n+o-i-r],h=s+u-f,l=Math.abs(h-s),c=Math.abs(h-u),d=Math.abs(h-f),p=void 0;p=l<=c&&l<=d?s:c<=d?u:f,e[n+o]=a+p&255}}},h.prototype.parse=function(t,e){"function"==typeof t&&(e=t),"object"!==(void 0===t?"undefined":n(t))&&(t={});try{for(this.decodeHeader();this.i<this.bytes.length;){var r=this.decodeChunk();if("IHDR"===r&&!1===t.data||"IEND"===r)break}var i=this.png;this.decodePixels(function(t){e(t,i)})}catch(t){e(t)}},e.default=h}).call(this,r(6).Buffer)},function(t,e,r){"use strict";(function(t){\n/*!\n * The buffer module from node.js, for the browser.\n *\n * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>\n * @license  MIT\n */\nvar n=r(7),i=r(8),o=r(9);function a(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(t,e){if(a()<e)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=u.prototype:(null===t&&(t=new u(e)),t.length=e),t}function u(t,e,r){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(t,e,r);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return l(this,t)}return f(this,t,e,r)}function f(t,e,r,n){if("number"==typeof e)throw new TypeError(\'"value" argument must not be a number\');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,r,n){if(e.byteLength,r<0||e.byteLength<r)throw new RangeError("\'offset\' is out of bounds");if(e.byteLength<r+(n||0))throw new RangeError("\'length\' is out of bounds");e=void 0===r&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,r):new Uint8Array(e,r,n);u.TYPED_ARRAY_SUPPORT?(t=e).__proto__=u.prototype:t=c(t,e);return t}(t,e,r,n):"string"==typeof e?function(t,e,r){"string"==typeof r&&""!==r||(r="utf8");if(!u.isEncoding(r))throw new TypeError(\'"encoding" must be a valid string encoding\');var n=0|p(e,r),i=(t=s(t,n)).write(e,r);i!==n&&(t=t.slice(0,i));return t}(t,e,r):function(t,e){if(u.isBuffer(e)){var r=0|d(e.length);return 0===(t=s(t,r)).length?t:(e.copy(t,0,0,r),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||function(t){return t!=t}(e.length)?s(t,0):c(t,e);if("Buffer"===e.type&&o(e.data))return c(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function h(t){if("number"!=typeof t)throw new TypeError(\'"size" argument must be a number\');if(t<0)throw new RangeError(\'"size" argument must not be negative\')}function l(t,e){if(h(e),t=s(t,e<0?0:0|d(e)),!u.TYPED_ARRAY_SUPPORT)for(var r=0;r<e;++r)t[r]=0;return t}function c(t,e){var r=e.length<0?0:0|d(e.length);t=s(t,r);for(var n=0;n<r;n+=1)t[n]=255&e[n];return t}function d(t){if(t>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|t}function p(t,e){if(u.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var r=t.length;if(0===r)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return j(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return Y(t).length;default:if(n)return j(t).length;e=(""+e).toLowerCase(),n=!0}}function g(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function y(t,e,r,n,i){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return-1;r=t.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof e&&(e=u.from(e,n)),u.isBuffer(e))return 0===e.length?-1:v(t,e,r,n,i);if("number"==typeof e)return e&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):v(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function v(t,e,r,n,i){var o,a=1,s=t.length,u=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;a=2,s/=2,u/=2,r/=2}function f(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}if(i){var h=-1;for(o=r;o<s;o++)if(f(t,o)===f(e,-1===h?0:o-h)){if(-1===h&&(h=o),o-h+1===u)return h*a}else-1!==h&&(o-=o-h),h=-1}else for(r+u>s&&(r=s-u),o=r;o>=0;o--){for(var l=!0,c=0;c<u;c++)if(f(t,o+c)!==f(e,c)){l=!1;break}if(l)return o}return-1}function w(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var a=0;a<n;++a){var s=parseInt(e.substr(2*a,2),16);if(isNaN(s))return a;t[r+a]=s}return a}function m(t,e,r,n){return Z(j(e,t.length-r),t,r,n)}function b(t,e,r,n){return Z(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,n)}function _(t,e,r,n){return b(t,e,r,n)}function E(t,e,r,n){return Z(Y(e),t,r,n)}function k(t,e,r,n){return Z(function(t,e){for(var r,n,i,o=[],a=0;a<t.length&&!((e-=2)<0);++a)r=t.charCodeAt(a),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(e,t.length-r),t,r,n)}function A(t,e,r){return 0===e&&r===t.length?n.fromByteArray(t):n.fromByteArray(t.slice(e,r))}function x(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var o,a,s,u,f=t[i],h=null,l=f>239?4:f>223?3:f>191?2:1;if(i+l<=r)switch(l){case 1:f<128&&(h=f);break;case 2:128==(192&(o=t[i+1]))&&(u=(31&f)<<6|63&o)>127&&(h=u);break;case 3:o=t[i+1],a=t[i+2],128==(192&o)&&128==(192&a)&&(u=(15&f)<<12|(63&o)<<6|63&a)>2047&&(u<55296||u>57343)&&(h=u);break;case 4:o=t[i+1],a=t[i+2],s=t[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(u=(15&f)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&u<1114112&&(h=u)}null===h?(h=65533,l=1):h>65535&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|1023&h),n.push(h),i+=l}return function(t){var e=t.length;if(e<=S)return String.fromCharCode.apply(String,t);var r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=S));return r}(n)}e.Buffer=u,e.SlowBuffer=function(t){+t!=t&&(t=0);return u.alloc(+t)},e.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=a(),u.poolSize=8192,u._augment=function(t){return t.__proto__=u.prototype,t},u.from=function(t,e,r){return f(null,t,e,r)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(t,e,r){return function(t,e,r,n){return h(e),e<=0?s(t,e):void 0!==r?"string"==typeof n?s(t,e).fill(r,n):s(t,e).fill(r):s(t,e)}(null,t,e,r)},u.allocUnsafe=function(t){return l(null,t)},u.allocUnsafeSlow=function(t){return l(null,t)},u.isBuffer=function(t){return!(null==t||!t._isBuffer)},u.compare=function(t,e){if(!u.isBuffer(t)||!u.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,n=e.length,i=0,o=Math.min(r,n);i<o;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},u.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(t,e){if(!o(t))throw new TypeError(\'"list" argument must be an Array of Buffers\');if(0===t.length)return u.alloc(0);var r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var n=u.allocUnsafe(e),i=0;for(r=0;r<t.length;++r){var a=t[r];if(!u.isBuffer(a))throw new TypeError(\'"list" argument must be an Array of Buffers\');a.copy(n,i),i+=a.length}return n},u.byteLength=p,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)g(this,e,e+1);return this},u.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)g(this,e,e+3),g(this,e+1,e+2);return this},u.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)g(this,e,e+7),g(this,e+1,e+6),g(this,e+2,e+5),g(this,e+3,e+4);return this},u.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?x(this,0,t):function(t,e,r){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return P(this,e,r);case"utf8":case"utf-8":return x(this,e,r);case"ascii":return T(this,e,r);case"latin1":case"binary":return B(this,e,r);case"base64":return A(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}.apply(this,arguments)},u.prototype.equals=function(t){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===u.compare(this,t)},u.prototype.inspect=function(){var t="",r=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(t+=" ... ")),"<Buffer "+t+">"},u.prototype.compare=function(t,e,r,n,i){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),e<0||r>t.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&e>=r)return 0;if(n>=i)return-1;if(e>=r)return 1;if(e>>>=0,r>>>=0,n>>>=0,i>>>=0,this===t)return 0;for(var o=i-n,a=r-e,s=Math.min(o,a),f=this.slice(n,i),h=t.slice(e,r),l=0;l<s;++l)if(f[l]!==h[l]){o=f[l],a=h[l];break}return o<a?-1:a<o?1:0},u.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},u.prototype.indexOf=function(t,e,r){return y(this,t,e,r,!0)},u.prototype.lastIndexOf=function(t,e,r){return y(this,t,e,r,!1)},u.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-e;if((void 0===r||r>i)&&(r=i),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return w(this,t,e,r);case"utf8":case"utf-8":return m(this,t,e,r);case"ascii":return b(this,t,e,r);case"latin1":case"binary":return _(this,t,e,r);case"base64":return E(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,t,e,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var S=4096;function T(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}function B(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function P(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=e;o<r;++o)i+=F(t[o]);return i}function R(t,e,r){for(var n=t.slice(e,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function U(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function C(t,e,r,n,i,o){if(!u.isBuffer(t))throw new TypeError(\'"buffer" argument must be a Buffer instance\');if(e>i||e<o)throw new RangeError(\'"value" argument is out of bounds\');if(r+n>t.length)throw new RangeError("Index out of range")}function I(t,e,r,n){e<0&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-r,2);i<o;++i)t[r+i]=(e&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function O(t,e,r,n){e<0&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-r,4);i<o;++i)t[r+i]=e>>>8*(n?i:3-i)&255}function L(t,e,r,n,i,o){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function M(t,e,r,n,o){return o||L(t,0,r,4),i.write(t,e,r,n,23,4),r+4}function D(t,e,r,n,o){return o||L(t,0,r,8),i.write(t,e,r,n,52,8),r+8}u.prototype.slice=function(t,e){var r,n=this.length;if(t=~~t,e=void 0===e?n:~~e,t<0?(t+=n)<0&&(t=0):t>n&&(t=n),e<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t),u.TYPED_ARRAY_SUPPORT)(r=this.subarray(t,e)).__proto__=u.prototype;else{var i=e-t;r=new u(i,void 0);for(var o=0;o<i;++o)r[o]=this[o+t]}return r},u.prototype.readUIntLE=function(t,e,r){t|=0,e|=0,r||U(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n},u.prototype.readUIntBE=function(t,e,r){t|=0,e|=0,r||U(t,e,this.length);for(var n=this[t+--e],i=1;e>0&&(i*=256);)n+=this[t+--e]*i;return n},u.prototype.readUInt8=function(t,e){return e||U(t,1,this.length),this[t]},u.prototype.readUInt16LE=function(t,e){return e||U(t,2,this.length),this[t]|this[t+1]<<8},u.prototype.readUInt16BE=function(t,e){return e||U(t,2,this.length),this[t]<<8|this[t+1]},u.prototype.readUInt32LE=function(t,e){return e||U(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},u.prototype.readUInt32BE=function(t,e){return e||U(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},u.prototype.readIntLE=function(t,e,r){t|=0,e|=0,r||U(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*e)),n},u.prototype.readIntBE=function(t,e,r){t|=0,e|=0,r||U(t,e,this.length);for(var n=e,i=1,o=this[t+--n];n>0&&(i*=256);)o+=this[t+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*e)),o},u.prototype.readInt8=function(t,e){return e||U(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},u.prototype.readInt16LE=function(t,e){e||U(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt16BE=function(t,e){e||U(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt32LE=function(t,e){return e||U(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},u.prototype.readInt32BE=function(t,e){return e||U(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},u.prototype.readFloatLE=function(t,e){return e||U(t,4,this.length),i.read(this,t,!0,23,4)},u.prototype.readFloatBE=function(t,e){return e||U(t,4,this.length),i.read(this,t,!1,23,4)},u.prototype.readDoubleLE=function(t,e){return e||U(t,8,this.length),i.read(this,t,!0,52,8)},u.prototype.readDoubleBE=function(t,e){return e||U(t,8,this.length),i.read(this,t,!1,52,8)},u.prototype.writeUIntLE=function(t,e,r,n){(t=+t,e|=0,r|=0,n)||C(this,t,e,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[e]=255&t;++o<r&&(i*=256);)this[e+o]=t/i&255;return e+r},u.prototype.writeUIntBE=function(t,e,r,n){(t=+t,e|=0,r|=0,n)||C(this,t,e,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+r},u.prototype.writeUInt8=function(t,e,r){return t=+t,e|=0,r||C(this,t,e,1,255,0),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},u.prototype.writeUInt16LE=function(t,e,r){return t=+t,e|=0,r||C(this,t,e,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):I(this,t,e,!0),e+2},u.prototype.writeUInt16BE=function(t,e,r){return t=+t,e|=0,r||C(this,t,e,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):I(this,t,e,!1),e+2},u.prototype.writeUInt32LE=function(t,e,r){return t=+t,e|=0,r||C(this,t,e,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):O(this,t,e,!0),e+4},u.prototype.writeUInt32BE=function(t,e,r){return t=+t,e|=0,r||C(this,t,e,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):O(this,t,e,!1),e+4},u.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);C(this,t,e,r,i-1,-i)}var o=0,a=1,s=0;for(this[e]=255&t;++o<r&&(a*=256);)t<0&&0===s&&0!==this[e+o-1]&&(s=1),this[e+o]=(t/a>>0)-s&255;return e+r},u.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);C(this,t,e,r,i-1,-i)}var o=r-1,a=1,s=0;for(this[e+o]=255&t;--o>=0&&(a*=256);)t<0&&0===s&&0!==this[e+o+1]&&(s=1),this[e+o]=(t/a>>0)-s&255;return e+r},u.prototype.writeInt8=function(t,e,r){return t=+t,e|=0,r||C(this,t,e,1,127,-128),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},u.prototype.writeInt16LE=function(t,e,r){return t=+t,e|=0,r||C(this,t,e,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):I(this,t,e,!0),e+2},u.prototype.writeInt16BE=function(t,e,r){return t=+t,e|=0,r||C(this,t,e,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):I(this,t,e,!1),e+2},u.prototype.writeInt32LE=function(t,e,r){return t=+t,e|=0,r||C(this,t,e,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):O(this,t,e,!0),e+4},u.prototype.writeInt32BE=function(t,e,r){return t=+t,e|=0,r||C(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):O(this,t,e,!1),e+4},u.prototype.writeFloatLE=function(t,e,r){return M(this,t,e,!0,r)},u.prototype.writeFloatBE=function(t,e,r){return M(this,t,e,!1,r)},u.prototype.writeDoubleLE=function(t,e,r){return D(this,t,e,!0,r)},u.prototype.writeDoubleBE=function(t,e,r){return D(this,t,e,!1,r)},u.prototype.copy=function(t,e,r,n){if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var i,o=n-r;if(this===t&&r<e&&e<n)for(i=o-1;i>=0;--i)t[i+e]=this[i+r];else if(o<1e3||!u.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+e]=this[i+r];else Uint8Array.prototype.set.call(t,this.subarray(r,r+o),e);return o},u.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!u.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;var o;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(o=e;o<r;++o)this[o]=t;else{var a=u.isBuffer(t)?t:j(new u(t,n).toString()),s=a.length;for(o=0;o<r-e;++o)this[o+e]=a[o%s]}return this};var N=/[^+\\/0-9A-Za-z-_]/g;function F(t){return t<16?"0"+t.toString(16):t.toString(16)}function j(t,e){var r;e=e||1/0;for(var n=t.length,i=null,o=[],a=0;a<n;++a){if((r=t.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(a+1===n){(e-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;o.push(r)}else if(r<2048){if((e-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function Y(t){return n.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\\s+|\\s+$/g,"")}(t).replace(N,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function Z(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}}).call(this,r(0))},function(t,e,r){"use strict";e.byteLength=function(t){var e=f(t),r=e[0],n=e[1];return 3*(r+n)/4-n},e.toByteArray=function(t){for(var e,r=f(t),n=r[0],a=r[1],s=new o(function(t,e,r){return 3*(e+r)/4-r}(0,n,a)),u=0,h=a>0?n-4:n,l=0;l<h;l+=4)e=i[t.charCodeAt(l)]<<18|i[t.charCodeAt(l+1)]<<12|i[t.charCodeAt(l+2)]<<6|i[t.charCodeAt(l+3)],s[u++]=e>>16&255,s[u++]=e>>8&255,s[u++]=255&e;2===a&&(e=i[t.charCodeAt(l)]<<2|i[t.charCodeAt(l+1)]>>4,s[u++]=255&e);1===a&&(e=i[t.charCodeAt(l)]<<10|i[t.charCodeAt(l+1)]<<4|i[t.charCodeAt(l+2)]>>2,s[u++]=e>>8&255,s[u++]=255&e);return s},e.fromByteArray=function(t){for(var e,r=t.length,i=r%3,o=[],a=0,s=r-i;a<s;a+=16383)o.push(l(t,a,a+16383>s?s:a+16383));1===i?(e=t[r-1],o.push(n[e>>2]+n[e<<4&63]+"==")):2===i&&(e=(t[r-2]<<8)+t[r-1],o.push(n[e>>10]+n[e>>4&63]+n[e<<2&63]+"="));return o.join("")};for(var n=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,u=a.length;s<u;++s)n[s]=a[s],i[a.charCodeAt(s)]=s;function f(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=e),[r,r===e?0:4-r%4]}function h(t){return n[t>>18&63]+n[t>>12&63]+n[t>>6&63]+n[63&t]}function l(t,e,r){for(var n,i=[],o=e;o<r;o+=3)n=(t[o]<<16&16711680)+(t[o+1]<<8&65280)+(255&t[o+2]),i.push(h(n));return i.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(t,e){e.read=function(t,e,r,n,i){var o,a,s=8*i-n-1,u=(1<<s)-1,f=u>>1,h=-7,l=r?i-1:0,c=r?-1:1,d=t[e+l];for(l+=c,o=d&(1<<-h)-1,d>>=-h,h+=s;h>0;o=256*o+t[e+l],l+=c,h-=8);for(a=o&(1<<-h)-1,o>>=-h,h+=n;h>0;a=256*a+t[e+l],l+=c,h-=8);if(0===o)o=1-f;else{if(o===u)return a?NaN:1/0*(d?-1:1);a+=Math.pow(2,n),o-=f}return(d?-1:1)*a*Math.pow(2,o-n)},e.write=function(t,e,r,n,i,o){var a,s,u,f=8*o-i-1,h=(1<<f)-1,l=h>>1,c=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:o-1,p=n?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=h):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),(e+=a+l>=1?c/u:c*Math.pow(2,1-l))*u>=2&&(a++,u/=2),a+l>=h?(s=0,a=h):a+l>=1?(s=(e*u-1)*Math.pow(2,i),a+=l):(s=e*Math.pow(2,l-1)*Math.pow(2,i),a=0));i>=8;t[r+d]=255&s,d+=p,s/=256,i-=8);for(a=a<<i|s,f+=i;f>0;t[r+d]=255&a,d+=p,a/=256,f-=8);t[r+d-p]|=128*g}},function(t,e){var r={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==r.call(t)}},function(t,e,r){var n;t.exports=function t(e,r,i){function o(s,u){if(!r[s]){if(!e[s]){var f="function"==typeof n&&n;if(!u&&f)return n(s,!0);if(a)return a(s,!0);var h=new Error("Cannot find module \'"+s+"\'");throw h.code="MODULE_NOT_FOUND",h}var l=r[s]={exports:{}};e[s][0].call(l.exports,function(t){var r=e[s][1][t];return o(r||t)},l,l.exports,t,e,r,i)}return r[s].exports}for(var a="function"==typeof n&&n,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(t,e,r){"use strict";function n(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;r.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var r=e.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var i in r)n(r,i)&&(t[i]=r[i])}}return t},r.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var o={arraySet:function(t,e,r,n,i){if(e.subarray&&t.subarray)t.set(e.subarray(r,r+n),i);else for(var o=0;o<n;o++)t[i+o]=e[r+o]},flattenChunks:function(t){var e,r,n,i,o,a;for(n=0,e=0,r=t.length;e<r;e++)n+=t[e].length;for(a=new Uint8Array(n),i=0,e=0,r=t.length;e<r;e++)o=t[e],a.set(o,i),i+=o.length;return a}},a={arraySet:function(t,e,r,n,i){for(var o=0;o<n;o++)t[i+o]=e[r+o]},flattenChunks:function(t){return[].concat.apply([],t)}};r.setTyped=function(t){t?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,o)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,a))},r.setTyped(i)},{}],2:[function(t,e,r){"use strict";function n(t,e){if(e<65537&&(t.subarray&&a||!t.subarray&&o))return String.fromCharCode.apply(null,i.shrinkBuf(t,e));for(var r="",n=0;n<e;n++)r+=String.fromCharCode(t[n]);return r}var i=t("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(t){o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){a=!1}for(var s=new i.Buf8(256),u=0;u<256;u++)s[u]=u>=252?6:u>=248?5:u>=240?4:u>=224?3:u>=192?2:1;s[254]=s[254]=1,r.string2buf=function(t){var e,r,n,o,a,s=t.length,u=0;for(o=0;o<s;o++)55296==(64512&(r=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(n=t.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(n-56320),o++),u+=r<128?1:r<2048?2:r<65536?3:4;for(e=new i.Buf8(u),a=0,o=0;a<u;o++)55296==(64512&(r=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(n=t.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(n-56320),o++),r<128?e[a++]=r:r<2048?(e[a++]=192|r>>>6,e[a++]=128|63&r):r<65536?(e[a++]=224|r>>>12,e[a++]=128|r>>>6&63,e[a++]=128|63&r):(e[a++]=240|r>>>18,e[a++]=128|r>>>12&63,e[a++]=128|r>>>6&63,e[a++]=128|63&r);return e},r.buf2binstring=function(t){return n(t,t.length)},r.binstring2buf=function(t){for(var e=new i.Buf8(t.length),r=0,n=e.length;r<n;r++)e[r]=t.charCodeAt(r);return e},r.buf2string=function(t,e){var r,i,o,a,u=e||t.length,f=new Array(2*u);for(i=0,r=0;r<u;)if((o=t[r++])<128)f[i++]=o;else if((a=s[o])>4)f[i++]=65533,r+=a-1;else{for(o&=2===a?31:3===a?15:7;a>1&&r<u;)o=o<<6|63&t[r++],a--;a>1?f[i++]=65533:o<65536?f[i++]=o:(o-=65536,f[i++]=55296|o>>10&1023,f[i++]=56320|1023&o)}return n(f,i)},r.utf8border=function(t,e){var r;for((e=e||t.length)>t.length&&(e=t.length),r=e-1;r>=0&&128==(192&t[r]);)r--;return r<0?e:0===r?e:r+s[t[r]]>e?r:e}},{"./common":1}],3:[function(t,e,r){"use strict";e.exports=function(t,e,r,n){for(var i=65535&t|0,o=t>>>16&65535|0,a=0;0!==r;){r-=a=r>2e3?2e3:r;do{o=o+(i=i+e[n++]|0)|0}while(--a);i%=65521,o%=65521}return i|o<<16|0}},{}],4:[function(t,e,r){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],5:[function(t,e,r){"use strict";var n=function(){for(var t,e=[],r=0;r<256;r++){t=r;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e}();e.exports=function(t,e,r,i){var o=n,a=i+r;t^=-1;for(var s=i;s<a;s++)t=t>>>8^o[255&(t^e[s])];return-1^t}},{}],6:[function(t,e,r){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],7:[function(t,e,r){"use strict";e.exports=function(t,e){var r,n,i,o,a,s,u,f,h,l,c,d,p,g,y,v,w,m,b,_,E,k,A,x,S;r=t.state,n=t.next_in,x=t.input,i=n+(t.avail_in-5),o=t.next_out,S=t.output,a=o-(e-t.avail_out),s=o+(t.avail_out-257),u=r.dmax,f=r.wsize,h=r.whave,l=r.wnext,c=r.window,d=r.hold,p=r.bits,g=r.lencode,y=r.distcode,v=(1<<r.lenbits)-1,w=(1<<r.distbits)-1;t:do{p<15&&(d+=x[n++]<<p,p+=8,d+=x[n++]<<p,p+=8),m=g[d&v];e:for(;;){if(d>>>=b=m>>>24,p-=b,0==(b=m>>>16&255))S[o++]=65535&m;else{if(!(16&b)){if(0==(64&b)){m=g[(65535&m)+(d&(1<<b)-1)];continue e}if(32&b){r.mode=12;break t}t.msg="invalid literal/length code",r.mode=30;break t}_=65535&m,(b&=15)&&(p<b&&(d+=x[n++]<<p,p+=8),_+=d&(1<<b)-1,d>>>=b,p-=b),p<15&&(d+=x[n++]<<p,p+=8,d+=x[n++]<<p,p+=8),m=y[d&w];r:for(;;){if(d>>>=b=m>>>24,p-=b,!(16&(b=m>>>16&255))){if(0==(64&b)){m=y[(65535&m)+(d&(1<<b)-1)];continue r}t.msg="invalid distance code",r.mode=30;break t}if(E=65535&m,p<(b&=15)&&(d+=x[n++]<<p,(p+=8)<b&&(d+=x[n++]<<p,p+=8)),(E+=d&(1<<b)-1)>u){t.msg="invalid distance too far back",r.mode=30;break t}if(d>>>=b,p-=b,E>(b=o-a)){if((b=E-b)>h&&r.sane){t.msg="invalid distance too far back",r.mode=30;break t}if(k=0,A=c,0===l){if(k+=f-b,b<_){_-=b;do{S[o++]=c[k++]}while(--b);k=o-E,A=S}}else if(l<b){if(k+=f+l-b,(b-=l)<_){_-=b;do{S[o++]=c[k++]}while(--b);if(k=0,l<_){_-=b=l;do{S[o++]=c[k++]}while(--b);k=o-E,A=S}}}else if(k+=l-b,b<_){_-=b;do{S[o++]=c[k++]}while(--b);k=o-E,A=S}for(;_>2;)S[o++]=A[k++],S[o++]=A[k++],S[o++]=A[k++],_-=3;_&&(S[o++]=A[k++],_>1&&(S[o++]=A[k++]))}else{k=o-E;do{S[o++]=S[k++],S[o++]=S[k++],S[o++]=S[k++],_-=3}while(_>2);_&&(S[o++]=S[k++],_>1&&(S[o++]=S[k++]))}break}}break}}while(n<i&&o<s);n-=_=p>>3,d&=(1<<(p-=_<<3))-1,t.next_in=n,t.next_out=o,t.avail_in=n<i?i-n+5:5-(n-i),t.avail_out=o<s?s-o+257:257-(o-s),r.hold=d,r.bits=p}},{}],8:[function(t,e,r){"use strict";function n(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function i(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=_,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new c.Buf32(k),e.distcode=e.distdyn=new c.Buf32(A),e.sane=1,e.back=-1,m):b}function o(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,i(t)):b}function a(t,e){var r,n;return t&&t.state?(n=t.state,e<0?(r=0,e=-e):(r=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?b:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=r,n.wbits=e,o(t))):b}function s(t,e){var r,n;return t?(n=new function(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new c.Buf16(320),this.work=new c.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0},t.state=n,n.window=null,(r=a(t,e))!==m&&(t.state=null),r):b}function u(t){if(x){var e;for(h=new c.Buf32(512),l=new c.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(y(v,t.lens,0,288,h,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;y(w,t.lens,0,32,l,0,t.work,{bits:5}),x=!1}t.lencode=h,t.lenbits=9,t.distcode=l,t.distbits=5}function f(t,e,r,n){var i,o=t.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new c.Buf8(o.wsize)),n>=o.wsize?(c.arraySet(o.window,e,r-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((i=o.wsize-o.wnext)>n&&(i=n),c.arraySet(o.window,e,r-n,i,o.wnext),(n-=i)?(c.arraySet(o.window,e,r-n,n,0),o.wnext=n,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0}var h,l,c=t("../utils/common"),d=t("./adler32"),p=t("./crc32"),g=t("./inffast"),y=t("./inftrees"),v=1,w=2,m=0,b=-2,_=1,E=12,k=852,A=592,x=!0;r.inflateReset=o,r.inflateReset2=a,r.inflateResetKeep=i,r.inflateInit=function(t){return s(t,15)},r.inflateInit2=s,r.inflate=function(t,e){var r,i,o,a,s,h,l,k,A,x,S,T,B,P,R,U,C,I,O,L,M,D,N,F,j=0,Y=new c.Buf8(4),Z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return b;(r=t.state).mode===E&&(r.mode=13),s=t.next_out,o=t.output,l=t.avail_out,a=t.next_in,i=t.input,h=t.avail_in,k=r.hold,A=r.bits,x=h,S=l,D=m;t:for(;;)switch(r.mode){case _:if(0===r.wrap){r.mode=13;break}for(;A<16;){if(0===h)break t;h--,k+=i[a++]<<A,A+=8}if(2&r.wrap&&35615===k){r.check=0,Y[0]=255&k,Y[1]=k>>>8&255,r.check=p(r.check,Y,2,0),k=0,A=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&k)<<8)+(k>>8))%31){t.msg="incorrect header check",r.mode=30;break}if(8!=(15&k)){t.msg="unknown compression method",r.mode=30;break}if(A-=4,M=8+(15&(k>>>=4)),0===r.wbits)r.wbits=M;else if(M>r.wbits){t.msg="invalid window size",r.mode=30;break}r.dmax=1<<M,t.adler=r.check=1,r.mode=512&k?10:E,k=0,A=0;break;case 2:for(;A<16;){if(0===h)break t;h--,k+=i[a++]<<A,A+=8}if(r.flags=k,8!=(255&r.flags)){t.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){t.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=k>>8&1),512&r.flags&&(Y[0]=255&k,Y[1]=k>>>8&255,r.check=p(r.check,Y,2,0)),k=0,A=0,r.mode=3;case 3:for(;A<32;){if(0===h)break t;h--,k+=i[a++]<<A,A+=8}r.head&&(r.head.time=k),512&r.flags&&(Y[0]=255&k,Y[1]=k>>>8&255,Y[2]=k>>>16&255,Y[3]=k>>>24&255,r.check=p(r.check,Y,4,0)),k=0,A=0,r.mode=4;case 4:for(;A<16;){if(0===h)break t;h--,k+=i[a++]<<A,A+=8}r.head&&(r.head.xflags=255&k,r.head.os=k>>8),512&r.flags&&(Y[0]=255&k,Y[1]=k>>>8&255,r.check=p(r.check,Y,2,0)),k=0,A=0,r.mode=5;case 5:if(1024&r.flags){for(;A<16;){if(0===h)break t;h--,k+=i[a++]<<A,A+=8}r.length=k,r.head&&(r.head.extra_len=k),512&r.flags&&(Y[0]=255&k,Y[1]=k>>>8&255,r.check=p(r.check,Y,2,0)),k=0,A=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&((T=r.length)>h&&(T=h),T&&(r.head&&(M=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),c.arraySet(r.head.extra,i,a,T,M)),512&r.flags&&(r.check=p(r.check,i,T,a)),h-=T,a+=T,r.length-=T),r.length))break t;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===h)break t;T=0;do{M=i[a+T++],r.head&&M&&r.length<65536&&(r.head.name+=String.fromCharCode(M))}while(M&&T<h);if(512&r.flags&&(r.check=p(r.check,i,T,a)),h-=T,a+=T,M)break t}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===h)break t;T=0;do{M=i[a+T++],r.head&&M&&r.length<65536&&(r.head.comment+=String.fromCharCode(M))}while(M&&T<h);if(512&r.flags&&(r.check=p(r.check,i,T,a)),h-=T,a+=T,M)break t}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;A<16;){if(0===h)break t;h--,k+=i[a++]<<A,A+=8}if(k!==(65535&r.check)){t.msg="header crc mismatch",r.mode=30;break}k=0,A=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=E;break;case 10:for(;A<32;){if(0===h)break t;h--,k+=i[a++]<<A,A+=8}t.adler=r.check=n(k),k=0,A=0,r.mode=11;case 11:if(0===r.havedict)return t.next_out=s,t.avail_out=l,t.next_in=a,t.avail_in=h,r.hold=k,r.bits=A,2;t.adler=r.check=1,r.mode=E;case E:if(5===e||6===e)break t;case 13:if(r.last){k>>>=7&A,A-=7&A,r.mode=27;break}for(;A<3;){if(0===h)break t;h--,k+=i[a++]<<A,A+=8}switch(r.last=1&k,A-=1,3&(k>>>=1)){case 0:r.mode=14;break;case 1:if(u(r),r.mode=20,6===e){k>>>=2,A-=2;break t}break;case 2:r.mode=17;break;case 3:t.msg="invalid block type",r.mode=30}k>>>=2,A-=2;break;case 14:for(k>>>=7&A,A-=7&A;A<32;){if(0===h)break t;h--,k+=i[a++]<<A,A+=8}if((65535&k)!=(k>>>16^65535)){t.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&k,k=0,A=0,r.mode=15,6===e)break t;case 15:r.mode=16;case 16:if(T=r.length){if(T>h&&(T=h),T>l&&(T=l),0===T)break t;c.arraySet(o,i,a,T,s),h-=T,a+=T,l-=T,s+=T,r.length-=T;break}r.mode=E;break;case 17:for(;A<14;){if(0===h)break t;h--,k+=i[a++]<<A,A+=8}if(r.nlen=257+(31&k),k>>>=5,A-=5,r.ndist=1+(31&k),k>>>=5,A-=5,r.ncode=4+(15&k),k>>>=4,A-=4,r.nlen>286||r.ndist>30){t.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;A<3;){if(0===h)break t;h--,k+=i[a++]<<A,A+=8}r.lens[Z[r.have++]]=7&k,k>>>=3,A-=3}for(;r.have<19;)r.lens[Z[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,N={bits:r.lenbits},D=y(0,r.lens,0,19,r.lencode,0,r.work,N),r.lenbits=N.bits,D){t.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;j=r.lencode[k&(1<<r.lenbits)-1],U=j>>>16&255,C=65535&j,!((R=j>>>24)<=A);){if(0===h)break t;h--,k+=i[a++]<<A,A+=8}if(C<16)k>>>=R,A-=R,r.lens[r.have++]=C;else{if(16===C){for(F=R+2;A<F;){if(0===h)break t;h--,k+=i[a++]<<A,A+=8}if(k>>>=R,A-=R,0===r.have){t.msg="invalid bit length repeat",r.mode=30;break}M=r.lens[r.have-1],T=3+(3&k),k>>>=2,A-=2}else if(17===C){for(F=R+3;A<F;){if(0===h)break t;h--,k+=i[a++]<<A,A+=8}A-=R,M=0,T=3+(7&(k>>>=R)),k>>>=3,A-=3}else{for(F=R+7;A<F;){if(0===h)break t;h--,k+=i[a++]<<A,A+=8}A-=R,M=0,T=11+(127&(k>>>=R)),k>>>=7,A-=7}if(r.have+T>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=30;break}for(;T--;)r.lens[r.have++]=M}}if(30===r.mode)break;if(0===r.lens[256]){t.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,N={bits:r.lenbits},D=y(v,r.lens,0,r.nlen,r.lencode,0,r.work,N),r.lenbits=N.bits,D){t.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,N={bits:r.distbits},D=y(w,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,N),r.distbits=N.bits,D){t.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===e)break t;case 20:r.mode=21;case 21:if(h>=6&&l>=258){t.next_out=s,t.avail_out=l,t.next_in=a,t.avail_in=h,r.hold=k,r.bits=A,g(t,S),s=t.next_out,o=t.output,l=t.avail_out,a=t.next_in,i=t.input,h=t.avail_in,k=r.hold,A=r.bits,r.mode===E&&(r.back=-1);break}for(r.back=0;j=r.lencode[k&(1<<r.lenbits)-1],U=j>>>16&255,C=65535&j,!((R=j>>>24)<=A);){if(0===h)break t;h--,k+=i[a++]<<A,A+=8}if(U&&0==(240&U)){for(I=R,O=U,L=C;j=r.lencode[L+((k&(1<<I+O)-1)>>I)],U=j>>>16&255,C=65535&j,!(I+(R=j>>>24)<=A);){if(0===h)break t;h--,k+=i[a++]<<A,A+=8}k>>>=I,A-=I,r.back+=I}if(k>>>=R,A-=R,r.back+=R,r.length=C,0===U){r.mode=26;break}if(32&U){r.back=-1,r.mode=E;break}if(64&U){t.msg="invalid literal/length code",r.mode=30;break}r.extra=15&U,r.mode=22;case 22:if(r.extra){for(F=r.extra;A<F;){if(0===h)break t;h--,k+=i[a++]<<A,A+=8}r.length+=k&(1<<r.extra)-1,k>>>=r.extra,A-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;j=r.distcode[k&(1<<r.distbits)-1],U=j>>>16&255,C=65535&j,!((R=j>>>24)<=A);){if(0===h)break t;h--,k+=i[a++]<<A,A+=8}if(0==(240&U)){for(I=R,O=U,L=C;j=r.distcode[L+((k&(1<<I+O)-1)>>I)],U=j>>>16&255,C=65535&j,!(I+(R=j>>>24)<=A);){if(0===h)break t;h--,k+=i[a++]<<A,A+=8}k>>>=I,A-=I,r.back+=I}if(k>>>=R,A-=R,r.back+=R,64&U){t.msg="invalid distance code",r.mode=30;break}r.offset=C,r.extra=15&U,r.mode=24;case 24:if(r.extra){for(F=r.extra;A<F;){if(0===h)break t;h--,k+=i[a++]<<A,A+=8}r.offset+=k&(1<<r.extra)-1,k>>>=r.extra,A-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===l)break t;if(T=S-l,r.offset>T){if((T=r.offset-T)>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=30;break}T>r.wnext?(T-=r.wnext,B=r.wsize-T):B=r.wnext-T,T>r.length&&(T=r.length),P=r.window}else P=o,B=s-r.offset,T=r.length;T>l&&(T=l),l-=T,r.length-=T;do{o[s++]=P[B++]}while(--T);0===r.length&&(r.mode=21);break;case 26:if(0===l)break t;o[s++]=r.length,l--,r.mode=21;break;case 27:if(r.wrap){for(;A<32;){if(0===h)break t;h--,k|=i[a++]<<A,A+=8}if(S-=l,t.total_out+=S,r.total+=S,S&&(t.adler=r.check=r.flags?p(r.check,o,S,s-S):d(r.check,o,S,s-S)),S=l,(r.flags?k:n(k))!==r.check){t.msg="incorrect data check",r.mode=30;break}k=0,A=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;A<32;){if(0===h)break t;h--,k+=i[a++]<<A,A+=8}if(k!==(4294967295&r.total)){t.msg="incorrect length check",r.mode=30;break}k=0,A=0}r.mode=29;case 29:D=1;break t;case 30:D=-3;break t;case 31:return-4;case 32:default:return b}return t.next_out=s,t.avail_out=l,t.next_in=a,t.avail_in=h,r.hold=k,r.bits=A,(r.wsize||S!==t.avail_out&&r.mode<30&&(r.mode<27||4!==e))&&f(t,t.output,t.next_out,S-t.avail_out)?(r.mode=31,-4):(x-=t.avail_in,S-=t.avail_out,t.total_in+=x,t.total_out+=S,r.total+=S,r.wrap&&S&&(t.adler=r.check=r.flags?p(r.check,o,S,t.next_out-S):d(r.check,o,S,t.next_out-S)),t.data_type=r.bits+(r.last?64:0)+(r.mode===E?128:0)+(20===r.mode||15===r.mode?256:0),(0===x&&0===S||4===e)&&D===m&&(D=-5),D)},r.inflateEnd=function(t){if(!t||!t.state)return b;var e=t.state;return e.window&&(e.window=null),t.state=null,m},r.inflateGetHeader=function(t,e){var r;return t&&t.state?0==(2&(r=t.state).wrap)?b:(r.head=e,e.done=!1,m):b},r.inflateSetDictionary=function(t,e){var r,n=e.length;return t&&t.state?0!==(r=t.state).wrap&&11!==r.mode?b:11===r.mode&&d(1,e,n,0)!==r.check?-3:f(t,e,n,n)?(r.mode=31,-4):(r.havedict=1,m):b},r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":1,"./adler32":3,"./crc32":5,"./inffast":7,"./inftrees":9}],9:[function(t,e,r){"use strict";var n=t("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,r,u,f,h,l,c){var d,p,g,y,v,w,m,b,_,E=c.bits,k=0,A=0,x=0,S=0,T=0,B=0,P=0,R=0,U=0,C=0,I=null,O=0,L=new n.Buf16(16),M=new n.Buf16(16),D=null,N=0;for(k=0;k<=15;k++)L[k]=0;for(A=0;A<u;A++)L[e[r+A]]++;for(T=E,S=15;S>=1&&0===L[S];S--);if(T>S&&(T=S),0===S)return f[h++]=20971520,f[h++]=20971520,c.bits=1,0;for(x=1;x<S&&0===L[x];x++);for(T<x&&(T=x),R=1,k=1;k<=15;k++)if(R<<=1,(R-=L[k])<0)return-1;if(R>0&&(0===t||1!==S))return-1;for(M[1]=0,k=1;k<15;k++)M[k+1]=M[k]+L[k];for(A=0;A<u;A++)0!==e[r+A]&&(l[M[e[r+A]]++]=A);if(0===t?(I=D=l,w=19):1===t?(I=i,O-=257,D=o,N-=257,w=256):(I=a,D=s,w=-1),C=0,A=0,k=x,v=h,B=T,P=0,g=-1,y=(U=1<<T)-1,1===t&&U>852||2===t&&U>592)return 1;for(;;){m=k-P,l[A]<w?(b=0,_=l[A]):l[A]>w?(b=D[N+l[A]],_=I[O+l[A]]):(b=96,_=0),d=1<<k-P,x=p=1<<B;do{f[v+(C>>P)+(p-=d)]=m<<24|b<<16|_|0}while(0!==p);for(d=1<<k-1;C&d;)d>>=1;if(0!==d?(C&=d-1,C+=d):C=0,A++,0==--L[k]){if(k===S)break;k=e[r+l[A]]}if(k>T&&(C&y)!==g){for(0===P&&(P=T),v+=x,R=1<<(B=k-P);B+P<S&&!((R-=L[B+P])<=0);)B++,R<<=1;if(U+=1<<B,1===t&&U>852||2===t&&U>592)return 1;f[g=C&y]=T<<24|B<<16|v-h|0}}return 0!==C&&(f[v+C]=k-P<<24|64<<16|0),c.bits=T,0}},{"../utils/common":1}],10:[function(t,e,r){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],11:[function(t,e,r){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],"/lib/inflate.js":[function(t,e,r){"use strict";function n(t){if(!(this instanceof n))return new n(t);this.options=a.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var r=o.inflateInit2(this.strm,e.windowBits);if(r!==u.Z_OK)throw new Error(f[r]);this.header=new l,o.inflateGetHeader(this.strm,this.header)}function i(t,e){var r=new n(e);if(r.push(t,!0),r.err)throw r.msg||f[r.err];return r.result}var o=t("./zlib/inflate"),a=t("./utils/common"),s=t("./utils/strings"),u=t("./zlib/constants"),f=t("./zlib/messages"),h=t("./zlib/zstream"),l=t("./zlib/gzheader"),c=Object.prototype.toString;n.prototype.push=function(t,e){var r,n,i,f,h,l,d=this.strm,p=this.options.chunkSize,g=this.options.dictionary,y=!1;if(this.ended)return!1;n=e===~~e?e:!0===e?u.Z_FINISH:u.Z_NO_FLUSH,"string"==typeof t?d.input=s.binstring2buf(t):"[object ArrayBuffer]"===c.call(t)?d.input=new Uint8Array(t):d.input=t,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new a.Buf8(p),d.next_out=0,d.avail_out=p),(r=o.inflate(d,u.Z_NO_FLUSH))===u.Z_NEED_DICT&&g&&(l="string"==typeof g?s.string2buf(g):"[object ArrayBuffer]"===c.call(g)?new Uint8Array(g):g,r=o.inflateSetDictionary(this.strm,l)),r===u.Z_BUF_ERROR&&!0===y&&(r=u.Z_OK,y=!1),r!==u.Z_STREAM_END&&r!==u.Z_OK)return this.onEnd(r),this.ended=!0,!1;d.next_out&&(0!==d.avail_out&&r!==u.Z_STREAM_END&&(0!==d.avail_in||n!==u.Z_FINISH&&n!==u.Z_SYNC_FLUSH)||("string"===this.options.to?(i=s.utf8border(d.output,d.next_out),f=d.next_out-i,h=s.buf2string(d.output,i),d.next_out=f,d.avail_out=p-f,f&&a.arraySet(d.output,d.output,i,f,0),this.onData(h)):this.onData(a.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(y=!0)}while((d.avail_in>0||0===d.avail_out)&&r!==u.Z_STREAM_END);return r===u.Z_STREAM_END&&(n=u.Z_FINISH),n===u.Z_FINISH?(r=o.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===u.Z_OK):n!==u.Z_SYNC_FLUSH||(this.onEnd(u.Z_OK),d.avail_out=0,!0)},n.prototype.onData=function(t){this.chunks.push(t)},n.prototype.onEnd=function(t){t===u.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=a.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},r.Inflate=n,r.inflate=i,r.inflateRaw=function(t,e){return(e=e||{}).raw=!0,i(t,e)},r.ungzip=i},{"./utils/common":1,"./utils/strings":2,"./zlib/constants":4,"./zlib/gzheader":6,"./zlib/inflate":8,"./zlib/messages":10,"./zlib/zstream":11}]},{},[])("/lib/inflate.js")},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){this.width=0,this.height=0,this.bitDepth=0,this.colorType=0,this.compressionMethod=0,this.filterMethod=0,this.interlaceMethod=0,this.colors=0,this.alpha=!1,this.pixelBits=0,this.palette=null,this.pixels=null};n.prototype.getWidth=function(){return this.width},n.prototype.setWidth=function(t){this.width=t},n.prototype.getHeight=function(){return this.height},n.prototype.setHeight=function(t){this.height=t},n.prototype.getBitDepth=function(){return this.bitDepth},n.prototype.setBitDepth=function(t){if(-1===[2,4,8,16].indexOf(t))throw new Error("invalid bith depth "+t);this.bitDepth=t},n.prototype.getColorType=function(){return this.colorType},n.prototype.setColorType=function(t){var e=0,r=!1;switch(t){case 0:e=1;break;case 2:e=3;break;case 3:e=1;break;case 4:e=2,r=!0;break;case 6:e=4,r=!0;break;default:throw new Error("invalid color type")}this.colors=e,this.alpha=r,this.colorType=t},n.prototype.getCompressionMethod=function(){return this.compressionMethod},n.prototype.setCompressionMethod=function(t){if(0!==t)throw new Error("invalid compression method "+t);this.compressionMethod=t},n.prototype.getFilterMethod=function(){return this.filterMethod},n.prototype.setFilterMethod=function(t){if(0!==t)throw new Error("invalid filter method "+t);this.filterMethod=t},n.prototype.getInterlaceMethod=function(){return this.interlaceMethod},n.prototype.setInterlaceMethod=function(t){if(0!==t&&1!==t)throw new Error("invalid interlace method "+t);this.interlaceMethod=t},n.prototype.setPalette=function(t){if(t.length%3!=0)throw new Error("incorrect PLTE chunk length");if(t.length>3*Math.pow(2,this.bitDepth))throw new Error("palette has more colors than 2^bitdepth");this.palette=t},n.prototype.getPalette=function(){return this.palette},n.prototype.getPixel=function(t,e){if(!this.pixels)throw new Error("pixel data is empty");if(t>=this.width||e>=this.height)throw new Error("x,y position out of bound");var r=this.colors*this.bitDepth/8*(e*this.width+t),n=this.pixels;switch(this.colorType){case 0:return[n[r],n[r],n[r],255];case 2:return[n[r],n[r+1],n[r+2],255];case 3:return[this.palette[3*n[r]+0],this.palette[3*n[r]+1],this.palette[3*n[r]+2],255];case 4:return[n[r],n[r],n[r],n[r+1]];case 6:return[n[r],n[r+1],n[r+2],n[r+3]]}},e.default=n},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();var i=!1;function o(){var t;i&&(t=console).log.apply(t,arguments)}var a=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.data={},this.entries=[],this.buffer=null,this.storeBuffer=null!=e&&e}return n(t,[{key:"_Uint8ToString",value:function(t){var e=[];if(Uint8Array.prototype.subarray)for(var r=0;r<t.byteLength;r+=32768)e.push(String.fromCharCode.apply(null,t.subarray(r,Math.min(r+32768,t.byteLength))));else if(Uint8Array.prototype.slice)for(var n=0;n<t.byteLength;n+=32768)e.push(String.fromCharCode.apply(null,t.slice(n,Math.min(n+32768,t.byteLength))));else for(var i=0;i<t.byteLength;i+=32768){for(var o=new Uint8Array(Math.min(32768,t.byteLength-i)),a=0;a<o.byteLength;++a)o[a]=t[i+a];e.push(String.fromCharCode.apply(null,o))}return e.join("")}},{key:"_parseImgURI",value:function(t,e){if(t instanceof Uint8Array)return null==e?"data:;base64,"+btoa(this._Uint8ToString(t)):"data:"+e+";base64,"+btoa(this._Uint8ToString(t));if(t instanceof ArrayBuffer){var r=new Uint8Array(t);return null==e?"data:;base64,"+btoa(this._Uint8ToString(r)):"data:"+e+";base64,"+btoa(this._Uint8ToString(r))}console.error("Unknow type ",t)}},{key:"parseBundle",value:function(t,e,r,n){n=n||{};var a=0,s="",u=new Uint8Array(e*r*3),f=n.password||"";this.storeBuffer&&(this.buffer=u);for(var h=0;h<t.length;h++)(h+1)%4!=0&&(u[a++]=t[h]);if(o("Extracted Uint8Array",u.length,u),i){for(var l="",c=500;c<800;c++)l+=u[c]+",";console.log("500 to 800 bytes"),console.log(l)}for(a=0;a<u.length&&!(u[a]<5);)s+=String.fromCharCode(u[a++]);o("Found the string 0 char at index "+a+" with value "+u[a]),o(s),a++;var d=0;if(""!==f)for(var p=a;p<u.length;p++){var g=u[p];g^=f.charCodeAt(d),u[p]=g,d=(d+1)%f.length}this.entries=[];var y=s.split("\\n");y=(s=y.join("")).split(";");for(var v=0;v<y.length;v++)if(""!==y[v]){var w=y[v].split(",");this.entries.push({path:w[0],type:w[1],length:parseInt(w[2],10)})}o("this.entries",this.entries);for(var m=0;m<this.entries.length;m++){var b=this.entries[m],_=u.subarray(a,a+b.length);o("Extracting "+b.path+": length "+_.length),o("Starts at "+a+" with value "+_[0]),o("Ends at "+(a+b.length)+" with value "+_[_.length-1]),a+=b.length,this.data[b.path]=_}}},{key:"read",value:function(t){return null===this.data[t]&&console.error("Bundle: ["+t+"] not found."),this.data[t]}},{key:"readText",value:function(t){var e="",r=this.read(t);if(null==r)return e;for(var n=0;n<r.length;n++)e+=String.fromCharCode(r[n]);return e}},{key:"readJSON",value:function(t){var e=this.readText(t);return""===e?{}:JSON.parse(e)}},{key:"readImg",value:function(t){var e=this.read(t);return null===e?(console.error("Cannot read ",t),""):this._parseImgURI(e,"image/jpeg")}},{key:"clearData",value:function(){this.data={}}}]),t}();e.default=a},function(t,e,r){(function(e,r){t.exports=function(){"use strict";function t(t){return"function"==typeof t}function n(){var t=setTimeout;return function(){return t(i,1)}}function i(){for(var t=0;t<m;t+=2){var e=B[t],r=B[t+1];e(r),B[t]=void 0,B[t+1]=void 0}m=0}function o(t,e){var r=this,n=new this.constructor(s);void 0===n[R]&&v(n);var i=r._state;if(i){var o=arguments[i-1];E(function(){return y(i,n,o,r._result)})}else p(r,n,t,e);return n}function a(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=new this(s);return h(e,t),e}function s(){}function u(t){try{return t.then}catch(t){return O.error=t,O}}function f(e,r,n){r.constructor===e.constructor&&n===o&&r.constructor.resolve===a?function(t,e){e._state===C?c(t,e._result):e._state===I?d(t,e._result):p(e,void 0,function(e){return h(t,e)},function(e){return d(t,e)})}(e,r):n===O?(d(e,O.error),O.error=null):void 0===n?c(e,r):t(n)?function(t,e,r){E(function(t){var n=!1,i=function(t,e,r,n){try{t.call(e,r,n)}catch(t){return t}}(r,e,function(r){n||(n=!0,e!==r?h(t,r):c(t,r))},function(e){n||(n=!0,d(t,e))},t._label);!n&&i&&(n=!0,d(t,i))},t)}(e,r,n):c(e,r)}function h(t,e){t===e?d(t,new TypeError("You cannot resolve a promise with itself")):function(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)}(e)?f(t,e,u(e)):c(t,e)}function l(t){t._onerror&&t._onerror(t._result),g(t)}function c(t,e){t._state===U&&(t._result=e,t._state=C,0!==t._subscribers.length&&E(g,t))}function d(t,e){t._state===U&&(t._state=I,t._result=e,E(l,t))}function p(t,e,r,n){var i=t._subscribers,o=i.length;t._onerror=null,i[o]=e,i[o+C]=r,i[o+I]=n,0===o&&t._state&&E(g,t)}function g(t){var e=t._subscribers,r=t._state;if(0!==e.length){for(var n=void 0,i=void 0,o=t._result,a=0;a<e.length;a+=3)n=e[a],i=e[a+r],n?y(r,n,i,o):i(o);t._subscribers.length=0}}function y(e,r,n,i){var o=t(n),a=void 0,s=void 0,u=void 0,f=void 0;if(o){if((a=function(t,e){try{return t(e)}catch(t){return O.error=t,O}}(n,i))===O?(f=!0,s=a.error,a.error=null):u=!0,r===a)return void d(r,new TypeError("A promises callback cannot return that same promise."))}else a=i,u=!0;r._state!==U||(o&&u?h(r,a):f?d(r,s):e===C?c(r,a):e===I&&d(r,a))}function v(t){t[R]=L++,t._state=void 0,t._result=void 0,t._subscribers=[]}var w=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},m=0,b=void 0,_=void 0,E=function(t,e){B[m]=t,B[m+1]=e,2===(m+=2)&&(_?_(i):P())},k="undefined"!=typeof window?window:void 0,A=k||{},x=A.MutationObserver||A.WebKitMutationObserver,S="undefined"==typeof self&&void 0!==e&&"[object process]"==={}.toString.call(e),T="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,B=new Array(1e3),P=void 0;P=S?function(){return e.nextTick(i)}:x?function(){var t=0,e=new x(i),r=document.createTextNode("");return e.observe(r,{characterData:!0}),function(){r.data=t=++t%2}}():T?function(){var t=new MessageChannel;return t.port1.onmessage=i,function(){return t.port2.postMessage(0)}}():void 0===k?function(){try{var t=Function("return this")().require("vertx");return void 0!==(b=t.runOnLoop||t.runOnContext)?function(){b(i)}:n()}catch(t){return n()}}():n();var R=Math.random().toString(36).substring(2),U=void 0,C=1,I=2,O={error:null},L=0,M=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(s),this.promise[R]||v(this.promise),w(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?c(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&c(this.promise,this._result))):d(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===U&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var r=this._instanceConstructor,n=r.resolve;if(n===a){var i=u(t);if(i===o&&t._state!==U)this._settledAt(t._state,e,t._result);else if("function"!=typeof i)this._remaining--,this._result[e]=t;else if(r===D){var h=new r(s);f(h,t,i),this._willSettleAt(h,e)}else this._willSettleAt(new r(function(e){return e(t)}),e)}else this._willSettleAt(n(t),e)},t.prototype._settledAt=function(t,e,r){var n=this.promise;n._state===U&&(this._remaining--,t===I?d(n,r):this._result[e]=r),0===this._remaining&&c(n,this._result)},t.prototype._willSettleAt=function(t,e){var r=this;p(t,void 0,function(t){return r._settledAt(C,e,t)},function(t){return r._settledAt(I,e,t)})},t}(),D=function(){function e(t){this[R]=L++,this._result=this._state=void 0,this._subscribers=[],s!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(t,e){try{e(function(e){h(t,e)},function(e){d(t,e)})}catch(e){d(t,e)}}(this,t):function(){throw new TypeError("Failed to construct \'Promise\': Please use the \'new\' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.finally=function(e){var r=this,n=r.constructor;return t(e)?r.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){throw t})}):r.then(e,e)},e}();return D.prototype.then=o,D.all=function(t){return new M(this,t).promise},D.race=function(t){var e=this;return new e(w(t)?function(r,n){for(var i=t.length,o=0;o<i;o++)e.resolve(t[o]).then(r,n)}:function(t,e){return e(new TypeError("You must pass an array to race."))})},D.resolve=a,D.reject=function(t){var e=new this(s);return d(e,t),e},D._setScheduler=function(t){_=t},D._setAsap=function(t){E=t},D._asap=E,D.polyfill=function(){var t=void 0;if(void 0!==r)t=r;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===n&&!e.cast)return}t.Promise=D},D.Promise=D,D.polyfill(),D}()}).call(this,r(14),r(0))},function(t,e){var r,n,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(r===setTimeout)return setTimeout(t,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(t){r=o}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(t){n=a}}();var u,f=[],h=!1,l=-1;function c(){h&&u&&(h=!1,u.length?f=u.concat(f):l=-1,f.length&&d())}function d(){if(!h){var t=s(c);h=!0;for(var e=f.length;e;){for(u=f,f=[];++l<e;)u&&u[l].run();l=-1,e=f.length}u=null,h=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function g(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];f.push(new p(t,e)),1!==f.length||h||s(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}}]);',r.p+"7c1c33460b14ac0d1878.worker.js")}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0);var i=function(e){function t(e){var r=e.renderer,n=e.color;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n,1));return o.angle=Math.PI/6,o.penumbra=.1,o.decay=.1,o.distance=1e-4,o.castShadow=!0,o.intensity=3,o.shadow.mapSize.width=1024,o.shadow.mapSize.height=1024,o.shadow.camera.near=1e-6,o.shadow.camera.far=1e-4,o._enabled=!1,o._renderer=r,o.__defaultGammaInput=o._renderer.gammaInput,o.__defaultGammaOutput=o._renderer.gammaOutput,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.SpotLight),n(t,[{key:"addToScene",value:function(e){this.__scene=e,e.add(this),e.add(this.target)}},{key:"removeFromScene",value:function(){this.__scene.remove(this),this.__scene.remove(this.target)}},{key:"setPose",value:function(e){var t=e.position,r=e.target;t&&this.position.copy(t),r&&this.target.position.copy(r)}},{key:"enabled",set:function(e){e?(this._renderer.shadowMap.enabled=!0,this._renderer.shadowMap.type=o.PCFSoftShadowMap,this._renderer.gammaInput=!0,this._renderer.gammaOutput=!0):(this._renderer.shadowMap.enabled=!1,this._renderer.gammaInput=this.__defaultGammaInput,this._renderer.gammaOutput=this.__defaultGammaOutput)},get:function(){return this._enabled}}]),t}();t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(6),i=r(0);var a=function(){function e(t){var r=t.id,n=t.cloudPath,a=t.name,s=void 0===a?"unknown":a,u=t.owner,l=void 0===u?"unknown":u,c=t.version,f=void 0===c?{major:0,minor:0,patch:0}:c,h=t.salt,d=void 0===h?"":h,p=t.maxLevel,v=void 0===p?20:p,y=t.minLevel,m=void 0===y?0:y,g=t.geoInfo,_=t.modelTransform;function b(e){var t=e.x,r=e.y,n=e.z;return new i.Vector3(t,r,n)}!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=r,this.cloudPath=n,this.name=s,this.owner=l,this.version=f,this.salt=d,this.maxLevel=v,this.minLevel=m,g=(0,o.optionPadding)({center:{geo:{lng:0,lat:0,alt:0},xyz:{x:0,y:0,z:0},epsg:"unknown"}},g),this.geoInfo={center:{geo:g.center.geo,xyz:b(g.center.xyz),epsg:g.center.epsg}},_=(0,o.optionPadding)({bbox:{max:{x:1,y:1,z:1},min:{x:-1,y:-1,z:-1}},scale:{x:1,y:1,z:1},position:{x:0,y:0,z:0},quaternion:{x:0,y:0,z:0,w:1}},_),this.modelTransform={bbox:{max:b(_.bbox.max),min:b(_.bbox.min)},scale:b(_.scale),position:b(_.position),quaternion:function(e){var t=e.x,r=e.y,n=e.z,o=e.w;return new i.Quaternion(t,r,n,o)}(_.quaternion)}}return n(e,[{key:"destruct",value:function(){return!0}},{key:"validate",value:function(){return!!this.id&&!!this.cloudPath}},{key:"valid",get:function(){return this.validate()}},{key:"dataPath",get:function(){return this.cloudPath.local.dataPath}},{key:"rootFileName",get:function(){return this.cloudPath.local.rootFileName}}]),e}();t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=s(r(3)),a=s(r(20));function s(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.tree,n=e.Type,o=void 0===n?a.default:n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r,o));return i._tree=r,i._Type=o,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),o(t,[{key:"generateTileMaterial",value:function(e){var t=n({},e.style,this.tree.style);return e.geometry.normal||e.geometry.computeVertexNormals(),new this.Type(t)}}]),t}();t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);var o=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.level,o=e.x,i=e.y,a=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(e,["level","x","y"]);!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=Object.assign({},a,{emissive:new n.Color(.6,.6,.6),metalness:.5,emissiveIntensity:1});var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,a));return s.level=r,s.x=o,s.y=i,s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.MeshPhysicalMaterial),t}();t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(r(8));var o=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.level,n=e.x,o=e.y;!function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n])}(e,["level","x","y"]);!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{color:8947848,specular:6710886,shininess:30,flatShading:!0}));return i.level=r,i.x=n,i.y=o,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.default),t}();t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);var o=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.level,n=e.x,o=e.y;!function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n])}(e,["level","x","y"]);!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{color:12303291,wireframe:!0}));return i.level=r,i.x=n,i.y=o,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.MeshBasicMaterial),t}();t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0},i=u(r(42)),a=u(r(107)),s=u(r(45));function u(e){return e&&e.__esModule?e:{default:e}}var l=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.tree,n=e.Type,o=void 0===n?s.default:n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{tree:r,Type:o}));return i._projectorUniforms.videoTexture={value:[]},i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),n(t,[{key:"destruct",value:function(){var e=!0;return this.clearProjectors(),e=o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)&&e}},{key:"addProjector",value:function(e){var r=e.fov,n=e.aspect,i=e.near,s=e.far,u=e.position,l=e.up,c=e.target,f=e.videoSrcUrl,h=e.type,d=o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addProjector",this).call(this,{options:{fov:r,aspect:n,near:i,far:s,position:u,up:l,target:c,offline_renderer:this.offline_renderer,sceneGraphRoot:this.tree.sceneGraphRoot,videoSrcUrl:f,type:h,projectorTreeMaterial:this},ProjectorType:a.default});return this._projectorUniforms.videoTexture.value.push(d.videoTexture),this._updateMaterials(),d}},{key:"removeProjectorByIndex",value:function(e){var t=this._projectorUniforms.projectors.value[e];t&&(this._projectorUniforms.count.value-=1,this._projectorUniforms.projectors.value.splice(e,1),this._projectorUniforms.depthTexture.value.splice(e,1),this._projectorUniforms.videoTexture.value.splice(e,1),t.destruct(),this._updateMaterials())}},{key:"clearProjectors",value:function(){o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clearProjectors",this).call(this),this._projectorUniforms.videoTexture.value.splice(0,this._projectorUniforms.videoTexture.value.length),this._updateMaterials()}}]),t}();t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0),i=function(e){return e&&e.__esModule?e:{default:e}}(r(43));var a=function(e){function t(e){var r=e.fov,n=e.aspect,i=e.near,a=e.far,s=e.position,u=e.up,l=e.target,c=e.projectorTreeMaterial,f=e.offline_renderer,h=e.sceneGraphRoot,d=e.videoSrcUrl,p=e.type;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var v=new o.PerspectiveCamera(r,n,i,a);v.position.set(s.x,s.y,s.z),v.up.set(u.x,u.y,u.z),v.lookAt(new o.Vector3(l.x,l.y,l.z)),v.updateProjectionMatrix(),v.updateMatrix(),v.updateMatrixWorld();var y=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{camera:v,parent:c,sceneGraphRoot:h,offline_renderer:f}));return y._target=l,y.vdom=document.createElement("video"),y.vdom.id=d,y.vdom.loop="true",y.vdom.autoplay="true",y.vdom.muted="true",y.vdom.preload="metadata",y.vdom.crossOrigin="anonymous",y.vdom.style="display:none",y.vsrc=document.createElement("source"),y.vsrc.src=d,y.vsrc.type=p,y.vdom.appendChild(y.vsrc),y.vdom.load(),y.vdom.play(),y._videoPath=d,y._videoType=p,y.videoTexture=new o.VideoTexture(y.vdom),y.videoTexture.minFilter=y.videoTexture.magFilter=o.LinearFilter,y.videoTexture.format=o.RGBFormat,y}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),n(t,[{key:"destruct",value:function(){return this.videoTexture.dispose(),this.videoTexture=null,this.vdom.pause(),this.vdom.removeAttribute("src"),this.vdom.removeChild(this.vsrc),this.vsrc.removeAttribute("src"),this.vdom.load(),this.vdom=null,this.vsrc=null,function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"playVideo",value:function(){return this.vdom.play()}},{key:"fov",get:function(){return this.camera.fov},set:function(e){this.camera.fov=e,this.camera.updateProjectionMatrix()}},{key:"aspect",get:function(){return this.camera.aspect},set:function(e){this.camera.aspect=e,this.camera.updateProjectionMatrix()}}]),t}();t.default=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=l(r(3)),i=l(r(46)),a=r(47),s=l(r(48)),u=r(0);function l(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.tree,n=e.Type,o=void 0===n?i.default:n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{tree:r,Type:o}));a._cropMask=new s.default({maskSize:1024}),a._cropSharedUniforms={test:{type:"float",value:233},cropMask:{type:"t",value:a._cropMask.texture},origin:{type:"v3",value:new u.Vector3},xDir:{type:"v3",value:new u.Vector3},yDir:{type:"v3",value:new u.Vector3},zDir:{type:"v3",value:new u.Vector3},minBound:{type:"v3",value:new u.Vector3},maxBound:{type:"v3",value:new u.Vector3}};var l=a;return a.initialized=new Promise(function(e,t){l._onInitSuccess=e,l._onInitFail=t}),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),n(t,[{key:"destruct",value:function(){return this._cropMask.destruct(),function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"loadCropMask",value:function(){var e=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){return function n(o,i){try{var a=t[o](i),s=a.value}catch(e){return void r(e)}if(!a.done)return Promise.resolve(s).then(function(e){n("next",e)},function(e){n("throw",e)});e(s)}("next")})}}(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this,e.abrupt("return",(0,a.loadMaskAPI)({api:this.altizureApi,pid:this.PID,type:"crop"}).then(function(e){return t._onInitSuccess(t),t._updateCropMask({uint8:e.image.rgba,maskSize:e.maskSize}),t._updateOrthoInfo(),Promise.resolve(t)}).catch(function(e){return t._onInitFail(e),Promise.reject(e)}));case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_updateCropMask",value:function(e){var t=e.uint8,r=e.maskSize;return this._cropMask.imageData={uint8:t,maskSize:r},this._cropSharedUniforms.cropMask.value&&this._cropSharedUniforms.cropMask.value.dispose(),this._cropSharedUniforms.cropMask.value=this._cropMask.texture,!0}},{key:"refreshMask",value:function(){return this._updateOrthoInfo(),this._cropSharedUniforms.cropMask.value!==this._cropMask.texture&&(this._cropSharedUniforms.cropMask.value.dispose(),this._cropSharedUniforms.cropMask.value=this._cropMask.texture),!0}},{key:"generateTileMaterial",value:function(e){var t=e.style,r={level:t.level,x:t.x,y:t.y,map:t.map,cropSharedUniforms:this._cropSharedUniforms};return new this.Type(r)}},{key:"_updateOrthoInfo",value:function(){var e=this.tree.projInfo.orthoInfo(this.tree.projInfo.modelTransform.objToOldDisplay);return this._cropSharedUniforms.origin.value=e.origin,this._cropSharedUniforms.xDir.value=e.xDir,this._cropSharedUniforms.yDir.value=e.yDir,this._cropSharedUniforms.zDir.value=e.zDir,this._cropSharedUniforms.minBound.value=e.minBound,this._cropSharedUniforms.maxBound.value=e.maxBound,!0}},{key:"altizureApi",get:function(){return this.tree.altizureApi}},{key:"PID",get:function(){return this.tree.projInfo.id}}]),t}();t.default=c},function(e,t,r){var n,o,i;o=[e,t],void 0===(i="function"==typeof(n=function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={decodeNumMat:function(e){for(var t=e.width,r=e.height,n=e.data,o=this.decodeNumArray(n),i=0,a=[],s=0;s<t;s++){a[s]=[];for(var u=0;u<r;u++)a[s][u]=o[i],i++}return a},encodeNumMat:function(e){for(var t=e.length,r=e[0].length,n=[],o=0;o<t;o++)for(var i=0;i<r;i++)n.push(e[o][i]);var a=this.encodeNumArray(n);return{width:t,height:r,data:a}},_firstChar:48,decodeNumArray:function(e){var t,r=[],n=[];for(t=0;t<e.length;t+=3){var o=e.charAt(t).charCodeAt()-this._firstChar,i=e.charAt(t+1).charCodeAt()-this._firstChar,a=e.charAt(t+2).charCodeAt()-this._firstChar;n.push(63&o>>2),n.push((3&o)<<4|15&i>>4),n.push((15&i)<<2|3&a>>6),n.push(63&a)}for(t=0;t<n.length;t++)63!==n[t]&&r.push(n[t]);return r},encodeNumArray:function(e){for(var t=[],r=0;r<e.length;r+=4){var n=e[r],o=r+1<e.length?e[r+1]:63,i=r+2<e.length?e[r+2]:63,a=r+3<e.length?e[r+3]:63;this.encodeSet(n,o,i,a,t)}return this.stringFromArray(t)},stringFromArray:function(e){for(var t="",r=0;r<e.length;r++)t+=e[r];return t},encodeSet:function(e,t,r,n,o){var i=String.fromCharCode;o.push(i(((63&e)<<2|3&t>>4)+this._firstChar)),o.push(i(((15&t)<<4|15&r>>2)+this._firstChar)),o.push(i(((3&r)<<6|63&n)+this._firstChar))},pack_boolean:function(e){for(var t={width:e.length,height:e[0].length,data:[]},r=0,n=!1,o=0;o<e.length;o++)for(var i=0;i<e[o].length;i++)e[o][i]===n?r++:e[o][i]===!n?(t.data.push(r),n=!n,r=1):console.warn("Error: unknown entry ["+o+","+i+"]="+e[o][i]);return t.data.push(r),t},unpack_boolean:function(e){function t(e,t,n,o){for(var a=n,s=e,u=t;a--;)i[s][u]=o,++u===r&&(s++,u=0);return{row:s,col:u}}for(var r=e.width,n=e.height,o=e.data,i=[],a=n;a--;)i[a]=[];var s=!1;a=0;for(var u=0,l=0;l<o.length;l+=16)for(var c=0;c<16;++c){var f=o[c+l],h=t(a,u,f,s);a=h.row,u=h.col,s=!s}return i},unpackToImage:function(e){function t(e,t,n,o){for(var a=n,s=e,u=t,l=4*(s*r+u);a--;)i[l]=i[l+1]=i[l+2]=i[l+3]=o,l+=4,++u===r&&(s++,u=0);return{row:s,col:u}}for(var r=e.width,n=e.height,o=e.data,i=new Uint8ClampedArray(r*n*4),a=0,s=!1,u=0,l=0,c=0;c<o.length;c+=16)for(var f=0;f<16;++f){var h=o[f+c],d=t(u,l,h,s?255:0);u=d.row,l=d.col,a+=!0===s?1:0,s=!s}var p={rgba:i,cntWhite:a};return p},downsampleImage:function(e,t,r,n){for(var o=Math.floor,i=o(t*n),a=o(r*n),s=new Uint8ClampedArray(i*a*4),u=0,l=0,c=0,f=0;f<a;++f)for(var h=0;h<i;++h)c=4*(f/n*t+h/n),s[l=4*(f*i+h)]=e[c],s[l+1]=e[c+1],s[l+2]=e[c+2],s[l+3]=e[c+3],u+=0===s[l]?0:1;return{rgba:s,cntWhite:u}}},e.exports=t.default})?n.apply(t,o):n)||(e.exports=i)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0},a=r(0),s=l(r(42)),u=l(r(49));function l(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.tree,n=e.Type,o=void 0===n?u.default:n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r,o));return i._tree=r,i._Type=o,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.default),o(t,[{key:"destruct",value:function(){return this._tree=void 0,this._Type=void 0,!0}},{key:"updateMaterial",value:function(){return this.tree.traverse(this.tree.root,function(e){return e.updateMaterial(),!0})}},{key:"generateTileMaterial",value:function(e){var t=n({projectorUniforms:this._projectorUniforms},e.style,this.tree.style);return e.geometry.normal||e.geometry.computeVertexNormals(),new this.Type(t)}},{key:"addProjector",value:function(e){var r=e.fov,n=e.aspect,o=e.near,s=e.far,u=e.position,l=e.up,c=e.target,f=new a.PerspectiveCamera(r,n,o,s);f.position.set(u.x,u.y,u.z),f.up.set(l.x,l.y,l.z),f.lookAt(new a.Vector3(c.x,c.y,c.z));var h=i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"addProjector",this).call(this,{options:{target:c,camera:f,offline_renderer:this.offline_renderer,sceneGraphRoot:this.tree.sceneGraphRoot,parent:this}});return this._updateMaterials(),h}},{key:"removeProjectorByIndex",value:function(e){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"removeProjectorByIndex",this).call(this,e),this._updateMaterials()}},{key:"clearProjectors",value:function(){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"clearProjectors",this).call(this),this._updateMaterials()}}]),t}();t.default=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=function(e){return e&&e.__esModule?e:{default:e}}(r(8));var i=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.level,o=e.x,i=e.y,a=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(e,["level","x","y"]);!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=a.map;s||console.warn("no map");var u=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{map:s,color:new n.Color(1,1,1),lights:!0,shininess:0,specular:new n.Color(0,0,0)}));return u.level=r,u.x=o,u.y=i,u}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),t}();t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=c(r(3)),a=c(r(50)),s=c(r(1)),u=c(r(7)),l=r(0);function c(e){return e&&e.__esModule?e:{default:e}}var f=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.tree,n=e.Type,o=void 0===n?a.default:n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{tree:r,Type:o}));return i._contourLineUniforms={heightInterval:{type:"f",value:20},color:{type:"v3",value:new l.Color(16777215)},lineWidth:{type:"f",value:2},mapAlpha:{type:"f",value:.4},distanceLimit:{type:"f",value:3200},worldToMeters:{type:"f",value:s.default.EARTH_RADIUS/u.default.scale}},i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),o(t,[{key:"generateTileMaterial",value:function(e){e.geometry.attributes.normal||e.geometry.computeVertexNormals();var t=n({contourLineUniforms:this._contourLineUniforms},e.style);return new this.Type(t)}},{key:"destruct",value:function(){return function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destruct",this).call(this)}},{key:"color",set:function(e){this._contourLineUniforms.color.value=new l.Color(e)},get:function(){return this._contourLineUniforms.color.value}},{key:"heightInterval",set:function(e){this._contourLineUniforms.heightInterval.value=e},get:function(){return this._contourLineUniforms.heightInterval.value}},{key:"lineWidth",set:function(e){this._contourLineUniforms.lineWidth.value=e},get:function(){return this._contourLineUniforms.lineWidth.value}},{key:"mapAlpha",set:function(e){this._contourLineUniforms.mapAlpha.value=e},get:function(){return this._contourLineUniforms.mapAlpha.value}}]),t}();t.default=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(0);var i=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=o.UniformsUtils.merge([o.ShaderLib.basic.uniforms,{alphaChannel:{type:"i",value:void 0===e.alphaChannel?1:e.alphaChannel}}]),n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{uniforms:r,vertexShader:a,fragmentShader:s}));return n.isMeshBasicMaterial=!0,n.color=new o.Color(16777215),n.map=null,n.lightMap=null,n.lightMapIntensity=1,n.aoMap=null,n.aoMapIntensity=1,n.specularMap=null,n.alphaMap=null,n.envMap=null,n.combine=o.MultiplyOperation,n.reflectivity=1,n.refractionRatio=.98,n.wireframe=!1,n.wireframeLinewidth=1,n.wireframeLinecap="round",n.wireframeLinejoin="round",n.skinning=!1,n.morphTargets=!1,n.lights=!1,n._useGeometryInstance=!1,n.setValues(e),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.ShaderMaterial),n(t,[{key:"alphaChannel",set:function(e){0===e||1===e||2===e||3===e?this.uniforms.alphaChannel.value=e:console.warn("only 0, 1, 2, 3 are valid values")},get:function(){return this.uniforms.alphaChannel.value}},{key:"useGeometryInstance",set:function(e){this._useGeometryInstance=e,this._useGeometryInstance?this.vertexShader="#define USE_GEOMETRY_INSTANCE]\n"+a:this.vertexShader=a,this.needsUpdate=!0},get:function(){return this._useGeometryInstance}}]),t}(),a="\n#ifdef USE_GEOMETRY_INSTANCE\n  attribute vec3 instancePosition;\n  attribute vec4 instanceQuaternion;\n  attribute vec3 instanceScale;\n  vec3 applyTRS( vec3 position, vec3 translation, vec4 quaternion, vec3 scale ) {\n  position *= scale;\n  position += 2.0 * cross( quaternion.xyz, cross( quaternion.xyz, position ) + quaternion.w * position );\n  return position + translation;\n  }\n#endif\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n  #include <uv_vertex>\n  #include <uv2_vertex>\n  #include <color_vertex>\n  #include <skinbase_vertex>\n  #ifdef USE_ENVMAP\n  #include <beginnormal_vertex>\n  #include <morphnormal_vertex>\n  #include <skinnormal_vertex>\n  #include <defaultnormal_vertex>\n  #endif\n\n  #ifdef USE_GEOMETRY_INSTANCE\n  vec3 transformed = applyTRS( position.xyz, instancePosition, instanceQuaternion, instanceScale );\n  #else\n  vec3 transformed = vec3( position );\n  #endif\n\n  #include <morphtarget_vertex>\n  #include <skinning_vertex>\n  #include <project_vertex>\n  #include <logdepthbuf_vertex>\n  #include <worldpos_vertex>\n  #include <clipping_planes_vertex>\n  #include <envmap_vertex>\n  #include <fog_vertex>\n}\n",s="\nuniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n  varying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n\n#ifdef USE_ALPHAMAP\n  uniform sampler2D alphaMap;\n  uniform int alphaChannel;\n#endif\n\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n  #include <clipping_planes_fragment>\n  vec4 diffuseColor = vec4( diffuse, opacity );\n  #include <logdepthbuf_fragment>\n  #include <map_fragment>\n  #include <color_fragment>\n\n  #ifdef USE_ALPHAMAP\n  vec4 alphaMapColor = texture2D( alphaMap, vUv );\n  float alphaMapAlpha = alphaMapColor.g;\n  alphaMapAlpha = alphaChannel == 0 ? alphaMapColor.r : alphaMapAlpha;\n  alphaMapAlpha = alphaChannel == 1 ? alphaMapColor.g : alphaMapAlpha;\n  alphaMapAlpha = alphaChannel == 2 ? alphaMapColor.b : alphaMapAlpha;\n  alphaMapAlpha = alphaChannel == 3 ? alphaMapColor.a : alphaMapAlpha;\n  diffuseColor.a *= alphaMapAlpha;\n  #endif\n\n  #include <alphatest_fragment>\n  #include <specularmap_fragment>\n  ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n  #ifdef USE_LIGHTMAP\n  reflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n  #else\n  reflectedLight.indirectDiffuse += vec3( 1.0 );\n  #endif\n  #include <aomap_fragment>\n  reflectedLight.indirectDiffuse *= diffuseColor.rgb;\n  vec3 outgoingLight = reflectedLight.indirectDiffuse;\n  #include <envmap_fragment>\n  gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n  #include <premultiplied_alpha_fragment>\n  #include <tonemapping_fragment>\n  #include <encodings_fragment>\n  #include <fog_fragment>\n}\n";t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.promiseFn=t.promiseFn,this.timer=t.timer,this.timeout=t.timeout,void 0!==t.promiseFn&&void 0!==this.timer&&void 0!==this.timeout?(this.processingTask=null,this.deferredTask=null,this.debug=t.debug||!1,this._running=null):console.error("RefreshQueue invalid construction.",t)}return n(e,[{key:"add",value:function(e){var t=this;null===this.processingTask?(this.processingTask=e,null!==this._running?this._running.then(function(){t._running=t._run()}):this._running=this._run()):null===this.deferredTask?this.deferredTask=e:null!==this.deferredTask?this.deferredTask=e:console.warn("RefreshQueue.add(): unknown condition")}},{key:"_run",value:function(){var e=this.debug;if(null===this.processingTask)return e&&console.log("no processingTask"),this._running=null,Promise.resolve();var t=this;return function(e,t){return Promise.race([e,new Promise(function(e,r){setTimeout(function(){r(new Error("Refresh task time out "+t))},t)})])}(this.promiseFn(this.processingTask),t.timeout).catch(function(r){return e&&console.warn("refresh task failed:",t.processingTask,r),Promise.resolve()}).then(function(){return t.processingTask=t.deferredTask,t.deferredTask=null,function(e){return new Promise(function(t,r){setTimeout(function(){t()},e)})}(t.timer)}).then(function(){return t._run()})}}]),e}();t.default=o},function(e,t,r){(function(t,r){e.exports=function(){"use strict";function e(e){return"function"==typeof e}function n(){var e=setTimeout;return function(){return e(o,1)}}function o(){for(var e=0;e<_;e+=2){var t=P[e],r=P[e+1];t(r),P[e]=void 0,P[e+1]=void 0}_=0}function i(e,t){var r=this,n=new this.constructor(s);void 0===n[M]&&m(n);var o=r._state;if(o){var i=arguments[o-1];A(function(){return y(o,n,i,r._result)})}else p(r,n,e,t);return n}function a(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=new this(s);return c(t,e),t}function s(){}function u(e){try{return e.then}catch(e){return B.error=e,B}}function l(t,r,n){r.constructor===t.constructor&&n===i&&r.constructor.resolve===a?function(e,t){t._state===j?h(e,t._result):t._state===L?d(e,t._result):p(t,void 0,function(t){return c(e,t)},function(t){return d(e,t)})}(t,r):n===B?(d(t,B.error),B.error=null):void 0===n?h(t,r):e(n)?function(e,t,r){A(function(e){var n=!1,o=function(e,t,r,n){try{e.call(t,r,n)}catch(e){return e}}(r,t,function(r){n||(n=!0,t!==r?c(e,r):h(e,r))},function(t){n||(n=!0,d(e,t))},e._label);!n&&o&&(n=!0,d(e,o))},e)}(t,r,n):h(t,r)}function c(e,t){e===t?d(e,new TypeError("You cannot resolve a promise with itself")):function(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}(t)?l(e,t,u(t)):h(e,t)}function f(e){e._onerror&&e._onerror(e._result),v(e)}function h(e,t){e._state===C&&(e._result=t,e._state=j,0!==e._subscribers.length&&A(v,e))}function d(e,t){e._state===C&&(e._state=L,e._result=t,A(f,e))}function p(e,t,r,n){var o=e._subscribers,i=o.length;e._onerror=null,o[i]=t,o[i+j]=r,o[i+L]=n,0===i&&e._state&&A(v,e)}function v(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var n=void 0,o=void 0,i=e._result,a=0;a<t.length;a+=3)n=t[a],o=t[a+r],n?y(r,n,o,i):o(i);e._subscribers.length=0}}function y(t,r,n,o){var i=e(n),a=void 0,s=void 0,u=void 0,l=void 0;if(i){if((a=function(e,t){try{return e(t)}catch(e){return B.error=e,B}}(n,o))===B?(l=!0,s=a.error,a.error=null):u=!0,r===a)return void d(r,new TypeError("A promises callback cannot return that same promise."))}else a=o,u=!0;r._state!==C||(i&&u?c(r,a):l?d(r,s):t===j?h(r,a):t===L&&d(r,a))}function m(e){e[M]=R++,e._state=void 0,e._result=void 0,e._subscribers=[]}var g=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},_=0,b=void 0,w=void 0,A=function(e,t){P[_]=e,P[_+1]=t,2===(_+=2)&&(w?w(o):S())},x="undefined"!=typeof window?window:void 0,k=x||{},T=k.MutationObserver||k.WebKitMutationObserver,O="undefined"==typeof self&&void 0!==t&&"[object process]"==={}.toString.call(t),E="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,P=new Array(1e3),S=void 0;S=O?function(){return t.nextTick(o)}:T?function(){var e=0,t=new T(o),r=document.createTextNode("");return t.observe(r,{characterData:!0}),function(){r.data=e=++e%2}}():E?function(){var e=new MessageChannel;return e.port1.onmessage=o,function(){return e.port2.postMessage(0)}}():void 0===x?function(){try{var e=Function("return this")().require("vertx");return void 0!==(b=e.runOnLoop||e.runOnContext)?function(){b(o)}:n()}catch(e){return n()}}():n();var M=Math.random().toString(36).substring(2),C=void 0,j=1,L=2,B={error:null},R=0,I=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(s),this.promise[M]||m(this.promise),g(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?h(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&h(this.promise,this._result))):d(this.promise,new Error("Array Methods must be provided an Array"))}return e.prototype._enumerate=function(e){for(var t=0;this._state===C&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var r=this._instanceConstructor,n=r.resolve;if(n===a){var o=u(e);if(o===i&&e._state!==C)this._settledAt(e._state,t,e._result);else if("function"!=typeof o)this._remaining--,this._result[t]=e;else if(r===D){var c=new r(s);l(c,e,o),this._willSettleAt(c,t)}else this._willSettleAt(new r(function(t){return t(e)}),t)}else this._willSettleAt(n(e),t)},e.prototype._settledAt=function(e,t,r){var n=this.promise;n._state===C&&(this._remaining--,e===L?d(n,r):this._result[t]=r),0===this._remaining&&h(n,this._result)},e.prototype._willSettleAt=function(e,t){var r=this;p(e,void 0,function(e){return r._settledAt(j,t,e)},function(e){return r._settledAt(L,t,e)})},e}(),D=function(){function t(e){this[M]=R++,this._result=this._state=void 0,this._subscribers=[],s!==e&&("function"!=typeof e&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof t?function(e,t){try{t(function(t){c(e,t)},function(t){d(e,t)})}catch(t){d(e,t)}}(this,e):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return t.prototype.catch=function(e){return this.then(null,e)},t.prototype.finally=function(t){var r=this,n=r.constructor;return e(t)?r.then(function(e){return n.resolve(t()).then(function(){return e})},function(e){return n.resolve(t()).then(function(){throw e})}):r.then(t,t)},t}();return D.prototype.then=i,D.all=function(e){return new I(this,e).promise},D.race=function(e){var t=this;return new t(g(e)?function(r,n){for(var o=e.length,i=0;i<o;i++)t.resolve(e[i]).then(r,n)}:function(e,t){return t(new TypeError("You must pass an array to race."))})},D.resolve=a,D.reject=function(e){var t=new this(s);return d(t,e),t},D._setScheduler=function(e){w=e},D._setAsap=function(e){A=e},D._asap=A,D.polyfill=function(){var e=void 0;if(void 0!==r)e=r;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=D},D.Promise=D,D.polyfill(),D}()}).call(this,r(116),r(117))},function(e,t){var r,n,o=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(r===setTimeout)return setTimeout(e,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(e){r=i}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var u,l=[],c=!1,f=-1;function h(){c&&u&&(c=!1,u.length?l=u.concat(l):f=-1,l.length&&d())}function d(){if(!c){var e=s(h);c=!0;for(var t=l.length;t;){for(u=l,l=[];++f<t;)u&&u[f].run();f=-1,t=l.length}u=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function v(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new p(e,t)),1!==l.length||c||s(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=v,o.addListener=v,o.once=v,o.off=v,o.removeListener=v,o.removeAllListeners=v,o.emit=v,o.prependListener=v,o.prependOnceListener=v,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r}])});